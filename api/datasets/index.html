
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="HeartKit, perform AI-based heart monitoring tasks">
      
      
      
      
        <link rel="prev" href="../../tutorials/heartkit-demo/">
      
      
        <link rel="next" href="../models/">
      
      <link rel="icon" href="../../assets/favicon.png">
      <meta name="generator" content="mkdocs-1.5.2, mkdocs-material-9.1.21">
    
    
      
        <title>Datasets - HeartKit</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.eebd395e.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ecc896b0.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../css/mkdocstrings.css">
    
      <link rel="stylesheet" href="../../css/termynal.css">
    
      <link rel="stylesheet" href="../../css/custom.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="indigo">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#datasets" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="HeartKit" class="md-header__button md-logo" aria-label="HeartKit" data-md-component="logo">
      
  <img src="../../assets/logo-white.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            HeartKit
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Datasets
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
          
            
            
            
            <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="indigo"  aria-label="Use system theme"  type="radio" name="__palette" id="__palette_1">
            
              <label class="md-header__button md-icon" title="Use system theme" for="__palette_3" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9h-1.9M20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69m-9.15 3.96h2.3L12 9l-1.15 3.65Z"/></svg>
              </label>
            
          
            
            
            
            <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="indigo"  aria-label="Switch to light theme"  type="radio" name="__palette" id="__palette_2">
            
              <label class="md-header__button md-icon" title="Switch to light theme" for="__palette_1" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
              </label>
            
          
            
            
            
            <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="blue" data-md-color-accent="indigo"  aria-label="Switch to dark theme"  type="radio" name="__palette" id="__palette_3">
            
              <label class="md-header__button md-icon" title="Switch to dark theme" for="__palette_2" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
              </label>
            
          
        </form>
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/AmbiqAI/heartkit" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg>
  </div>
  <div class="md-source__repository">
    AmbiqAI/hearkit
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="HeartKit" class="md-nav__button md-logo" aria-label="HeartKit" data-md-component="logo">
      
  <img src="../../assets/logo-white.png" alt="logo">

    </a>
    HeartKit
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/AmbiqAI/heartkit" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg>
  </div>
  <div class="md-source__repository">
    AmbiqAI/hearkit
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        HeartKit
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../overview/" class="md-nav__link">
        Overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../datasets/" class="md-nav__link">
        Datasets
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/" class="md-nav__link">
        Architecture
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../results/" class="md-nav__link">
        Results
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
      
      
      
        <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
          Tutorials
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Tutorials
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/evb-setup/" class="md-nav__link">
        EVB Setup
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/arrhythmia-demo/" class="md-nav__link">
        Arrhythmia Demo
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/heartkit-demo/" class="md-nav__link">
        HeartKit Demo
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" checked>
      
      
      
        <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
          API
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          API
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Datasets
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Datasets
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#heartkit.datasets.defines" class="md-nav__link">
    defines
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#heartkit.datasets.download" class="md-nav__link">
    download
  </a>
  
    <nav class="md-nav" aria-label="download">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.download.download_datasets" class="md-nav__link">
    download_datasets()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#heartkit.datasets.augmentation" class="md-nav__link">
    augmentation
  </a>
  
    <nav class="md-nav" aria-label="augmentation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.augmentation.augment_pipeline" class="md-nav__link">
    augment_pipeline()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.augmentation.baseline_wander" class="md-nav__link">
    baseline_wander()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.augmentation.emg_noise" class="md-nav__link">
    emg_noise()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.augmentation.lead_noise" class="md-nav__link">
    lead_noise()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.augmentation.random_scaling" class="md-nav__link">
    random_scaling()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#heartkit.datasets.preprocess" class="md-nav__link">
    preprocess
  </a>
  
    <nav class="md-nav" aria-label="preprocess">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.preprocess.filter_signal" class="md-nav__link">
    filter_signal()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.preprocess.generate_arm_biquad_sos" class="md-nav__link">
    generate_arm_biquad_sos()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.preprocess.get_butter_bp_sos" class="md-nav__link">
    get_butter_bp_sos()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.preprocess.normalize_signal" class="md-nav__link">
    normalize_signal()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.preprocess.pad_signal" class="md-nav__link">
    pad_signal()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.preprocess.preprocess_signal" class="md-nav__link">
    preprocess_signal()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.preprocess.resample_signal" class="md-nav__link">
    resample_signal()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.preprocess.rolling_standardize" class="md-nav__link">
    rolling_standardize()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.preprocess.running_mean_std" class="md-nav__link">
    running_mean_std()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#heartkit.datasets.icentia11k" class="md-nav__link">
    icentia11k
  </a>
  
    <nav class="md-nav" aria-label="icentia11k">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.icentia11k.IcentiaBeat" class="md-nav__link">
    IcentiaBeat
  </a>
  
    <nav class="md-nav" aria-label="IcentiaBeat">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.icentia11k.IcentiaBeat.hi_priority" class="md-nav__link">
    hi_priority()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.icentia11k.IcentiaBeat.lo_priority" class="md-nav__link">
    lo_priority()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.icentia11k.IcentiaDataset" class="md-nav__link">
    IcentiaDataset
  </a>
  
    <nav class="md-nav" aria-label="IcentiaDataset">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.icentia11k.IcentiaDataset.arr_rhythm_patients" class="md-nav__link">
    arr_rhythm_patients
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.icentia11k.IcentiaDataset.mean" class="md-nav__link">
    mean
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.icentia11k.IcentiaDataset.patient_ids" class="md-nav__link">
    patient_ids
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.icentia11k.IcentiaDataset.sampling_rate" class="md-nav__link">
    sampling_rate
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.icentia11k.IcentiaDataset.std" class="md-nav__link">
    std
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.icentia11k.IcentiaDataset.beat_data_generator" class="md-nav__link">
    beat_data_generator()
  </a>
  
    <nav class="md-nav" aria-label="beat_data_generator()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.icentia11k.IcentiaDataset.beat_data_generator--samples-per-patient-defaults-to-1" class="md-nav__link">
    samples per patient. Defaults to 1.
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.icentia11k.IcentiaDataset.download" class="md-nav__link">
    download()
  </a>
  
    <nav class="md-nav" aria-label="download()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.icentia11k.IcentiaDataset.download--parallel-workers-defaults-to-none" class="md-nav__link">
    parallel workers. Defaults to None.
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.icentia11k.IcentiaDataset.download_raw_dataset" class="md-nav__link">
    download_raw_dataset()
  </a>
  
    <nav class="md-nav" aria-label="download_raw_dataset()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.icentia11k.IcentiaDataset.download_raw_dataset--parallel-workers-defaults-to-oscpu_count" class="md-nav__link">
    parallel workers. Defaults to os.cpu_count().
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.icentia11k.IcentiaDataset.get_complete_beats" class="md-nav__link">
    get_complete_beats()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.icentia11k.IcentiaDataset.get_rhythm_statistics" class="md-nav__link">
    get_rhythm_statistics()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.icentia11k.IcentiaDataset.get_test_patient_ids" class="md-nav__link">
    get_test_patient_ids()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.icentia11k.IcentiaDataset.get_train_patient_ids" class="md-nav__link">
    get_train_patient_ids()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.icentia11k.IcentiaDataset.heart_rate_data_generator" class="md-nav__link">
    heart_rate_data_generator()
  </a>
  
    <nav class="md-nav" aria-label="heart_rate_data_generator()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.icentia11k.IcentiaDataset.heart_rate_data_generator--samples-per-patient-defaults-to-1" class="md-nav__link">
    samples per patient. Defaults to 1.
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.icentia11k.IcentiaDataset.random_patient_generator" class="md-nav__link">
    random_patient_generator()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.icentia11k.IcentiaDataset.rhythm_data_generator" class="md-nav__link">
    rhythm_data_generator()
  </a>
  
    <nav class="md-nav" aria-label="rhythm_data_generator()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.icentia11k.IcentiaDataset.rhythm_data_generator--samples-per-patient-defaults-to-1" class="md-nav__link">
    samples per patient. Defaults to 1.
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.icentia11k.IcentiaDataset.signal_generator" class="md-nav__link">
    signal_generator()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.icentia11k.IcentiaDataset.task_data_generator" class="md-nav__link">
    task_data_generator()
  </a>
  
    <nav class="md-nav" aria-label="task_data_generator()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.icentia11k.IcentiaDataset.task_data_generator--samples-per-patient-defaults-to-1" class="md-nav__link">
    samples per patient. Defaults to 1.
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.icentia11k.IcentiaDataset.uniform_patient_generator" class="md-nav__link">
    uniform_patient_generator()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.icentia11k.IcentiaHeartRate" class="md-nav__link">
    IcentiaHeartRate
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.icentia11k.IcentiaRhythm" class="md-nav__link">
    IcentiaRhythm
  </a>
  
    <nav class="md-nav" aria-label="IcentiaRhythm">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.icentia11k.IcentiaRhythm.hi_priority" class="md-nav__link">
    hi_priority()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.icentia11k.IcentiaRhythm.lo_priority" class="md-nav__link">
    lo_priority()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#heartkit.datasets.ludb" class="md-nav__link">
    ludb
  </a>
  
    <nav class="md-nav" aria-label="ludb">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.ludb.LudbDataset" class="md-nav__link">
    LudbDataset
  </a>
  
    <nav class="md-nav" aria-label="LudbDataset">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.ludb.LudbDataset.mean" class="md-nav__link">
    mean
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.ludb.LudbDataset.patient_ids" class="md-nav__link">
    patient_ids
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.ludb.LudbDataset.sampling_rate" class="md-nav__link">
    sampling_rate
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.ludb.LudbDataset.std" class="md-nav__link">
    std
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.ludb.LudbDataset.convert_dataset_zip_to_hdf5" class="md-nav__link">
    convert_dataset_zip_to_hdf5()
  </a>
  
    <nav class="md-nav" aria-label="convert_dataset_zip_to_hdf5()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.ludb.LudbDataset.convert_dataset_zip_to_hdf5--parallel-workers-defaults-to-oscpu_count" class="md-nav__link">
    parallel workers. Defaults to os.cpu_count().
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.ludb.LudbDataset.convert_pt_wfdb_to_hdf5" class="md-nav__link">
    convert_pt_wfdb_to_hdf5()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.ludb.LudbDataset.download" class="md-nav__link">
    download()
  </a>
  
    <nav class="md-nav" aria-label="download()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.ludb.LudbDataset.download--parallel-workers-defaults-to-none" class="md-nav__link">
    parallel workers. Defaults to None.
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.ludb.LudbDataset.get_patient_data_segments" class="md-nav__link">
    get_patient_data_segments()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.ludb.LudbDataset.get_test_patient_ids" class="md-nav__link">
    get_test_patient_ids()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.ludb.LudbDataset.get_train_patient_ids" class="md-nav__link">
    get_train_patient_ids()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.ludb.LudbDataset.segmentation_generator" class="md-nav__link">
    segmentation_generator()
  </a>
  
    <nav class="md-nav" aria-label="segmentation_generator()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.ludb.LudbDataset.segmentation_generator--samples-per-patient-defaults-to-1" class="md-nav__link">
    samples per patient. Defaults to 1.
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.ludb.LudbDataset.signal_generator" class="md-nav__link">
    signal_generator()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.ludb.LudbDataset.task_data_generator" class="md-nav__link">
    task_data_generator()
  </a>
  
    <nav class="md-nav" aria-label="task_data_generator()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.ludb.LudbDataset.task_data_generator--samples-per-patient-defaults-to-1" class="md-nav__link">
    samples per patient. Defaults to 1.
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.ludb.LudbDataset.uniform_patient_generator" class="md-nav__link">
    uniform_patient_generator()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#heartkit.datasets.qtdb" class="md-nav__link">
    qtdb
  </a>
  
    <nav class="md-nav" aria-label="qtdb">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.qtdb.QtdbDataset" class="md-nav__link">
    QtdbDataset
  </a>
  
    <nav class="md-nav" aria-label="QtdbDataset">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.qtdb.QtdbDataset.mean" class="md-nav__link">
    mean
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.qtdb.QtdbDataset.patient_ids" class="md-nav__link">
    patient_ids
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.qtdb.QtdbDataset.sampling_rate" class="md-nav__link">
    sampling_rate
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.qtdb.QtdbDataset.std" class="md-nav__link">
    std
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.qtdb.QtdbDataset.convert_dataset_zip_to_hdf5" class="md-nav__link">
    convert_dataset_zip_to_hdf5()
  </a>
  
    <nav class="md-nav" aria-label="convert_dataset_zip_to_hdf5()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.qtdb.QtdbDataset.convert_dataset_zip_to_hdf5--parallel-workers-defaults-to-oscpu_count" class="md-nav__link">
    parallel workers. Defaults to os.cpu_count().
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.qtdb.QtdbDataset.convert_pt_wfdb_to_hdf5" class="md-nav__link">
    convert_pt_wfdb_to_hdf5()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.qtdb.QtdbDataset.download" class="md-nav__link">
    download()
  </a>
  
    <nav class="md-nav" aria-label="download()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.qtdb.QtdbDataset.download--parallel-workers-defaults-to-none" class="md-nav__link">
    parallel workers. Defaults to None.
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.qtdb.QtdbDataset.get_patient_data_segments" class="md-nav__link">
    get_patient_data_segments()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.qtdb.QtdbDataset.get_test_patient_ids" class="md-nav__link">
    get_test_patient_ids()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.qtdb.QtdbDataset.get_train_patient_ids" class="md-nav__link">
    get_train_patient_ids()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.qtdb.QtdbDataset.segmentation_generator" class="md-nav__link">
    segmentation_generator()
  </a>
  
    <nav class="md-nav" aria-label="segmentation_generator()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.qtdb.QtdbDataset.segmentation_generator--samples-per-patient-defaults-to-1" class="md-nav__link">
    samples per patient. Defaults to 1.
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.qtdb.QtdbDataset.signal_generator" class="md-nav__link">
    signal_generator()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.qtdb.QtdbDataset.task_data_generator" class="md-nav__link">
    task_data_generator()
  </a>
  
    <nav class="md-nav" aria-label="task_data_generator()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.qtdb.QtdbDataset.task_data_generator--samples-per-patient-defaults-to-1" class="md-nav__link">
    samples per patient. Defaults to 1.
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.qtdb.QtdbDataset.uniform_patient_generator" class="md-nav__link">
    uniform_patient_generator()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#heartkit.datasets.synthetic" class="md-nav__link">
    synthetic
  </a>
  
    <nav class="md-nav" aria-label="synthetic">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.synthetic.SyntheticDataset" class="md-nav__link">
    SyntheticDataset
  </a>
  
    <nav class="md-nav" aria-label="SyntheticDataset">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.synthetic.synthetic_dataset.SyntheticDataset.cachable" class="md-nav__link">
    cachable
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.synthetic.synthetic_dataset.SyntheticDataset.mean" class="md-nav__link">
    mean
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.synthetic.synthetic_dataset.SyntheticDataset.patient_ids" class="md-nav__link">
    patient_ids
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.synthetic.synthetic_dataset.SyntheticDataset.sampling_rate" class="md-nav__link">
    sampling_rate
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.synthetic.synthetic_dataset.SyntheticDataset.std" class="md-nav__link">
    std
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.synthetic.synthetic_dataset.SyntheticDataset.download" class="md-nav__link">
    download()
  </a>
  
    <nav class="md-nav" aria-label="download()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.synthetic.synthetic_dataset.SyntheticDataset.download--parallel-workers-defaults-to-none" class="md-nav__link">
    parallel workers. Defaults to None.
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.synthetic.synthetic_dataset.SyntheticDataset.get_test_patient_ids" class="md-nav__link">
    get_test_patient_ids()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.synthetic.synthetic_dataset.SyntheticDataset.get_train_patient_ids" class="md-nav__link">
    get_train_patient_ids()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.synthetic.synthetic_dataset.SyntheticDataset.segmentation_generator" class="md-nav__link">
    segmentation_generator()
  </a>
  
    <nav class="md-nav" aria-label="segmentation_generator()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.synthetic.synthetic_dataset.SyntheticDataset.segmentation_generator--samples-per-patient-defaults-to-1" class="md-nav__link">
    samples per patient. Defaults to 1.
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.synthetic.synthetic_dataset.SyntheticDataset.signal_generator" class="md-nav__link">
    signal_generator()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.synthetic.synthetic_dataset.SyntheticDataset.task_data_generator" class="md-nav__link">
    task_data_generator()
  </a>
  
    <nav class="md-nav" aria-label="task_data_generator()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.synthetic.synthetic_dataset.SyntheticDataset.task_data_generator--samples-per-patient-defaults-to-1" class="md-nav__link">
    samples per patient. Defaults to 1.
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.synthetic.synthetic_dataset.SyntheticDataset.uniform_patient_generator" class="md-nav__link">
    uniform_patient_generator()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../models/" class="md-nav__link">
        Models
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#heartkit.datasets.defines" class="md-nav__link">
    defines
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#heartkit.datasets.download" class="md-nav__link">
    download
  </a>
  
    <nav class="md-nav" aria-label="download">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.download.download_datasets" class="md-nav__link">
    download_datasets()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#heartkit.datasets.augmentation" class="md-nav__link">
    augmentation
  </a>
  
    <nav class="md-nav" aria-label="augmentation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.augmentation.augment_pipeline" class="md-nav__link">
    augment_pipeline()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.augmentation.baseline_wander" class="md-nav__link">
    baseline_wander()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.augmentation.emg_noise" class="md-nav__link">
    emg_noise()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.augmentation.lead_noise" class="md-nav__link">
    lead_noise()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.augmentation.random_scaling" class="md-nav__link">
    random_scaling()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#heartkit.datasets.preprocess" class="md-nav__link">
    preprocess
  </a>
  
    <nav class="md-nav" aria-label="preprocess">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.preprocess.filter_signal" class="md-nav__link">
    filter_signal()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.preprocess.generate_arm_biquad_sos" class="md-nav__link">
    generate_arm_biquad_sos()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.preprocess.get_butter_bp_sos" class="md-nav__link">
    get_butter_bp_sos()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.preprocess.normalize_signal" class="md-nav__link">
    normalize_signal()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.preprocess.pad_signal" class="md-nav__link">
    pad_signal()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.preprocess.preprocess_signal" class="md-nav__link">
    preprocess_signal()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.preprocess.resample_signal" class="md-nav__link">
    resample_signal()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.preprocess.rolling_standardize" class="md-nav__link">
    rolling_standardize()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.preprocess.running_mean_std" class="md-nav__link">
    running_mean_std()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#heartkit.datasets.icentia11k" class="md-nav__link">
    icentia11k
  </a>
  
    <nav class="md-nav" aria-label="icentia11k">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.icentia11k.IcentiaBeat" class="md-nav__link">
    IcentiaBeat
  </a>
  
    <nav class="md-nav" aria-label="IcentiaBeat">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.icentia11k.IcentiaBeat.hi_priority" class="md-nav__link">
    hi_priority()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.icentia11k.IcentiaBeat.lo_priority" class="md-nav__link">
    lo_priority()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.icentia11k.IcentiaDataset" class="md-nav__link">
    IcentiaDataset
  </a>
  
    <nav class="md-nav" aria-label="IcentiaDataset">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.icentia11k.IcentiaDataset.arr_rhythm_patients" class="md-nav__link">
    arr_rhythm_patients
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.icentia11k.IcentiaDataset.mean" class="md-nav__link">
    mean
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.icentia11k.IcentiaDataset.patient_ids" class="md-nav__link">
    patient_ids
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.icentia11k.IcentiaDataset.sampling_rate" class="md-nav__link">
    sampling_rate
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.icentia11k.IcentiaDataset.std" class="md-nav__link">
    std
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.icentia11k.IcentiaDataset.beat_data_generator" class="md-nav__link">
    beat_data_generator()
  </a>
  
    <nav class="md-nav" aria-label="beat_data_generator()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.icentia11k.IcentiaDataset.beat_data_generator--samples-per-patient-defaults-to-1" class="md-nav__link">
    samples per patient. Defaults to 1.
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.icentia11k.IcentiaDataset.download" class="md-nav__link">
    download()
  </a>
  
    <nav class="md-nav" aria-label="download()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.icentia11k.IcentiaDataset.download--parallel-workers-defaults-to-none" class="md-nav__link">
    parallel workers. Defaults to None.
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.icentia11k.IcentiaDataset.download_raw_dataset" class="md-nav__link">
    download_raw_dataset()
  </a>
  
    <nav class="md-nav" aria-label="download_raw_dataset()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.icentia11k.IcentiaDataset.download_raw_dataset--parallel-workers-defaults-to-oscpu_count" class="md-nav__link">
    parallel workers. Defaults to os.cpu_count().
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.icentia11k.IcentiaDataset.get_complete_beats" class="md-nav__link">
    get_complete_beats()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.icentia11k.IcentiaDataset.get_rhythm_statistics" class="md-nav__link">
    get_rhythm_statistics()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.icentia11k.IcentiaDataset.get_test_patient_ids" class="md-nav__link">
    get_test_patient_ids()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.icentia11k.IcentiaDataset.get_train_patient_ids" class="md-nav__link">
    get_train_patient_ids()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.icentia11k.IcentiaDataset.heart_rate_data_generator" class="md-nav__link">
    heart_rate_data_generator()
  </a>
  
    <nav class="md-nav" aria-label="heart_rate_data_generator()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.icentia11k.IcentiaDataset.heart_rate_data_generator--samples-per-patient-defaults-to-1" class="md-nav__link">
    samples per patient. Defaults to 1.
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.icentia11k.IcentiaDataset.random_patient_generator" class="md-nav__link">
    random_patient_generator()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.icentia11k.IcentiaDataset.rhythm_data_generator" class="md-nav__link">
    rhythm_data_generator()
  </a>
  
    <nav class="md-nav" aria-label="rhythm_data_generator()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.icentia11k.IcentiaDataset.rhythm_data_generator--samples-per-patient-defaults-to-1" class="md-nav__link">
    samples per patient. Defaults to 1.
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.icentia11k.IcentiaDataset.signal_generator" class="md-nav__link">
    signal_generator()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.icentia11k.IcentiaDataset.task_data_generator" class="md-nav__link">
    task_data_generator()
  </a>
  
    <nav class="md-nav" aria-label="task_data_generator()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.icentia11k.IcentiaDataset.task_data_generator--samples-per-patient-defaults-to-1" class="md-nav__link">
    samples per patient. Defaults to 1.
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.icentia11k.IcentiaDataset.uniform_patient_generator" class="md-nav__link">
    uniform_patient_generator()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.icentia11k.IcentiaHeartRate" class="md-nav__link">
    IcentiaHeartRate
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.icentia11k.IcentiaRhythm" class="md-nav__link">
    IcentiaRhythm
  </a>
  
    <nav class="md-nav" aria-label="IcentiaRhythm">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.icentia11k.IcentiaRhythm.hi_priority" class="md-nav__link">
    hi_priority()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.icentia11k.IcentiaRhythm.lo_priority" class="md-nav__link">
    lo_priority()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#heartkit.datasets.ludb" class="md-nav__link">
    ludb
  </a>
  
    <nav class="md-nav" aria-label="ludb">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.ludb.LudbDataset" class="md-nav__link">
    LudbDataset
  </a>
  
    <nav class="md-nav" aria-label="LudbDataset">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.ludb.LudbDataset.mean" class="md-nav__link">
    mean
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.ludb.LudbDataset.patient_ids" class="md-nav__link">
    patient_ids
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.ludb.LudbDataset.sampling_rate" class="md-nav__link">
    sampling_rate
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.ludb.LudbDataset.std" class="md-nav__link">
    std
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.ludb.LudbDataset.convert_dataset_zip_to_hdf5" class="md-nav__link">
    convert_dataset_zip_to_hdf5()
  </a>
  
    <nav class="md-nav" aria-label="convert_dataset_zip_to_hdf5()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.ludb.LudbDataset.convert_dataset_zip_to_hdf5--parallel-workers-defaults-to-oscpu_count" class="md-nav__link">
    parallel workers. Defaults to os.cpu_count().
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.ludb.LudbDataset.convert_pt_wfdb_to_hdf5" class="md-nav__link">
    convert_pt_wfdb_to_hdf5()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.ludb.LudbDataset.download" class="md-nav__link">
    download()
  </a>
  
    <nav class="md-nav" aria-label="download()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.ludb.LudbDataset.download--parallel-workers-defaults-to-none" class="md-nav__link">
    parallel workers. Defaults to None.
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.ludb.LudbDataset.get_patient_data_segments" class="md-nav__link">
    get_patient_data_segments()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.ludb.LudbDataset.get_test_patient_ids" class="md-nav__link">
    get_test_patient_ids()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.ludb.LudbDataset.get_train_patient_ids" class="md-nav__link">
    get_train_patient_ids()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.ludb.LudbDataset.segmentation_generator" class="md-nav__link">
    segmentation_generator()
  </a>
  
    <nav class="md-nav" aria-label="segmentation_generator()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.ludb.LudbDataset.segmentation_generator--samples-per-patient-defaults-to-1" class="md-nav__link">
    samples per patient. Defaults to 1.
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.ludb.LudbDataset.signal_generator" class="md-nav__link">
    signal_generator()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.ludb.LudbDataset.task_data_generator" class="md-nav__link">
    task_data_generator()
  </a>
  
    <nav class="md-nav" aria-label="task_data_generator()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.ludb.LudbDataset.task_data_generator--samples-per-patient-defaults-to-1" class="md-nav__link">
    samples per patient. Defaults to 1.
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.ludb.LudbDataset.uniform_patient_generator" class="md-nav__link">
    uniform_patient_generator()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#heartkit.datasets.qtdb" class="md-nav__link">
    qtdb
  </a>
  
    <nav class="md-nav" aria-label="qtdb">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.qtdb.QtdbDataset" class="md-nav__link">
    QtdbDataset
  </a>
  
    <nav class="md-nav" aria-label="QtdbDataset">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.qtdb.QtdbDataset.mean" class="md-nav__link">
    mean
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.qtdb.QtdbDataset.patient_ids" class="md-nav__link">
    patient_ids
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.qtdb.QtdbDataset.sampling_rate" class="md-nav__link">
    sampling_rate
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.qtdb.QtdbDataset.std" class="md-nav__link">
    std
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.qtdb.QtdbDataset.convert_dataset_zip_to_hdf5" class="md-nav__link">
    convert_dataset_zip_to_hdf5()
  </a>
  
    <nav class="md-nav" aria-label="convert_dataset_zip_to_hdf5()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.qtdb.QtdbDataset.convert_dataset_zip_to_hdf5--parallel-workers-defaults-to-oscpu_count" class="md-nav__link">
    parallel workers. Defaults to os.cpu_count().
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.qtdb.QtdbDataset.convert_pt_wfdb_to_hdf5" class="md-nav__link">
    convert_pt_wfdb_to_hdf5()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.qtdb.QtdbDataset.download" class="md-nav__link">
    download()
  </a>
  
    <nav class="md-nav" aria-label="download()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.qtdb.QtdbDataset.download--parallel-workers-defaults-to-none" class="md-nav__link">
    parallel workers. Defaults to None.
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.qtdb.QtdbDataset.get_patient_data_segments" class="md-nav__link">
    get_patient_data_segments()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.qtdb.QtdbDataset.get_test_patient_ids" class="md-nav__link">
    get_test_patient_ids()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.qtdb.QtdbDataset.get_train_patient_ids" class="md-nav__link">
    get_train_patient_ids()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.qtdb.QtdbDataset.segmentation_generator" class="md-nav__link">
    segmentation_generator()
  </a>
  
    <nav class="md-nav" aria-label="segmentation_generator()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.qtdb.QtdbDataset.segmentation_generator--samples-per-patient-defaults-to-1" class="md-nav__link">
    samples per patient. Defaults to 1.
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.qtdb.QtdbDataset.signal_generator" class="md-nav__link">
    signal_generator()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.qtdb.QtdbDataset.task_data_generator" class="md-nav__link">
    task_data_generator()
  </a>
  
    <nav class="md-nav" aria-label="task_data_generator()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.qtdb.QtdbDataset.task_data_generator--samples-per-patient-defaults-to-1" class="md-nav__link">
    samples per patient. Defaults to 1.
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.qtdb.QtdbDataset.uniform_patient_generator" class="md-nav__link">
    uniform_patient_generator()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#heartkit.datasets.synthetic" class="md-nav__link">
    synthetic
  </a>
  
    <nav class="md-nav" aria-label="synthetic">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.synthetic.SyntheticDataset" class="md-nav__link">
    SyntheticDataset
  </a>
  
    <nav class="md-nav" aria-label="SyntheticDataset">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.synthetic.synthetic_dataset.SyntheticDataset.cachable" class="md-nav__link">
    cachable
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.synthetic.synthetic_dataset.SyntheticDataset.mean" class="md-nav__link">
    mean
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.synthetic.synthetic_dataset.SyntheticDataset.patient_ids" class="md-nav__link">
    patient_ids
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.synthetic.synthetic_dataset.SyntheticDataset.sampling_rate" class="md-nav__link">
    sampling_rate
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.synthetic.synthetic_dataset.SyntheticDataset.std" class="md-nav__link">
    std
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.synthetic.synthetic_dataset.SyntheticDataset.download" class="md-nav__link">
    download()
  </a>
  
    <nav class="md-nav" aria-label="download()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.synthetic.synthetic_dataset.SyntheticDataset.download--parallel-workers-defaults-to-none" class="md-nav__link">
    parallel workers. Defaults to None.
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.synthetic.synthetic_dataset.SyntheticDataset.get_test_patient_ids" class="md-nav__link">
    get_test_patient_ids()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.synthetic.synthetic_dataset.SyntheticDataset.get_train_patient_ids" class="md-nav__link">
    get_train_patient_ids()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.synthetic.synthetic_dataset.SyntheticDataset.segmentation_generator" class="md-nav__link">
    segmentation_generator()
  </a>
  
    <nav class="md-nav" aria-label="segmentation_generator()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.synthetic.synthetic_dataset.SyntheticDataset.segmentation_generator--samples-per-patient-defaults-to-1" class="md-nav__link">
    samples per patient. Defaults to 1.
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.synthetic.synthetic_dataset.SyntheticDataset.signal_generator" class="md-nav__link">
    signal_generator()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.synthetic.synthetic_dataset.SyntheticDataset.task_data_generator" class="md-nav__link">
    task_data_generator()
  </a>
  
    <nav class="md-nav" aria-label="task_data_generator()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.synthetic.synthetic_dataset.SyntheticDataset.task_data_generator--samples-per-patient-defaults-to-1" class="md-nav__link">
    samples per patient. Defaults to 1.
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heartkit.datasets.synthetic.synthetic_dataset.SyntheticDataset.uniform_patient_generator" class="md-nav__link">
    uniform_patient_generator()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="datasets">Datasets</h1>
<p>See <a href="../../datasets/">Datasets</a> for information about available datasets.</p>


<div class="doc doc-object doc-module">



<h2 id="heartkit.datasets.defines" class="doc doc-heading">
          <code>heartkit.datasets.defines</code>


</h2>

  <div class="doc doc-contents first">

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="heartkit.datasets.download" class="doc doc-heading">
          <code>heartkit.datasets.download</code>


</h2>

  <div class="doc doc-contents first">

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h3 id="heartkit.datasets.download.download_datasets" class="doc doc-heading">
<code class="highlight language-python"><span class="n">download_datasets</span><span class="p">(</span><span class="n">params</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Download all specified datasets.</p>

  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b>params</b>
            (<code><span title="heartkit.defines.HeartDownloadParams">HeartDownloadParams</span></code>)
        – <p>Download parameters</p>
      </li>
  </ul>

      <details class="quote">
        <summary>Source code in <code>heartkit/datasets/download.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-10">10</a></span>
<span class="normal"><a href="#__codelineno-0-11">11</a></span>
<span class="normal"><a href="#__codelineno-0-12">12</a></span>
<span class="normal"><a href="#__codelineno-0-13">13</a></span>
<span class="normal"><a href="#__codelineno-0-14">14</a></span>
<span class="normal"><a href="#__codelineno-0-15">15</a></span>
<span class="normal"><a href="#__codelineno-0-16">16</a></span>
<span class="normal"><a href="#__codelineno-0-17">17</a></span>
<span class="normal"><a href="#__codelineno-0-18">18</a></span>
<span class="normal"><a href="#__codelineno-0-19">19</a></span>
<span class="normal"><a href="#__codelineno-0-20">20</a></span>
<span class="normal"><a href="#__codelineno-0-21">21</a></span>
<span class="normal"><a href="#__codelineno-0-22">22</a></span>
<span class="normal"><a href="#__codelineno-0-23">23</a></span>
<span class="normal"><a href="#__codelineno-0-24">24</a></span>
<span class="normal"><a href="#__codelineno-0-25">25</a></span>
<span class="normal"><a href="#__codelineno-0-26">26</a></span>
<span class="normal"><a href="#__codelineno-0-27">27</a></span>
<span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-10" name="__codelineno-0-10"></a><span class="k">def</span> <span class="nf">download_datasets</span><span class="p">(</span><span class="n">params</span><span class="p">:</span> <span class="n">HeartDownloadParams</span><span class="p">):</span>
<a id="__codelineno-0-11" name="__codelineno-0-11"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Download all specified datasets.</span>
<a id="__codelineno-0-12" name="__codelineno-0-12"></a>
<a id="__codelineno-0-13" name="__codelineno-0-13"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-14" name="__codelineno-0-14"></a><span class="sd">        params (HeartDownloadParams): Download parameters</span>
<a id="__codelineno-0-15" name="__codelineno-0-15"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-16" name="__codelineno-0-16"></a>    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">ds_path</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-17" name="__codelineno-0-17"></a>
<a id="__codelineno-0-18" name="__codelineno-0-18"></a>    <span class="k">if</span> <span class="s2">&quot;icentia11k&quot;</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">datasets</span><span class="p">:</span>
<a id="__codelineno-0-19" name="__codelineno-0-19"></a>        <span class="n">IcentiaDataset</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">ds_path</span><span class="p">))</span><span class="o">.</span><span class="n">download</span><span class="p">(</span>
<a id="__codelineno-0-20" name="__codelineno-0-20"></a>            <span class="n">num_workers</span><span class="o">=</span><span class="n">params</span><span class="o">.</span><span class="n">data_parallelism</span><span class="p">,</span>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a>            <span class="n">force</span><span class="o">=</span><span class="n">params</span><span class="o">.</span><span class="n">force</span><span class="p">,</span>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a>        <span class="p">)</span>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a>    <span class="k">if</span> <span class="s2">&quot;ludb&quot;</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">datasets</span><span class="p">:</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a>        <span class="n">LudbDataset</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">ds_path</span><span class="p">))</span><span class="o">.</span><span class="n">download</span><span class="p">(</span>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a>            <span class="n">num_workers</span><span class="o">=</span><span class="n">params</span><span class="o">.</span><span class="n">data_parallelism</span><span class="p">,</span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a>            <span class="n">force</span><span class="o">=</span><span class="n">params</span><span class="o">.</span><span class="n">force</span><span class="p">,</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a>        <span class="p">)</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a>    <span class="k">if</span> <span class="s2">&quot;qtdb&quot;</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">datasets</span><span class="p">:</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a>        <span class="n">QtdbDataset</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">ds_path</span><span class="p">))</span><span class="o">.</span><span class="n">download</span><span class="p">(</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a>            <span class="n">num_workers</span><span class="o">=</span><span class="n">params</span><span class="o">.</span><span class="n">data_parallelism</span><span class="p">,</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a>            <span class="n">force</span><span class="o">=</span><span class="n">params</span><span class="o">.</span><span class="n">force</span><span class="p">,</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a>        <span class="p">)</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a>    <span class="k">if</span> <span class="s2">&quot;ptbxl&quot;</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">datasets</span><span class="p">:</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a>        <span class="n">PtbxlDataset</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">ds_path</span><span class="p">))</span><span class="o">.</span><span class="n">download</span><span class="p">(</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a>            <span class="n">num_workers</span><span class="o">=</span><span class="n">params</span><span class="o">.</span><span class="n">data_parallelism</span><span class="p">,</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a>            <span class="n">force</span><span class="o">=</span><span class="n">params</span><span class="o">.</span><span class="n">force</span><span class="p">,</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a>        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="heartkit.datasets.augmentation" class="doc doc-heading">
          <code>heartkit.datasets.augmentation</code>


</h2>

  <div class="doc doc-contents first">

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h3 id="heartkit.datasets.augmentation.augment_pipeline" class="doc doc-heading">
<code class="highlight language-python"><span class="n">augment_pipeline</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">augmentations</span><span class="p">,</span> <span class="n">sample_rate</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Apply augmentation pipeline</p>

  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b>x</b>
            (<code><a class="autorefs autorefs-external" title="numpy" href="https://numpy.org/doc/stable/reference/index.html#module-numpy">npt</a>.<span title="numpy.NDArray">NDArray</span></code>)
        – <p>Signal</p>
      </li>
      <li class="field-body">
        <b>augmentations</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#list">list</a>[<span title="heartkit.defines.AugmentationParams">AugmentationParams</span>]</code>)
        – <p>Augmentations to apply</p>
      </li>
      <li class="field-body">
        <b>sample_rate</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a></code>)
        – <p>Sampling rate in Hz.</p>
      </li>
  </ul>

  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code><a class="autorefs autorefs-external" title="numpy" href="https://numpy.org/doc/stable/reference/index.html#module-numpy">npt</a>.<span title="numpy.NDArray">NDArray</span></code>
        – <p>npt.NDArray: Augmented signal</p>
      </li>
  </ul>

      <details class="quote">
        <summary>Source code in <code>heartkit/datasets/augmentation.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="k">def</span> <span class="nf">augment_pipeline</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">,</span> <span class="n">augmentations</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">AugmentationParams</span><span class="p">],</span> <span class="n">sample_rate</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">:</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Apply augmentation pipeline</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a><span class="sd">        x (npt.NDArray): Signal</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="sd">        augmentations (list[AugmentationParams]): Augmentations to apply</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="sd">        sample_rate: Sampling rate in Hz.</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="sd">        npt.NDArray: Augmented signal</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a>    <span class="k">for</span> <span class="n">augmentation</span> <span class="ow">in</span> <span class="n">augmentations</span><span class="p">:</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a>        <span class="n">args</span> <span class="o">=</span> <span class="n">augmentation</span><span class="o">.</span><span class="n">args</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a>        <span class="k">if</span> <span class="n">augmentation</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;baseline_wander&quot;</span><span class="p">:</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a>            <span class="n">amplitude</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;amplitude&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.06</span><span class="p">])</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a>            <span class="n">frequency</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;frequency&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>            <span class="n">x</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">add_baseline_wander</span><span class="p">(</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>                <span class="n">x</span><span class="p">,</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>                <span class="n">amplitude</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">amplitude</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">amplitude</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>                <span class="n">frequency</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">frequency</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">frequency</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>                <span class="n">sample_rate</span><span class="o">=</span><span class="n">sample_rate</span><span class="p">,</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>            <span class="p">)</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>        <span class="k">elif</span> <span class="n">augmentation</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;motion_noise&quot;</span><span class="p">:</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>            <span class="n">amplitude</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;amplitude&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">])</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>            <span class="n">frequency</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;frequency&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">])</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>            <span class="n">x</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">add_motion_noise</span><span class="p">(</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>                <span class="n">x</span><span class="p">,</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>                <span class="n">amplitude</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">amplitude</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">amplitude</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>                <span class="n">frequency</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">frequency</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">frequency</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>                <span class="n">sample_rate</span><span class="o">=</span><span class="n">sample_rate</span><span class="p">,</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>            <span class="p">)</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>        <span class="k">elif</span> <span class="n">augmentation</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;burst_noise&quot;</span><span class="p">:</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>            <span class="n">amplitude</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;amplitude&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">])</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>            <span class="n">frequency</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;frequency&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">sample_rate</span> <span class="o">/</span> <span class="mi">4</span><span class="p">,</span> <span class="n">sample_rate</span> <span class="o">/</span> <span class="mi">2</span><span class="p">])</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>            <span class="n">burst_number</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;burst_number&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>            <span class="n">x</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">add_burst_noise</span><span class="p">(</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>                <span class="n">x</span><span class="p">,</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>                <span class="n">amplitude</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">amplitude</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">amplitude</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>                <span class="n">frequency</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">frequency</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">frequency</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>                <span class="n">burst_number</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">burst_number</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">burst_number</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>                <span class="n">sample_rate</span><span class="o">=</span><span class="n">sample_rate</span><span class="p">,</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>            <span class="p">)</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>        <span class="k">elif</span> <span class="n">augmentation</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;powerline_noise&quot;</span><span class="p">:</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>            <span class="n">amplitude</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;amplitude&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.005</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">])</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>            <span class="n">frequency</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;frequency&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">60</span><span class="p">])</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>            <span class="n">x</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">add_powerline_noise</span><span class="p">(</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>                <span class="n">x</span><span class="p">,</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>                <span class="n">amplitude</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">amplitude</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">amplitude</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>                <span class="n">frequency</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">frequency</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">frequency</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>                <span class="n">sample_rate</span><span class="o">=</span><span class="n">sample_rate</span><span class="p">,</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>            <span class="p">)</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>        <span class="k">elif</span> <span class="n">augmentation</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;noise_sources&quot;</span><span class="p">:</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>            <span class="n">num_sources</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;num_sources&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>            <span class="n">amplitude</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;amplitude&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">])</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>            <span class="n">frequency</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;frequency&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">sample_rate</span> <span class="o">/</span> <span class="mi">2</span><span class="p">])</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>            <span class="n">num_sources</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">num_sources</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">num_sources</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>            <span class="n">x</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">add_noise_sources</span><span class="p">(</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>                <span class="n">x</span><span class="p">,</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>                <span class="n">amplitudes</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">amplitude</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">amplitude</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_sources</span><span class="p">)],</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>                <span class="n">frequencies</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">frequency</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">frequency</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_sources</span><span class="p">)],</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>                <span class="n">sample_rate</span><span class="o">=</span><span class="n">sample_rate</span><span class="p">,</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>            <span class="p">)</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>    <span class="k">return</span> <span class="n">x</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="heartkit.datasets.augmentation.baseline_wander" class="doc doc-heading">
<code class="highlight language-python"><span class="n">baseline_wander</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">0.001</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Apply baseline wander</p>

  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b>y</b>
            (<code><a class="autorefs autorefs-external" title="numpy" href="https://numpy.org/doc/stable/reference/index.html#module-numpy">npt</a>.<span title="numpy.NDArray">NDArray</span></code>)
        – <p>Signal</p>
      </li>
      <li class="field-body">
        <b>scale</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a></code>)
        – <p>Noise scale. Defaults to 1e-3.</p>
      </li>
  </ul>

  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code><a class="autorefs autorefs-external" title="numpy" href="https://numpy.org/doc/stable/reference/index.html#module-numpy">npt</a>.<span title="numpy.NDArray">NDArray</span></code>
        – <p>npt.NDArray: New signal</p>
      </li>
  </ul>

      <details class="quote">
        <summary>Source code in <code>heartkit/datasets/augmentation.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-55">55</a></span>
<span class="normal"><a href="#__codelineno-0-56">56</a></span>
<span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span>
<span class="normal"><a href="#__codelineno-0-64">64</a></span>
<span class="normal"><a href="#__codelineno-0-65">65</a></span>
<span class="normal"><a href="#__codelineno-0-66">66</a></span>
<span class="normal"><a href="#__codelineno-0-67">67</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="k">def</span> <span class="nf">baseline_wander</span><span class="p">(</span><span class="n">y</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">,</span> <span class="n">scale</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-3</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">:</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Apply baseline wander</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="sd">        y (npt.NDArray): Signal</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="sd">        scale (float, optional): Noise scale. Defaults to 1e-3.</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="sd">        npt.NDArray: New signal</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a>    <span class="n">skew</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">y</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>    <span class="n">skew</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">skew</span><span class="p">)</span> <span class="o">*</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">scale</span> <span class="o">/</span> <span class="mi">10</span><span class="p">,</span> <span class="n">scale</span><span class="p">)</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a>    <span class="n">y</span> <span class="o">=</span> <span class="n">y</span> <span class="o">+</span> <span class="n">skew</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="heartkit.datasets.augmentation.emg_noise" class="doc doc-heading">
<code class="highlight language-python"><span class="n">emg_noise</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">1e-05</span><span class="p">,</span> <span class="n">sampling_frequency</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Add EMG noise to signal</p>

  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b>y</b>
            (<code><a class="autorefs autorefs-external" title="numpy" href="https://numpy.org/doc/stable/reference/index.html#module-numpy">npt</a>.<span title="numpy.NDArray">NDArray</span></code>)
        – <p>Signal</p>
      </li>
      <li class="field-body">
        <b>scale</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a></code>)
        – <p>Noise scale. Defaults to 1e-5.</p>
      </li>
      <li class="field-body">
        <b>sampling_frequency</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code>)
        – <p>Sampling rate in Hz. Defaults to 1000.</p>
      </li>
  </ul>

  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code><a class="autorefs autorefs-external" title="numpy" href="https://numpy.org/doc/stable/reference/index.html#module-numpy">npt</a>.<span title="numpy.NDArray">NDArray</span></code>
        – <p>npt.NDArray: New signal</p>
      </li>
  </ul>

      <details class="quote">
        <summary>Source code in <code>heartkit/datasets/augmentation.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-10">10</a></span>
<span class="normal"><a href="#__codelineno-0-11">11</a></span>
<span class="normal"><a href="#__codelineno-0-12">12</a></span>
<span class="normal"><a href="#__codelineno-0-13">13</a></span>
<span class="normal"><a href="#__codelineno-0-14">14</a></span>
<span class="normal"><a href="#__codelineno-0-15">15</a></span>
<span class="normal"><a href="#__codelineno-0-16">16</a></span>
<span class="normal"><a href="#__codelineno-0-17">17</a></span>
<span class="normal"><a href="#__codelineno-0-18">18</a></span>
<span class="normal"><a href="#__codelineno-0-19">19</a></span>
<span class="normal"><a href="#__codelineno-0-20">20</a></span>
<span class="normal"><a href="#__codelineno-0-21">21</a></span>
<span class="normal"><a href="#__codelineno-0-22">22</a></span>
<span class="normal"><a href="#__codelineno-0-23">23</a></span>
<span class="normal"><a href="#__codelineno-0-24">24</a></span>
<span class="normal"><a href="#__codelineno-0-25">25</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-10" name="__codelineno-0-10"></a><span class="k">def</span> <span class="nf">emg_noise</span><span class="p">(</span><span class="n">y</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">,</span> <span class="n">scale</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-5</span><span class="p">,</span> <span class="n">sampling_frequency</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">:</span>
<a id="__codelineno-0-11" name="__codelineno-0-11"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Add EMG noise to signal</span>
<a id="__codelineno-0-12" name="__codelineno-0-12"></a>
<a id="__codelineno-0-13" name="__codelineno-0-13"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-14" name="__codelineno-0-14"></a><span class="sd">        y (npt.NDArray): Signal</span>
<a id="__codelineno-0-15" name="__codelineno-0-15"></a><span class="sd">        scale (float, optional): Noise scale. Defaults to 1e-5.</span>
<a id="__codelineno-0-16" name="__codelineno-0-16"></a><span class="sd">        sampling_frequency (int, optional): Sampling rate in Hz. Defaults to 1000.</span>
<a id="__codelineno-0-17" name="__codelineno-0-17"></a>
<a id="__codelineno-0-18" name="__codelineno-0-18"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-19" name="__codelineno-0-19"></a><span class="sd">        npt.NDArray: New signal</span>
<a id="__codelineno-0-20" name="__codelineno-0-20"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a>    <span class="n">noise</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a>        <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">sampling_frequency</span><span class="p">)</span> <span class="o">*</span> <span class="mi">10000</span><span class="p">),</span>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a>        <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">size</span> <span class="o">/</span> <span class="n">sampling_frequency</span><span class="p">),</span>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a>    <span class="p">)</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a>    <span class="k">return</span> <span class="n">y</span> <span class="o">+</span> <span class="n">scale</span> <span class="o">*</span> <span class="n">noise</span><span class="p">[:</span> <span class="n">y</span><span class="o">.</span><span class="n">size</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="heartkit.datasets.augmentation.lead_noise" class="doc doc-heading">
<code class="highlight language-python"><span class="n">lead_noise</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Add Lead noise</p>

  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b>y</b>
            (<code><a class="autorefs autorefs-external" title="numpy" href="https://numpy.org/doc/stable/reference/index.html#module-numpy">npt</a>.<span title="numpy.NDArray">NDArray</span></code>)
        – <p>Signal</p>
      </li>
      <li class="field-body">
        <b>scale</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a></code>)
        – <p>Noise scale. Defaults to 1.</p>
      </li>
  </ul>

  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code><a class="autorefs autorefs-external" title="numpy" href="https://numpy.org/doc/stable/reference/index.html#module-numpy">npt</a>.<span title="numpy.NDArray">NDArray</span></code>
        – <p>npt.NDArray: New signal</p>
      </li>
  </ul>

      <details class="quote">
        <summary>Source code in <code>heartkit/datasets/augmentation.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="k">def</span> <span class="nf">lead_noise</span><span class="p">(</span><span class="n">y</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">,</span> <span class="n">scale</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">:</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Add Lead noise</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="sd">        y (npt.NDArray): Signal</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="sd">        scale (float, optional): Noise scale. Defaults to 1.</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="sd">        npt.NDArray: New signal</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a>    <span class="k">return</span> <span class="n">y</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="o">-</span><span class="n">scale</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="heartkit.datasets.augmentation.random_scaling" class="doc doc-heading">
<code class="highlight language-python"><span class="n">random_scaling</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="mf">2.0</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Randomly scale signal.</p>

  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b>y</b>
            (<code><a class="autorefs autorefs-external" title="numpy" href="https://numpy.org/doc/stable/reference/index.html#module-numpy">npt</a>.<span title="numpy.NDArray">NDArray</span></code>)
        – <p>Signal</p>
      </li>
      <li class="field-body">
        <b>lower</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a></code>)
        – <p>Lower bound. Defaults to 0.5.</p>
      </li>
      <li class="field-body">
        <b>upper</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a></code>)
        – <p>Upper bound. Defaults to 2.0.</p>
      </li>
  </ul>

  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code><a class="autorefs autorefs-external" title="numpy" href="https://numpy.org/doc/stable/reference/index.html#module-numpy">npt</a>.<span title="numpy.NDArray">NDArray</span></code>
        – <p>npt.NDArray: New signal</p>
      </li>
  </ul>

      <details class="quote">
        <summary>Source code in <code>heartkit/datasets/augmentation.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-41" name="__codelineno-0-41"></a><span class="k">def</span> <span class="nf">random_scaling</span><span class="p">(</span><span class="n">y</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">,</span> <span class="n">lower</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">upper</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">2.0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">:</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Randomly scale signal.</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="sd">        y (npt.NDArray): Signal</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="sd">        lower (float, optional): Lower bound. Defaults to 0.5.</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="sd">        upper (float, optional): Upper bound. Defaults to 2.0.</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="sd">        npt.NDArray: New signal</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a>    <span class="k">return</span> <span class="n">y</span> <span class="o">*</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="heartkit.datasets.preprocess" class="doc doc-heading">
          <code>heartkit.datasets.preprocess</code>


</h2>

  <div class="doc doc-contents first">

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h3 id="heartkit.datasets.preprocess.filter_signal" class="doc doc-heading">
<code class="highlight language-python"><span class="n">filter_signal</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">lowcut</span><span class="p">,</span> <span class="n">highcut</span><span class="p">,</span> <span class="n">sample_rate</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Apply band-pass filter to signal using butterworth design and forward-backward cascaded filter</p>

  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b>data</b>
            (<code><a class="autorefs autorefs-external" title="numpy" href="https://numpy.org/doc/stable/reference/index.html#module-numpy">npt</a>.<span title="numpy.NDArray">NDArray</span></code>)
        – <p>Signal</p>
      </li>
      <li class="field-body">
        <b>lowcut</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a></code>)
        – <p>Lower cutoff in Hz</p>
      </li>
      <li class="field-body">
        <b>highcut</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a></code>)
        – <p>Upper cutoff in Hz</p>
      </li>
      <li class="field-body">
        <b>sample_rate</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a></code>)
        – <p>Sampling rate in Hz</p>
      </li>
      <li class="field-body">
        <b>order</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code>)
        – <p>Filter order. Defaults to 3.</p>
      </li>
  </ul>

  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code><a class="autorefs autorefs-external" title="numpy" href="https://numpy.org/doc/stable/reference/index.html#module-numpy">npt</a>.<span title="numpy.NDArray">NDArray</span></code>
        – <p>npt.NDArray: Filtered signal</p>
      </li>
  </ul>

      <details class="quote">
        <summary>Source code in <code>heartkit/datasets/preprocess.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-86" name="__codelineno-0-86"></a><span class="k">def</span> <span class="nf">filter_signal</span><span class="p">(</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>    <span class="n">data</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">,</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>    <span class="n">lowcut</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>    <span class="n">highcut</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>    <span class="n">sample_rate</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>    <span class="n">order</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>    <span class="n">axis</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">:</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Apply band-pass filter to signal using butterworth design and forward-backward cascaded filter</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a><span class="sd">        data (npt.NDArray): Signal</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a><span class="sd">        lowcut (float): Lower cutoff in Hz</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a><span class="sd">        highcut (float): Upper cutoff in Hz</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a><span class="sd">        sample_rate (float): Sampling rate in Hz</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a><span class="sd">        order (int, optional): Filter order. Defaults to 3.</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a><span class="sd">        npt.NDArray: Filtered signal</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>    <span class="n">sos</span> <span class="o">=</span> <span class="n">get_butter_bp_sos</span><span class="p">(</span><span class="n">lowcut</span><span class="o">=</span><span class="n">lowcut</span><span class="p">,</span> <span class="n">highcut</span><span class="o">=</span><span class="n">highcut</span><span class="p">,</span> <span class="n">sample_rate</span><span class="o">=</span><span class="n">sample_rate</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">)</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>    <span class="k">return</span> <span class="n">scipy</span><span class="o">.</span><span class="n">signal</span><span class="o">.</span><span class="n">sosfiltfilt</span><span class="p">(</span><span class="n">sos</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="heartkit.datasets.preprocess.generate_arm_biquad_sos" class="doc doc-heading">
<code class="highlight language-python"><span class="n">generate_arm_biquad_sos</span><span class="p">(</span><span class="n">lowcut</span><span class="p">,</span> <span class="n">highcut</span><span class="p">,</span> <span class="n">sample_rate</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">var_name</span><span class="o">=</span><span class="s1">&#39;biquadFilter&#39;</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Generate ARM second order section coefficients.</p>

      <details class="quote">
        <summary>Source code in <code>heartkit/datasets/preprocess.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-64">64</a></span>
<span class="normal"><a href="#__codelineno-0-65">65</a></span>
<span class="normal"><a href="#__codelineno-0-66">66</a></span>
<span class="normal"><a href="#__codelineno-0-67">67</a></span>
<span class="normal"><a href="#__codelineno-0-68">68</a></span>
<span class="normal"><a href="#__codelineno-0-69">69</a></span>
<span class="normal"><a href="#__codelineno-0-70">70</a></span>
<span class="normal"><a href="#__codelineno-0-71">71</a></span>
<span class="normal"><a href="#__codelineno-0-72">72</a></span>
<span class="normal"><a href="#__codelineno-0-73">73</a></span>
<span class="normal"><a href="#__codelineno-0-74">74</a></span>
<span class="normal"><a href="#__codelineno-0-75">75</a></span>
<span class="normal"><a href="#__codelineno-0-76">76</a></span>
<span class="normal"><a href="#__codelineno-0-77">77</a></span>
<span class="normal"><a href="#__codelineno-0-78">78</a></span>
<span class="normal"><a href="#__codelineno-0-79">79</a></span>
<span class="normal"><a href="#__codelineno-0-80">80</a></span>
<span class="normal"><a href="#__codelineno-0-81">81</a></span>
<span class="normal"><a href="#__codelineno-0-82">82</a></span>
<span class="normal"><a href="#__codelineno-0-83">83</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="k">def</span> <span class="nf">generate_arm_biquad_sos</span><span class="p">(</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a>    <span class="n">lowcut</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>    <span class="n">highcut</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a>    <span class="n">sample_rate</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>    <span class="n">order</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>    <span class="n">var_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;biquadFilter&quot;</span><span class="p">,</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="p">):</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate ARM second order section coefficients.&quot;&quot;&quot;</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>    <span class="n">sos</span> <span class="o">=</span> <span class="n">get_butter_bp_sos</span><span class="p">(</span><span class="n">lowcut</span><span class="o">=</span><span class="n">lowcut</span><span class="p">,</span> <span class="n">highcut</span><span class="o">=</span><span class="n">highcut</span><span class="p">,</span> <span class="n">sample_rate</span><span class="o">=</span><span class="n">sample_rate</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">)</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>    <span class="c1"># Each section needs to be mapped as follows:</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a>    <span class="c1">#   [b0, b1, b2, a0, a1, a2] -&gt; [b0, b1, b2, -a1, -a2]</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a>    <span class="n">sec_len_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">var_name</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2">_NUM_SECS&quot;</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>    <span class="n">arm_sos</span> <span class="o">=</span> <span class="n">sos</span><span class="p">[:,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]]</span> <span class="o">*</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a>    <span class="n">coef_str</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">linesep</span><span class="si">:</span><span class="s2">&lt;4</span><span class="si">}{</span><span class="n">c</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">5</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">arm_sos</span><span class="o">.</span><span class="n">flatten</span><span class="p">()))</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a>    <span class="n">arm_str</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a>        <span class="sa">f</span><span class="s2">&quot;#define </span><span class="si">{</span><span class="n">sec_len_name</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">order</span><span class="si">:</span><span class="s2">0d</span><span class="si">}</span><span class="s2">)</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">linesep</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a>        <span class="sa">f</span><span class="s2">&quot;static float32_t </span><span class="si">{</span><span class="n">var_name</span><span class="si">}</span><span class="s2">State[2 * </span><span class="si">{</span><span class="n">sec_len_name</span><span class="si">}</span><span class="s2">];</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">linesep</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a>        <span class="sa">f</span><span class="s2">&quot;static float32_t </span><span class="si">{</span><span class="n">var_name</span><span class="si">}</span><span class="s2">[5 * </span><span class="si">{</span><span class="n">sec_len_name</span><span class="si">}</span><span class="s2">] = </span><span class="se">{{</span><span class="s2"> </span><span class="si">{</span><span class="n">coef_str</span><span class="si">}</span><span class="se">\n}}</span><span class="s2">;</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">linesep</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a>    <span class="p">)</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a>    <span class="k">return</span> <span class="n">arm_str</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="heartkit.datasets.preprocess.get_butter_bp_sos" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_butter_bp_sos</span><span class="p">(</span><span class="n">lowcut</span><span class="p">,</span> <span class="n">highcut</span><span class="p">,</span> <span class="n">sample_rate</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-cached"><code>cached</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Compute band-pass filter coefficients as SOS. This function caches.</p>

  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b>lowcut</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a></code>)
        – <p>Lower cutoff in Hz</p>
      </li>
      <li class="field-body">
        <b>highcut</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a></code>)
        – <p>Upper cutoff in Hz</p>
      </li>
      <li class="field-body">
        <b>sample_rate</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a></code>)
        – <p>Sampling rate in Hz</p>
      </li>
      <li class="field-body">
        <b>order</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code>)
        – <p>Filter order. Defaults to 3.</p>
      </li>
  </ul>

  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code><a class="autorefs autorefs-external" title="numpy" href="https://numpy.org/doc/stable/reference/index.html#module-numpy">npt</a>.<span title="numpy.NDArray">NDArray</span></code>
        – <p>npt.NDArray: SOS</p>
      </li>
  </ul>

      <details class="quote">
        <summary>Source code in <code>heartkit/datasets/preprocess.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span>
<span class="normal"><a href="#__codelineno-0-56">56</a></span>
<span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="nd">@functools</span><span class="o">.</span><span class="n">cache</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a><span class="k">def</span> <span class="nf">get_butter_bp_sos</span><span class="p">(</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a>    <span class="n">lowcut</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a>    <span class="n">highcut</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a>    <span class="n">sample_rate</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a>    <span class="n">order</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">:</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute band-pass filter coefficients as SOS. This function caches.</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="sd">        lowcut (float): Lower cutoff in Hz</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="sd">        highcut (float): Upper cutoff in Hz</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="sd">        sample_rate (float): Sampling rate in Hz</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="sd">        order (int, optional): Filter order. Defaults to 3.</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="sd">        npt.NDArray: SOS</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a>    <span class="n">nyq</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">sample_rate</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a>    <span class="n">low</span> <span class="o">=</span> <span class="n">lowcut</span> <span class="o">/</span> <span class="n">nyq</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a>    <span class="n">high</span> <span class="o">=</span> <span class="n">highcut</span> <span class="o">/</span> <span class="n">nyq</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a>    <span class="n">sos</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">signal</span><span class="o">.</span><span class="n">butter</span><span class="p">(</span><span class="n">order</span><span class="p">,</span> <span class="p">[</span><span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">],</span> <span class="n">btype</span><span class="o">=</span><span class="s2">&quot;band&quot;</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="s2">&quot;sos&quot;</span><span class="p">)</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a>    <span class="k">return</span> <span class="n">sos</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="heartkit.datasets.preprocess.normalize_signal" class="doc doc-heading">
<code class="highlight language-python"><span class="n">normalize_signal</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Normalize signal about its mean and std.</p>

  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b>data</b>
            (<code><a class="autorefs autorefs-external" title="numpy" href="https://numpy.org/doc/stable/reference/index.html#module-numpy">npt</a>.<span title="numpy.NDArray">NDArray</span></code>)
        – <p>Signal</p>
      </li>
      <li class="field-body">
        <b>eps</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a></code>)
        – <p>Epsilon added to st. dev. Defaults to 1e-3.</p>
      </li>
      <li class="field-body">
        <b>axis</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code>)
        – <p>Axis to normalize along. Defaults to 0.</p>
      </li>
  </ul>

  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code><a class="autorefs autorefs-external" title="numpy" href="https://numpy.org/doc/stable/reference/index.html#module-numpy">npt</a>.<span title="numpy.NDArray">NDArray</span></code>
        – <p>npt.NDArray: Normalized signal</p>
      </li>
  </ul>

      <details class="quote">
        <summary>Source code in <code>heartkit/datasets/preprocess.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-127" name="__codelineno-0-127"></a><span class="k">def</span> <span class="nf">normalize_signal</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">,</span> <span class="n">eps</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-3</span><span class="p">,</span> <span class="n">axis</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">:</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Normalize signal about its mean and std.</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a><span class="sd">        data (npt.NDArray): Signal</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a><span class="sd">        eps (float, optional): Epsilon added to st. dev. Defaults to 1e-3.</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a><span class="sd">        axis (int, optional): Axis to normalize along. Defaults to 0.</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a><span class="sd">        npt.NDArray: Normalized signal</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>    <span class="n">mu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>    <span class="n">std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanstd</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span> <span class="o">+</span> <span class="n">eps</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>    <span class="k">return</span> <span class="p">(</span><span class="n">data</span> <span class="o">-</span> <span class="n">mu</span><span class="p">)</span> <span class="o">/</span> <span class="n">std</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="heartkit.datasets.preprocess.pad_signal" class="doc doc-heading">
<code class="highlight language-python"><span class="n">pad_signal</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">max_len</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;pre&#39;</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Pads signal shorter than <code>max_len</code> and trims those longer than <code>max_len</code>.</p>

  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b>x</b>
            (<code><a class="autorefs autorefs-external" title="numpy" href="https://numpy.org/doc/stable/reference/index.html#module-numpy">npt</a>.<span title="numpy.NDArray">NDArray</span></code>)
        – <p>Array of sequences.</p>
      </li>
      <li class="field-body">
        <b>max_len</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a> | None</code>)
        – <p>Maximum length of sequence. Defaults to longest.</p>
      </li>
      <li class="field-body">
        <b>padding</b>
            (<code><a class="autorefs autorefs-external" title="typing.Literal" href="https://docs.python.org/3/library/typing.html#typing.Literal">Literal</a>[&#39;pre&#39;, &#39;post&#39;]</code>)
        – <p>Before or after sequence. Defaults to pre.</p>
      </li>
  </ul>

  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code><a class="autorefs autorefs-external" title="numpy" href="https://numpy.org/doc/stable/reference/index.html#module-numpy">npt</a>.<span title="numpy.NDArray">NDArray</span></code>
        – <p>npt.NDArray Array of padded sequences.</p>
      </li>
  </ul>

      <details class="quote">
        <summary>Source code in <code>heartkit/datasets/preprocess.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-181" name="__codelineno-0-181"></a><span class="k">def</span> <span class="nf">pad_signal</span><span class="p">(</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a>    <span class="n">x</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">,</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a>    <span class="n">max_len</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a>    <span class="n">padding</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;pre&quot;</span><span class="p">,</span> <span class="s2">&quot;post&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;pre&quot;</span><span class="p">,</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">:</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Pads signal shorter than `max_len` and trims those longer than `max_len`.</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a><span class="sd">        x (npt.NDArray): Array of sequences.</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a><span class="sd">        max_len (int | None, optional): Maximum length of sequence. Defaults to longest.</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a><span class="sd">        padding (Literal[&quot;pre&quot;, &quot;post&quot;]): Before or after sequence. Defaults to pre.</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a><span class="sd">        npt.NDArray Array of padded sequences.</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a>    <span class="k">if</span> <span class="n">max_len</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a>        <span class="n">max_len</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">len</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a>    <span class="n">x_shape</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a>    <span class="n">x_dtype</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a>    <span class="n">x_padded</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">max_len</span><span class="p">)</span> <span class="o">+</span> <span class="n">x_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">x_dtype</span><span class="p">)</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a>    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">x_i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a>        <span class="n">trim_len</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">max_len</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_i</span><span class="p">))</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a>        <span class="k">if</span> <span class="n">padding</span> <span class="o">==</span> <span class="s2">&quot;pre&quot;</span><span class="p">:</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a>            <span class="n">x_padded</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="o">-</span><span class="n">trim_len</span><span class="p">:]</span> <span class="o">=</span> <span class="n">x_i</span><span class="p">[</span><span class="o">-</span><span class="n">trim_len</span><span class="p">:]</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a>        <span class="k">elif</span> <span class="n">padding</span> <span class="o">==</span> <span class="s2">&quot;post&quot;</span><span class="p">:</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>            <span class="n">x_padded</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:</span><span class="n">trim_len</span><span class="p">]</span> <span class="o">=</span> <span class="n">x_i</span><span class="p">[:</span><span class="n">trim_len</span><span class="p">]</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown padding: </span><span class="si">{</span><span class="n">padding</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a>    <span class="k">return</span> <span class="n">x_padded</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="heartkit.datasets.preprocess.preprocess_signal" class="doc doc-heading">
<code class="highlight language-python"><span class="n">preprocess_signal</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">sample_rate</span><span class="p">,</span> <span class="n">target_rate</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Pre-process signal</p>

  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b>data</b>
            (<code><a class="autorefs autorefs-external" title="numpy" href="https://numpy.org/doc/stable/reference/index.html#module-numpy">npt</a>.<span title="numpy.NDArray">NDArray</span></code>)
        – <p>Signal</p>
      </li>
      <li class="field-body">
        <b>sample_rate</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a></code>)
        – <p>Sampling rate (Hz)</p>
      </li>
      <li class="field-body">
        <b>target_rate</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a></code>)
        – <p>Target sampling rate (Hz)</p>
      </li>
  </ul>

  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code><a class="autorefs autorefs-external" title="numpy" href="https://numpy.org/doc/stable/reference/index.html#module-numpy">npt</a>.<span title="numpy.NDArray">NDArray</span></code>
        – <p>npt.NDArray: Pre-processed signal</p>
      </li>
  </ul>

      <details class="quote">
        <summary>Source code in <code>heartkit/datasets/preprocess.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-10">10</a></span>
<span class="normal"><a href="#__codelineno-0-11">11</a></span>
<span class="normal"><a href="#__codelineno-0-12">12</a></span>
<span class="normal"><a href="#__codelineno-0-13">13</a></span>
<span class="normal"><a href="#__codelineno-0-14">14</a></span>
<span class="normal"><a href="#__codelineno-0-15">15</a></span>
<span class="normal"><a href="#__codelineno-0-16">16</a></span>
<span class="normal"><a href="#__codelineno-0-17">17</a></span>
<span class="normal"><a href="#__codelineno-0-18">18</a></span>
<span class="normal"><a href="#__codelineno-0-19">19</a></span>
<span class="normal"><a href="#__codelineno-0-20">20</a></span>
<span class="normal"><a href="#__codelineno-0-21">21</a></span>
<span class="normal"><a href="#__codelineno-0-22">22</a></span>
<span class="normal"><a href="#__codelineno-0-23">23</a></span>
<span class="normal"><a href="#__codelineno-0-24">24</a></span>
<span class="normal"><a href="#__codelineno-0-25">25</a></span>
<span class="normal"><a href="#__codelineno-0-26">26</a></span>
<span class="normal"><a href="#__codelineno-0-27">27</a></span>
<span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-10" name="__codelineno-0-10"></a><span class="k">def</span> <span class="nf">preprocess_signal</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">,</span> <span class="n">sample_rate</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">target_rate</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">:</span>
<a id="__codelineno-0-11" name="__codelineno-0-11"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Pre-process signal</span>
<a id="__codelineno-0-12" name="__codelineno-0-12"></a>
<a id="__codelineno-0-13" name="__codelineno-0-13"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-14" name="__codelineno-0-14"></a><span class="sd">        data (npt.NDArray): Signal</span>
<a id="__codelineno-0-15" name="__codelineno-0-15"></a><span class="sd">        sample_rate (float): Sampling rate (Hz)</span>
<a id="__codelineno-0-16" name="__codelineno-0-16"></a><span class="sd">        target_rate (float): Target sampling rate (Hz)</span>
<a id="__codelineno-0-17" name="__codelineno-0-17"></a>
<a id="__codelineno-0-18" name="__codelineno-0-18"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-19" name="__codelineno-0-19"></a><span class="sd">        npt.NDArray: Pre-processed signal</span>
<a id="__codelineno-0-20" name="__codelineno-0-20"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a>    <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a>    <span class="n">norm_en</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a>    <span class="n">norm_eps</span> <span class="o">=</span> <span class="mf">1e-6</span>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a>    <span class="n">filter_en</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a>    <span class="n">filt_lo</span> <span class="o">=</span> <span class="mf">0.5</span>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a>    <span class="n">filt_hi</span> <span class="o">=</span> <span class="mi">30</span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a>    <span class="n">resample_en</span> <span class="o">=</span> <span class="n">target_rate</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">sample_rate</span> <span class="o">!=</span> <span class="n">target_rate</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a>    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a>    <span class="k">if</span> <span class="n">filter_en</span><span class="p">:</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a>        <span class="n">x</span> <span class="o">=</span> <span class="n">filter_signal</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">lowcut</span><span class="o">=</span><span class="n">filt_lo</span><span class="p">,</span> <span class="n">highcut</span><span class="o">=</span><span class="n">filt_hi</span><span class="p">,</span> <span class="n">sample_rate</span><span class="o">=</span><span class="n">sample_rate</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a>    <span class="k">if</span> <span class="n">resample_en</span><span class="p">:</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a>        <span class="n">x</span> <span class="o">=</span> <span class="n">resample_signal</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">sample_rate</span><span class="o">=</span><span class="n">sample_rate</span><span class="p">,</span> <span class="n">target_rate</span><span class="o">=</span><span class="n">target_rate</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a>    <span class="k">if</span> <span class="n">norm_en</span><span class="p">:</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a>        <span class="n">x</span> <span class="o">=</span> <span class="n">normalize_signal</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="n">norm_eps</span><span class="p">)</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a>    <span class="k">return</span> <span class="n">x</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="heartkit.datasets.preprocess.resample_signal" class="doc doc-heading">
<code class="highlight language-python"><span class="n">resample_signal</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">sample_rate</span><span class="p">,</span> <span class="n">target_rate</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Resample signal using scipy FFT-based resample routine.</p>

  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b>data</b>
            (<code><a class="autorefs autorefs-external" title="numpy" href="https://numpy.org/doc/stable/reference/index.html#module-numpy">npt</a>.<span title="numpy.NDArray">NDArray</span></code>)
        – <p>Signal</p>
      </li>
      <li class="field-body">
        <b>sample_rate</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a></code>)
        – <p>Signal sampling rate</p>
      </li>
      <li class="field-body">
        <b>target_rate</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a></code>)
        – <p>Target sampling rate</p>
      </li>
      <li class="field-body">
        <b>axis</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code>)
        – <p>Axis to resample along. Defaults to 0.</p>
      </li>
  </ul>

  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code><a class="autorefs autorefs-external" title="numpy" href="https://numpy.org/doc/stable/reference/index.html#module-numpy">npt</a>.<span title="numpy.NDArray">NDArray</span></code>
        – <p>npt.NDArray: Resampled signal</p>
      </li>
  </ul>

      <details class="quote">
        <summary>Source code in <code>heartkit/datasets/preprocess.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-110" name="__codelineno-0-110"></a><span class="k">def</span> <span class="nf">resample_signal</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">,</span> <span class="n">sample_rate</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">target_rate</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">axis</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">:</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Resample signal using scipy FFT-based resample routine.</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a><span class="sd">        data (npt.NDArray): Signal</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a><span class="sd">        sample_rate (float): Signal sampling rate</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a><span class="sd">        target_rate (float): Target sampling rate</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a><span class="sd">        axis (int, optional): Axis to resample along. Defaults to 0.</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a><span class="sd">        npt.NDArray: Resampled signal</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>    <span class="n">ratio</span> <span class="o">=</span> <span class="n">target_rate</span> <span class="o">/</span> <span class="n">sample_rate</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>    <span class="n">desired_length</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span> <span class="o">*</span> <span class="n">ratio</span><span class="p">))</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>    <span class="k">return</span> <span class="n">scipy</span><span class="o">.</span><span class="n">signal</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">desired_length</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="heartkit.datasets.preprocess.rolling_standardize" class="doc doc-heading">
<code class="highlight language-python"><span class="n">rolling_standardize</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">win_len</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Performs rolling standardization</p>

  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b>x</b>
            (<code><a class="autorefs autorefs-external" title="numpy" href="https://numpy.org/doc/stable/reference/index.html#module-numpy">npt</a>.<span title="numpy.NDArray">NDArray</span></code>)
        – <p>Data</p>
      </li>
      <li class="field-body">
        <b>win_len</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code>)
        – <p>Window length</p>
      </li>
  </ul>

  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code><a class="autorefs autorefs-external" title="numpy" href="https://numpy.org/doc/stable/reference/index.html#module-numpy">npt</a>.<span title="numpy.NDArray">NDArray</span></code>
        – <p>npt.NDArray: Standardized data</p>
      </li>
  </ul>

      <details class="quote">
        <summary>Source code in <code>heartkit/datasets/preprocess.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-143" name="__codelineno-0-143"></a><span class="k">def</span> <span class="nf">rolling_standardize</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">,</span> <span class="n">win_len</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">:</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Performs rolling standardization</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a><span class="sd">        x (npt.NDArray): Data</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a><span class="sd">        win_len (int): Window length</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a><span class="sd">        npt.NDArray: Standardized data</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>    <span class="n">x_roll</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">stride_tricks</span><span class="o">.</span><span class="n">sliding_window_view</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">win_len</span><span class="p">)</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>    <span class="n">x_roll_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">x_roll</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>    <span class="n">x_roll_mu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">x_roll</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>    <span class="n">x_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">x_roll_std</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">x_roll_std</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">x_roll_std</span><span class="p">))</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>    <span class="n">x_mu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">x_roll_mu</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">x_roll_mu</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">x_roll_mu</span><span class="p">))</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a>    <span class="n">x_norm</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">x_mu</span><span class="p">)</span> <span class="o">/</span> <span class="n">x_std</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>    <span class="k">return</span> <span class="n">x_norm</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="heartkit.datasets.preprocess.running_mean_std" class="doc doc-heading">
<code class="highlight language-python"><span class="n">running_mean_std</span><span class="p">(</span><span class="n">iterator</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Calculate mean and standard deviation while iterating over the data iterator.
    iterator (Iterable): Data iterator.
    dtype (npt.DTypeLike | None): Type of accumulators.</p>

  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#tuple">tuple</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a>, <a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a>]</code>
        – <p>tuple[float, float]; mean, Std.</p>
      </li>
  </ul>

      <details class="quote">
        <summary>Source code in <code>heartkit/datasets/preprocess.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-162" name="__codelineno-0-162"></a><span class="k">def</span> <span class="nf">running_mean_std</span><span class="p">(</span><span class="n">iterator</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">DTypeLike</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate mean and standard deviation while iterating over the data iterator.</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a><span class="sd">        iterator (Iterable): Data iterator.</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a><span class="sd">        dtype (npt.DTypeLike | None): Type of accumulators.</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a><span class="sd">        tuple[float, float]; mean, Std.</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a>    <span class="n">sum_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a>    <span class="n">sum_x2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a>    <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a>    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">iterator</span><span class="p">:</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a>        <span class="n">sum_x</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>        <span class="n">sum_x2</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a>        <span class="n">n</span> <span class="o">+=</span> <span class="n">x</span><span class="o">.</span><span class="n">size</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a>    <span class="n">mean</span> <span class="o">=</span> <span class="n">sum_x</span> <span class="o">/</span> <span class="n">n</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>    <span class="n">std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">sum_x2</span> <span class="o">/</span> <span class="n">n</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">mean</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a>    <span class="k">return</span> <span class="n">mean</span><span class="p">,</span> <span class="n">std</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="heartkit.datasets.icentia11k" class="doc doc-heading">
          <code>heartkit.datasets.icentia11k</code>


</h2>

  <div class="doc doc-contents first">

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="heartkit.datasets.icentia11k.IcentiaBeat" class="doc doc-heading">
        <code>IcentiaBeat</code>


</h3>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-external" title="enum.IntEnum" href="https://docs.python.org/3/library/enum.html#enum.IntEnum">IntEnum</a></code></p>

  
      <p>Incentia beat labels</p>


        <details class="quote">
          <summary>Source code in <code>heartkit/datasets/icentia11k.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span>
<span class="normal"><a href="#__codelineno-0-56">56</a></span>
<span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span>
<span class="normal"><a href="#__codelineno-0-64">64</a></span>
<span class="normal"><a href="#__codelineno-0-65">65</a></span>
<span class="normal"><a href="#__codelineno-0-66">66</a></span>
<span class="normal"><a href="#__codelineno-0-67">67</a></span>
<span class="normal"><a href="#__codelineno-0-68">68</a></span>
<span class="normal"><a href="#__codelineno-0-69">69</a></span>
<span class="normal"><a href="#__codelineno-0-70">70</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="k">class</span> <span class="nc">IcentiaBeat</span><span class="p">(</span><span class="n">IntEnum</span><span class="p">):</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Incentia beat labels&quot;&quot;&quot;</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a>    <span class="n">undefined</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a>    <span class="n">normal</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a>    <span class="n">pac</span> <span class="o">=</span> <span class="mi">2</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a>    <span class="c1"># aberrated = 3</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a>    <span class="n">pvc</span> <span class="o">=</span> <span class="mi">4</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>    <span class="nd">@classmethod</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a>    <span class="k">def</span> <span class="nf">hi_priority</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;High priority labels&quot;&quot;&quot;</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a>        <span class="k">return</span> <span class="p">[</span><span class="bp">cls</span><span class="o">.</span><span class="n">pac</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">pvc</span><span class="p">]</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a>    <span class="nd">@classmethod</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>    <span class="k">def</span> <span class="nf">lo_priority</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Low priority labels&quot;&quot;&quot;</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>        <span class="k">return</span> <span class="p">[</span><span class="bp">cls</span><span class="o">.</span><span class="n">undefined</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">normal</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h4 id="heartkit.datasets.icentia11k.IcentiaBeat.hi_priority" class="doc doc-heading">
<code class="highlight language-python"><span class="n">hi_priority</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h4>


  <div class="doc doc-contents ">
  
      <p>High priority labels</p>

      <details class="quote">
        <summary>Source code in <code>heartkit/datasets/icentia11k.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span>
<span class="normal"><a href="#__codelineno-0-64">64</a></span>
<span class="normal"><a href="#__codelineno-0-65">65</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-62" name="__codelineno-0-62"></a><span class="nd">@classmethod</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="k">def</span> <span class="nf">hi_priority</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;High priority labels&quot;&quot;&quot;</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a>    <span class="k">return</span> <span class="p">[</span><span class="bp">cls</span><span class="o">.</span><span class="n">pac</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">pvc</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="heartkit.datasets.icentia11k.IcentiaBeat.lo_priority" class="doc doc-heading">
<code class="highlight language-python"><span class="n">lo_priority</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h4>


  <div class="doc doc-contents ">
  
      <p>Low priority labels</p>

      <details class="quote">
        <summary>Source code in <code>heartkit/datasets/icentia11k.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-67">67</a></span>
<span class="normal"><a href="#__codelineno-0-68">68</a></span>
<span class="normal"><a href="#__codelineno-0-69">69</a></span>
<span class="normal"><a href="#__codelineno-0-70">70</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="nd">@classmethod</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a><span class="k">def</span> <span class="nf">lo_priority</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Low priority labels&quot;&quot;&quot;</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>    <span class="k">return</span> <span class="p">[</span><span class="bp">cls</span><span class="o">.</span><span class="n">undefined</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">normal</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="heartkit.datasets.icentia11k.IcentiaDataset" class="doc doc-heading">
        <code>IcentiaDataset</code>


</h3>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><span title="heartkit.datasets.dataset.HeartKitDataset">HeartKitDataset</span></code></p>

  
      <p>Icentia dataset</p>


        <details class="quote">
          <summary>Source code in <code>heartkit/datasets/icentia11k.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span>
<span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span>
<span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span>
<span class="normal"><a href="#__codelineno-0-309">309</a></span>
<span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span>
<span class="normal"><a href="#__codelineno-0-316">316</a></span>
<span class="normal"><a href="#__codelineno-0-317">317</a></span>
<span class="normal"><a href="#__codelineno-0-318">318</a></span>
<span class="normal"><a href="#__codelineno-0-319">319</a></span>
<span class="normal"><a href="#__codelineno-0-320">320</a></span>
<span class="normal"><a href="#__codelineno-0-321">321</a></span>
<span class="normal"><a href="#__codelineno-0-322">322</a></span>
<span class="normal"><a href="#__codelineno-0-323">323</a></span>
<span class="normal"><a href="#__codelineno-0-324">324</a></span>
<span class="normal"><a href="#__codelineno-0-325">325</a></span>
<span class="normal"><a href="#__codelineno-0-326">326</a></span>
<span class="normal"><a href="#__codelineno-0-327">327</a></span>
<span class="normal"><a href="#__codelineno-0-328">328</a></span>
<span class="normal"><a href="#__codelineno-0-329">329</a></span>
<span class="normal"><a href="#__codelineno-0-330">330</a></span>
<span class="normal"><a href="#__codelineno-0-331">331</a></span>
<span class="normal"><a href="#__codelineno-0-332">332</a></span>
<span class="normal"><a href="#__codelineno-0-333">333</a></span>
<span class="normal"><a href="#__codelineno-0-334">334</a></span>
<span class="normal"><a href="#__codelineno-0-335">335</a></span>
<span class="normal"><a href="#__codelineno-0-336">336</a></span>
<span class="normal"><a href="#__codelineno-0-337">337</a></span>
<span class="normal"><a href="#__codelineno-0-338">338</a></span>
<span class="normal"><a href="#__codelineno-0-339">339</a></span>
<span class="normal"><a href="#__codelineno-0-340">340</a></span>
<span class="normal"><a href="#__codelineno-0-341">341</a></span>
<span class="normal"><a href="#__codelineno-0-342">342</a></span>
<span class="normal"><a href="#__codelineno-0-343">343</a></span>
<span class="normal"><a href="#__codelineno-0-344">344</a></span>
<span class="normal"><a href="#__codelineno-0-345">345</a></span>
<span class="normal"><a href="#__codelineno-0-346">346</a></span>
<span class="normal"><a href="#__codelineno-0-347">347</a></span>
<span class="normal"><a href="#__codelineno-0-348">348</a></span>
<span class="normal"><a href="#__codelineno-0-349">349</a></span>
<span class="normal"><a href="#__codelineno-0-350">350</a></span>
<span class="normal"><a href="#__codelineno-0-351">351</a></span>
<span class="normal"><a href="#__codelineno-0-352">352</a></span>
<span class="normal"><a href="#__codelineno-0-353">353</a></span>
<span class="normal"><a href="#__codelineno-0-354">354</a></span>
<span class="normal"><a href="#__codelineno-0-355">355</a></span>
<span class="normal"><a href="#__codelineno-0-356">356</a></span>
<span class="normal"><a href="#__codelineno-0-357">357</a></span>
<span class="normal"><a href="#__codelineno-0-358">358</a></span>
<span class="normal"><a href="#__codelineno-0-359">359</a></span>
<span class="normal"><a href="#__codelineno-0-360">360</a></span>
<span class="normal"><a href="#__codelineno-0-361">361</a></span>
<span class="normal"><a href="#__codelineno-0-362">362</a></span>
<span class="normal"><a href="#__codelineno-0-363">363</a></span>
<span class="normal"><a href="#__codelineno-0-364">364</a></span>
<span class="normal"><a href="#__codelineno-0-365">365</a></span>
<span class="normal"><a href="#__codelineno-0-366">366</a></span>
<span class="normal"><a href="#__codelineno-0-367">367</a></span>
<span class="normal"><a href="#__codelineno-0-368">368</a></span>
<span class="normal"><a href="#__codelineno-0-369">369</a></span>
<span class="normal"><a href="#__codelineno-0-370">370</a></span>
<span class="normal"><a href="#__codelineno-0-371">371</a></span>
<span class="normal"><a href="#__codelineno-0-372">372</a></span>
<span class="normal"><a href="#__codelineno-0-373">373</a></span>
<span class="normal"><a href="#__codelineno-0-374">374</a></span>
<span class="normal"><a href="#__codelineno-0-375">375</a></span>
<span class="normal"><a href="#__codelineno-0-376">376</a></span>
<span class="normal"><a href="#__codelineno-0-377">377</a></span>
<span class="normal"><a href="#__codelineno-0-378">378</a></span>
<span class="normal"><a href="#__codelineno-0-379">379</a></span>
<span class="normal"><a href="#__codelineno-0-380">380</a></span>
<span class="normal"><a href="#__codelineno-0-381">381</a></span>
<span class="normal"><a href="#__codelineno-0-382">382</a></span>
<span class="normal"><a href="#__codelineno-0-383">383</a></span>
<span class="normal"><a href="#__codelineno-0-384">384</a></span>
<span class="normal"><a href="#__codelineno-0-385">385</a></span>
<span class="normal"><a href="#__codelineno-0-386">386</a></span>
<span class="normal"><a href="#__codelineno-0-387">387</a></span>
<span class="normal"><a href="#__codelineno-0-388">388</a></span>
<span class="normal"><a href="#__codelineno-0-389">389</a></span>
<span class="normal"><a href="#__codelineno-0-390">390</a></span>
<span class="normal"><a href="#__codelineno-0-391">391</a></span>
<span class="normal"><a href="#__codelineno-0-392">392</a></span>
<span class="normal"><a href="#__codelineno-0-393">393</a></span>
<span class="normal"><a href="#__codelineno-0-394">394</a></span>
<span class="normal"><a href="#__codelineno-0-395">395</a></span>
<span class="normal"><a href="#__codelineno-0-396">396</a></span>
<span class="normal"><a href="#__codelineno-0-397">397</a></span>
<span class="normal"><a href="#__codelineno-0-398">398</a></span>
<span class="normal"><a href="#__codelineno-0-399">399</a></span>
<span class="normal"><a href="#__codelineno-0-400">400</a></span>
<span class="normal"><a href="#__codelineno-0-401">401</a></span>
<span class="normal"><a href="#__codelineno-0-402">402</a></span>
<span class="normal"><a href="#__codelineno-0-403">403</a></span>
<span class="normal"><a href="#__codelineno-0-404">404</a></span>
<span class="normal"><a href="#__codelineno-0-405">405</a></span>
<span class="normal"><a href="#__codelineno-0-406">406</a></span>
<span class="normal"><a href="#__codelineno-0-407">407</a></span>
<span class="normal"><a href="#__codelineno-0-408">408</a></span>
<span class="normal"><a href="#__codelineno-0-409">409</a></span>
<span class="normal"><a href="#__codelineno-0-410">410</a></span>
<span class="normal"><a href="#__codelineno-0-411">411</a></span>
<span class="normal"><a href="#__codelineno-0-412">412</a></span>
<span class="normal"><a href="#__codelineno-0-413">413</a></span>
<span class="normal"><a href="#__codelineno-0-414">414</a></span>
<span class="normal"><a href="#__codelineno-0-415">415</a></span>
<span class="normal"><a href="#__codelineno-0-416">416</a></span>
<span class="normal"><a href="#__codelineno-0-417">417</a></span>
<span class="normal"><a href="#__codelineno-0-418">418</a></span>
<span class="normal"><a href="#__codelineno-0-419">419</a></span>
<span class="normal"><a href="#__codelineno-0-420">420</a></span>
<span class="normal"><a href="#__codelineno-0-421">421</a></span>
<span class="normal"><a href="#__codelineno-0-422">422</a></span>
<span class="normal"><a href="#__codelineno-0-423">423</a></span>
<span class="normal"><a href="#__codelineno-0-424">424</a></span>
<span class="normal"><a href="#__codelineno-0-425">425</a></span>
<span class="normal"><a href="#__codelineno-0-426">426</a></span>
<span class="normal"><a href="#__codelineno-0-427">427</a></span>
<span class="normal"><a href="#__codelineno-0-428">428</a></span>
<span class="normal"><a href="#__codelineno-0-429">429</a></span>
<span class="normal"><a href="#__codelineno-0-430">430</a></span>
<span class="normal"><a href="#__codelineno-0-431">431</a></span>
<span class="normal"><a href="#__codelineno-0-432">432</a></span>
<span class="normal"><a href="#__codelineno-0-433">433</a></span>
<span class="normal"><a href="#__codelineno-0-434">434</a></span>
<span class="normal"><a href="#__codelineno-0-435">435</a></span>
<span class="normal"><a href="#__codelineno-0-436">436</a></span>
<span class="normal"><a href="#__codelineno-0-437">437</a></span>
<span class="normal"><a href="#__codelineno-0-438">438</a></span>
<span class="normal"><a href="#__codelineno-0-439">439</a></span>
<span class="normal"><a href="#__codelineno-0-440">440</a></span>
<span class="normal"><a href="#__codelineno-0-441">441</a></span>
<span class="normal"><a href="#__codelineno-0-442">442</a></span>
<span class="normal"><a href="#__codelineno-0-443">443</a></span>
<span class="normal"><a href="#__codelineno-0-444">444</a></span>
<span class="normal"><a href="#__codelineno-0-445">445</a></span>
<span class="normal"><a href="#__codelineno-0-446">446</a></span>
<span class="normal"><a href="#__codelineno-0-447">447</a></span>
<span class="normal"><a href="#__codelineno-0-448">448</a></span>
<span class="normal"><a href="#__codelineno-0-449">449</a></span>
<span class="normal"><a href="#__codelineno-0-450">450</a></span>
<span class="normal"><a href="#__codelineno-0-451">451</a></span>
<span class="normal"><a href="#__codelineno-0-452">452</a></span>
<span class="normal"><a href="#__codelineno-0-453">453</a></span>
<span class="normal"><a href="#__codelineno-0-454">454</a></span>
<span class="normal"><a href="#__codelineno-0-455">455</a></span>
<span class="normal"><a href="#__codelineno-0-456">456</a></span>
<span class="normal"><a href="#__codelineno-0-457">457</a></span>
<span class="normal"><a href="#__codelineno-0-458">458</a></span>
<span class="normal"><a href="#__codelineno-0-459">459</a></span>
<span class="normal"><a href="#__codelineno-0-460">460</a></span>
<span class="normal"><a href="#__codelineno-0-461">461</a></span>
<span class="normal"><a href="#__codelineno-0-462">462</a></span>
<span class="normal"><a href="#__codelineno-0-463">463</a></span>
<span class="normal"><a href="#__codelineno-0-464">464</a></span>
<span class="normal"><a href="#__codelineno-0-465">465</a></span>
<span class="normal"><a href="#__codelineno-0-466">466</a></span>
<span class="normal"><a href="#__codelineno-0-467">467</a></span>
<span class="normal"><a href="#__codelineno-0-468">468</a></span>
<span class="normal"><a href="#__codelineno-0-469">469</a></span>
<span class="normal"><a href="#__codelineno-0-470">470</a></span>
<span class="normal"><a href="#__codelineno-0-471">471</a></span>
<span class="normal"><a href="#__codelineno-0-472">472</a></span>
<span class="normal"><a href="#__codelineno-0-473">473</a></span>
<span class="normal"><a href="#__codelineno-0-474">474</a></span>
<span class="normal"><a href="#__codelineno-0-475">475</a></span>
<span class="normal"><a href="#__codelineno-0-476">476</a></span>
<span class="normal"><a href="#__codelineno-0-477">477</a></span>
<span class="normal"><a href="#__codelineno-0-478">478</a></span>
<span class="normal"><a href="#__codelineno-0-479">479</a></span>
<span class="normal"><a href="#__codelineno-0-480">480</a></span>
<span class="normal"><a href="#__codelineno-0-481">481</a></span>
<span class="normal"><a href="#__codelineno-0-482">482</a></span>
<span class="normal"><a href="#__codelineno-0-483">483</a></span>
<span class="normal"><a href="#__codelineno-0-484">484</a></span>
<span class="normal"><a href="#__codelineno-0-485">485</a></span>
<span class="normal"><a href="#__codelineno-0-486">486</a></span>
<span class="normal"><a href="#__codelineno-0-487">487</a></span>
<span class="normal"><a href="#__codelineno-0-488">488</a></span>
<span class="normal"><a href="#__codelineno-0-489">489</a></span>
<span class="normal"><a href="#__codelineno-0-490">490</a></span>
<span class="normal"><a href="#__codelineno-0-491">491</a></span>
<span class="normal"><a href="#__codelineno-0-492">492</a></span>
<span class="normal"><a href="#__codelineno-0-493">493</a></span>
<span class="normal"><a href="#__codelineno-0-494">494</a></span>
<span class="normal"><a href="#__codelineno-0-495">495</a></span>
<span class="normal"><a href="#__codelineno-0-496">496</a></span>
<span class="normal"><a href="#__codelineno-0-497">497</a></span>
<span class="normal"><a href="#__codelineno-0-498">498</a></span>
<span class="normal"><a href="#__codelineno-0-499">499</a></span>
<span class="normal"><a href="#__codelineno-0-500">500</a></span>
<span class="normal"><a href="#__codelineno-0-501">501</a></span>
<span class="normal"><a href="#__codelineno-0-502">502</a></span>
<span class="normal"><a href="#__codelineno-0-503">503</a></span>
<span class="normal"><a href="#__codelineno-0-504">504</a></span>
<span class="normal"><a href="#__codelineno-0-505">505</a></span>
<span class="normal"><a href="#__codelineno-0-506">506</a></span>
<span class="normal"><a href="#__codelineno-0-507">507</a></span>
<span class="normal"><a href="#__codelineno-0-508">508</a></span>
<span class="normal"><a href="#__codelineno-0-509">509</a></span>
<span class="normal"><a href="#__codelineno-0-510">510</a></span>
<span class="normal"><a href="#__codelineno-0-511">511</a></span>
<span class="normal"><a href="#__codelineno-0-512">512</a></span>
<span class="normal"><a href="#__codelineno-0-513">513</a></span>
<span class="normal"><a href="#__codelineno-0-514">514</a></span>
<span class="normal"><a href="#__codelineno-0-515">515</a></span>
<span class="normal"><a href="#__codelineno-0-516">516</a></span>
<span class="normal"><a href="#__codelineno-0-517">517</a></span>
<span class="normal"><a href="#__codelineno-0-518">518</a></span>
<span class="normal"><a href="#__codelineno-0-519">519</a></span>
<span class="normal"><a href="#__codelineno-0-520">520</a></span>
<span class="normal"><a href="#__codelineno-0-521">521</a></span>
<span class="normal"><a href="#__codelineno-0-522">522</a></span>
<span class="normal"><a href="#__codelineno-0-523">523</a></span>
<span class="normal"><a href="#__codelineno-0-524">524</a></span>
<span class="normal"><a href="#__codelineno-0-525">525</a></span>
<span class="normal"><a href="#__codelineno-0-526">526</a></span>
<span class="normal"><a href="#__codelineno-0-527">527</a></span>
<span class="normal"><a href="#__codelineno-0-528">528</a></span>
<span class="normal"><a href="#__codelineno-0-529">529</a></span>
<span class="normal"><a href="#__codelineno-0-530">530</a></span>
<span class="normal"><a href="#__codelineno-0-531">531</a></span>
<span class="normal"><a href="#__codelineno-0-532">532</a></span>
<span class="normal"><a href="#__codelineno-0-533">533</a></span>
<span class="normal"><a href="#__codelineno-0-534">534</a></span>
<span class="normal"><a href="#__codelineno-0-535">535</a></span>
<span class="normal"><a href="#__codelineno-0-536">536</a></span>
<span class="normal"><a href="#__codelineno-0-537">537</a></span>
<span class="normal"><a href="#__codelineno-0-538">538</a></span>
<span class="normal"><a href="#__codelineno-0-539">539</a></span>
<span class="normal"><a href="#__codelineno-0-540">540</a></span>
<span class="normal"><a href="#__codelineno-0-541">541</a></span>
<span class="normal"><a href="#__codelineno-0-542">542</a></span>
<span class="normal"><a href="#__codelineno-0-543">543</a></span>
<span class="normal"><a href="#__codelineno-0-544">544</a></span>
<span class="normal"><a href="#__codelineno-0-545">545</a></span>
<span class="normal"><a href="#__codelineno-0-546">546</a></span>
<span class="normal"><a href="#__codelineno-0-547">547</a></span>
<span class="normal"><a href="#__codelineno-0-548">548</a></span>
<span class="normal"><a href="#__codelineno-0-549">549</a></span>
<span class="normal"><a href="#__codelineno-0-550">550</a></span>
<span class="normal"><a href="#__codelineno-0-551">551</a></span>
<span class="normal"><a href="#__codelineno-0-552">552</a></span>
<span class="normal"><a href="#__codelineno-0-553">553</a></span>
<span class="normal"><a href="#__codelineno-0-554">554</a></span>
<span class="normal"><a href="#__codelineno-0-555">555</a></span>
<span class="normal"><a href="#__codelineno-0-556">556</a></span>
<span class="normal"><a href="#__codelineno-0-557">557</a></span>
<span class="normal"><a href="#__codelineno-0-558">558</a></span>
<span class="normal"><a href="#__codelineno-0-559">559</a></span>
<span class="normal"><a href="#__codelineno-0-560">560</a></span>
<span class="normal"><a href="#__codelineno-0-561">561</a></span>
<span class="normal"><a href="#__codelineno-0-562">562</a></span>
<span class="normal"><a href="#__codelineno-0-563">563</a></span>
<span class="normal"><a href="#__codelineno-0-564">564</a></span>
<span class="normal"><a href="#__codelineno-0-565">565</a></span>
<span class="normal"><a href="#__codelineno-0-566">566</a></span>
<span class="normal"><a href="#__codelineno-0-567">567</a></span>
<span class="normal"><a href="#__codelineno-0-568">568</a></span>
<span class="normal"><a href="#__codelineno-0-569">569</a></span>
<span class="normal"><a href="#__codelineno-0-570">570</a></span>
<span class="normal"><a href="#__codelineno-0-571">571</a></span>
<span class="normal"><a href="#__codelineno-0-572">572</a></span>
<span class="normal"><a href="#__codelineno-0-573">573</a></span>
<span class="normal"><a href="#__codelineno-0-574">574</a></span>
<span class="normal"><a href="#__codelineno-0-575">575</a></span>
<span class="normal"><a href="#__codelineno-0-576">576</a></span>
<span class="normal"><a href="#__codelineno-0-577">577</a></span>
<span class="normal"><a href="#__codelineno-0-578">578</a></span>
<span class="normal"><a href="#__codelineno-0-579">579</a></span>
<span class="normal"><a href="#__codelineno-0-580">580</a></span>
<span class="normal"><a href="#__codelineno-0-581">581</a></span>
<span class="normal"><a href="#__codelineno-0-582">582</a></span>
<span class="normal"><a href="#__codelineno-0-583">583</a></span>
<span class="normal"><a href="#__codelineno-0-584">584</a></span>
<span class="normal"><a href="#__codelineno-0-585">585</a></span>
<span class="normal"><a href="#__codelineno-0-586">586</a></span>
<span class="normal"><a href="#__codelineno-0-587">587</a></span>
<span class="normal"><a href="#__codelineno-0-588">588</a></span>
<span class="normal"><a href="#__codelineno-0-589">589</a></span>
<span class="normal"><a href="#__codelineno-0-590">590</a></span>
<span class="normal"><a href="#__codelineno-0-591">591</a></span>
<span class="normal"><a href="#__codelineno-0-592">592</a></span>
<span class="normal"><a href="#__codelineno-0-593">593</a></span>
<span class="normal"><a href="#__codelineno-0-594">594</a></span>
<span class="normal"><a href="#__codelineno-0-595">595</a></span>
<span class="normal"><a href="#__codelineno-0-596">596</a></span>
<span class="normal"><a href="#__codelineno-0-597">597</a></span>
<span class="normal"><a href="#__codelineno-0-598">598</a></span>
<span class="normal"><a href="#__codelineno-0-599">599</a></span>
<span class="normal"><a href="#__codelineno-0-600">600</a></span>
<span class="normal"><a href="#__codelineno-0-601">601</a></span>
<span class="normal"><a href="#__codelineno-0-602">602</a></span>
<span class="normal"><a href="#__codelineno-0-603">603</a></span>
<span class="normal"><a href="#__codelineno-0-604">604</a></span>
<span class="normal"><a href="#__codelineno-0-605">605</a></span>
<span class="normal"><a href="#__codelineno-0-606">606</a></span>
<span class="normal"><a href="#__codelineno-0-607">607</a></span>
<span class="normal"><a href="#__codelineno-0-608">608</a></span>
<span class="normal"><a href="#__codelineno-0-609">609</a></span>
<span class="normal"><a href="#__codelineno-0-610">610</a></span>
<span class="normal"><a href="#__codelineno-0-611">611</a></span>
<span class="normal"><a href="#__codelineno-0-612">612</a></span>
<span class="normal"><a href="#__codelineno-0-613">613</a></span>
<span class="normal"><a href="#__codelineno-0-614">614</a></span>
<span class="normal"><a href="#__codelineno-0-615">615</a></span>
<span class="normal"><a href="#__codelineno-0-616">616</a></span>
<span class="normal"><a href="#__codelineno-0-617">617</a></span>
<span class="normal"><a href="#__codelineno-0-618">618</a></span>
<span class="normal"><a href="#__codelineno-0-619">619</a></span>
<span class="normal"><a href="#__codelineno-0-620">620</a></span>
<span class="normal"><a href="#__codelineno-0-621">621</a></span>
<span class="normal"><a href="#__codelineno-0-622">622</a></span>
<span class="normal"><a href="#__codelineno-0-623">623</a></span>
<span class="normal"><a href="#__codelineno-0-624">624</a></span>
<span class="normal"><a href="#__codelineno-0-625">625</a></span>
<span class="normal"><a href="#__codelineno-0-626">626</a></span>
<span class="normal"><a href="#__codelineno-0-627">627</a></span>
<span class="normal"><a href="#__codelineno-0-628">628</a></span>
<span class="normal"><a href="#__codelineno-0-629">629</a></span>
<span class="normal"><a href="#__codelineno-0-630">630</a></span>
<span class="normal"><a href="#__codelineno-0-631">631</a></span>
<span class="normal"><a href="#__codelineno-0-632">632</a></span>
<span class="normal"><a href="#__codelineno-0-633">633</a></span>
<span class="normal"><a href="#__codelineno-0-634">634</a></span>
<span class="normal"><a href="#__codelineno-0-635">635</a></span>
<span class="normal"><a href="#__codelineno-0-636">636</a></span>
<span class="normal"><a href="#__codelineno-0-637">637</a></span>
<span class="normal"><a href="#__codelineno-0-638">638</a></span>
<span class="normal"><a href="#__codelineno-0-639">639</a></span>
<span class="normal"><a href="#__codelineno-0-640">640</a></span>
<span class="normal"><a href="#__codelineno-0-641">641</a></span>
<span class="normal"><a href="#__codelineno-0-642">642</a></span>
<span class="normal"><a href="#__codelineno-0-643">643</a></span>
<span class="normal"><a href="#__codelineno-0-644">644</a></span>
<span class="normal"><a href="#__codelineno-0-645">645</a></span>
<span class="normal"><a href="#__codelineno-0-646">646</a></span>
<span class="normal"><a href="#__codelineno-0-647">647</a></span>
<span class="normal"><a href="#__codelineno-0-648">648</a></span>
<span class="normal"><a href="#__codelineno-0-649">649</a></span>
<span class="normal"><a href="#__codelineno-0-650">650</a></span>
<span class="normal"><a href="#__codelineno-0-651">651</a></span>
<span class="normal"><a href="#__codelineno-0-652">652</a></span>
<span class="normal"><a href="#__codelineno-0-653">653</a></span>
<span class="normal"><a href="#__codelineno-0-654">654</a></span>
<span class="normal"><a href="#__codelineno-0-655">655</a></span>
<span class="normal"><a href="#__codelineno-0-656">656</a></span>
<span class="normal"><a href="#__codelineno-0-657">657</a></span>
<span class="normal"><a href="#__codelineno-0-658">658</a></span>
<span class="normal"><a href="#__codelineno-0-659">659</a></span>
<span class="normal"><a href="#__codelineno-0-660">660</a></span>
<span class="normal"><a href="#__codelineno-0-661">661</a></span>
<span class="normal"><a href="#__codelineno-0-662">662</a></span>
<span class="normal"><a href="#__codelineno-0-663">663</a></span>
<span class="normal"><a href="#__codelineno-0-664">664</a></span>
<span class="normal"><a href="#__codelineno-0-665">665</a></span>
<span class="normal"><a href="#__codelineno-0-666">666</a></span>
<span class="normal"><a href="#__codelineno-0-667">667</a></span>
<span class="normal"><a href="#__codelineno-0-668">668</a></span>
<span class="normal"><a href="#__codelineno-0-669">669</a></span>
<span class="normal"><a href="#__codelineno-0-670">670</a></span>
<span class="normal"><a href="#__codelineno-0-671">671</a></span>
<span class="normal"><a href="#__codelineno-0-672">672</a></span>
<span class="normal"><a href="#__codelineno-0-673">673</a></span>
<span class="normal"><a href="#__codelineno-0-674">674</a></span>
<span class="normal"><a href="#__codelineno-0-675">675</a></span>
<span class="normal"><a href="#__codelineno-0-676">676</a></span>
<span class="normal"><a href="#__codelineno-0-677">677</a></span>
<span class="normal"><a href="#__codelineno-0-678">678</a></span>
<span class="normal"><a href="#__codelineno-0-679">679</a></span>
<span class="normal"><a href="#__codelineno-0-680">680</a></span>
<span class="normal"><a href="#__codelineno-0-681">681</a></span>
<span class="normal"><a href="#__codelineno-0-682">682</a></span>
<span class="normal"><a href="#__codelineno-0-683">683</a></span>
<span class="normal"><a href="#__codelineno-0-684">684</a></span>
<span class="normal"><a href="#__codelineno-0-685">685</a></span>
<span class="normal"><a href="#__codelineno-0-686">686</a></span>
<span class="normal"><a href="#__codelineno-0-687">687</a></span>
<span class="normal"><a href="#__codelineno-0-688">688</a></span>
<span class="normal"><a href="#__codelineno-0-689">689</a></span>
<span class="normal"><a href="#__codelineno-0-690">690</a></span>
<span class="normal"><a href="#__codelineno-0-691">691</a></span>
<span class="normal"><a href="#__codelineno-0-692">692</a></span>
<span class="normal"><a href="#__codelineno-0-693">693</a></span>
<span class="normal"><a href="#__codelineno-0-694">694</a></span>
<span class="normal"><a href="#__codelineno-0-695">695</a></span>
<span class="normal"><a href="#__codelineno-0-696">696</a></span>
<span class="normal"><a href="#__codelineno-0-697">697</a></span>
<span class="normal"><a href="#__codelineno-0-698">698</a></span>
<span class="normal"><a href="#__codelineno-0-699">699</a></span>
<span class="normal"><a href="#__codelineno-0-700">700</a></span>
<span class="normal"><a href="#__codelineno-0-701">701</a></span>
<span class="normal"><a href="#__codelineno-0-702">702</a></span>
<span class="normal"><a href="#__codelineno-0-703">703</a></span>
<span class="normal"><a href="#__codelineno-0-704">704</a></span>
<span class="normal"><a href="#__codelineno-0-705">705</a></span>
<span class="normal"><a href="#__codelineno-0-706">706</a></span>
<span class="normal"><a href="#__codelineno-0-707">707</a></span>
<span class="normal"><a href="#__codelineno-0-708">708</a></span>
<span class="normal"><a href="#__codelineno-0-709">709</a></span>
<span class="normal"><a href="#__codelineno-0-710">710</a></span>
<span class="normal"><a href="#__codelineno-0-711">711</a></span>
<span class="normal"><a href="#__codelineno-0-712">712</a></span>
<span class="normal"><a href="#__codelineno-0-713">713</a></span>
<span class="normal"><a href="#__codelineno-0-714">714</a></span>
<span class="normal"><a href="#__codelineno-0-715">715</a></span>
<span class="normal"><a href="#__codelineno-0-716">716</a></span>
<span class="normal"><a href="#__codelineno-0-717">717</a></span>
<span class="normal"><a href="#__codelineno-0-718">718</a></span>
<span class="normal"><a href="#__codelineno-0-719">719</a></span>
<span class="normal"><a href="#__codelineno-0-720">720</a></span>
<span class="normal"><a href="#__codelineno-0-721">721</a></span>
<span class="normal"><a href="#__codelineno-0-722">722</a></span>
<span class="normal"><a href="#__codelineno-0-723">723</a></span>
<span class="normal"><a href="#__codelineno-0-724">724</a></span>
<span class="normal"><a href="#__codelineno-0-725">725</a></span>
<span class="normal"><a href="#__codelineno-0-726">726</a></span>
<span class="normal"><a href="#__codelineno-0-727">727</a></span>
<span class="normal"><a href="#__codelineno-0-728">728</a></span>
<span class="normal"><a href="#__codelineno-0-729">729</a></span>
<span class="normal"><a href="#__codelineno-0-730">730</a></span>
<span class="normal"><a href="#__codelineno-0-731">731</a></span>
<span class="normal"><a href="#__codelineno-0-732">732</a></span>
<span class="normal"><a href="#__codelineno-0-733">733</a></span>
<span class="normal"><a href="#__codelineno-0-734">734</a></span>
<span class="normal"><a href="#__codelineno-0-735">735</a></span>
<span class="normal"><a href="#__codelineno-0-736">736</a></span>
<span class="normal"><a href="#__codelineno-0-737">737</a></span>
<span class="normal"><a href="#__codelineno-0-738">738</a></span>
<span class="normal"><a href="#__codelineno-0-739">739</a></span>
<span class="normal"><a href="#__codelineno-0-740">740</a></span>
<span class="normal"><a href="#__codelineno-0-741">741</a></span>
<span class="normal"><a href="#__codelineno-0-742">742</a></span>
<span class="normal"><a href="#__codelineno-0-743">743</a></span>
<span class="normal"><a href="#__codelineno-0-744">744</a></span>
<span class="normal"><a href="#__codelineno-0-745">745</a></span>
<span class="normal"><a href="#__codelineno-0-746">746</a></span>
<span class="normal"><a href="#__codelineno-0-747">747</a></span>
<span class="normal"><a href="#__codelineno-0-748">748</a></span>
<span class="normal"><a href="#__codelineno-0-749">749</a></span>
<span class="normal"><a href="#__codelineno-0-750">750</a></span>
<span class="normal"><a href="#__codelineno-0-751">751</a></span>
<span class="normal"><a href="#__codelineno-0-752">752</a></span>
<span class="normal"><a href="#__codelineno-0-753">753</a></span>
<span class="normal"><a href="#__codelineno-0-754">754</a></span>
<span class="normal"><a href="#__codelineno-0-755">755</a></span>
<span class="normal"><a href="#__codelineno-0-756">756</a></span>
<span class="normal"><a href="#__codelineno-0-757">757</a></span>
<span class="normal"><a href="#__codelineno-0-758">758</a></span>
<span class="normal"><a href="#__codelineno-0-759">759</a></span>
<span class="normal"><a href="#__codelineno-0-760">760</a></span>
<span class="normal"><a href="#__codelineno-0-761">761</a></span>
<span class="normal"><a href="#__codelineno-0-762">762</a></span>
<span class="normal"><a href="#__codelineno-0-763">763</a></span>
<span class="normal"><a href="#__codelineno-0-764">764</a></span>
<span class="normal"><a href="#__codelineno-0-765">765</a></span>
<span class="normal"><a href="#__codelineno-0-766">766</a></span>
<span class="normal"><a href="#__codelineno-0-767">767</a></span>
<span class="normal"><a href="#__codelineno-0-768">768</a></span>
<span class="normal"><a href="#__codelineno-0-769">769</a></span>
<span class="normal"><a href="#__codelineno-0-770">770</a></span>
<span class="normal"><a href="#__codelineno-0-771">771</a></span>
<span class="normal"><a href="#__codelineno-0-772">772</a></span>
<span class="normal"><a href="#__codelineno-0-773">773</a></span>
<span class="normal"><a href="#__codelineno-0-774">774</a></span>
<span class="normal"><a href="#__codelineno-0-775">775</a></span>
<span class="normal"><a href="#__codelineno-0-776">776</a></span>
<span class="normal"><a href="#__codelineno-0-777">777</a></span>
<span class="normal"><a href="#__codelineno-0-778">778</a></span>
<span class="normal"><a href="#__codelineno-0-779">779</a></span>
<span class="normal"><a href="#__codelineno-0-780">780</a></span>
<span class="normal"><a href="#__codelineno-0-781">781</a></span>
<span class="normal"><a href="#__codelineno-0-782">782</a></span>
<span class="normal"><a href="#__codelineno-0-783">783</a></span>
<span class="normal"><a href="#__codelineno-0-784">784</a></span>
<span class="normal"><a href="#__codelineno-0-785">785</a></span>
<span class="normal"><a href="#__codelineno-0-786">786</a></span>
<span class="normal"><a href="#__codelineno-0-787">787</a></span>
<span class="normal"><a href="#__codelineno-0-788">788</a></span>
<span class="normal"><a href="#__codelineno-0-789">789</a></span>
<span class="normal"><a href="#__codelineno-0-790">790</a></span>
<span class="normal"><a href="#__codelineno-0-791">791</a></span>
<span class="normal"><a href="#__codelineno-0-792">792</a></span>
<span class="normal"><a href="#__codelineno-0-793">793</a></span>
<span class="normal"><a href="#__codelineno-0-794">794</a></span>
<span class="normal"><a href="#__codelineno-0-795">795</a></span>
<span class="normal"><a href="#__codelineno-0-796">796</a></span>
<span class="normal"><a href="#__codelineno-0-797">797</a></span>
<span class="normal"><a href="#__codelineno-0-798">798</a></span>
<span class="normal"><a href="#__codelineno-0-799">799</a></span>
<span class="normal"><a href="#__codelineno-0-800">800</a></span>
<span class="normal"><a href="#__codelineno-0-801">801</a></span>
<span class="normal"><a href="#__codelineno-0-802">802</a></span>
<span class="normal"><a href="#__codelineno-0-803">803</a></span>
<span class="normal"><a href="#__codelineno-0-804">804</a></span>
<span class="normal"><a href="#__codelineno-0-805">805</a></span>
<span class="normal"><a href="#__codelineno-0-806">806</a></span>
<span class="normal"><a href="#__codelineno-0-807">807</a></span>
<span class="normal"><a href="#__codelineno-0-808">808</a></span>
<span class="normal"><a href="#__codelineno-0-809">809</a></span>
<span class="normal"><a href="#__codelineno-0-810">810</a></span>
<span class="normal"><a href="#__codelineno-0-811">811</a></span>
<span class="normal"><a href="#__codelineno-0-812">812</a></span>
<span class="normal"><a href="#__codelineno-0-813">813</a></span>
<span class="normal"><a href="#__codelineno-0-814">814</a></span>
<span class="normal"><a href="#__codelineno-0-815">815</a></span>
<span class="normal"><a href="#__codelineno-0-816">816</a></span>
<span class="normal"><a href="#__codelineno-0-817">817</a></span>
<span class="normal"><a href="#__codelineno-0-818">818</a></span>
<span class="normal"><a href="#__codelineno-0-819">819</a></span>
<span class="normal"><a href="#__codelineno-0-820">820</a></span>
<span class="normal"><a href="#__codelineno-0-821">821</a></span>
<span class="normal"><a href="#__codelineno-0-822">822</a></span>
<span class="normal"><a href="#__codelineno-0-823">823</a></span>
<span class="normal"><a href="#__codelineno-0-824">824</a></span>
<span class="normal"><a href="#__codelineno-0-825">825</a></span>
<span class="normal"><a href="#__codelineno-0-826">826</a></span>
<span class="normal"><a href="#__codelineno-0-827">827</a></span>
<span class="normal"><a href="#__codelineno-0-828">828</a></span>
<span class="normal"><a href="#__codelineno-0-829">829</a></span>
<span class="normal"><a href="#__codelineno-0-830">830</a></span>
<span class="normal"><a href="#__codelineno-0-831">831</a></span>
<span class="normal"><a href="#__codelineno-0-832">832</a></span>
<span class="normal"><a href="#__codelineno-0-833">833</a></span>
<span class="normal"><a href="#__codelineno-0-834">834</a></span>
<span class="normal"><a href="#__codelineno-0-835">835</a></span>
<span class="normal"><a href="#__codelineno-0-836">836</a></span>
<span class="normal"><a href="#__codelineno-0-837">837</a></span>
<span class="normal"><a href="#__codelineno-0-838">838</a></span>
<span class="normal"><a href="#__codelineno-0-839">839</a></span>
<span class="normal"><a href="#__codelineno-0-840">840</a></span>
<span class="normal"><a href="#__codelineno-0-841">841</a></span>
<span class="normal"><a href="#__codelineno-0-842">842</a></span>
<span class="normal"><a href="#__codelineno-0-843">843</a></span>
<span class="normal"><a href="#__codelineno-0-844">844</a></span>
<span class="normal"><a href="#__codelineno-0-845">845</a></span>
<span class="normal"><a href="#__codelineno-0-846">846</a></span>
<span class="normal"><a href="#__codelineno-0-847">847</a></span>
<span class="normal"><a href="#__codelineno-0-848">848</a></span>
<span class="normal"><a href="#__codelineno-0-849">849</a></span>
<span class="normal"><a href="#__codelineno-0-850">850</a></span>
<span class="normal"><a href="#__codelineno-0-851">851</a></span>
<span class="normal"><a href="#__codelineno-0-852">852</a></span>
<span class="normal"><a href="#__codelineno-0-853">853</a></span>
<span class="normal"><a href="#__codelineno-0-854">854</a></span>
<span class="normal"><a href="#__codelineno-0-855">855</a></span>
<span class="normal"><a href="#__codelineno-0-856">856</a></span>
<span class="normal"><a href="#__codelineno-0-857">857</a></span>
<span class="normal"><a href="#__codelineno-0-858">858</a></span>
<span class="normal"><a href="#__codelineno-0-859">859</a></span>
<span class="normal"><a href="#__codelineno-0-860">860</a></span>
<span class="normal"><a href="#__codelineno-0-861">861</a></span>
<span class="normal"><a href="#__codelineno-0-862">862</a></span>
<span class="normal"><a href="#__codelineno-0-863">863</a></span>
<span class="normal"><a href="#__codelineno-0-864">864</a></span>
<span class="normal"><a href="#__codelineno-0-865">865</a></span>
<span class="normal"><a href="#__codelineno-0-866">866</a></span>
<span class="normal"><a href="#__codelineno-0-867">867</a></span>
<span class="normal"><a href="#__codelineno-0-868">868</a></span>
<span class="normal"><a href="#__codelineno-0-869">869</a></span>
<span class="normal"><a href="#__codelineno-0-870">870</a></span>
<span class="normal"><a href="#__codelineno-0-871">871</a></span>
<span class="normal"><a href="#__codelineno-0-872">872</a></span>
<span class="normal"><a href="#__codelineno-0-873">873</a></span>
<span class="normal"><a href="#__codelineno-0-874">874</a></span>
<span class="normal"><a href="#__codelineno-0-875">875</a></span>
<span class="normal"><a href="#__codelineno-0-876">876</a></span>
<span class="normal"><a href="#__codelineno-0-877">877</a></span>
<span class="normal"><a href="#__codelineno-0-878">878</a></span>
<span class="normal"><a href="#__codelineno-0-879">879</a></span>
<span class="normal"><a href="#__codelineno-0-880">880</a></span>
<span class="normal"><a href="#__codelineno-0-881">881</a></span>
<span class="normal"><a href="#__codelineno-0-882">882</a></span>
<span class="normal"><a href="#__codelineno-0-883">883</a></span>
<span class="normal"><a href="#__codelineno-0-884">884</a></span>
<span class="normal"><a href="#__codelineno-0-885">885</a></span>
<span class="normal"><a href="#__codelineno-0-886">886</a></span>
<span class="normal"><a href="#__codelineno-0-887">887</a></span>
<span class="normal"><a href="#__codelineno-0-888">888</a></span>
<span class="normal"><a href="#__codelineno-0-889">889</a></span>
<span class="normal"><a href="#__codelineno-0-890">890</a></span>
<span class="normal"><a href="#__codelineno-0-891">891</a></span>
<span class="normal"><a href="#__codelineno-0-892">892</a></span>
<span class="normal"><a href="#__codelineno-0-893">893</a></span>
<span class="normal"><a href="#__codelineno-0-894">894</a></span>
<span class="normal"><a href="#__codelineno-0-895">895</a></span>
<span class="normal"><a href="#__codelineno-0-896">896</a></span>
<span class="normal"><a href="#__codelineno-0-897">897</a></span>
<span class="normal"><a href="#__codelineno-0-898">898</a></span>
<span class="normal"><a href="#__codelineno-0-899">899</a></span>
<span class="normal"><a href="#__codelineno-0-900">900</a></span>
<span class="normal"><a href="#__codelineno-0-901">901</a></span>
<span class="normal"><a href="#__codelineno-0-902">902</a></span>
<span class="normal"><a href="#__codelineno-0-903">903</a></span>
<span class="normal"><a href="#__codelineno-0-904">904</a></span>
<span class="normal"><a href="#__codelineno-0-905">905</a></span>
<span class="normal"><a href="#__codelineno-0-906">906</a></span>
<span class="normal"><a href="#__codelineno-0-907">907</a></span>
<span class="normal"><a href="#__codelineno-0-908">908</a></span>
<span class="normal"><a href="#__codelineno-0-909">909</a></span>
<span class="normal"><a href="#__codelineno-0-910">910</a></span>
<span class="normal"><a href="#__codelineno-0-911">911</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-101" name="__codelineno-0-101"></a><span class="k">class</span> <span class="nc">IcentiaDataset</span><span class="p">(</span><span class="n">HeartKitDataset</span><span class="p">):</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Icentia dataset&quot;&quot;&quot;</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>        <span class="n">ds_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>        <span class="n">task</span><span class="p">:</span> <span class="n">HeartTask</span> <span class="o">=</span> <span class="n">HeartTask</span><span class="o">.</span><span class="n">arrhythmia</span><span class="p">,</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>        <span class="n">frame_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1250</span><span class="p">,</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>        <span class="n">target_rate</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">250</span><span class="p">,</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ds_path</span><span class="p">,</span> <span class="s2">&quot;icentia11k&quot;</span><span class="p">),</span> <span class="n">task</span><span class="p">,</span> <span class="n">frame_size</span><span class="p">,</span> <span class="n">target_rate</span><span class="p">)</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>    <span class="nd">@property</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>    <span class="k">def</span> <span class="nf">sampling_rate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Sampling rate in Hz&quot;&quot;&quot;</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>        <span class="k">return</span> <span class="mi">250</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>    <span class="nd">@property</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>    <span class="k">def</span> <span class="nf">mean</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Dataset mean&quot;&quot;&quot;</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>        <span class="k">return</span> <span class="mf">0.0018</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>    <span class="nd">@property</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>    <span class="k">def</span> <span class="nf">std</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Dataset st dev&quot;&quot;&quot;</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>        <span class="k">return</span> <span class="mf">1.3711</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>    <span class="nd">@property</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>    <span class="k">def</span> <span class="nf">patient_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">:</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get dataset patient IDs</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a><span class="sd">            npt.NDArray: patient IDs</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">11_000</span><span class="p">)</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>    <span class="k">def</span> <span class="nf">get_train_patient_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">:</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get training patient IDs</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a><span class="sd">            npt.NDArray: patient IDs</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">patient_ids</span><span class="p">[:</span><span class="mi">10_000</span><span class="p">]</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>    <span class="k">def</span> <span class="nf">get_test_patient_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">:</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get patient IDs reserved for testing only</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a><span class="sd">            npt.NDArray: patient IDs</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">patient_ids</span><span class="p">[</span><span class="mi">10_000</span><span class="p">:]</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>    <span class="k">def</span> <span class="nf">_pt_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">patient_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;p</span><span class="si">{</span><span class="n">patient_id</span><span class="si">:</span><span class="s2">05d</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>    <span class="nd">@functools</span><span class="o">.</span><span class="n">cached_property</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>    <span class="k">def</span> <span class="nf">arr_rhythm_patients</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">:</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Find all patients with arrhythmia events. This takes roughly 10 secs.</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a><span class="sd">            npt.NDArray: Patient ids</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a>        <span class="n">patient_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">patient_ids</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>        <span class="k">with</span> <span class="n">Pool</span><span class="p">()</span> <span class="k">as</span> <span class="n">pool</span><span class="p">:</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>            <span class="n">arr_pts_bool</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">pool</span><span class="o">.</span><span class="n">imap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_pt_has_rhythm_arrhythmia</span><span class="p">,</span> <span class="n">patient_ids</span><span class="p">))</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>        <span class="n">patient_ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">arr_pts_bool</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a>        <span class="k">return</span> <span class="n">patient_ids</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a>    <span class="k">def</span> <span class="nf">task_data_generator</span><span class="p">(</span>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a>        <span class="n">patient_generator</span><span class="p">:</span> <span class="n">PatientGenerator</span><span class="p">,</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a>        <span class="n">samples_per_patient</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SampleGenerator</span><span class="p">:</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Task-level data generator.</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a><span class="sd">            patient_generator (PatientGenerator): Patient data generator</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a><span class="sd">            samples_per_patient (int | list[int], optional): # samples per patient. Defaults to 1.</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a><span class="sd">            SampleGenerator: Sample data generator</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">task</span> <span class="o">==</span> <span class="n">HeartTask</span><span class="o">.</span><span class="n">arrhythmia</span><span class="p">:</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rhythm_data_generator</span><span class="p">(</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a>                <span class="n">patient_generator</span><span class="o">=</span><span class="n">patient_generator</span><span class="p">,</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a>                <span class="n">samples_per_patient</span><span class="o">=</span><span class="n">samples_per_patient</span><span class="p">,</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a>            <span class="p">)</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">task</span> <span class="o">==</span> <span class="n">HeartTask</span><span class="o">.</span><span class="n">beat</span><span class="p">:</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">beat_data_generator</span><span class="p">(</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a>                <span class="n">patient_generator</span><span class="o">=</span><span class="n">patient_generator</span><span class="p">,</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a>                <span class="n">samples_per_patient</span><span class="o">=</span><span class="n">samples_per_patient</span><span class="p">,</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a>            <span class="p">)</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">task</span> <span class="o">==</span> <span class="n">HeartTask</span><span class="o">.</span><span class="n">hrv</span><span class="p">:</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">heart_rate_data_generator</span><span class="p">(</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a>                <span class="n">patient_generator</span><span class="o">=</span><span class="n">patient_generator</span><span class="p">,</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a>                <span class="n">samples_per_patient</span><span class="o">=</span><span class="n">samples_per_patient</span><span class="p">,</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a>            <span class="p">)</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a>    <span class="k">def</span> <span class="nf">_split_train_test_patients</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">patient_ids</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">,</span> <span class="n">test_size</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]]:</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Perform train/test split on patients for given task.</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a><span class="sd">        NOTE: We only perform inter-patient splits and not intra-patient.</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a><span class="sd">            patient_ids (npt.NDArray): Patient Ids</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a><span class="sd">            test_size (float): Test size</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a><span class="sd">            list[list[int]]: Train and test sets of patient ids</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a>        <span class="c1"># Use stratified split for arrhythmia task</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">task</span> <span class="o">==</span> <span class="n">HeartTask</span><span class="o">.</span><span class="n">arrhythmia</span><span class="p">:</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a>            <span class="n">arr_pt_ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arr_rhythm_patients</span><span class="p">,</span> <span class="n">patient_ids</span><span class="p">)</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a>            <span class="n">norm_pt_ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">setdiff1d</span><span class="p">(</span><span class="n">patient_ids</span><span class="p">,</span> <span class="n">arr_pt_ids</span><span class="p">)</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a>            <span class="p">(</span>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a>                <span class="n">norm_train_pt_ids</span><span class="p">,</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a>                <span class="n">norm_val_pt_ids</span><span class="p">,</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a>            <span class="p">)</span> <span class="o">=</span> <span class="n">sklearn</span><span class="o">.</span><span class="n">model_selection</span><span class="o">.</span><span class="n">train_test_split</span><span class="p">(</span><span class="n">norm_pt_ids</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="n">test_size</span><span class="p">)</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a>            <span class="p">(</span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a>                <span class="n">arr_train_pt_ids</span><span class="p">,</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a>                <span class="n">afib_val_pt_ids</span><span class="p">,</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a>            <span class="p">)</span> <span class="o">=</span> <span class="n">sklearn</span><span class="o">.</span><span class="n">model_selection</span><span class="o">.</span><span class="n">train_test_split</span><span class="p">(</span><span class="n">arr_pt_ids</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="n">test_size</span><span class="p">)</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a>            <span class="n">train_pt_ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">norm_train_pt_ids</span><span class="p">,</span> <span class="n">arr_train_pt_ids</span><span class="p">))</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a>            <span class="n">val_pt_ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">norm_val_pt_ids</span><span class="p">,</span> <span class="n">afib_val_pt_ids</span><span class="p">))</span>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a>            <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">train_pt_ids</span><span class="p">)</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a>            <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">val_pt_ids</span><span class="p">)</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a>            <span class="k">return</span> <span class="n">train_pt_ids</span><span class="p">,</span> <span class="n">val_pt_ids</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a>        <span class="c1"># END IF</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a>        <span class="k">return</span> <span class="n">sklearn</span><span class="o">.</span><span class="n">model_selection</span><span class="o">.</span><span class="n">train_test_split</span><span class="p">(</span><span class="n">patient_ids</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="n">test_size</span><span class="p">)</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a>    <span class="k">def</span> <span class="nf">rhythm_data_generator</span><span class="p">(</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a>        <span class="n">patient_generator</span><span class="p">:</span> <span class="n">PatientGenerator</span><span class="p">,</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a>        <span class="n">samples_per_patient</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SampleGenerator</span><span class="p">:</span>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate frames and rhythm label using patient generator.</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a><span class="sd">            patient_generator (PatientGenerator): Patient Generator</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a><span class="sd">            samples_per_patient (int | list[int], optional): # samples per patient. Defaults to 1.</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a><span class="sd">            SampleGenerator: Sample generator</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a><span class="sd">        Yields:</span>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a><span class="sd">            Iterator[SampleGenerator]</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a>        <span class="n">tgt_labels</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a>            <span class="n">IcentiaRhythm</span><span class="o">.</span><span class="n">normal</span><span class="p">,</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a>            <span class="n">IcentiaRhythm</span><span class="o">.</span><span class="n">afib</span><span class="p">,</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a>            <span class="n">IcentiaRhythm</span><span class="o">.</span><span class="n">aflut</span><span class="p">,</span>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a>        <span class="p">)</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">samples_per_patient</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">):</span>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a>            <span class="n">samples_per_tgt</span> <span class="o">=</span> <span class="n">samples_per_patient</span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a>            <span class="n">num_per_tgt</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">samples_per_patient</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">tgt_labels</span><span class="p">)))</span>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a>            <span class="n">samples_per_tgt</span> <span class="o">=</span> <span class="n">num_per_tgt</span> <span class="o">*</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">tgt_labels</span><span class="p">)]</span>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a>        <span class="n">input_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">sampling_rate</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_rate</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_size</span><span class="p">))</span>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a>        <span class="c1"># Group patient rhythms by type (segment, start, stop, delta)</span>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a>        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">segments</span> <span class="ow">in</span> <span class="n">patient_generator</span><span class="p">:</span>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a>            <span class="c1"># This maps segment index to segment key</span>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a>            <span class="n">seg_map</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">segments</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a>            <span class="n">pt_tgt_seg_map</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">tgt_labels</span><span class="p">]</span>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a>            <span class="k">for</span> <span class="n">seg_idx</span><span class="p">,</span> <span class="n">seg_key</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">seg_map</span><span class="p">):</span>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a>                <span class="n">rlabels</span> <span class="o">=</span> <span class="n">segments</span><span class="p">[</span><span class="n">seg_key</span><span class="p">][</span><span class="s2">&quot;rlabels&quot;</span><span class="p">][:]</span>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">rlabels</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a>                    <span class="k">continue</span>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a>                <span class="n">rlabels</span> <span class="o">=</span> <span class="n">rlabels</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">rlabels</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">IcentiaRhythm</span><span class="o">.</span><span class="n">noise</span><span class="o">.</span><span class="n">value</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a>                <span class="n">xs</span><span class="p">,</span> <span class="n">xe</span><span class="p">,</span> <span class="n">xl</span> <span class="o">=</span> <span class="n">rlabels</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">rlabels</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">rlabels</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a>                <span class="k">for</span> <span class="n">tgt_idx</span><span class="p">,</span> <span class="n">tgt_class</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tgt_labels</span><span class="p">):</span>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a>                    <span class="n">idxs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">xe</span> <span class="o">-</span> <span class="n">xs</span> <span class="o">&gt;=</span> <span class="n">input_size</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">xl</span> <span class="o">==</span> <span class="n">tgt_class</span><span class="p">))</span>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a>                    <span class="n">seg_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">seg_idx</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">idxs</span><span class="p">),</span> <span class="n">xs</span><span class="p">[</span><span class="n">idxs</span><span class="p">],</span> <span class="n">xe</span><span class="p">[</span><span class="n">idxs</span><span class="p">]))</span><span class="o">.</span><span class="n">T</span>
<a id="__codelineno-0-275" name="__codelineno-0-275"></a>                    <span class="n">pt_tgt_seg_map</span><span class="p">[</span><span class="n">tgt_idx</span><span class="p">]</span> <span class="o">+=</span> <span class="n">seg_vals</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a>                <span class="c1"># END FOR</span>
<a id="__codelineno-0-277" name="__codelineno-0-277"></a>            <span class="c1"># END FOR</span>
<a id="__codelineno-0-278" name="__codelineno-0-278"></a>            <span class="n">pt_tgt_seg_map</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">pt_tgt_seg_map</span><span class="p">]</span>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a>            <span class="c1"># Grab target segments</span>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a>            <span class="n">seg_samples</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a>            <span class="k">for</span> <span class="n">tgt_idx</span><span class="p">,</span> <span class="n">tgt_class</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tgt_labels</span><span class="p">):</span>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a>                <span class="n">tgt_segments</span> <span class="o">=</span> <span class="n">pt_tgt_seg_map</span><span class="p">[</span><span class="n">tgt_idx</span><span class="p">]</span>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">tgt_segments</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a>                    <span class="k">continue</span>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a>                <span class="n">tgt_seg_indices</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choices</span><span class="p">(</span>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a>                    <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">tgt_segments</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a>                    <span class="n">weights</span><span class="o">=</span><span class="n">tgt_segments</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">tgt_segments</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a>                    <span class="n">k</span><span class="o">=</span><span class="n">samples_per_tgt</span><span class="p">[</span><span class="n">tgt_idx</span><span class="p">],</span>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a>                <span class="p">)</span>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a>                <span class="k">for</span> <span class="n">tgt_seg_idx</span> <span class="ow">in</span> <span class="n">tgt_seg_indices</span><span class="p">:</span>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a>                    <span class="n">seg_idx</span><span class="p">,</span> <span class="n">rhy_start</span><span class="p">,</span> <span class="n">rhy_end</span> <span class="o">=</span> <span class="n">tgt_segments</span><span class="p">[</span><span class="n">tgt_seg_idx</span><span class="p">]</span>
<a id="__codelineno-0-293" name="__codelineno-0-293"></a>                    <span class="n">frame_start</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">rhy_start</span><span class="p">,</span> <span class="n">rhy_end</span> <span class="o">-</span> <span class="n">input_size</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-294" name="__codelineno-0-294"></a>                    <span class="n">frame_end</span> <span class="o">=</span> <span class="n">frame_start</span> <span class="o">+</span> <span class="n">input_size</span>
<a id="__codelineno-0-295" name="__codelineno-0-295"></a>                    <span class="n">seg_samples</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">seg_idx</span><span class="p">,</span> <span class="n">frame_start</span><span class="p">,</span> <span class="n">frame_end</span><span class="p">,</span> <span class="n">HeartRhythmMap</span><span class="p">[</span><span class="n">tgt_class</span><span class="p">]))</span>
<a id="__codelineno-0-296" name="__codelineno-0-296"></a>                <span class="c1"># END FOR</span>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a>            <span class="c1"># END FOR</span>
<a id="__codelineno-0-298" name="__codelineno-0-298"></a>
<a id="__codelineno-0-299" name="__codelineno-0-299"></a>            <span class="c1"># Shuffle segments</span>
<a id="__codelineno-0-300" name="__codelineno-0-300"></a>            <span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">seg_samples</span><span class="p">)</span>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a>            <span class="k">for</span> <span class="n">seg_idx</span><span class="p">,</span> <span class="n">frame_start</span><span class="p">,</span> <span class="n">frame_end</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">seg_samples</span><span class="p">:</span>
<a id="__codelineno-0-302" name="__codelineno-0-302"></a>                <span class="n">x</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span> <span class="o">=</span> <span class="n">segments</span><span class="p">[</span><span class="n">seg_map</span><span class="p">[</span><span class="n">seg_idx</span><span class="p">]][</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="n">frame_start</span><span class="p">:</span><span class="n">frame_end</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<a id="__codelineno-0-303" name="__codelineno-0-303"></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampling_rate</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_rate</span><span class="p">:</span>
<a id="__codelineno-0-304" name="__codelineno-0-304"></a>                    <span class="n">x</span> <span class="o">=</span> <span class="n">resample_signal</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampling_rate</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_rate</span><span class="p">)</span>
<a id="__codelineno-0-305" name="__codelineno-0-305"></a>                <span class="k">yield</span> <span class="n">x</span><span class="p">,</span> <span class="n">label</span>
<a id="__codelineno-0-306" name="__codelineno-0-306"></a>            <span class="c1"># END FOR</span>
<a id="__codelineno-0-307" name="__codelineno-0-307"></a>        <span class="c1"># END FOR</span>
<a id="__codelineno-0-308" name="__codelineno-0-308"></a>
<a id="__codelineno-0-309" name="__codelineno-0-309"></a>    <span class="k">def</span> <span class="nf">beat_data_generator</span><span class="p">(</span>
<a id="__codelineno-0-310" name="__codelineno-0-310"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-311" name="__codelineno-0-311"></a>        <span class="n">patient_generator</span><span class="p">:</span> <span class="n">PatientGenerator</span><span class="p">,</span>
<a id="__codelineno-0-312" name="__codelineno-0-312"></a>        <span class="n">samples_per_patient</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-313" name="__codelineno-0-313"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SampleGenerator</span><span class="p">:</span>
<a id="__codelineno-0-314" name="__codelineno-0-314"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate frames and beat label using patient generator.</span>
<a id="__codelineno-0-315" name="__codelineno-0-315"></a><span class="sd">        There are over 2.5 billion normal and undefined while less than 40 million arrhythmia beats.</span>
<a id="__codelineno-0-316" name="__codelineno-0-316"></a><span class="sd">        The following routine sorts each patient&#39;s beats by type and then approx. uniformly samples them by amount requested.</span>
<a id="__codelineno-0-317" name="__codelineno-0-317"></a><span class="sd">        We start with arrhythmia types followed by undefined and normal. For each beat we resplit remaining samples requested.</span>
<a id="__codelineno-0-318" name="__codelineno-0-318"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-319" name="__codelineno-0-319"></a><span class="sd">            patient_generator (PatientGenerator): Patient generator</span>
<a id="__codelineno-0-320" name="__codelineno-0-320"></a><span class="sd">            samples_per_patient (int | list[int], optional): # samples per patient. Defaults to 1.</span>
<a id="__codelineno-0-321" name="__codelineno-0-321"></a>
<a id="__codelineno-0-322" name="__codelineno-0-322"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-323" name="__codelineno-0-323"></a><span class="sd">            SampleGenerator: Sample generator</span>
<a id="__codelineno-0-324" name="__codelineno-0-324"></a>
<a id="__codelineno-0-325" name="__codelineno-0-325"></a><span class="sd">        Yields:</span>
<a id="__codelineno-0-326" name="__codelineno-0-326"></a><span class="sd">            Iterator[SampleGenerator]</span>
<a id="__codelineno-0-327" name="__codelineno-0-327"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-328" name="__codelineno-0-328"></a>        <span class="n">nlabel_threshold</span> <span class="o">=</span> <span class="mf">0.25</span>
<a id="__codelineno-0-329" name="__codelineno-0-329"></a>        <span class="n">blabel_padding</span> <span class="o">=</span> <span class="mi">20</span>
<a id="__codelineno-0-330" name="__codelineno-0-330"></a>        <span class="n">rr_win_len</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">10</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampling_rate</span><span class="p">)</span>
<a id="__codelineno-0-331" name="__codelineno-0-331"></a>        <span class="n">rr_min_len</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">0.3</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampling_rate</span><span class="p">)</span>
<a id="__codelineno-0-332" name="__codelineno-0-332"></a>        <span class="n">rr_max_len</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampling_rate</span><span class="p">)</span>
<a id="__codelineno-0-333" name="__codelineno-0-333"></a>
<a id="__codelineno-0-334" name="__codelineno-0-334"></a>        <span class="n">tgt_beat_labels</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-335" name="__codelineno-0-335"></a>            <span class="n">IcentiaBeat</span><span class="o">.</span><span class="n">normal</span><span class="p">,</span>
<a id="__codelineno-0-336" name="__codelineno-0-336"></a>            <span class="n">IcentiaBeat</span><span class="o">.</span><span class="n">pac</span><span class="p">,</span>
<a id="__codelineno-0-337" name="__codelineno-0-337"></a>            <span class="n">IcentiaBeat</span><span class="o">.</span><span class="n">pvc</span><span class="p">,</span>
<a id="__codelineno-0-338" name="__codelineno-0-338"></a>            <span class="c1"># IcentiaBeat.undefined,</span>
<a id="__codelineno-0-339" name="__codelineno-0-339"></a>        <span class="p">]</span>
<a id="__codelineno-0-340" name="__codelineno-0-340"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">samples_per_patient</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">):</span>
<a id="__codelineno-0-341" name="__codelineno-0-341"></a>            <span class="n">samples_per_tgt</span> <span class="o">=</span> <span class="n">samples_per_patient</span>
<a id="__codelineno-0-342" name="__codelineno-0-342"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-343" name="__codelineno-0-343"></a>            <span class="n">num_per_tgt</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">samples_per_patient</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">tgt_beat_labels</span><span class="p">)))</span>
<a id="__codelineno-0-344" name="__codelineno-0-344"></a>            <span class="n">samples_per_tgt</span> <span class="o">=</span> <span class="n">num_per_tgt</span> <span class="o">*</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">tgt_beat_labels</span><span class="p">)]</span>
<a id="__codelineno-0-345" name="__codelineno-0-345"></a>
<a id="__codelineno-0-346" name="__codelineno-0-346"></a>        <span class="n">input_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">sampling_rate</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_rate</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_size</span><span class="p">))</span>
<a id="__codelineno-0-347" name="__codelineno-0-347"></a>        <span class="c1"># For each patient</span>
<a id="__codelineno-0-348" name="__codelineno-0-348"></a>        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">segments</span> <span class="ow">in</span> <span class="n">patient_generator</span><span class="p">:</span>
<a id="__codelineno-0-349" name="__codelineno-0-349"></a>            <span class="c1"># This maps segment index to segment key</span>
<a id="__codelineno-0-350" name="__codelineno-0-350"></a>            <span class="n">seg_map</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">segments</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<a id="__codelineno-0-351" name="__codelineno-0-351"></a>
<a id="__codelineno-0-352" name="__codelineno-0-352"></a>            <span class="c1"># Capture beat locations for each segment</span>
<a id="__codelineno-0-353" name="__codelineno-0-353"></a>            <span class="n">pt_beat_map</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">tgt_beat_labels</span><span class="p">]</span>
<a id="__codelineno-0-354" name="__codelineno-0-354"></a>            <span class="k">for</span> <span class="n">seg_idx</span><span class="p">,</span> <span class="n">seg_key</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">seg_map</span><span class="p">):</span>
<a id="__codelineno-0-355" name="__codelineno-0-355"></a>                <span class="n">blabels</span> <span class="o">=</span> <span class="n">segments</span><span class="p">[</span><span class="n">seg_key</span><span class="p">][</span><span class="s2">&quot;blabels&quot;</span><span class="p">][:]</span>
<a id="__codelineno-0-356" name="__codelineno-0-356"></a>                <span class="n">num_blabels</span> <span class="o">=</span> <span class="n">blabels</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-357" name="__codelineno-0-357"></a>                <span class="k">if</span> <span class="n">num_blabels</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-358" name="__codelineno-0-358"></a>                    <span class="k">continue</span>
<a id="__codelineno-0-359" name="__codelineno-0-359"></a>                <span class="c1"># END IF</span>
<a id="__codelineno-0-360" name="__codelineno-0-360"></a>                <span class="n">num_nlabels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">blabels</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">IcentiaBeat</span><span class="o">.</span><span class="n">normal</span><span class="p">)</span>
<a id="__codelineno-0-361" name="__codelineno-0-361"></a>                <span class="k">if</span> <span class="n">num_nlabels</span> <span class="o">/</span> <span class="n">num_blabels</span> <span class="o">&lt;</span> <span class="n">nlabel_threshold</span><span class="p">:</span>
<a id="__codelineno-0-362" name="__codelineno-0-362"></a>                    <span class="k">continue</span>
<a id="__codelineno-0-363" name="__codelineno-0-363"></a>
<a id="__codelineno-0-364" name="__codelineno-0-364"></a>                <span class="c1"># Capture all beat locations</span>
<a id="__codelineno-0-365" name="__codelineno-0-365"></a>                <span class="k">for</span> <span class="n">tgt_beat_idx</span><span class="p">,</span> <span class="n">beat</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tgt_beat_labels</span><span class="p">):</span>
<a id="__codelineno-0-366" name="__codelineno-0-366"></a>                    <span class="n">beat_idxs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">blabels</span><span class="p">[</span><span class="n">blabel_padding</span><span class="p">:</span><span class="o">-</span><span class="n">blabel_padding</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">beat</span><span class="o">.</span><span class="n">value</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">blabel_padding</span>
<a id="__codelineno-0-367" name="__codelineno-0-367"></a>                    <span class="k">if</span> <span class="n">beat</span> <span class="o">==</span> <span class="n">IcentiaBeat</span><span class="o">.</span><span class="n">normal</span><span class="p">:</span>
<a id="__codelineno-0-368" name="__codelineno-0-368"></a>                        <span class="n">filt_func</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">i</span><span class="p">:</span> <span class="n">blabels</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">blabels</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">IcentiaBeat</span><span class="o">.</span><span class="n">normal</span>
<a id="__codelineno-0-369" name="__codelineno-0-369"></a>                    <span class="k">elif</span> <span class="n">beat</span> <span class="ow">in</span> <span class="p">(</span><span class="n">IcentiaBeat</span><span class="o">.</span><span class="n">pac</span><span class="p">,</span> <span class="n">IcentiaBeat</span><span class="o">.</span><span class="n">pvc</span><span class="p">):</span>
<a id="__codelineno-0-370" name="__codelineno-0-370"></a>                        <span class="n">filt_func</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">i</span><span class="p">:</span> <span class="n">IcentiaBeat</span><span class="o">.</span><span class="n">undefined</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span>
<a id="__codelineno-0-371" name="__codelineno-0-371"></a>                            <span class="n">blabels</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
<a id="__codelineno-0-372" name="__codelineno-0-372"></a>                            <span class="n">blabels</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
<a id="__codelineno-0-373" name="__codelineno-0-373"></a>                        <span class="p">)</span>
<a id="__codelineno-0-374" name="__codelineno-0-374"></a>                    <span class="k">elif</span> <span class="n">beat</span> <span class="o">==</span> <span class="n">IcentiaBeat</span><span class="o">.</span><span class="n">undefined</span><span class="p">:</span>
<a id="__codelineno-0-375" name="__codelineno-0-375"></a>                        <span class="n">filt_func</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">i</span><span class="p">:</span> <span class="n">blabels</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">blabels</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">IcentiaBeat</span><span class="o">.</span><span class="n">undefined</span>
<a id="__codelineno-0-376" name="__codelineno-0-376"></a>                    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-377" name="__codelineno-0-377"></a>                        <span class="n">filt_func</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">_</span><span class="p">:</span> <span class="kc">True</span>
<a id="__codelineno-0-378" name="__codelineno-0-378"></a>                    <span class="n">beat_idxs</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="n">filt_func</span><span class="p">,</span> <span class="n">beat_idxs</span><span class="p">)</span>
<a id="__codelineno-0-379" name="__codelineno-0-379"></a>                    <span class="n">pt_beat_map</span><span class="p">[</span><span class="n">tgt_beat_idx</span><span class="p">]</span> <span class="o">+=</span> <span class="p">[(</span><span class="n">seg_idx</span><span class="p">,</span> <span class="n">blabels</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">beat_idxs</span><span class="p">]</span>
<a id="__codelineno-0-380" name="__codelineno-0-380"></a>                <span class="c1"># END FOR</span>
<a id="__codelineno-0-381" name="__codelineno-0-381"></a>            <span class="c1"># END FOR</span>
<a id="__codelineno-0-382" name="__codelineno-0-382"></a>            <span class="n">pt_beat_map</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">pt_beat_map</span><span class="p">]</span>
<a id="__codelineno-0-383" name="__codelineno-0-383"></a>
<a id="__codelineno-0-384" name="__codelineno-0-384"></a>            <span class="c1"># Randomly select N samples of each target beat</span>
<a id="__codelineno-0-385" name="__codelineno-0-385"></a>            <span class="n">pt_segs_beat_idxs</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-386" name="__codelineno-0-386"></a>            <span class="k">for</span> <span class="n">tgt_beat_idx</span><span class="p">,</span> <span class="n">beat</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tgt_beat_labels</span><span class="p">):</span>
<a id="__codelineno-0-387" name="__codelineno-0-387"></a>                <span class="n">tgt_beats</span> <span class="o">=</span> <span class="n">pt_beat_map</span><span class="p">[</span><span class="n">tgt_beat_idx</span><span class="p">]</span>
<a id="__codelineno-0-388" name="__codelineno-0-388"></a>                <span class="n">tgt_count</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">samples_per_tgt</span><span class="p">[</span><span class="n">tgt_beat_idx</span><span class="p">],</span> <span class="nb">len</span><span class="p">(</span><span class="n">tgt_beats</span><span class="p">))</span>
<a id="__codelineno-0-389" name="__codelineno-0-389"></a>                <span class="n">tgt_idxs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tgt_beats</span><span class="p">)),</span> <span class="n">size</span><span class="o">=</span><span class="n">tgt_count</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-390" name="__codelineno-0-390"></a>                <span class="n">pt_segs_beat_idxs</span> <span class="o">+=</span> <span class="p">[(</span><span class="n">tgt_beats</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">tgt_beats</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">HeartBeatMap</span><span class="p">[</span><span class="n">beat</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tgt_idxs</span><span class="p">]</span>
<a id="__codelineno-0-391" name="__codelineno-0-391"></a>            <span class="c1"># END FOR</span>
<a id="__codelineno-0-392" name="__codelineno-0-392"></a>
<a id="__codelineno-0-393" name="__codelineno-0-393"></a>            <span class="c1"># Shuffle all</span>
<a id="__codelineno-0-394" name="__codelineno-0-394"></a>            <span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">pt_segs_beat_idxs</span><span class="p">)</span>
<a id="__codelineno-0-395" name="__codelineno-0-395"></a>
<a id="__codelineno-0-396" name="__codelineno-0-396"></a>            <span class="c1"># Yield selected samples for patient</span>
<a id="__codelineno-0-397" name="__codelineno-0-397"></a>            <span class="k">for</span> <span class="n">seg_idx</span><span class="p">,</span> <span class="n">beat_idx</span><span class="p">,</span> <span class="n">beat</span> <span class="ow">in</span> <span class="n">pt_segs_beat_idxs</span><span class="p">:</span>
<a id="__codelineno-0-398" name="__codelineno-0-398"></a>                <span class="n">frame_start</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">beat_idx</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.4722</span><span class="p">,</span> <span class="mf">0.5278</span><span class="p">)</span> <span class="o">*</span> <span class="n">input_size</span><span class="p">))</span>
<a id="__codelineno-0-399" name="__codelineno-0-399"></a>                <span class="n">frame_end</span> <span class="o">=</span> <span class="n">frame_start</span> <span class="o">+</span> <span class="n">input_size</span>
<a id="__codelineno-0-400" name="__codelineno-0-400"></a>                <span class="n">data</span> <span class="o">=</span> <span class="n">segments</span><span class="p">[</span><span class="n">seg_map</span><span class="p">[</span><span class="n">seg_idx</span><span class="p">]][</span><span class="s2">&quot;data&quot;</span><span class="p">]</span>
<a id="__codelineno-0-401" name="__codelineno-0-401"></a>                <span class="n">blabels</span> <span class="o">=</span> <span class="n">segments</span><span class="p">[</span><span class="n">seg_map</span><span class="p">[</span><span class="n">seg_idx</span><span class="p">]][</span><span class="s2">&quot;blabels&quot;</span><span class="p">]</span>
<a id="__codelineno-0-402" name="__codelineno-0-402"></a>                <span class="n">rr_xs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">blabels</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">frame_start</span> <span class="o">-</span> <span class="n">rr_win_len</span><span class="p">))</span>
<a id="__codelineno-0-403" name="__codelineno-0-403"></a>                <span class="n">rr_xe</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">blabels</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">frame_end</span> <span class="o">+</span> <span class="n">rr_win_len</span><span class="p">)</span>
<a id="__codelineno-0-404" name="__codelineno-0-404"></a>                <span class="k">if</span> <span class="n">rr_xe</span> <span class="o">&lt;=</span> <span class="n">rr_xs</span><span class="p">:</span>
<a id="__codelineno-0-405" name="__codelineno-0-405"></a>                    <span class="k">continue</span>
<a id="__codelineno-0-406" name="__codelineno-0-406"></a>                <span class="n">blabel_diffs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">blabels</span><span class="p">[</span><span class="n">rr_xs</span> <span class="p">:</span> <span class="n">rr_xe</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-0-407" name="__codelineno-0-407"></a>                <span class="n">blabel_diffs</span> <span class="o">=</span> <span class="n">blabel_diffs</span><span class="p">[(</span><span class="n">blabel_diffs</span> <span class="o">&gt;</span> <span class="n">rr_min_len</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">blabel_diffs</span> <span class="o">&lt;</span> <span class="n">rr_max_len</span><span class="p">)]</span>
<a id="__codelineno-0-408" name="__codelineno-0-408"></a>                <span class="k">if</span> <span class="n">blabel_diffs</span><span class="o">.</span><span class="n">size</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-409" name="__codelineno-0-409"></a>                    <span class="k">continue</span>
<a id="__codelineno-0-410" name="__codelineno-0-410"></a>                <span class="n">avg_rr</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">blabel_diffs</span><span class="p">))</span>
<a id="__codelineno-0-411" name="__codelineno-0-411"></a>
<a id="__codelineno-0-412" name="__codelineno-0-412"></a>                <span class="c1"># avg_rr = input_size</span>
<a id="__codelineno-0-413" name="__codelineno-0-413"></a>
<a id="__codelineno-0-414" name="__codelineno-0-414"></a>                <span class="k">if</span> <span class="n">frame_start</span> <span class="o">-</span> <span class="n">avg_rr</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">frame_end</span> <span class="o">+</span> <span class="n">avg_rr</span> <span class="o">&gt;=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
<a id="__codelineno-0-415" name="__codelineno-0-415"></a>                    <span class="k">continue</span>
<a id="__codelineno-0-416" name="__codelineno-0-416"></a>
<a id="__codelineno-0-417" name="__codelineno-0-417"></a>                <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span>
<a id="__codelineno-0-418" name="__codelineno-0-418"></a>                    <span class="p">(</span>
<a id="__codelineno-0-419" name="__codelineno-0-419"></a>                        <span class="n">data</span><span class="p">[</span><span class="n">frame_start</span> <span class="o">-</span> <span class="n">avg_rr</span> <span class="p">:</span> <span class="n">frame_end</span> <span class="o">-</span> <span class="n">avg_rr</span><span class="p">],</span>
<a id="__codelineno-0-420" name="__codelineno-0-420"></a>                        <span class="n">data</span><span class="p">[</span><span class="n">frame_start</span><span class="p">:</span><span class="n">frame_end</span><span class="p">],</span>
<a id="__codelineno-0-421" name="__codelineno-0-421"></a>                        <span class="n">data</span><span class="p">[</span><span class="n">frame_start</span> <span class="o">+</span> <span class="n">avg_rr</span> <span class="p">:</span> <span class="n">frame_end</span> <span class="o">+</span> <span class="n">avg_rr</span><span class="p">],</span>
<a id="__codelineno-0-422" name="__codelineno-0-422"></a>                    <span class="p">)</span>
<a id="__codelineno-0-423" name="__codelineno-0-423"></a>                <span class="p">)</span>
<a id="__codelineno-0-424" name="__codelineno-0-424"></a>                <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<a id="__codelineno-0-425" name="__codelineno-0-425"></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampling_rate</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_rate</span><span class="p">:</span>
<a id="__codelineno-0-426" name="__codelineno-0-426"></a>                    <span class="n">x</span> <span class="o">=</span> <span class="n">resample_signal</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampling_rate</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_rate</span><span class="p">)</span>
<a id="__codelineno-0-427" name="__codelineno-0-427"></a>                <span class="n">y</span> <span class="o">=</span> <span class="n">beat</span>
<a id="__codelineno-0-428" name="__codelineno-0-428"></a>                <span class="k">yield</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>
<a id="__codelineno-0-429" name="__codelineno-0-429"></a>            <span class="c1"># END FOR</span>
<a id="__codelineno-0-430" name="__codelineno-0-430"></a>        <span class="c1"># END FOR</span>
<a id="__codelineno-0-431" name="__codelineno-0-431"></a>
<a id="__codelineno-0-432" name="__codelineno-0-432"></a>    <span class="k">def</span> <span class="nf">heart_rate_data_generator</span><span class="p">(</span>
<a id="__codelineno-0-433" name="__codelineno-0-433"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-434" name="__codelineno-0-434"></a>        <span class="n">patient_generator</span><span class="p">:</span> <span class="n">PatientGenerator</span><span class="p">,</span>
<a id="__codelineno-0-435" name="__codelineno-0-435"></a>        <span class="n">samples_per_patient</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-436" name="__codelineno-0-436"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SampleGenerator</span><span class="p">:</span>
<a id="__codelineno-0-437" name="__codelineno-0-437"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate frames and heart rate label using patient generator.</span>
<a id="__codelineno-0-438" name="__codelineno-0-438"></a>
<a id="__codelineno-0-439" name="__codelineno-0-439"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-440" name="__codelineno-0-440"></a><span class="sd">            patient_generator (PatientGenerator): Patient generator</span>
<a id="__codelineno-0-441" name="__codelineno-0-441"></a><span class="sd">            samples_per_patient (int, optional): # samples per patient. Defaults to 1.</span>
<a id="__codelineno-0-442" name="__codelineno-0-442"></a>
<a id="__codelineno-0-443" name="__codelineno-0-443"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-444" name="__codelineno-0-444"></a><span class="sd">            SampleGenerator: Sample generator</span>
<a id="__codelineno-0-445" name="__codelineno-0-445"></a>
<a id="__codelineno-0-446" name="__codelineno-0-446"></a><span class="sd">        Yields:</span>
<a id="__codelineno-0-447" name="__codelineno-0-447"></a><span class="sd">            Iterator[SampleGenerator]</span>
<a id="__codelineno-0-448" name="__codelineno-0-448"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-449" name="__codelineno-0-449"></a>
<a id="__codelineno-0-450" name="__codelineno-0-450"></a>        <span class="n">label_frame_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_size</span>
<a id="__codelineno-0-451" name="__codelineno-0-451"></a>        <span class="n">max_frame_size</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frame_size</span><span class="p">,</span> <span class="n">label_frame_size</span><span class="p">)</span>
<a id="__codelineno-0-452" name="__codelineno-0-452"></a>        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">segments</span> <span class="ow">in</span> <span class="n">patient_generator</span><span class="p">:</span>
<a id="__codelineno-0-453" name="__codelineno-0-453"></a>            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">samples_per_patient</span><span class="p">):</span>
<a id="__codelineno-0-454" name="__codelineno-0-454"></a>                <span class="n">segment</span> <span class="o">=</span> <span class="n">segments</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">segments</span><span class="o">.</span><span class="n">keys</span><span class="p">()))]</span>
<a id="__codelineno-0-455" name="__codelineno-0-455"></a>                <span class="n">segment_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">segment</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-456" name="__codelineno-0-456"></a>                <span class="n">frame_center</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">segment_size</span> <span class="o">-</span> <span class="n">max_frame_size</span><span class="p">)</span> <span class="o">+</span> <span class="n">max_frame_size</span> <span class="o">//</span> <span class="mi">2</span>
<a id="__codelineno-0-457" name="__codelineno-0-457"></a>                <span class="n">signal_frame_start</span> <span class="o">=</span> <span class="n">frame_center</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_size</span> <span class="o">//</span> <span class="mi">2</span>
<a id="__codelineno-0-458" name="__codelineno-0-458"></a>                <span class="n">signal_frame_end</span> <span class="o">=</span> <span class="n">frame_center</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_size</span> <span class="o">//</span> <span class="mi">2</span>
<a id="__codelineno-0-459" name="__codelineno-0-459"></a>                <span class="n">x</span> <span class="o">=</span> <span class="n">segment</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="n">signal_frame_start</span><span class="p">:</span><span class="n">signal_frame_end</span><span class="p">]</span>
<a id="__codelineno-0-460" name="__codelineno-0-460"></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampling_rate</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_rate</span><span class="p">:</span>
<a id="__codelineno-0-461" name="__codelineno-0-461"></a>                    <span class="n">x</span> <span class="o">=</span> <span class="n">resample_signal</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampling_rate</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_rate</span><span class="p">)</span>
<a id="__codelineno-0-462" name="__codelineno-0-462"></a>                <span class="n">label_frame_start</span> <span class="o">=</span> <span class="n">frame_center</span> <span class="o">-</span> <span class="n">label_frame_size</span> <span class="o">//</span> <span class="mi">2</span>
<a id="__codelineno-0-463" name="__codelineno-0-463"></a>                <span class="n">label_frame_end</span> <span class="o">=</span> <span class="n">frame_center</span> <span class="o">+</span> <span class="n">label_frame_size</span> <span class="o">//</span> <span class="mi">2</span>
<a id="__codelineno-0-464" name="__codelineno-0-464"></a>                <span class="n">beat_indices</span> <span class="o">=</span> <span class="n">segment</span><span class="p">[</span><span class="s2">&quot;blabels&quot;</span><span class="p">][:,</span> <span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-465" name="__codelineno-0-465"></a>                <span class="n">frame_beat_indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_complete_beats</span><span class="p">(</span><span class="n">beat_indices</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">label_frame_start</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">label_frame_end</span><span class="p">)</span>
<a id="__codelineno-0-466" name="__codelineno-0-466"></a>                <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_heart_rate_label</span><span class="p">(</span><span class="n">frame_beat_indices</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampling_rate</span><span class="p">)</span>
<a id="__codelineno-0-467" name="__codelineno-0-467"></a>                <span class="k">yield</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>
<a id="__codelineno-0-468" name="__codelineno-0-468"></a>            <span class="c1"># END FOR</span>
<a id="__codelineno-0-469" name="__codelineno-0-469"></a>        <span class="c1"># END FOR</span>
<a id="__codelineno-0-470" name="__codelineno-0-470"></a>
<a id="__codelineno-0-471" name="__codelineno-0-471"></a>    <span class="k">def</span> <span class="nf">signal_generator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">patient_generator</span><span class="p">:</span> <span class="n">PatientGenerator</span><span class="p">,</span> <span class="n">samples_per_patient</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SampleGenerator</span><span class="p">:</span>
<a id="__codelineno-0-472" name="__codelineno-0-472"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-473" name="__codelineno-0-473"></a><span class="sd">        Generate frames using patient generator.</span>
<a id="__codelineno-0-474" name="__codelineno-0-474"></a><span class="sd">        from the segments in patient data by placing a frame in a random location within one of the segments.</span>
<a id="__codelineno-0-475" name="__codelineno-0-475"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-476" name="__codelineno-0-476"></a><span class="sd">            patient_generator (PatientGenerator): Generator that yields a tuple of patient id and patient data.</span>
<a id="__codelineno-0-477" name="__codelineno-0-477"></a><span class="sd">                    Patient data may contain only signals, since labels are not used.</span>
<a id="__codelineno-0-478" name="__codelineno-0-478"></a><span class="sd">            samples_per_patient (int): Samples per patient.</span>
<a id="__codelineno-0-479" name="__codelineno-0-479"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-480" name="__codelineno-0-480"></a><span class="sd">            SampleGenerator: Generator of input data of shape (frame_size, 1)</span>
<a id="__codelineno-0-481" name="__codelineno-0-481"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-482" name="__codelineno-0-482"></a>        <span class="n">input_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">sampling_rate</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_rate</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_size</span><span class="p">))</span>
<a id="__codelineno-0-483" name="__codelineno-0-483"></a>        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">segments</span> <span class="ow">in</span> <span class="n">patient_generator</span><span class="p">:</span>
<a id="__codelineno-0-484" name="__codelineno-0-484"></a>            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">samples_per_patient</span><span class="p">):</span>
<a id="__codelineno-0-485" name="__codelineno-0-485"></a>                <span class="n">segment</span> <span class="o">=</span> <span class="n">segments</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">segments</span><span class="o">.</span><span class="n">keys</span><span class="p">()))]</span>
<a id="__codelineno-0-486" name="__codelineno-0-486"></a>                <span class="n">segment_size</span> <span class="o">=</span> <span class="n">segment</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-487" name="__codelineno-0-487"></a>                <span class="n">frame_start</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">segment_size</span> <span class="o">-</span> <span class="n">input_size</span><span class="p">)</span>
<a id="__codelineno-0-488" name="__codelineno-0-488"></a>                <span class="n">frame_end</span> <span class="o">=</span> <span class="n">frame_start</span> <span class="o">+</span> <span class="n">input_size</span>
<a id="__codelineno-0-489" name="__codelineno-0-489"></a>                <span class="n">x</span> <span class="o">=</span> <span class="n">segment</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="n">frame_start</span><span class="p">:</span><span class="n">frame_end</span><span class="p">]</span>
<a id="__codelineno-0-490" name="__codelineno-0-490"></a>                <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<a id="__codelineno-0-491" name="__codelineno-0-491"></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampling_rate</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_rate</span><span class="p">:</span>
<a id="__codelineno-0-492" name="__codelineno-0-492"></a>                    <span class="n">x</span> <span class="o">=</span> <span class="n">resample_signal</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampling_rate</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_rate</span><span class="p">)</span>
<a id="__codelineno-0-493" name="__codelineno-0-493"></a>                <span class="k">yield</span> <span class="n">x</span>
<a id="__codelineno-0-494" name="__codelineno-0-494"></a>            <span class="c1"># END FOR</span>
<a id="__codelineno-0-495" name="__codelineno-0-495"></a>        <span class="c1"># END FOR</span>
<a id="__codelineno-0-496" name="__codelineno-0-496"></a>
<a id="__codelineno-0-497" name="__codelineno-0-497"></a>    <span class="k">def</span> <span class="nf">uniform_patient_generator</span><span class="p">(</span>
<a id="__codelineno-0-498" name="__codelineno-0-498"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-499" name="__codelineno-0-499"></a>        <span class="n">patient_ids</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">,</span>
<a id="__codelineno-0-500" name="__codelineno-0-500"></a>        <span class="n">repeat</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-501" name="__codelineno-0-501"></a>        <span class="n">shuffle</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-502" name="__codelineno-0-502"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PatientGenerator</span><span class="p">:</span>
<a id="__codelineno-0-503" name="__codelineno-0-503"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Yield data for each patient in the array.</span>
<a id="__codelineno-0-504" name="__codelineno-0-504"></a>
<a id="__codelineno-0-505" name="__codelineno-0-505"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-506" name="__codelineno-0-506"></a><span class="sd">            patient_ids (pt.ArrayLike): Array of patient ids</span>
<a id="__codelineno-0-507" name="__codelineno-0-507"></a><span class="sd">            repeat (bool, optional): Whether to repeat generator. Defaults to True.</span>
<a id="__codelineno-0-508" name="__codelineno-0-508"></a><span class="sd">            shuffle (bool, optional): Whether to shuffle patient ids.. Defaults to True.</span>
<a id="__codelineno-0-509" name="__codelineno-0-509"></a>
<a id="__codelineno-0-510" name="__codelineno-0-510"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-511" name="__codelineno-0-511"></a><span class="sd">            PatientGenerator: Patient generator</span>
<a id="__codelineno-0-512" name="__codelineno-0-512"></a>
<a id="__codelineno-0-513" name="__codelineno-0-513"></a><span class="sd">        Yields:</span>
<a id="__codelineno-0-514" name="__codelineno-0-514"></a><span class="sd">            Iterator[PatientGenerator]</span>
<a id="__codelineno-0-515" name="__codelineno-0-515"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-516" name="__codelineno-0-516"></a>        <span class="n">patient_ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">patient_ids</span><span class="p">)</span>
<a id="__codelineno-0-517" name="__codelineno-0-517"></a>        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
<a id="__codelineno-0-518" name="__codelineno-0-518"></a>            <span class="k">if</span> <span class="n">shuffle</span><span class="p">:</span>
<a id="__codelineno-0-519" name="__codelineno-0-519"></a>                <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">patient_ids</span><span class="p">)</span>
<a id="__codelineno-0-520" name="__codelineno-0-520"></a>            <span class="k">for</span> <span class="n">patient_id</span> <span class="ow">in</span> <span class="n">patient_ids</span><span class="p">:</span>
<a id="__codelineno-0-521" name="__codelineno-0-521"></a>                <span class="n">pt_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pt_key</span><span class="p">(</span><span class="n">patient_id</span><span class="p">)</span>
<a id="__codelineno-0-522" name="__codelineno-0-522"></a>                <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ds_path</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pt_key</span><span class="si">}</span><span class="s2">.h5&quot;</span><span class="p">),</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">h5</span><span class="p">:</span>
<a id="__codelineno-0-523" name="__codelineno-0-523"></a>                    <span class="n">patient_data</span> <span class="o">=</span> <span class="n">h5</span><span class="p">[</span><span class="n">pt_key</span><span class="p">]</span>
<a id="__codelineno-0-524" name="__codelineno-0-524"></a>                    <span class="k">yield</span> <span class="n">patient_id</span><span class="p">,</span> <span class="n">patient_data</span>
<a id="__codelineno-0-525" name="__codelineno-0-525"></a>            <span class="c1"># END FOR</span>
<a id="__codelineno-0-526" name="__codelineno-0-526"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">repeat</span><span class="p">:</span>
<a id="__codelineno-0-527" name="__codelineno-0-527"></a>                <span class="k">break</span>
<a id="__codelineno-0-528" name="__codelineno-0-528"></a>        <span class="c1"># END WHILE</span>
<a id="__codelineno-0-529" name="__codelineno-0-529"></a>
<a id="__codelineno-0-530" name="__codelineno-0-530"></a>    <span class="k">def</span> <span class="nf">random_patient_generator</span><span class="p">(</span>
<a id="__codelineno-0-531" name="__codelineno-0-531"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-532" name="__codelineno-0-532"></a>        <span class="n">patient_ids</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
<a id="__codelineno-0-533" name="__codelineno-0-533"></a>        <span class="n">patient_weights</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-534" name="__codelineno-0-534"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PatientGenerator</span><span class="p">:</span>
<a id="__codelineno-0-535" name="__codelineno-0-535"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Samples patient data from the provided patient distribution.</span>
<a id="__codelineno-0-536" name="__codelineno-0-536"></a>
<a id="__codelineno-0-537" name="__codelineno-0-537"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-538" name="__codelineno-0-538"></a><span class="sd">            patient_ids (list[int]): Patient ids</span>
<a id="__codelineno-0-539" name="__codelineno-0-539"></a><span class="sd">            patient_weights (list[int] | None, optional): Probabilities associated with each patient. Defaults to None.</span>
<a id="__codelineno-0-540" name="__codelineno-0-540"></a>
<a id="__codelineno-0-541" name="__codelineno-0-541"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-542" name="__codelineno-0-542"></a><span class="sd">            PatientGenerator: Patient generator</span>
<a id="__codelineno-0-543" name="__codelineno-0-543"></a>
<a id="__codelineno-0-544" name="__codelineno-0-544"></a><span class="sd">        Yields:</span>
<a id="__codelineno-0-545" name="__codelineno-0-545"></a><span class="sd">            Iterator[PatientGenerator]</span>
<a id="__codelineno-0-546" name="__codelineno-0-546"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-547" name="__codelineno-0-547"></a>        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
<a id="__codelineno-0-548" name="__codelineno-0-548"></a>            <span class="k">for</span> <span class="n">patient_id</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">patient_ids</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">1024</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">patient_weights</span><span class="p">):</span>
<a id="__codelineno-0-549" name="__codelineno-0-549"></a>                <span class="n">pt_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pt_key</span><span class="p">(</span><span class="n">patient_id</span><span class="p">)</span>
<a id="__codelineno-0-550" name="__codelineno-0-550"></a>                <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ds_path</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pt_key</span><span class="si">}</span><span class="s2">.h5&quot;</span><span class="p">),</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">h5</span><span class="p">:</span>
<a id="__codelineno-0-551" name="__codelineno-0-551"></a>                    <span class="n">patient_data</span> <span class="o">=</span> <span class="n">h5</span><span class="p">[</span><span class="n">pt_key</span><span class="p">]</span>
<a id="__codelineno-0-552" name="__codelineno-0-552"></a>                    <span class="k">yield</span> <span class="n">patient_id</span><span class="p">,</span> <span class="n">patient_data</span>
<a id="__codelineno-0-553" name="__codelineno-0-553"></a>            <span class="c1"># END FOR</span>
<a id="__codelineno-0-554" name="__codelineno-0-554"></a>        <span class="c1"># END WHILE</span>
<a id="__codelineno-0-555" name="__codelineno-0-555"></a>
<a id="__codelineno-0-556" name="__codelineno-0-556"></a>    <span class="k">def</span> <span class="nf">get_complete_beats</span><span class="p">(</span>
<a id="__codelineno-0-557" name="__codelineno-0-557"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-558" name="__codelineno-0-558"></a>        <span class="n">indices</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">,</span>
<a id="__codelineno-0-559" name="__codelineno-0-559"></a>        <span class="n">labels</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-560" name="__codelineno-0-560"></a>        <span class="n">start</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-561" name="__codelineno-0-561"></a>        <span class="n">end</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-562" name="__codelineno-0-562"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">,</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">]:</span>
<a id="__codelineno-0-563" name="__codelineno-0-563"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-564" name="__codelineno-0-564"></a><span class="sd">        Find all complete beats within a frame i.e. start and end of the beat lie within the frame.</span>
<a id="__codelineno-0-565" name="__codelineno-0-565"></a><span class="sd">        The indices are assumed to specify the end of a heartbeat.</span>
<a id="__codelineno-0-566" name="__codelineno-0-566"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-567" name="__codelineno-0-567"></a><span class="sd">            indices (npt.NDArray): List of sorted beat indices.</span>
<a id="__codelineno-0-568" name="__codelineno-0-568"></a><span class="sd">            labels (npt.NDArray | None): List of beat labels. Defaults to None.</span>
<a id="__codelineno-0-569" name="__codelineno-0-569"></a><span class="sd">            start (int): Index of the first sample in the frame. Defaults to 0.</span>
<a id="__codelineno-0-570" name="__codelineno-0-570"></a><span class="sd">            end (int | None): Index of the last sample in the frame. Defaults to None.</span>
<a id="__codelineno-0-571" name="__codelineno-0-571"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-572" name="__codelineno-0-572"></a><span class="sd">            tuple[npt.NDArray, npt.NDArray]: (beat indices, beat labels)</span>
<a id="__codelineno-0-573" name="__codelineno-0-573"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-574" name="__codelineno-0-574"></a>        <span class="k">if</span> <span class="n">end</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-575" name="__codelineno-0-575"></a>            <span class="n">end</span> <span class="o">=</span> <span class="n">indices</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-576" name="__codelineno-0-576"></a>        <span class="k">if</span> <span class="n">start</span> <span class="o">&gt;=</span> <span class="n">end</span><span class="p">:</span>
<a id="__codelineno-0-577" name="__codelineno-0-577"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`end` must be greater than `start`&quot;</span><span class="p">)</span>
<a id="__codelineno-0-578" name="__codelineno-0-578"></a>        <span class="n">start_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">side</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
<a id="__codelineno-0-579" name="__codelineno-0-579"></a>        <span class="n">end_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">side</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">)</span>
<a id="__codelineno-0-580" name="__codelineno-0-580"></a>        <span class="n">indices_slice</span> <span class="o">=</span> <span class="n">indices</span><span class="p">[</span><span class="n">start_index</span><span class="p">:</span><span class="n">end_index</span><span class="p">]</span>
<a id="__codelineno-0-581" name="__codelineno-0-581"></a>        <span class="k">if</span> <span class="n">labels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-582" name="__codelineno-0-582"></a>            <span class="k">return</span> <span class="n">indices_slice</span>
<a id="__codelineno-0-583" name="__codelineno-0-583"></a>        <span class="n">label_slice</span> <span class="o">=</span> <span class="n">labels</span><span class="p">[</span><span class="n">start_index</span><span class="p">:</span><span class="n">end_index</span><span class="p">]</span>
<a id="__codelineno-0-584" name="__codelineno-0-584"></a>        <span class="k">return</span> <span class="p">(</span><span class="n">indices_slice</span><span class="p">,</span> <span class="n">label_slice</span><span class="p">)</span>
<a id="__codelineno-0-585" name="__codelineno-0-585"></a>
<a id="__codelineno-0-586" name="__codelineno-0-586"></a>    <span class="k">def</span> <span class="nf">_get_rhythm_label</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">durations</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">,</span> <span class="n">labels</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">):</span>
<a id="__codelineno-0-587" name="__codelineno-0-587"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Determine rhythm label based on the longest rhythm among arrhythmias.</span>
<a id="__codelineno-0-588" name="__codelineno-0-588"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-589" name="__codelineno-0-589"></a><span class="sd">            durations (npt.NDArray): Array of rhythm durations</span>
<a id="__codelineno-0-590" name="__codelineno-0-590"></a><span class="sd">            labels (npt.NDArray): Array of rhythm labels</span>
<a id="__codelineno-0-591" name="__codelineno-0-591"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-592" name="__codelineno-0-592"></a><span class="sd">            Rhythm label as an integer</span>
<a id="__codelineno-0-593" name="__codelineno-0-593"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-594" name="__codelineno-0-594"></a>        <span class="c1"># sum up the durations of each rhythm</span>
<a id="__codelineno-0-595" name="__codelineno-0-595"></a>        <span class="n">summed_durations</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">IcentiaRhythm</span><span class="p">))</span>
<a id="__codelineno-0-596" name="__codelineno-0-596"></a>        <span class="k">for</span> <span class="n">rhythm</span> <span class="ow">in</span> <span class="n">IcentiaRhythm</span><span class="p">:</span>
<a id="__codelineno-0-597" name="__codelineno-0-597"></a>            <span class="n">summed_durations</span><span class="p">[</span><span class="n">rhythm</span><span class="o">.</span><span class="n">value</span><span class="p">]</span> <span class="o">=</span> <span class="n">durations</span><span class="p">[</span><span class="n">labels</span> <span class="o">==</span> <span class="n">rhythm</span><span class="o">.</span><span class="n">value</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<a id="__codelineno-0-598" name="__codelineno-0-598"></a>        <span class="n">longest_hp_rhythm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">summed_durations</span><span class="p">[</span><span class="n">IcentiaRhythm</span><span class="o">.</span><span class="n">hi_priority</span><span class="p">()])</span>
<a id="__codelineno-0-599" name="__codelineno-0-599"></a>        <span class="k">if</span> <span class="n">summed_durations</span><span class="p">[</span><span class="n">IcentiaRhythm</span><span class="o">.</span><span class="n">hi_priority</span><span class="p">()][</span><span class="n">longest_hp_rhythm</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-600" name="__codelineno-0-600"></a>            <span class="n">y</span> <span class="o">=</span> <span class="n">HeartRhythmMap</span><span class="p">[</span><span class="n">IcentiaRhythm</span><span class="o">.</span><span class="n">hi_priority</span><span class="p">()[</span><span class="n">longest_hp_rhythm</span><span class="p">]]</span>
<a id="__codelineno-0-601" name="__codelineno-0-601"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-602" name="__codelineno-0-602"></a>            <span class="n">longest_lp_rhythm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">summed_durations</span><span class="p">[</span><span class="n">IcentiaRhythm</span><span class="o">.</span><span class="n">lo_priority</span><span class="p">()])</span>
<a id="__codelineno-0-603" name="__codelineno-0-603"></a>            <span class="c1"># handle the case of no detected rhythm</span>
<a id="__codelineno-0-604" name="__codelineno-0-604"></a>            <span class="k">if</span> <span class="n">summed_durations</span><span class="p">[</span><span class="n">IcentiaRhythm</span><span class="o">.</span><span class="n">lo_priority</span><span class="p">()][</span><span class="n">longest_lp_rhythm</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-605" name="__codelineno-0-605"></a>                <span class="n">y</span> <span class="o">=</span> <span class="n">HeartRhythmMap</span><span class="p">[</span><span class="n">IcentiaRhythm</span><span class="o">.</span><span class="n">lo_priority</span><span class="p">()[</span><span class="n">longest_lp_rhythm</span><span class="p">]]</span>
<a id="__codelineno-0-606" name="__codelineno-0-606"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-607" name="__codelineno-0-607"></a>                <span class="n">y</span> <span class="o">=</span> <span class="n">HeartRhythmMap</span><span class="p">[</span><span class="n">IcentiaRhythm</span><span class="o">.</span><span class="n">noise</span><span class="p">]</span>
<a id="__codelineno-0-608" name="__codelineno-0-608"></a>        <span class="k">return</span> <span class="n">y</span>
<a id="__codelineno-0-609" name="__codelineno-0-609"></a>
<a id="__codelineno-0-610" name="__codelineno-0-610"></a>    <span class="k">def</span> <span class="nf">_get_beat_label</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">labels</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">):</span>
<a id="__codelineno-0-611" name="__codelineno-0-611"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Determine beat label based on the occurrence of pac / abberated / pvc,</span>
<a id="__codelineno-0-612" name="__codelineno-0-612"></a><span class="sd">            otherwise pick the most common beat type among the normal / undefined.</span>
<a id="__codelineno-0-613" name="__codelineno-0-613"></a>
<a id="__codelineno-0-614" name="__codelineno-0-614"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-615" name="__codelineno-0-615"></a><span class="sd">            labels (npt.NDArray): Array of beat labels.</span>
<a id="__codelineno-0-616" name="__codelineno-0-616"></a>
<a id="__codelineno-0-617" name="__codelineno-0-617"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-618" name="__codelineno-0-618"></a><span class="sd">            int: Beat label as an integer.</span>
<a id="__codelineno-0-619" name="__codelineno-0-619"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-620" name="__codelineno-0-620"></a>        <span class="c1"># calculate the count of each beat type in the frame</span>
<a id="__codelineno-0-621" name="__codelineno-0-621"></a>        <span class="n">beat_counts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">bincount</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">minlength</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">IcentiaBeat</span><span class="p">))</span>
<a id="__codelineno-0-622" name="__codelineno-0-622"></a>        <span class="n">max_hp_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">beat_counts</span><span class="p">[</span><span class="n">IcentiaBeat</span><span class="o">.</span><span class="n">hi_priority</span><span class="p">()])</span>
<a id="__codelineno-0-623" name="__codelineno-0-623"></a>        <span class="k">if</span> <span class="n">beat_counts</span><span class="p">[</span><span class="n">IcentiaBeat</span><span class="o">.</span><span class="n">hi_priority</span><span class="p">()][</span><span class="n">max_hp_idx</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-624" name="__codelineno-0-624"></a>            <span class="n">y</span> <span class="o">=</span> <span class="n">HeartBeatMap</span><span class="p">[</span><span class="n">IcentiaBeat</span><span class="o">.</span><span class="n">hi_priority</span><span class="p">()[</span><span class="n">max_hp_idx</span><span class="p">]]</span>
<a id="__codelineno-0-625" name="__codelineno-0-625"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-626" name="__codelineno-0-626"></a>            <span class="n">max_lp_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">beat_counts</span><span class="p">[</span><span class="n">IcentiaBeat</span><span class="o">.</span><span class="n">lo_priority</span><span class="p">()])</span>
<a id="__codelineno-0-627" name="__codelineno-0-627"></a>            <span class="c1"># handle the case of no detected beats</span>
<a id="__codelineno-0-628" name="__codelineno-0-628"></a>            <span class="k">if</span> <span class="n">beat_counts</span><span class="p">[</span><span class="n">IcentiaBeat</span><span class="o">.</span><span class="n">lo_priority</span><span class="p">()][</span><span class="n">max_lp_idx</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-629" name="__codelineno-0-629"></a>                <span class="n">y</span> <span class="o">=</span> <span class="n">HeartBeatMap</span><span class="p">[</span><span class="n">IcentiaBeat</span><span class="o">.</span><span class="n">lo_priority</span><span class="p">()[</span><span class="n">max_lp_idx</span><span class="p">]]</span>
<a id="__codelineno-0-630" name="__codelineno-0-630"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-631" name="__codelineno-0-631"></a>                <span class="n">y</span> <span class="o">=</span> <span class="n">HeartBeatMap</span><span class="p">[</span><span class="n">IcentiaBeat</span><span class="o">.</span><span class="n">undefined</span><span class="p">]</span>
<a id="__codelineno-0-632" name="__codelineno-0-632"></a>        <span class="k">return</span> <span class="n">y</span>
<a id="__codelineno-0-633" name="__codelineno-0-633"></a>
<a id="__codelineno-0-634" name="__codelineno-0-634"></a>    <span class="k">def</span> <span class="nf">_get_heart_rate_label</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qrs_indices</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<a id="__codelineno-0-635" name="__codelineno-0-635"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Determine the heart rate label based on an array of QRS indices (separating individual heartbeats).</span>
<a id="__codelineno-0-636" name="__codelineno-0-636"></a><span class="sd">            The QRS indices are assumed to be measured in seconds if sampling frequency `fs` is not specified.</span>
<a id="__codelineno-0-637" name="__codelineno-0-637"></a><span class="sd">            The heartbeat label is based on the following BPM (beats per minute) values: (0) tachycardia &lt;60 BPM,</span>
<a id="__codelineno-0-638" name="__codelineno-0-638"></a><span class="sd">            (1) bradycardia &gt;100 BPM, (2) healthy 60-100 BPM, (3) noisy if QRS detection failed.</span>
<a id="__codelineno-0-639" name="__codelineno-0-639"></a>
<a id="__codelineno-0-640" name="__codelineno-0-640"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-641" name="__codelineno-0-641"></a><span class="sd">            qrs_indices (list[int]): Array of QRS indices.</span>
<a id="__codelineno-0-642" name="__codelineno-0-642"></a><span class="sd">            fs (float, optional): Sampling frequency of the signal. Defaults to None.</span>
<a id="__codelineno-0-643" name="__codelineno-0-643"></a>
<a id="__codelineno-0-644" name="__codelineno-0-644"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-645" name="__codelineno-0-645"></a><span class="sd">            int: Heart rate label</span>
<a id="__codelineno-0-646" name="__codelineno-0-646"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-647" name="__codelineno-0-647"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">qrs_indices</span><span class="p">:</span>
<a id="__codelineno-0-648" name="__codelineno-0-648"></a>            <span class="k">return</span> <span class="n">HeartRate</span><span class="o">.</span><span class="n">noise</span><span class="o">.</span><span class="n">value</span>
<a id="__codelineno-0-649" name="__codelineno-0-649"></a>
<a id="__codelineno-0-650" name="__codelineno-0-650"></a>        <span class="n">rr_intervals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">qrs_indices</span><span class="p">)</span>
<a id="__codelineno-0-651" name="__codelineno-0-651"></a>        <span class="k">if</span> <span class="n">fs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-652" name="__codelineno-0-652"></a>            <span class="n">rr_intervals</span> <span class="o">=</span> <span class="n">rr_intervals</span> <span class="o">/</span> <span class="n">fs</span>
<a id="__codelineno-0-653" name="__codelineno-0-653"></a>        <span class="n">bpm</span> <span class="o">=</span> <span class="mi">60</span> <span class="o">/</span> <span class="n">rr_intervals</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<a id="__codelineno-0-654" name="__codelineno-0-654"></a>        <span class="k">if</span> <span class="n">bpm</span> <span class="o">&lt;</span> <span class="mi">60</span><span class="p">:</span>
<a id="__codelineno-0-655" name="__codelineno-0-655"></a>            <span class="k">return</span> <span class="n">HeartRate</span><span class="o">.</span><span class="n">bradycardia</span><span class="o">.</span><span class="n">value</span>
<a id="__codelineno-0-656" name="__codelineno-0-656"></a>        <span class="k">if</span> <span class="n">bpm</span> <span class="o">&lt;=</span> <span class="mi">100</span><span class="p">:</span>
<a id="__codelineno-0-657" name="__codelineno-0-657"></a>            <span class="k">return</span> <span class="n">HeartRate</span><span class="o">.</span><span class="n">normal</span><span class="o">.</span><span class="n">value</span>
<a id="__codelineno-0-658" name="__codelineno-0-658"></a>        <span class="k">return</span> <span class="n">HeartRate</span><span class="o">.</span><span class="n">tachycardia</span><span class="o">.</span><span class="n">value</span>
<a id="__codelineno-0-659" name="__codelineno-0-659"></a>
<a id="__codelineno-0-660" name="__codelineno-0-660"></a>    <span class="k">def</span> <span class="nf">_pt_has_rhythm_arrhythmia</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">patient_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<a id="__codelineno-0-661" name="__codelineno-0-661"></a>        <span class="n">pt_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pt_key</span><span class="p">(</span><span class="n">patient_id</span><span class="p">)</span>
<a id="__codelineno-0-662" name="__codelineno-0-662"></a>        <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ds_path</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pt_key</span><span class="si">}</span><span class="s2">.h5&quot;</span><span class="p">),</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">h5</span><span class="p">:</span>
<a id="__codelineno-0-663" name="__codelineno-0-663"></a>            <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">segment</span> <span class="ow">in</span> <span class="n">h5</span><span class="p">[</span><span class="n">pt_key</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-664" name="__codelineno-0-664"></a>                <span class="n">rlabels</span> <span class="o">=</span> <span class="n">segment</span><span class="p">[</span><span class="s2">&quot;rlabels&quot;</span><span class="p">][:]</span>
<a id="__codelineno-0-665" name="__codelineno-0-665"></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">rlabels</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
<a id="__codelineno-0-666" name="__codelineno-0-666"></a>                    <span class="k">continue</span>
<a id="__codelineno-0-667" name="__codelineno-0-667"></a>                <span class="n">rlabels</span> <span class="o">=</span> <span class="n">rlabels</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-668" name="__codelineno-0-668"></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">rlabels</span> <span class="o">==</span> <span class="n">IcentiaRhythm</span><span class="o">.</span><span class="n">afib</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">rlabels</span> <span class="o">==</span> <span class="n">IcentiaRhythm</span><span class="o">.</span><span class="n">aflut</span><span class="p">))[</span><span class="mi">0</span><span class="p">]):</span>
<a id="__codelineno-0-669" name="__codelineno-0-669"></a>                    <span class="k">return</span> <span class="kc">True</span>
<a id="__codelineno-0-670" name="__codelineno-0-670"></a>            <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-671" name="__codelineno-0-671"></a>
<a id="__codelineno-0-672" name="__codelineno-0-672"></a>    <span class="k">def</span> <span class="nf">get_rhythm_statistics</span><span class="p">(</span>
<a id="__codelineno-0-673" name="__codelineno-0-673"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-674" name="__codelineno-0-674"></a>        <span class="n">patient_ids</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-675" name="__codelineno-0-675"></a>        <span class="n">save_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-676" name="__codelineno-0-676"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<a id="__codelineno-0-677" name="__codelineno-0-677"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Utility function to extract rhythm statistics across entire dataset. Useful for EDA.</span>
<a id="__codelineno-0-678" name="__codelineno-0-678"></a>
<a id="__codelineno-0-679" name="__codelineno-0-679"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-680" name="__codelineno-0-680"></a><span class="sd">            patient_ids (npt.NDArray | None, optional): Patients IDs to include. Defaults to all.</span>
<a id="__codelineno-0-681" name="__codelineno-0-681"></a><span class="sd">            save_path (str | None, optional): Parquet file path to save results. Defaults to None.</span>
<a id="__codelineno-0-682" name="__codelineno-0-682"></a>
<a id="__codelineno-0-683" name="__codelineno-0-683"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-684" name="__codelineno-0-684"></a><span class="sd">            pd.DataFrame: DataFrame of statistics</span>
<a id="__codelineno-0-685" name="__codelineno-0-685"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-686" name="__codelineno-0-686"></a>
<a id="__codelineno-0-687" name="__codelineno-0-687"></a>        <span class="k">if</span> <span class="n">patient_ids</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-688" name="__codelineno-0-688"></a>            <span class="n">patient_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">patient_ids</span>
<a id="__codelineno-0-689" name="__codelineno-0-689"></a>        <span class="n">pt_gen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">uniform_patient_generator</span><span class="p">(</span><span class="n">patient_ids</span><span class="o">=</span><span class="n">patient_ids</span><span class="p">,</span> <span class="n">repeat</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-690" name="__codelineno-0-690"></a>        <span class="n">stats</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-691" name="__codelineno-0-691"></a>        <span class="k">for</span> <span class="n">pt</span><span class="p">,</span> <span class="n">segments</span> <span class="ow">in</span> <span class="n">pt_gen</span><span class="p">:</span>
<a id="__codelineno-0-692" name="__codelineno-0-692"></a>            <span class="c1"># Group patient rhythms by type (segment, start, stop)</span>
<a id="__codelineno-0-693" name="__codelineno-0-693"></a>            <span class="n">segment_label_map</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]]</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-694" name="__codelineno-0-694"></a>            <span class="k">for</span> <span class="n">seg_key</span><span class="p">,</span> <span class="n">segment</span> <span class="ow">in</span> <span class="n">segments</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-695" name="__codelineno-0-695"></a>                <span class="n">rlabels</span> <span class="o">=</span> <span class="n">segment</span><span class="p">[</span><span class="s2">&quot;rlabels&quot;</span><span class="p">][:]</span>
<a id="__codelineno-0-696" name="__codelineno-0-696"></a>                <span class="k">if</span> <span class="n">rlabels</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-697" name="__codelineno-0-697"></a>                    <span class="k">continue</span>  <span class="c1"># Segment has no rhythm labels</span>
<a id="__codelineno-0-698" name="__codelineno-0-698"></a>                <span class="n">rlabels</span> <span class="o">=</span> <span class="n">rlabels</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">rlabels</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">IcentiaRhythm</span><span class="o">.</span><span class="n">noise</span><span class="o">.</span><span class="n">value</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>
<a id="__codelineno-0-699" name="__codelineno-0-699"></a>                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">rlabels</span><span class="p">[::</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]):</span>
<a id="__codelineno-0-700" name="__codelineno-0-700"></a>                    <span class="k">if</span> <span class="n">l</span> <span class="ow">in</span> <span class="p">(</span>
<a id="__codelineno-0-701" name="__codelineno-0-701"></a>                        <span class="n">IcentiaRhythm</span><span class="o">.</span><span class="n">noise</span><span class="p">,</span>
<a id="__codelineno-0-702" name="__codelineno-0-702"></a>                        <span class="n">IcentiaRhythm</span><span class="o">.</span><span class="n">normal</span><span class="p">,</span>
<a id="__codelineno-0-703" name="__codelineno-0-703"></a>                        <span class="n">IcentiaRhythm</span><span class="o">.</span><span class="n">afib</span><span class="p">,</span>
<a id="__codelineno-0-704" name="__codelineno-0-704"></a>                        <span class="n">IcentiaRhythm</span><span class="o">.</span><span class="n">aflut</span><span class="p">,</span>
<a id="__codelineno-0-705" name="__codelineno-0-705"></a>                    <span class="p">):</span>
<a id="__codelineno-0-706" name="__codelineno-0-706"></a>                        <span class="n">rhy_start</span><span class="p">,</span> <span class="n">rhy_stop</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-707" name="__codelineno-0-707"></a>                            <span class="n">rlabels</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
<a id="__codelineno-0-708" name="__codelineno-0-708"></a>                            <span class="n">rlabels</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
<a id="__codelineno-0-709" name="__codelineno-0-709"></a>                        <span class="p">)</span>
<a id="__codelineno-0-710" name="__codelineno-0-710"></a>                        <span class="n">stats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<a id="__codelineno-0-711" name="__codelineno-0-711"></a>                            <span class="nb">dict</span><span class="p">(</span>
<a id="__codelineno-0-712" name="__codelineno-0-712"></a>                                <span class="n">pt</span><span class="o">=</span><span class="n">pt</span><span class="p">,</span>
<a id="__codelineno-0-713" name="__codelineno-0-713"></a>                                <span class="n">rc</span><span class="o">=</span><span class="n">seg_key</span><span class="p">,</span>
<a id="__codelineno-0-714" name="__codelineno-0-714"></a>                                <span class="n">rhythm</span><span class="o">=</span><span class="n">l</span><span class="p">,</span>
<a id="__codelineno-0-715" name="__codelineno-0-715"></a>                                <span class="n">start</span><span class="o">=</span><span class="n">rhy_start</span><span class="p">,</span>
<a id="__codelineno-0-716" name="__codelineno-0-716"></a>                                <span class="n">stop</span><span class="o">=</span><span class="n">rhy_stop</span><span class="p">,</span>
<a id="__codelineno-0-717" name="__codelineno-0-717"></a>                                <span class="n">dur</span><span class="o">=</span><span class="n">rhy_stop</span> <span class="o">-</span> <span class="n">rhy_start</span><span class="p">,</span>
<a id="__codelineno-0-718" name="__codelineno-0-718"></a>                            <span class="p">)</span>
<a id="__codelineno-0-719" name="__codelineno-0-719"></a>                        <span class="p">)</span>
<a id="__codelineno-0-720" name="__codelineno-0-720"></a>                        <span class="n">segment_label_map</span><span class="p">[</span><span class="n">l</span><span class="p">]</span> <span class="o">=</span> <span class="n">segment_label_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="p">[])</span> <span class="o">+</span> <span class="p">[</span>
<a id="__codelineno-0-721" name="__codelineno-0-721"></a>                            <span class="p">(</span><span class="n">seg_key</span><span class="p">,</span> <span class="n">rlabels</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">rlabels</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-0-722" name="__codelineno-0-722"></a>                        <span class="p">]</span>
<a id="__codelineno-0-723" name="__codelineno-0-723"></a>                    <span class="c1"># END IF</span>
<a id="__codelineno-0-724" name="__codelineno-0-724"></a>                <span class="c1"># END FOR</span>
<a id="__codelineno-0-725" name="__codelineno-0-725"></a>            <span class="c1"># END FOR</span>
<a id="__codelineno-0-726" name="__codelineno-0-726"></a>        <span class="c1"># END FOR</span>
<a id="__codelineno-0-727" name="__codelineno-0-727"></a>        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">stats</span><span class="p">)</span>
<a id="__codelineno-0-728" name="__codelineno-0-728"></a>        <span class="k">if</span> <span class="n">save_path</span><span class="p">:</span>
<a id="__codelineno-0-729" name="__codelineno-0-729"></a>            <span class="n">df</span><span class="o">.</span><span class="n">to_parquet</span><span class="p">(</span><span class="n">save_path</span><span class="p">)</span>
<a id="__codelineno-0-730" name="__codelineno-0-730"></a>        <span class="k">return</span> <span class="n">df</span>
<a id="__codelineno-0-731" name="__codelineno-0-731"></a>
<a id="__codelineno-0-732" name="__codelineno-0-732"></a>    <span class="k">def</span> <span class="nf">download</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_workers</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">force</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<a id="__codelineno-0-733" name="__codelineno-0-733"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Download dataset</span>
<a id="__codelineno-0-734" name="__codelineno-0-734"></a>
<a id="__codelineno-0-735" name="__codelineno-0-735"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-736" name="__codelineno-0-736"></a><span class="sd">            num_workers (int | None, optional): # parallel workers. Defaults to None.</span>
<a id="__codelineno-0-737" name="__codelineno-0-737"></a><span class="sd">            force (bool, optional): Force redownload. Defaults to False.</span>
<a id="__codelineno-0-738" name="__codelineno-0-738"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-739" name="__codelineno-0-739"></a>
<a id="__codelineno-0-740" name="__codelineno-0-740"></a>        <span class="k">def</span> <span class="nf">download_s3_file</span><span class="p">(</span>
<a id="__codelineno-0-741" name="__codelineno-0-741"></a>            <span class="n">s3_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-742" name="__codelineno-0-742"></a>            <span class="n">save_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-743" name="__codelineno-0-743"></a>            <span class="n">bucket</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-744" name="__codelineno-0-744"></a>            <span class="n">client</span><span class="p">:</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">,</span>
<a id="__codelineno-0-745" name="__codelineno-0-745"></a>            <span class="n">force</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-746" name="__codelineno-0-746"></a>        <span class="p">):</span>
<a id="__codelineno-0-747" name="__codelineno-0-747"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">force</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">save_path</span><span class="p">):</span>
<a id="__codelineno-0-748" name="__codelineno-0-748"></a>                <span class="k">return</span>
<a id="__codelineno-0-749" name="__codelineno-0-749"></a>            <span class="n">client</span><span class="o">.</span><span class="n">download_file</span><span class="p">(</span>
<a id="__codelineno-0-750" name="__codelineno-0-750"></a>                <span class="n">Bucket</span><span class="o">=</span><span class="n">bucket</span><span class="p">,</span>
<a id="__codelineno-0-751" name="__codelineno-0-751"></a>                <span class="n">Key</span><span class="o">=</span><span class="n">s3_file</span><span class="p">,</span>
<a id="__codelineno-0-752" name="__codelineno-0-752"></a>                <span class="n">Filename</span><span class="o">=</span><span class="n">save_path</span><span class="p">,</span>
<a id="__codelineno-0-753" name="__codelineno-0-753"></a>            <span class="p">)</span>
<a id="__codelineno-0-754" name="__codelineno-0-754"></a>
<a id="__codelineno-0-755" name="__codelineno-0-755"></a>        <span class="n">s3_bucket</span> <span class="o">=</span> <span class="s2">&quot;ambiqai-ecg-icentia11k-dataset&quot;</span>
<a id="__codelineno-0-756" name="__codelineno-0-756"></a>        <span class="n">s3_prefix</span> <span class="o">=</span> <span class="s2">&quot;patients&quot;</span>
<a id="__codelineno-0-757" name="__codelineno-0-757"></a>
<a id="__codelineno-0-758" name="__codelineno-0-758"></a>        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ds_path</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-759" name="__codelineno-0-759"></a>
<a id="__codelineno-0-760" name="__codelineno-0-760"></a>        <span class="n">patient_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">patient_ids</span>
<a id="__codelineno-0-761" name="__codelineno-0-761"></a>
<a id="__codelineno-0-762" name="__codelineno-0-762"></a>        <span class="c1"># Creating only one session and one client</span>
<a id="__codelineno-0-763" name="__codelineno-0-763"></a>        <span class="n">session</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>
<a id="__codelineno-0-764" name="__codelineno-0-764"></a>        <span class="n">client</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s2">&quot;s3&quot;</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">Config</span><span class="p">(</span><span class="n">signature_version</span><span class="o">=</span><span class="n">UNSIGNED</span><span class="p">))</span>
<a id="__codelineno-0-765" name="__codelineno-0-765"></a>
<a id="__codelineno-0-766" name="__codelineno-0-766"></a>        <span class="n">func</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">download_s3_file</span><span class="p">,</span> <span class="n">bucket</span><span class="o">=</span><span class="n">s3_bucket</span><span class="p">,</span> <span class="n">client</span><span class="o">=</span><span class="n">client</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="n">force</span><span class="p">)</span>
<a id="__codelineno-0-767" name="__codelineno-0-767"></a>
<a id="__codelineno-0-768" name="__codelineno-0-768"></a>        <span class="k">with</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Downloading icentia11k dataset from S3&quot;</span><span class="p">,</span> <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">patient_ids</span><span class="p">))</span> <span class="k">as</span> <span class="n">pbar</span><span class="p">:</span>
<a id="__codelineno-0-769" name="__codelineno-0-769"></a>            <span class="n">pt_keys</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_pt_key</span><span class="p">(</span><span class="n">patient_id</span><span class="p">)</span> <span class="k">for</span> <span class="n">patient_id</span> <span class="ow">in</span> <span class="n">patient_ids</span><span class="p">]</span>
<a id="__codelineno-0-770" name="__codelineno-0-770"></a>            <span class="k">with</span> <span class="n">ThreadPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="mi">2</span> <span class="o">*</span> <span class="n">num_workers</span><span class="p">)</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
<a id="__codelineno-0-771" name="__codelineno-0-771"></a>                <span class="n">futures</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-772" name="__codelineno-0-772"></a>                    <span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span>
<a id="__codelineno-0-773" name="__codelineno-0-773"></a>                        <span class="n">func</span><span class="p">,</span>
<a id="__codelineno-0-774" name="__codelineno-0-774"></a>                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">s3_prefix</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">pt_key</span><span class="si">}</span><span class="s2">.h5&quot;</span><span class="p">,</span>
<a id="__codelineno-0-775" name="__codelineno-0-775"></a>                        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ds_path</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pt_key</span><span class="si">}</span><span class="s2">.h5&quot;</span><span class="p">),</span>
<a id="__codelineno-0-776" name="__codelineno-0-776"></a>                    <span class="p">)</span>
<a id="__codelineno-0-777" name="__codelineno-0-777"></a>                    <span class="k">for</span> <span class="n">pt_key</span> <span class="ow">in</span> <span class="n">pt_keys</span>
<a id="__codelineno-0-778" name="__codelineno-0-778"></a>                <span class="p">)</span>
<a id="__codelineno-0-779" name="__codelineno-0-779"></a>                <span class="k">for</span> <span class="n">future</span> <span class="ow">in</span> <span class="n">as_completed</span><span class="p">(</span><span class="n">futures</span><span class="p">):</span>
<a id="__codelineno-0-780" name="__codelineno-0-780"></a>                    <span class="n">err</span> <span class="o">=</span> <span class="n">future</span><span class="o">.</span><span class="n">exception</span><span class="p">()</span>
<a id="__codelineno-0-781" name="__codelineno-0-781"></a>                    <span class="k">if</span> <span class="n">err</span><span class="p">:</span>
<a id="__codelineno-0-782" name="__codelineno-0-782"></a>                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Failed on file&quot;</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
<a id="__codelineno-0-783" name="__codelineno-0-783"></a>                    <span class="n">pbar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-784" name="__codelineno-0-784"></a>                <span class="c1"># END FOR</span>
<a id="__codelineno-0-785" name="__codelineno-0-785"></a>            <span class="c1"># END WITH</span>
<a id="__codelineno-0-786" name="__codelineno-0-786"></a>        <span class="c1"># END WITH</span>
<a id="__codelineno-0-787" name="__codelineno-0-787"></a>
<a id="__codelineno-0-788" name="__codelineno-0-788"></a>    <span class="k">def</span> <span class="nf">download_raw_dataset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_workers</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">force</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<a id="__codelineno-0-789" name="__codelineno-0-789"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Downloads full Icentia dataset zipfile and converts into individial patient HDF5 files.</span>
<a id="__codelineno-0-790" name="__codelineno-0-790"></a><span class="sd">        NOTE: This is a very long process (e.g. 24 hrs). Please use `icentia11k.download_dataset` instead.</span>
<a id="__codelineno-0-791" name="__codelineno-0-791"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-792" name="__codelineno-0-792"></a><span class="sd">            force (bool, optional): Whether to force re-download if destination exists. Defaults to False.</span>
<a id="__codelineno-0-793" name="__codelineno-0-793"></a><span class="sd">            num_workers (int, optional): # parallel workers. Defaults to os.cpu_count().</span>
<a id="__codelineno-0-794" name="__codelineno-0-794"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-795" name="__codelineno-0-795"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Downloading icentia11k dataset&quot;</span><span class="p">)</span>
<a id="__codelineno-0-796" name="__codelineno-0-796"></a>        <span class="n">ds_url</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-797" name="__codelineno-0-797"></a>            <span class="s2">&quot;https://physionet.org/static/published-projects/icentia11k-continuous-ecg/&quot;</span>
<a id="__codelineno-0-798" name="__codelineno-0-798"></a>            <span class="s2">&quot;icentia11k-single-lead-continuous-raw-electrocardiogram-dataset-1.0.zip&quot;</span>
<a id="__codelineno-0-799" name="__codelineno-0-799"></a>        <span class="p">)</span>
<a id="__codelineno-0-800" name="__codelineno-0-800"></a>        <span class="n">ds_zip_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ds_path</span><span class="p">,</span> <span class="s2">&quot;icentia11k.zip&quot;</span><span class="p">)</span>
<a id="__codelineno-0-801" name="__codelineno-0-801"></a>        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ds_path</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-802" name="__codelineno-0-802"></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">ds_zip_path</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">force</span><span class="p">:</span>
<a id="__codelineno-0-803" name="__codelineno-0-803"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
<a id="__codelineno-0-804" name="__codelineno-0-804"></a>                <span class="sa">f</span><span class="s2">&quot;Zip file already exists. Please delete or set `force` flag to redownload. PATH=</span><span class="si">{</span><span class="n">ds_zip_path</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-805" name="__codelineno-0-805"></a>            <span class="p">)</span>
<a id="__codelineno-0-806" name="__codelineno-0-806"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-807" name="__codelineno-0-807"></a>            <span class="n">download_file</span><span class="p">(</span><span class="n">ds_url</span><span class="p">,</span> <span class="n">ds_zip_path</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-808" name="__codelineno-0-808"></a>
<a id="__codelineno-0-809" name="__codelineno-0-809"></a>        <span class="c1"># 2. Extract and convert patient ECG data to H5 files</span>
<a id="__codelineno-0-810" name="__codelineno-0-810"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Generating icentia11k patient data&quot;</span><span class="p">)</span>
<a id="__codelineno-0-811" name="__codelineno-0-811"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_convert_dataset_zip_to_hdf5</span><span class="p">(</span>
<a id="__codelineno-0-812" name="__codelineno-0-812"></a>            <span class="n">zip_path</span><span class="o">=</span><span class="n">ds_zip_path</span><span class="p">,</span>
<a id="__codelineno-0-813" name="__codelineno-0-813"></a>            <span class="n">force</span><span class="o">=</span><span class="n">force</span><span class="p">,</span>
<a id="__codelineno-0-814" name="__codelineno-0-814"></a>            <span class="n">num_workers</span><span class="o">=</span><span class="n">num_workers</span><span class="p">,</span>
<a id="__codelineno-0-815" name="__codelineno-0-815"></a>        <span class="p">)</span>
<a id="__codelineno-0-816" name="__codelineno-0-816"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Finished icentia11k patient data&quot;</span><span class="p">)</span>
<a id="__codelineno-0-817" name="__codelineno-0-817"></a>
<a id="__codelineno-0-818" name="__codelineno-0-818"></a>    <span class="k">def</span> <span class="nf">_convert_dataset_pt_zip_to_hdf5</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">patient</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">zip_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">force</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<a id="__codelineno-0-819" name="__codelineno-0-819"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract patient data from Icentia zipfile. Pulls out ECG data along with all labels.</span>
<a id="__codelineno-0-820" name="__codelineno-0-820"></a>
<a id="__codelineno-0-821" name="__codelineno-0-821"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-822" name="__codelineno-0-822"></a><span class="sd">            patient (int): Patient id</span>
<a id="__codelineno-0-823" name="__codelineno-0-823"></a><span class="sd">            zip_path (str): Zipfile path</span>
<a id="__codelineno-0-824" name="__codelineno-0-824"></a><span class="sd">            force (bool, optional): Whether to override destination if it exists. Defaults to False.</span>
<a id="__codelineno-0-825" name="__codelineno-0-825"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-826" name="__codelineno-0-826"></a>        <span class="kn">import</span> <span class="nn">re</span>  <span class="c1"># pylint: disable=import-outside-toplevel</span>
<a id="__codelineno-0-827" name="__codelineno-0-827"></a>
<a id="__codelineno-0-828" name="__codelineno-0-828"></a>        <span class="kn">import</span> <span class="nn">wfdb</span>  <span class="c1"># pylint: disable=import-outside-toplevel</span>
<a id="__codelineno-0-829" name="__codelineno-0-829"></a>
<a id="__codelineno-0-830" name="__codelineno-0-830"></a>        <span class="c1"># These map Wfdb labels to icentia labels</span>
<a id="__codelineno-0-831" name="__codelineno-0-831"></a>        <span class="n">WfdbRhythmMap</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;(N&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;(AFIB&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;(AFL&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;)&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">}</span>
<a id="__codelineno-0-832" name="__codelineno-0-832"></a>        <span class="n">WfdbBeatMap</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Q&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;N&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;S&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;V&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">}</span>
<a id="__codelineno-0-833" name="__codelineno-0-833"></a>
<a id="__codelineno-0-834" name="__codelineno-0-834"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processing patient </span><span class="si">{</span><span class="n">patient</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-835" name="__codelineno-0-835"></a>        <span class="n">pt_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pt_key</span><span class="p">(</span><span class="n">patient</span><span class="p">)</span>
<a id="__codelineno-0-836" name="__codelineno-0-836"></a>        <span class="n">pt_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ds_path</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pt_id</span><span class="si">}</span><span class="s2">.h5&quot;</span><span class="p">)</span>
<a id="__codelineno-0-837" name="__codelineno-0-837"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">force</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">pt_path</span><span class="p">):</span>
<a id="__codelineno-0-838" name="__codelineno-0-838"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;skipping patient&quot;</span><span class="p">)</span>
<a id="__codelineno-0-839" name="__codelineno-0-839"></a>            <span class="k">return</span>
<a id="__codelineno-0-840" name="__codelineno-0-840"></a>        <span class="n">zp</span> <span class="o">=</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">zip_path</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">)</span>  <span class="c1"># pylint: disable=consider-using-with</span>
<a id="__codelineno-0-841" name="__codelineno-0-841"></a>        <span class="n">h5</span> <span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">pt_path</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">)</span>
<a id="__codelineno-0-842" name="__codelineno-0-842"></a>
<a id="__codelineno-0-843" name="__codelineno-0-843"></a>        <span class="c1"># Find all patient .dat file indices</span>
<a id="__codelineno-0-844" name="__codelineno-0-844"></a>        <span class="n">zp_rec_names</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span>
<a id="__codelineno-0-845" name="__codelineno-0-845"></a>            <span class="k">lambda</span> <span class="n">f</span><span class="p">:</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pt_id</span><span class="si">}</span><span class="s2">_[A-z0-9]+.dat&quot;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">f</span><span class="p">)),</span>
<a id="__codelineno-0-846" name="__codelineno-0-846"></a>            <span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">filename</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">zp</span><span class="o">.</span><span class="n">filelist</span><span class="p">),</span>
<a id="__codelineno-0-847" name="__codelineno-0-847"></a>        <span class="p">)</span>
<a id="__codelineno-0-848" name="__codelineno-0-848"></a>        <span class="k">for</span> <span class="n">zp_rec_name</span> <span class="ow">in</span> <span class="n">zp_rec_names</span><span class="p">:</span>
<a id="__codelineno-0-849" name="__codelineno-0-849"></a>            <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-850" name="__codelineno-0-850"></a>                <span class="n">zp_hdr_name</span> <span class="o">=</span> <span class="n">zp_rec_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.dat&quot;</span><span class="p">,</span> <span class="s2">&quot;.hea&quot;</span><span class="p">)</span>
<a id="__codelineno-0-851" name="__codelineno-0-851"></a>                <span class="n">zp_atr_name</span> <span class="o">=</span> <span class="n">zp_rec_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.dat&quot;</span><span class="p">,</span> <span class="s2">&quot;.atr&quot;</span><span class="p">)</span>
<a id="__codelineno-0-852" name="__codelineno-0-852"></a>
<a id="__codelineno-0-853" name="__codelineno-0-853"></a>                <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryDirectory</span><span class="p">()</span> <span class="k">as</span> <span class="n">tmpdir</span><span class="p">:</span>
<a id="__codelineno-0-854" name="__codelineno-0-854"></a>                    <span class="n">rec_fpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmpdir</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">zp_rec_name</span><span class="p">))</span>
<a id="__codelineno-0-855" name="__codelineno-0-855"></a>                    <span class="n">atr_fpath</span> <span class="o">=</span> <span class="n">rec_fpath</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.dat&quot;</span><span class="p">,</span> <span class="s2">&quot;.atr&quot;</span><span class="p">)</span>
<a id="__codelineno-0-856" name="__codelineno-0-856"></a>                    <span class="n">hdr_fpath</span> <span class="o">=</span> <span class="n">rec_fpath</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.dat&quot;</span><span class="p">,</span> <span class="s2">&quot;.hea&quot;</span><span class="p">)</span>
<a id="__codelineno-0-857" name="__codelineno-0-857"></a>                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">hdr_fpath</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
<a id="__codelineno-0-858" name="__codelineno-0-858"></a>                        <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">zp</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">zp_hdr_name</span><span class="p">))</span>
<a id="__codelineno-0-859" name="__codelineno-0-859"></a>                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">rec_fpath</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
<a id="__codelineno-0-860" name="__codelineno-0-860"></a>                        <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">zp</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">zp_rec_name</span><span class="p">))</span>
<a id="__codelineno-0-861" name="__codelineno-0-861"></a>                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">atr_fpath</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
<a id="__codelineno-0-862" name="__codelineno-0-862"></a>                        <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">zp</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">zp_atr_name</span><span class="p">))</span>
<a id="__codelineno-0-863" name="__codelineno-0-863"></a>                    <span class="n">rec</span> <span class="o">=</span> <span class="n">wfdb</span><span class="o">.</span><span class="n">rdrecord</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">rec_fpath</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">physical</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-864" name="__codelineno-0-864"></a>                    <span class="n">atr</span> <span class="o">=</span> <span class="n">wfdb</span><span class="o">.</span><span class="n">rdann</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">atr_fpath</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">extension</span><span class="o">=</span><span class="s2">&quot;atr&quot;</span><span class="p">)</span>
<a id="__codelineno-0-865" name="__codelineno-0-865"></a>                <span class="n">pt_seg_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;/</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">zp_rec_name</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;/&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-866" name="__codelineno-0-866"></a>                <span class="n">data</span> <span class="o">=</span> <span class="n">rec</span><span class="o">.</span><span class="n">p_signal</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float16</span><span class="p">)</span>
<a id="__codelineno-0-867" name="__codelineno-0-867"></a>                <span class="n">blabels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
<a id="__codelineno-0-868" name="__codelineno-0-868"></a>                    <span class="p">[[</span><span class="n">atr</span><span class="o">.</span><span class="n">sample</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">WfdbBeatMap</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">s</span><span class="p">)]</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">atr</span><span class="o">.</span><span class="n">symbol</span><span class="p">)</span> <span class="k">if</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">WfdbBeatMap</span><span class="p">],</span>
<a id="__codelineno-0-869" name="__codelineno-0-869"></a>                    <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">,</span>
<a id="__codelineno-0-870" name="__codelineno-0-870"></a>                <span class="p">)</span>
<a id="__codelineno-0-871" name="__codelineno-0-871"></a>                <span class="n">rlabels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
<a id="__codelineno-0-872" name="__codelineno-0-872"></a>                    <span class="p">[</span>
<a id="__codelineno-0-873" name="__codelineno-0-873"></a>                        <span class="p">[</span><span class="n">atr</span><span class="o">.</span><span class="n">sample</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">WfdbRhythmMap</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">atr</span><span class="o">.</span><span class="n">aux_note</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mi">0</span><span class="p">)]</span>
<a id="__codelineno-0-874" name="__codelineno-0-874"></a>                        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">atr</span><span class="o">.</span><span class="n">symbol</span><span class="p">)</span>
<a id="__codelineno-0-875" name="__codelineno-0-875"></a>                        <span class="k">if</span> <span class="n">s</span> <span class="o">==</span> <span class="s2">&quot;+&quot;</span>
<a id="__codelineno-0-876" name="__codelineno-0-876"></a>                    <span class="p">],</span>
<a id="__codelineno-0-877" name="__codelineno-0-877"></a>                    <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">,</span>
<a id="__codelineno-0-878" name="__codelineno-0-878"></a>                <span class="p">)</span>
<a id="__codelineno-0-879" name="__codelineno-0-879"></a>                <span class="n">h5</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span>
<a id="__codelineno-0-880" name="__codelineno-0-880"></a>                    <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pt_seg_path</span><span class="si">}</span><span class="s2">/data&quot;</span><span class="p">,</span>
<a id="__codelineno-0-881" name="__codelineno-0-881"></a>                    <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
<a id="__codelineno-0-882" name="__codelineno-0-882"></a>                    <span class="n">compression</span><span class="o">=</span><span class="s2">&quot;gzip&quot;</span><span class="p">,</span>
<a id="__codelineno-0-883" name="__codelineno-0-883"></a>                    <span class="n">compression_opts</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
<a id="__codelineno-0-884" name="__codelineno-0-884"></a>                <span class="p">)</span>
<a id="__codelineno-0-885" name="__codelineno-0-885"></a>                <span class="n">h5</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pt_seg_path</span><span class="si">}</span><span class="s2">/blabels&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">blabels</span><span class="p">)</span>
<a id="__codelineno-0-886" name="__codelineno-0-886"></a>                <span class="n">h5</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pt_seg_path</span><span class="si">}</span><span class="s2">/rlabels&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">rlabels</span><span class="p">)</span>
<a id="__codelineno-0-887" name="__codelineno-0-887"></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>  <span class="c1"># pylint: disable=broad-except</span>
<a id="__codelineno-0-888" name="__codelineno-0-888"></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed processing </span><span class="si">{</span><span class="n">zp_rec_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
<a id="__codelineno-0-889" name="__codelineno-0-889"></a>                <span class="k">continue</span>
<a id="__codelineno-0-890" name="__codelineno-0-890"></a>        <span class="n">h5</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-0-891" name="__codelineno-0-891"></a>
<a id="__codelineno-0-892" name="__codelineno-0-892"></a>    <span class="k">def</span> <span class="nf">_convert_dataset_zip_to_hdf5</span><span class="p">(</span>
<a id="__codelineno-0-893" name="__codelineno-0-893"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-894" name="__codelineno-0-894"></a>        <span class="n">zip_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-895" name="__codelineno-0-895"></a>        <span class="n">patient_ids</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-896" name="__codelineno-0-896"></a>        <span class="n">force</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-897" name="__codelineno-0-897"></a>        <span class="n">num_workers</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-898" name="__codelineno-0-898"></a>    <span class="p">):</span>
<a id="__codelineno-0-899" name="__codelineno-0-899"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert zipped Icentia dataset into individial patient HDF5 files.</span>
<a id="__codelineno-0-900" name="__codelineno-0-900"></a>
<a id="__codelineno-0-901" name="__codelineno-0-901"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-902" name="__codelineno-0-902"></a><span class="sd">            zip_path (str): Zipfile path</span>
<a id="__codelineno-0-903" name="__codelineno-0-903"></a><span class="sd">            patient_ids (npt.NDArray | None, optional): List of patient IDs to extract. Defaults to all.</span>
<a id="__codelineno-0-904" name="__codelineno-0-904"></a><span class="sd">            force (bool, optional): Whether to force re-download if destination exists. Defaults to False.</span>
<a id="__codelineno-0-905" name="__codelineno-0-905"></a><span class="sd">            num_workers (int, optional): # parallel workers. Defaults to os.cpu_count().</span>
<a id="__codelineno-0-906" name="__codelineno-0-906"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-907" name="__codelineno-0-907"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">patient_ids</span><span class="p">:</span>
<a id="__codelineno-0-908" name="__codelineno-0-908"></a>            <span class="n">patient_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">patient_ids</span>
<a id="__codelineno-0-909" name="__codelineno-0-909"></a>        <span class="n">f</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_convert_dataset_pt_zip_to_hdf5</span><span class="p">,</span> <span class="n">zip_path</span><span class="o">=</span><span class="n">zip_path</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="n">force</span><span class="p">)</span>
<a id="__codelineno-0-910" name="__codelineno-0-910"></a>        <span class="k">with</span> <span class="n">Pool</span><span class="p">(</span><span class="n">processes</span><span class="o">=</span><span class="n">num_workers</span><span class="p">)</span> <span class="k">as</span> <span class="n">pool</span><span class="p">:</span>
<a id="__codelineno-0-911" name="__codelineno-0-911"></a>            <span class="n">_</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">tqdm</span><span class="p">(</span><span class="n">pool</span><span class="o">.</span><span class="n">imap</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">patient_ids</span><span class="p">),</span> <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">patient_ids</span><span class="p">)))</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h4 id="heartkit.datasets.icentia11k.IcentiaDataset.arr_rhythm_patients" class="doc doc-heading">
<code class="highlight language-python"><span class="n">arr_rhythm_patients</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-cached"><code>cached</code></small>
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h4>


  <div class="doc doc-contents ">
  
      <p>Find all patients with arrhythmia events. This takes roughly 10 secs.</p>

  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code><a class="autorefs autorefs-external" title="numpy" href="https://numpy.org/doc/stable/reference/index.html#module-numpy">npt</a>.<span title="numpy.NDArray">NDArray</span></code>
        – <p>npt.NDArray: Patient ids</p>
      </li>
  </ul>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="heartkit.datasets.icentia11k.IcentiaDataset.mean" class="doc doc-heading">
<code class="highlight language-python"><span class="n">mean</span><span class="p">:</span> <span class="nb">float</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h4>


  <div class="doc doc-contents ">
  
      <p>Dataset mean</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="heartkit.datasets.icentia11k.IcentiaDataset.patient_ids" class="doc doc-heading">
<code class="highlight language-python"><span class="n">patient_ids</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h4>


  <div class="doc doc-contents ">
  
      <p>Get dataset patient IDs</p>

  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code><a class="autorefs autorefs-external" title="numpy" href="https://numpy.org/doc/stable/reference/index.html#module-numpy">npt</a>.<span title="numpy.NDArray">NDArray</span></code>
        – <p>npt.NDArray: patient IDs</p>
      </li>
  </ul>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="heartkit.datasets.icentia11k.IcentiaDataset.sampling_rate" class="doc doc-heading">
<code class="highlight language-python"><span class="n">sampling_rate</span><span class="p">:</span> <span class="nb">int</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h4>


  <div class="doc doc-contents ">
  
      <p>Sampling rate in Hz</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="heartkit.datasets.icentia11k.IcentiaDataset.std" class="doc doc-heading">
<code class="highlight language-python"><span class="n">std</span><span class="p">:</span> <span class="nb">float</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h4>


  <div class="doc doc-contents ">
  
      <p>Dataset st dev</p>
  </div>

</div>



<div class="doc doc-object doc-function">



<h4 id="heartkit.datasets.icentia11k.IcentiaDataset.beat_data_generator" class="doc doc-heading">
<code class="highlight language-python"><span class="n">beat_data_generator</span><span class="p">(</span><span class="n">patient_generator</span><span class="p">,</span> <span class="n">samples_per_patient</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Generate frames and beat label using patient generator.
There are over 2.5 billion normal and undefined while less than 40 million arrhythmia beats.
The following routine sorts each patient's beats by type and then approx. uniformly samples them by amount requested.
We start with arrhythmia types followed by undefined and normal. For each beat we resplit remaining samples requested.</p>

  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b>patient_generator</b>
            (<code><span title="heartkit.datasets.defines.PatientGenerator">PatientGenerator</span></code>)
        – <p>Patient generator</p>
      </li>
      <li class="field-body">
        <b>samples_per_patient</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a> | <a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#list">list</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a>]</code>)
        – <h5 id="heartkit.datasets.icentia11k.IcentiaDataset.beat_data_generator--samples-per-patient-defaults-to-1">samples per patient. Defaults to 1.</h5>
      </li>
  </ul>

  <p>Returns:</p>
  <ul>
      <li class="field-body">
<b>SampleGenerator</b>(            <code><span title="heartkit.datasets.defines.SampleGenerator">SampleGenerator</span></code>
)        – <p>Sample generator</p>
      </li>
  </ul>

  <p>Yields:</p>
  <ul>
      <li class="field-body">
            <code><span title="heartkit.datasets.defines.SampleGenerator">SampleGenerator</span></code>
        – <p>Iterator[SampleGenerator]</p>
      </li>
  </ul>

      <details class="quote">
        <summary>Source code in <code>heartkit/datasets/icentia11k.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-309">309</a></span>
<span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span>
<span class="normal"><a href="#__codelineno-0-316">316</a></span>
<span class="normal"><a href="#__codelineno-0-317">317</a></span>
<span class="normal"><a href="#__codelineno-0-318">318</a></span>
<span class="normal"><a href="#__codelineno-0-319">319</a></span>
<span class="normal"><a href="#__codelineno-0-320">320</a></span>
<span class="normal"><a href="#__codelineno-0-321">321</a></span>
<span class="normal"><a href="#__codelineno-0-322">322</a></span>
<span class="normal"><a href="#__codelineno-0-323">323</a></span>
<span class="normal"><a href="#__codelineno-0-324">324</a></span>
<span class="normal"><a href="#__codelineno-0-325">325</a></span>
<span class="normal"><a href="#__codelineno-0-326">326</a></span>
<span class="normal"><a href="#__codelineno-0-327">327</a></span>
<span class="normal"><a href="#__codelineno-0-328">328</a></span>
<span class="normal"><a href="#__codelineno-0-329">329</a></span>
<span class="normal"><a href="#__codelineno-0-330">330</a></span>
<span class="normal"><a href="#__codelineno-0-331">331</a></span>
<span class="normal"><a href="#__codelineno-0-332">332</a></span>
<span class="normal"><a href="#__codelineno-0-333">333</a></span>
<span class="normal"><a href="#__codelineno-0-334">334</a></span>
<span class="normal"><a href="#__codelineno-0-335">335</a></span>
<span class="normal"><a href="#__codelineno-0-336">336</a></span>
<span class="normal"><a href="#__codelineno-0-337">337</a></span>
<span class="normal"><a href="#__codelineno-0-338">338</a></span>
<span class="normal"><a href="#__codelineno-0-339">339</a></span>
<span class="normal"><a href="#__codelineno-0-340">340</a></span>
<span class="normal"><a href="#__codelineno-0-341">341</a></span>
<span class="normal"><a href="#__codelineno-0-342">342</a></span>
<span class="normal"><a href="#__codelineno-0-343">343</a></span>
<span class="normal"><a href="#__codelineno-0-344">344</a></span>
<span class="normal"><a href="#__codelineno-0-345">345</a></span>
<span class="normal"><a href="#__codelineno-0-346">346</a></span>
<span class="normal"><a href="#__codelineno-0-347">347</a></span>
<span class="normal"><a href="#__codelineno-0-348">348</a></span>
<span class="normal"><a href="#__codelineno-0-349">349</a></span>
<span class="normal"><a href="#__codelineno-0-350">350</a></span>
<span class="normal"><a href="#__codelineno-0-351">351</a></span>
<span class="normal"><a href="#__codelineno-0-352">352</a></span>
<span class="normal"><a href="#__codelineno-0-353">353</a></span>
<span class="normal"><a href="#__codelineno-0-354">354</a></span>
<span class="normal"><a href="#__codelineno-0-355">355</a></span>
<span class="normal"><a href="#__codelineno-0-356">356</a></span>
<span class="normal"><a href="#__codelineno-0-357">357</a></span>
<span class="normal"><a href="#__codelineno-0-358">358</a></span>
<span class="normal"><a href="#__codelineno-0-359">359</a></span>
<span class="normal"><a href="#__codelineno-0-360">360</a></span>
<span class="normal"><a href="#__codelineno-0-361">361</a></span>
<span class="normal"><a href="#__codelineno-0-362">362</a></span>
<span class="normal"><a href="#__codelineno-0-363">363</a></span>
<span class="normal"><a href="#__codelineno-0-364">364</a></span>
<span class="normal"><a href="#__codelineno-0-365">365</a></span>
<span class="normal"><a href="#__codelineno-0-366">366</a></span>
<span class="normal"><a href="#__codelineno-0-367">367</a></span>
<span class="normal"><a href="#__codelineno-0-368">368</a></span>
<span class="normal"><a href="#__codelineno-0-369">369</a></span>
<span class="normal"><a href="#__codelineno-0-370">370</a></span>
<span class="normal"><a href="#__codelineno-0-371">371</a></span>
<span class="normal"><a href="#__codelineno-0-372">372</a></span>
<span class="normal"><a href="#__codelineno-0-373">373</a></span>
<span class="normal"><a href="#__codelineno-0-374">374</a></span>
<span class="normal"><a href="#__codelineno-0-375">375</a></span>
<span class="normal"><a href="#__codelineno-0-376">376</a></span>
<span class="normal"><a href="#__codelineno-0-377">377</a></span>
<span class="normal"><a href="#__codelineno-0-378">378</a></span>
<span class="normal"><a href="#__codelineno-0-379">379</a></span>
<span class="normal"><a href="#__codelineno-0-380">380</a></span>
<span class="normal"><a href="#__codelineno-0-381">381</a></span>
<span class="normal"><a href="#__codelineno-0-382">382</a></span>
<span class="normal"><a href="#__codelineno-0-383">383</a></span>
<span class="normal"><a href="#__codelineno-0-384">384</a></span>
<span class="normal"><a href="#__codelineno-0-385">385</a></span>
<span class="normal"><a href="#__codelineno-0-386">386</a></span>
<span class="normal"><a href="#__codelineno-0-387">387</a></span>
<span class="normal"><a href="#__codelineno-0-388">388</a></span>
<span class="normal"><a href="#__codelineno-0-389">389</a></span>
<span class="normal"><a href="#__codelineno-0-390">390</a></span>
<span class="normal"><a href="#__codelineno-0-391">391</a></span>
<span class="normal"><a href="#__codelineno-0-392">392</a></span>
<span class="normal"><a href="#__codelineno-0-393">393</a></span>
<span class="normal"><a href="#__codelineno-0-394">394</a></span>
<span class="normal"><a href="#__codelineno-0-395">395</a></span>
<span class="normal"><a href="#__codelineno-0-396">396</a></span>
<span class="normal"><a href="#__codelineno-0-397">397</a></span>
<span class="normal"><a href="#__codelineno-0-398">398</a></span>
<span class="normal"><a href="#__codelineno-0-399">399</a></span>
<span class="normal"><a href="#__codelineno-0-400">400</a></span>
<span class="normal"><a href="#__codelineno-0-401">401</a></span>
<span class="normal"><a href="#__codelineno-0-402">402</a></span>
<span class="normal"><a href="#__codelineno-0-403">403</a></span>
<span class="normal"><a href="#__codelineno-0-404">404</a></span>
<span class="normal"><a href="#__codelineno-0-405">405</a></span>
<span class="normal"><a href="#__codelineno-0-406">406</a></span>
<span class="normal"><a href="#__codelineno-0-407">407</a></span>
<span class="normal"><a href="#__codelineno-0-408">408</a></span>
<span class="normal"><a href="#__codelineno-0-409">409</a></span>
<span class="normal"><a href="#__codelineno-0-410">410</a></span>
<span class="normal"><a href="#__codelineno-0-411">411</a></span>
<span class="normal"><a href="#__codelineno-0-412">412</a></span>
<span class="normal"><a href="#__codelineno-0-413">413</a></span>
<span class="normal"><a href="#__codelineno-0-414">414</a></span>
<span class="normal"><a href="#__codelineno-0-415">415</a></span>
<span class="normal"><a href="#__codelineno-0-416">416</a></span>
<span class="normal"><a href="#__codelineno-0-417">417</a></span>
<span class="normal"><a href="#__codelineno-0-418">418</a></span>
<span class="normal"><a href="#__codelineno-0-419">419</a></span>
<span class="normal"><a href="#__codelineno-0-420">420</a></span>
<span class="normal"><a href="#__codelineno-0-421">421</a></span>
<span class="normal"><a href="#__codelineno-0-422">422</a></span>
<span class="normal"><a href="#__codelineno-0-423">423</a></span>
<span class="normal"><a href="#__codelineno-0-424">424</a></span>
<span class="normal"><a href="#__codelineno-0-425">425</a></span>
<span class="normal"><a href="#__codelineno-0-426">426</a></span>
<span class="normal"><a href="#__codelineno-0-427">427</a></span>
<span class="normal"><a href="#__codelineno-0-428">428</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-309" name="__codelineno-0-309"></a><span class="k">def</span> <span class="nf">beat_data_generator</span><span class="p">(</span>
<a id="__codelineno-0-310" name="__codelineno-0-310"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-311" name="__codelineno-0-311"></a>    <span class="n">patient_generator</span><span class="p">:</span> <span class="n">PatientGenerator</span><span class="p">,</span>
<a id="__codelineno-0-312" name="__codelineno-0-312"></a>    <span class="n">samples_per_patient</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-313" name="__codelineno-0-313"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SampleGenerator</span><span class="p">:</span>
<a id="__codelineno-0-314" name="__codelineno-0-314"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate frames and beat label using patient generator.</span>
<a id="__codelineno-0-315" name="__codelineno-0-315"></a><span class="sd">    There are over 2.5 billion normal and undefined while less than 40 million arrhythmia beats.</span>
<a id="__codelineno-0-316" name="__codelineno-0-316"></a><span class="sd">    The following routine sorts each patient&#39;s beats by type and then approx. uniformly samples them by amount requested.</span>
<a id="__codelineno-0-317" name="__codelineno-0-317"></a><span class="sd">    We start with arrhythmia types followed by undefined and normal. For each beat we resplit remaining samples requested.</span>
<a id="__codelineno-0-318" name="__codelineno-0-318"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-319" name="__codelineno-0-319"></a><span class="sd">        patient_generator (PatientGenerator): Patient generator</span>
<a id="__codelineno-0-320" name="__codelineno-0-320"></a><span class="sd">        samples_per_patient (int | list[int], optional): # samples per patient. Defaults to 1.</span>
<a id="__codelineno-0-321" name="__codelineno-0-321"></a>
<a id="__codelineno-0-322" name="__codelineno-0-322"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-323" name="__codelineno-0-323"></a><span class="sd">        SampleGenerator: Sample generator</span>
<a id="__codelineno-0-324" name="__codelineno-0-324"></a>
<a id="__codelineno-0-325" name="__codelineno-0-325"></a><span class="sd">    Yields:</span>
<a id="__codelineno-0-326" name="__codelineno-0-326"></a><span class="sd">        Iterator[SampleGenerator]</span>
<a id="__codelineno-0-327" name="__codelineno-0-327"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-328" name="__codelineno-0-328"></a>    <span class="n">nlabel_threshold</span> <span class="o">=</span> <span class="mf">0.25</span>
<a id="__codelineno-0-329" name="__codelineno-0-329"></a>    <span class="n">blabel_padding</span> <span class="o">=</span> <span class="mi">20</span>
<a id="__codelineno-0-330" name="__codelineno-0-330"></a>    <span class="n">rr_win_len</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">10</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampling_rate</span><span class="p">)</span>
<a id="__codelineno-0-331" name="__codelineno-0-331"></a>    <span class="n">rr_min_len</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">0.3</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampling_rate</span><span class="p">)</span>
<a id="__codelineno-0-332" name="__codelineno-0-332"></a>    <span class="n">rr_max_len</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampling_rate</span><span class="p">)</span>
<a id="__codelineno-0-333" name="__codelineno-0-333"></a>
<a id="__codelineno-0-334" name="__codelineno-0-334"></a>    <span class="n">tgt_beat_labels</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-335" name="__codelineno-0-335"></a>        <span class="n">IcentiaBeat</span><span class="o">.</span><span class="n">normal</span><span class="p">,</span>
<a id="__codelineno-0-336" name="__codelineno-0-336"></a>        <span class="n">IcentiaBeat</span><span class="o">.</span><span class="n">pac</span><span class="p">,</span>
<a id="__codelineno-0-337" name="__codelineno-0-337"></a>        <span class="n">IcentiaBeat</span><span class="o">.</span><span class="n">pvc</span><span class="p">,</span>
<a id="__codelineno-0-338" name="__codelineno-0-338"></a>        <span class="c1"># IcentiaBeat.undefined,</span>
<a id="__codelineno-0-339" name="__codelineno-0-339"></a>    <span class="p">]</span>
<a id="__codelineno-0-340" name="__codelineno-0-340"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">samples_per_patient</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">):</span>
<a id="__codelineno-0-341" name="__codelineno-0-341"></a>        <span class="n">samples_per_tgt</span> <span class="o">=</span> <span class="n">samples_per_patient</span>
<a id="__codelineno-0-342" name="__codelineno-0-342"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-343" name="__codelineno-0-343"></a>        <span class="n">num_per_tgt</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">samples_per_patient</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">tgt_beat_labels</span><span class="p">)))</span>
<a id="__codelineno-0-344" name="__codelineno-0-344"></a>        <span class="n">samples_per_tgt</span> <span class="o">=</span> <span class="n">num_per_tgt</span> <span class="o">*</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">tgt_beat_labels</span><span class="p">)]</span>
<a id="__codelineno-0-345" name="__codelineno-0-345"></a>
<a id="__codelineno-0-346" name="__codelineno-0-346"></a>    <span class="n">input_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">sampling_rate</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_rate</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_size</span><span class="p">))</span>
<a id="__codelineno-0-347" name="__codelineno-0-347"></a>    <span class="c1"># For each patient</span>
<a id="__codelineno-0-348" name="__codelineno-0-348"></a>    <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">segments</span> <span class="ow">in</span> <span class="n">patient_generator</span><span class="p">:</span>
<a id="__codelineno-0-349" name="__codelineno-0-349"></a>        <span class="c1"># This maps segment index to segment key</span>
<a id="__codelineno-0-350" name="__codelineno-0-350"></a>        <span class="n">seg_map</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">segments</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<a id="__codelineno-0-351" name="__codelineno-0-351"></a>
<a id="__codelineno-0-352" name="__codelineno-0-352"></a>        <span class="c1"># Capture beat locations for each segment</span>
<a id="__codelineno-0-353" name="__codelineno-0-353"></a>        <span class="n">pt_beat_map</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">tgt_beat_labels</span><span class="p">]</span>
<a id="__codelineno-0-354" name="__codelineno-0-354"></a>        <span class="k">for</span> <span class="n">seg_idx</span><span class="p">,</span> <span class="n">seg_key</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">seg_map</span><span class="p">):</span>
<a id="__codelineno-0-355" name="__codelineno-0-355"></a>            <span class="n">blabels</span> <span class="o">=</span> <span class="n">segments</span><span class="p">[</span><span class="n">seg_key</span><span class="p">][</span><span class="s2">&quot;blabels&quot;</span><span class="p">][:]</span>
<a id="__codelineno-0-356" name="__codelineno-0-356"></a>            <span class="n">num_blabels</span> <span class="o">=</span> <span class="n">blabels</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-357" name="__codelineno-0-357"></a>            <span class="k">if</span> <span class="n">num_blabels</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-358" name="__codelineno-0-358"></a>                <span class="k">continue</span>
<a id="__codelineno-0-359" name="__codelineno-0-359"></a>            <span class="c1"># END IF</span>
<a id="__codelineno-0-360" name="__codelineno-0-360"></a>            <span class="n">num_nlabels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">blabels</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">IcentiaBeat</span><span class="o">.</span><span class="n">normal</span><span class="p">)</span>
<a id="__codelineno-0-361" name="__codelineno-0-361"></a>            <span class="k">if</span> <span class="n">num_nlabels</span> <span class="o">/</span> <span class="n">num_blabels</span> <span class="o">&lt;</span> <span class="n">nlabel_threshold</span><span class="p">:</span>
<a id="__codelineno-0-362" name="__codelineno-0-362"></a>                <span class="k">continue</span>
<a id="__codelineno-0-363" name="__codelineno-0-363"></a>
<a id="__codelineno-0-364" name="__codelineno-0-364"></a>            <span class="c1"># Capture all beat locations</span>
<a id="__codelineno-0-365" name="__codelineno-0-365"></a>            <span class="k">for</span> <span class="n">tgt_beat_idx</span><span class="p">,</span> <span class="n">beat</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tgt_beat_labels</span><span class="p">):</span>
<a id="__codelineno-0-366" name="__codelineno-0-366"></a>                <span class="n">beat_idxs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">blabels</span><span class="p">[</span><span class="n">blabel_padding</span><span class="p">:</span><span class="o">-</span><span class="n">blabel_padding</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">beat</span><span class="o">.</span><span class="n">value</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">blabel_padding</span>
<a id="__codelineno-0-367" name="__codelineno-0-367"></a>                <span class="k">if</span> <span class="n">beat</span> <span class="o">==</span> <span class="n">IcentiaBeat</span><span class="o">.</span><span class="n">normal</span><span class="p">:</span>
<a id="__codelineno-0-368" name="__codelineno-0-368"></a>                    <span class="n">filt_func</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">i</span><span class="p">:</span> <span class="n">blabels</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">blabels</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">IcentiaBeat</span><span class="o">.</span><span class="n">normal</span>
<a id="__codelineno-0-369" name="__codelineno-0-369"></a>                <span class="k">elif</span> <span class="n">beat</span> <span class="ow">in</span> <span class="p">(</span><span class="n">IcentiaBeat</span><span class="o">.</span><span class="n">pac</span><span class="p">,</span> <span class="n">IcentiaBeat</span><span class="o">.</span><span class="n">pvc</span><span class="p">):</span>
<a id="__codelineno-0-370" name="__codelineno-0-370"></a>                    <span class="n">filt_func</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">i</span><span class="p">:</span> <span class="n">IcentiaBeat</span><span class="o">.</span><span class="n">undefined</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span>
<a id="__codelineno-0-371" name="__codelineno-0-371"></a>                        <span class="n">blabels</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
<a id="__codelineno-0-372" name="__codelineno-0-372"></a>                        <span class="n">blabels</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
<a id="__codelineno-0-373" name="__codelineno-0-373"></a>                    <span class="p">)</span>
<a id="__codelineno-0-374" name="__codelineno-0-374"></a>                <span class="k">elif</span> <span class="n">beat</span> <span class="o">==</span> <span class="n">IcentiaBeat</span><span class="o">.</span><span class="n">undefined</span><span class="p">:</span>
<a id="__codelineno-0-375" name="__codelineno-0-375"></a>                    <span class="n">filt_func</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">i</span><span class="p">:</span> <span class="n">blabels</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">blabels</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">IcentiaBeat</span><span class="o">.</span><span class="n">undefined</span>
<a id="__codelineno-0-376" name="__codelineno-0-376"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-377" name="__codelineno-0-377"></a>                    <span class="n">filt_func</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">_</span><span class="p">:</span> <span class="kc">True</span>
<a id="__codelineno-0-378" name="__codelineno-0-378"></a>                <span class="n">beat_idxs</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="n">filt_func</span><span class="p">,</span> <span class="n">beat_idxs</span><span class="p">)</span>
<a id="__codelineno-0-379" name="__codelineno-0-379"></a>                <span class="n">pt_beat_map</span><span class="p">[</span><span class="n">tgt_beat_idx</span><span class="p">]</span> <span class="o">+=</span> <span class="p">[(</span><span class="n">seg_idx</span><span class="p">,</span> <span class="n">blabels</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">beat_idxs</span><span class="p">]</span>
<a id="__codelineno-0-380" name="__codelineno-0-380"></a>            <span class="c1"># END FOR</span>
<a id="__codelineno-0-381" name="__codelineno-0-381"></a>        <span class="c1"># END FOR</span>
<a id="__codelineno-0-382" name="__codelineno-0-382"></a>        <span class="n">pt_beat_map</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">pt_beat_map</span><span class="p">]</span>
<a id="__codelineno-0-383" name="__codelineno-0-383"></a>
<a id="__codelineno-0-384" name="__codelineno-0-384"></a>        <span class="c1"># Randomly select N samples of each target beat</span>
<a id="__codelineno-0-385" name="__codelineno-0-385"></a>        <span class="n">pt_segs_beat_idxs</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-386" name="__codelineno-0-386"></a>        <span class="k">for</span> <span class="n">tgt_beat_idx</span><span class="p">,</span> <span class="n">beat</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tgt_beat_labels</span><span class="p">):</span>
<a id="__codelineno-0-387" name="__codelineno-0-387"></a>            <span class="n">tgt_beats</span> <span class="o">=</span> <span class="n">pt_beat_map</span><span class="p">[</span><span class="n">tgt_beat_idx</span><span class="p">]</span>
<a id="__codelineno-0-388" name="__codelineno-0-388"></a>            <span class="n">tgt_count</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">samples_per_tgt</span><span class="p">[</span><span class="n">tgt_beat_idx</span><span class="p">],</span> <span class="nb">len</span><span class="p">(</span><span class="n">tgt_beats</span><span class="p">))</span>
<a id="__codelineno-0-389" name="__codelineno-0-389"></a>            <span class="n">tgt_idxs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tgt_beats</span><span class="p">)),</span> <span class="n">size</span><span class="o">=</span><span class="n">tgt_count</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-390" name="__codelineno-0-390"></a>            <span class="n">pt_segs_beat_idxs</span> <span class="o">+=</span> <span class="p">[(</span><span class="n">tgt_beats</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">tgt_beats</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">HeartBeatMap</span><span class="p">[</span><span class="n">beat</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tgt_idxs</span><span class="p">]</span>
<a id="__codelineno-0-391" name="__codelineno-0-391"></a>        <span class="c1"># END FOR</span>
<a id="__codelineno-0-392" name="__codelineno-0-392"></a>
<a id="__codelineno-0-393" name="__codelineno-0-393"></a>        <span class="c1"># Shuffle all</span>
<a id="__codelineno-0-394" name="__codelineno-0-394"></a>        <span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">pt_segs_beat_idxs</span><span class="p">)</span>
<a id="__codelineno-0-395" name="__codelineno-0-395"></a>
<a id="__codelineno-0-396" name="__codelineno-0-396"></a>        <span class="c1"># Yield selected samples for patient</span>
<a id="__codelineno-0-397" name="__codelineno-0-397"></a>        <span class="k">for</span> <span class="n">seg_idx</span><span class="p">,</span> <span class="n">beat_idx</span><span class="p">,</span> <span class="n">beat</span> <span class="ow">in</span> <span class="n">pt_segs_beat_idxs</span><span class="p">:</span>
<a id="__codelineno-0-398" name="__codelineno-0-398"></a>            <span class="n">frame_start</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">beat_idx</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.4722</span><span class="p">,</span> <span class="mf">0.5278</span><span class="p">)</span> <span class="o">*</span> <span class="n">input_size</span><span class="p">))</span>
<a id="__codelineno-0-399" name="__codelineno-0-399"></a>            <span class="n">frame_end</span> <span class="o">=</span> <span class="n">frame_start</span> <span class="o">+</span> <span class="n">input_size</span>
<a id="__codelineno-0-400" name="__codelineno-0-400"></a>            <span class="n">data</span> <span class="o">=</span> <span class="n">segments</span><span class="p">[</span><span class="n">seg_map</span><span class="p">[</span><span class="n">seg_idx</span><span class="p">]][</span><span class="s2">&quot;data&quot;</span><span class="p">]</span>
<a id="__codelineno-0-401" name="__codelineno-0-401"></a>            <span class="n">blabels</span> <span class="o">=</span> <span class="n">segments</span><span class="p">[</span><span class="n">seg_map</span><span class="p">[</span><span class="n">seg_idx</span><span class="p">]][</span><span class="s2">&quot;blabels&quot;</span><span class="p">]</span>
<a id="__codelineno-0-402" name="__codelineno-0-402"></a>            <span class="n">rr_xs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">blabels</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">frame_start</span> <span class="o">-</span> <span class="n">rr_win_len</span><span class="p">))</span>
<a id="__codelineno-0-403" name="__codelineno-0-403"></a>            <span class="n">rr_xe</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">blabels</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">frame_end</span> <span class="o">+</span> <span class="n">rr_win_len</span><span class="p">)</span>
<a id="__codelineno-0-404" name="__codelineno-0-404"></a>            <span class="k">if</span> <span class="n">rr_xe</span> <span class="o">&lt;=</span> <span class="n">rr_xs</span><span class="p">:</span>
<a id="__codelineno-0-405" name="__codelineno-0-405"></a>                <span class="k">continue</span>
<a id="__codelineno-0-406" name="__codelineno-0-406"></a>            <span class="n">blabel_diffs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">blabels</span><span class="p">[</span><span class="n">rr_xs</span> <span class="p">:</span> <span class="n">rr_xe</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-0-407" name="__codelineno-0-407"></a>            <span class="n">blabel_diffs</span> <span class="o">=</span> <span class="n">blabel_diffs</span><span class="p">[(</span><span class="n">blabel_diffs</span> <span class="o">&gt;</span> <span class="n">rr_min_len</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">blabel_diffs</span> <span class="o">&lt;</span> <span class="n">rr_max_len</span><span class="p">)]</span>
<a id="__codelineno-0-408" name="__codelineno-0-408"></a>            <span class="k">if</span> <span class="n">blabel_diffs</span><span class="o">.</span><span class="n">size</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-409" name="__codelineno-0-409"></a>                <span class="k">continue</span>
<a id="__codelineno-0-410" name="__codelineno-0-410"></a>            <span class="n">avg_rr</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">blabel_diffs</span><span class="p">))</span>
<a id="__codelineno-0-411" name="__codelineno-0-411"></a>
<a id="__codelineno-0-412" name="__codelineno-0-412"></a>            <span class="c1"># avg_rr = input_size</span>
<a id="__codelineno-0-413" name="__codelineno-0-413"></a>
<a id="__codelineno-0-414" name="__codelineno-0-414"></a>            <span class="k">if</span> <span class="n">frame_start</span> <span class="o">-</span> <span class="n">avg_rr</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">frame_end</span> <span class="o">+</span> <span class="n">avg_rr</span> <span class="o">&gt;=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
<a id="__codelineno-0-415" name="__codelineno-0-415"></a>                <span class="k">continue</span>
<a id="__codelineno-0-416" name="__codelineno-0-416"></a>
<a id="__codelineno-0-417" name="__codelineno-0-417"></a>            <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span>
<a id="__codelineno-0-418" name="__codelineno-0-418"></a>                <span class="p">(</span>
<a id="__codelineno-0-419" name="__codelineno-0-419"></a>                    <span class="n">data</span><span class="p">[</span><span class="n">frame_start</span> <span class="o">-</span> <span class="n">avg_rr</span> <span class="p">:</span> <span class="n">frame_end</span> <span class="o">-</span> <span class="n">avg_rr</span><span class="p">],</span>
<a id="__codelineno-0-420" name="__codelineno-0-420"></a>                    <span class="n">data</span><span class="p">[</span><span class="n">frame_start</span><span class="p">:</span><span class="n">frame_end</span><span class="p">],</span>
<a id="__codelineno-0-421" name="__codelineno-0-421"></a>                    <span class="n">data</span><span class="p">[</span><span class="n">frame_start</span> <span class="o">+</span> <span class="n">avg_rr</span> <span class="p">:</span> <span class="n">frame_end</span> <span class="o">+</span> <span class="n">avg_rr</span><span class="p">],</span>
<a id="__codelineno-0-422" name="__codelineno-0-422"></a>                <span class="p">)</span>
<a id="__codelineno-0-423" name="__codelineno-0-423"></a>            <span class="p">)</span>
<a id="__codelineno-0-424" name="__codelineno-0-424"></a>            <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<a id="__codelineno-0-425" name="__codelineno-0-425"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampling_rate</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_rate</span><span class="p">:</span>
<a id="__codelineno-0-426" name="__codelineno-0-426"></a>                <span class="n">x</span> <span class="o">=</span> <span class="n">resample_signal</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampling_rate</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_rate</span><span class="p">)</span>
<a id="__codelineno-0-427" name="__codelineno-0-427"></a>            <span class="n">y</span> <span class="o">=</span> <span class="n">beat</span>
<a id="__codelineno-0-428" name="__codelineno-0-428"></a>            <span class="k">yield</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="heartkit.datasets.icentia11k.IcentiaDataset.download" class="doc doc-heading">
<code class="highlight language-python"><span class="n">download</span><span class="p">(</span><span class="n">num_workers</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Download dataset</p>

  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b>num_workers</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a> | None</code>)
        – <h5 id="heartkit.datasets.icentia11k.IcentiaDataset.download--parallel-workers-defaults-to-none">parallel workers. Defaults to None.</h5>
      </li>
      <li class="field-body">
        <b>force</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>)
        – <p>Force redownload. Defaults to False.</p>
      </li>
  </ul>

      <details class="quote">
        <summary>Source code in <code>heartkit/datasets/icentia11k.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-732">732</a></span>
<span class="normal"><a href="#__codelineno-0-733">733</a></span>
<span class="normal"><a href="#__codelineno-0-734">734</a></span>
<span class="normal"><a href="#__codelineno-0-735">735</a></span>
<span class="normal"><a href="#__codelineno-0-736">736</a></span>
<span class="normal"><a href="#__codelineno-0-737">737</a></span>
<span class="normal"><a href="#__codelineno-0-738">738</a></span>
<span class="normal"><a href="#__codelineno-0-739">739</a></span>
<span class="normal"><a href="#__codelineno-0-740">740</a></span>
<span class="normal"><a href="#__codelineno-0-741">741</a></span>
<span class="normal"><a href="#__codelineno-0-742">742</a></span>
<span class="normal"><a href="#__codelineno-0-743">743</a></span>
<span class="normal"><a href="#__codelineno-0-744">744</a></span>
<span class="normal"><a href="#__codelineno-0-745">745</a></span>
<span class="normal"><a href="#__codelineno-0-746">746</a></span>
<span class="normal"><a href="#__codelineno-0-747">747</a></span>
<span class="normal"><a href="#__codelineno-0-748">748</a></span>
<span class="normal"><a href="#__codelineno-0-749">749</a></span>
<span class="normal"><a href="#__codelineno-0-750">750</a></span>
<span class="normal"><a href="#__codelineno-0-751">751</a></span>
<span class="normal"><a href="#__codelineno-0-752">752</a></span>
<span class="normal"><a href="#__codelineno-0-753">753</a></span>
<span class="normal"><a href="#__codelineno-0-754">754</a></span>
<span class="normal"><a href="#__codelineno-0-755">755</a></span>
<span class="normal"><a href="#__codelineno-0-756">756</a></span>
<span class="normal"><a href="#__codelineno-0-757">757</a></span>
<span class="normal"><a href="#__codelineno-0-758">758</a></span>
<span class="normal"><a href="#__codelineno-0-759">759</a></span>
<span class="normal"><a href="#__codelineno-0-760">760</a></span>
<span class="normal"><a href="#__codelineno-0-761">761</a></span>
<span class="normal"><a href="#__codelineno-0-762">762</a></span>
<span class="normal"><a href="#__codelineno-0-763">763</a></span>
<span class="normal"><a href="#__codelineno-0-764">764</a></span>
<span class="normal"><a href="#__codelineno-0-765">765</a></span>
<span class="normal"><a href="#__codelineno-0-766">766</a></span>
<span class="normal"><a href="#__codelineno-0-767">767</a></span>
<span class="normal"><a href="#__codelineno-0-768">768</a></span>
<span class="normal"><a href="#__codelineno-0-769">769</a></span>
<span class="normal"><a href="#__codelineno-0-770">770</a></span>
<span class="normal"><a href="#__codelineno-0-771">771</a></span>
<span class="normal"><a href="#__codelineno-0-772">772</a></span>
<span class="normal"><a href="#__codelineno-0-773">773</a></span>
<span class="normal"><a href="#__codelineno-0-774">774</a></span>
<span class="normal"><a href="#__codelineno-0-775">775</a></span>
<span class="normal"><a href="#__codelineno-0-776">776</a></span>
<span class="normal"><a href="#__codelineno-0-777">777</a></span>
<span class="normal"><a href="#__codelineno-0-778">778</a></span>
<span class="normal"><a href="#__codelineno-0-779">779</a></span>
<span class="normal"><a href="#__codelineno-0-780">780</a></span>
<span class="normal"><a href="#__codelineno-0-781">781</a></span>
<span class="normal"><a href="#__codelineno-0-782">782</a></span>
<span class="normal"><a href="#__codelineno-0-783">783</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-732" name="__codelineno-0-732"></a><span class="k">def</span> <span class="nf">download</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_workers</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">force</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<a id="__codelineno-0-733" name="__codelineno-0-733"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Download dataset</span>
<a id="__codelineno-0-734" name="__codelineno-0-734"></a>
<a id="__codelineno-0-735" name="__codelineno-0-735"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-736" name="__codelineno-0-736"></a><span class="sd">        num_workers (int | None, optional): # parallel workers. Defaults to None.</span>
<a id="__codelineno-0-737" name="__codelineno-0-737"></a><span class="sd">        force (bool, optional): Force redownload. Defaults to False.</span>
<a id="__codelineno-0-738" name="__codelineno-0-738"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-739" name="__codelineno-0-739"></a>
<a id="__codelineno-0-740" name="__codelineno-0-740"></a>    <span class="k">def</span> <span class="nf">download_s3_file</span><span class="p">(</span>
<a id="__codelineno-0-741" name="__codelineno-0-741"></a>        <span class="n">s3_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-742" name="__codelineno-0-742"></a>        <span class="n">save_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-743" name="__codelineno-0-743"></a>        <span class="n">bucket</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-744" name="__codelineno-0-744"></a>        <span class="n">client</span><span class="p">:</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">,</span>
<a id="__codelineno-0-745" name="__codelineno-0-745"></a>        <span class="n">force</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-746" name="__codelineno-0-746"></a>    <span class="p">):</span>
<a id="__codelineno-0-747" name="__codelineno-0-747"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">force</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">save_path</span><span class="p">):</span>
<a id="__codelineno-0-748" name="__codelineno-0-748"></a>            <span class="k">return</span>
<a id="__codelineno-0-749" name="__codelineno-0-749"></a>        <span class="n">client</span><span class="o">.</span><span class="n">download_file</span><span class="p">(</span>
<a id="__codelineno-0-750" name="__codelineno-0-750"></a>            <span class="n">Bucket</span><span class="o">=</span><span class="n">bucket</span><span class="p">,</span>
<a id="__codelineno-0-751" name="__codelineno-0-751"></a>            <span class="n">Key</span><span class="o">=</span><span class="n">s3_file</span><span class="p">,</span>
<a id="__codelineno-0-752" name="__codelineno-0-752"></a>            <span class="n">Filename</span><span class="o">=</span><span class="n">save_path</span><span class="p">,</span>
<a id="__codelineno-0-753" name="__codelineno-0-753"></a>        <span class="p">)</span>
<a id="__codelineno-0-754" name="__codelineno-0-754"></a>
<a id="__codelineno-0-755" name="__codelineno-0-755"></a>    <span class="n">s3_bucket</span> <span class="o">=</span> <span class="s2">&quot;ambiqai-ecg-icentia11k-dataset&quot;</span>
<a id="__codelineno-0-756" name="__codelineno-0-756"></a>    <span class="n">s3_prefix</span> <span class="o">=</span> <span class="s2">&quot;patients&quot;</span>
<a id="__codelineno-0-757" name="__codelineno-0-757"></a>
<a id="__codelineno-0-758" name="__codelineno-0-758"></a>    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ds_path</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-759" name="__codelineno-0-759"></a>
<a id="__codelineno-0-760" name="__codelineno-0-760"></a>    <span class="n">patient_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">patient_ids</span>
<a id="__codelineno-0-761" name="__codelineno-0-761"></a>
<a id="__codelineno-0-762" name="__codelineno-0-762"></a>    <span class="c1"># Creating only one session and one client</span>
<a id="__codelineno-0-763" name="__codelineno-0-763"></a>    <span class="n">session</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>
<a id="__codelineno-0-764" name="__codelineno-0-764"></a>    <span class="n">client</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s2">&quot;s3&quot;</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">Config</span><span class="p">(</span><span class="n">signature_version</span><span class="o">=</span><span class="n">UNSIGNED</span><span class="p">))</span>
<a id="__codelineno-0-765" name="__codelineno-0-765"></a>
<a id="__codelineno-0-766" name="__codelineno-0-766"></a>    <span class="n">func</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">download_s3_file</span><span class="p">,</span> <span class="n">bucket</span><span class="o">=</span><span class="n">s3_bucket</span><span class="p">,</span> <span class="n">client</span><span class="o">=</span><span class="n">client</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="n">force</span><span class="p">)</span>
<a id="__codelineno-0-767" name="__codelineno-0-767"></a>
<a id="__codelineno-0-768" name="__codelineno-0-768"></a>    <span class="k">with</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Downloading icentia11k dataset from S3&quot;</span><span class="p">,</span> <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">patient_ids</span><span class="p">))</span> <span class="k">as</span> <span class="n">pbar</span><span class="p">:</span>
<a id="__codelineno-0-769" name="__codelineno-0-769"></a>        <span class="n">pt_keys</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_pt_key</span><span class="p">(</span><span class="n">patient_id</span><span class="p">)</span> <span class="k">for</span> <span class="n">patient_id</span> <span class="ow">in</span> <span class="n">patient_ids</span><span class="p">]</span>
<a id="__codelineno-0-770" name="__codelineno-0-770"></a>        <span class="k">with</span> <span class="n">ThreadPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="mi">2</span> <span class="o">*</span> <span class="n">num_workers</span><span class="p">)</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
<a id="__codelineno-0-771" name="__codelineno-0-771"></a>            <span class="n">futures</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-772" name="__codelineno-0-772"></a>                <span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span>
<a id="__codelineno-0-773" name="__codelineno-0-773"></a>                    <span class="n">func</span><span class="p">,</span>
<a id="__codelineno-0-774" name="__codelineno-0-774"></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">s3_prefix</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">pt_key</span><span class="si">}</span><span class="s2">.h5&quot;</span><span class="p">,</span>
<a id="__codelineno-0-775" name="__codelineno-0-775"></a>                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ds_path</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pt_key</span><span class="si">}</span><span class="s2">.h5&quot;</span><span class="p">),</span>
<a id="__codelineno-0-776" name="__codelineno-0-776"></a>                <span class="p">)</span>
<a id="__codelineno-0-777" name="__codelineno-0-777"></a>                <span class="k">for</span> <span class="n">pt_key</span> <span class="ow">in</span> <span class="n">pt_keys</span>
<a id="__codelineno-0-778" name="__codelineno-0-778"></a>            <span class="p">)</span>
<a id="__codelineno-0-779" name="__codelineno-0-779"></a>            <span class="k">for</span> <span class="n">future</span> <span class="ow">in</span> <span class="n">as_completed</span><span class="p">(</span><span class="n">futures</span><span class="p">):</span>
<a id="__codelineno-0-780" name="__codelineno-0-780"></a>                <span class="n">err</span> <span class="o">=</span> <span class="n">future</span><span class="o">.</span><span class="n">exception</span><span class="p">()</span>
<a id="__codelineno-0-781" name="__codelineno-0-781"></a>                <span class="k">if</span> <span class="n">err</span><span class="p">:</span>
<a id="__codelineno-0-782" name="__codelineno-0-782"></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Failed on file&quot;</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
<a id="__codelineno-0-783" name="__codelineno-0-783"></a>                <span class="n">pbar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="heartkit.datasets.icentia11k.IcentiaDataset.download_raw_dataset" class="doc doc-heading">
<code class="highlight language-python"><span class="n">download_raw_dataset</span><span class="p">(</span><span class="n">num_workers</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Downloads full Icentia dataset zipfile and converts into individial patient HDF5 files.
NOTE: This is a very long process (e.g. 24 hrs). Please use <code>icentia11k.download_dataset</code> instead.</p>

  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b>force</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>)
        – <p>Whether to force re-download if destination exists. Defaults to False.</p>
      </li>
      <li class="field-body">
        <b>num_workers</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code>)
        – <h5 id="heartkit.datasets.icentia11k.IcentiaDataset.download_raw_dataset--parallel-workers-defaults-to-oscpu_count">parallel workers. Defaults to os.cpu_count().</h5>
      </li>
  </ul>

      <details class="quote">
        <summary>Source code in <code>heartkit/datasets/icentia11k.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-788">788</a></span>
<span class="normal"><a href="#__codelineno-0-789">789</a></span>
<span class="normal"><a href="#__codelineno-0-790">790</a></span>
<span class="normal"><a href="#__codelineno-0-791">791</a></span>
<span class="normal"><a href="#__codelineno-0-792">792</a></span>
<span class="normal"><a href="#__codelineno-0-793">793</a></span>
<span class="normal"><a href="#__codelineno-0-794">794</a></span>
<span class="normal"><a href="#__codelineno-0-795">795</a></span>
<span class="normal"><a href="#__codelineno-0-796">796</a></span>
<span class="normal"><a href="#__codelineno-0-797">797</a></span>
<span class="normal"><a href="#__codelineno-0-798">798</a></span>
<span class="normal"><a href="#__codelineno-0-799">799</a></span>
<span class="normal"><a href="#__codelineno-0-800">800</a></span>
<span class="normal"><a href="#__codelineno-0-801">801</a></span>
<span class="normal"><a href="#__codelineno-0-802">802</a></span>
<span class="normal"><a href="#__codelineno-0-803">803</a></span>
<span class="normal"><a href="#__codelineno-0-804">804</a></span>
<span class="normal"><a href="#__codelineno-0-805">805</a></span>
<span class="normal"><a href="#__codelineno-0-806">806</a></span>
<span class="normal"><a href="#__codelineno-0-807">807</a></span>
<span class="normal"><a href="#__codelineno-0-808">808</a></span>
<span class="normal"><a href="#__codelineno-0-809">809</a></span>
<span class="normal"><a href="#__codelineno-0-810">810</a></span>
<span class="normal"><a href="#__codelineno-0-811">811</a></span>
<span class="normal"><a href="#__codelineno-0-812">812</a></span>
<span class="normal"><a href="#__codelineno-0-813">813</a></span>
<span class="normal"><a href="#__codelineno-0-814">814</a></span>
<span class="normal"><a href="#__codelineno-0-815">815</a></span>
<span class="normal"><a href="#__codelineno-0-816">816</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-788" name="__codelineno-0-788"></a><span class="k">def</span> <span class="nf">download_raw_dataset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_workers</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">force</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<a id="__codelineno-0-789" name="__codelineno-0-789"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Downloads full Icentia dataset zipfile and converts into individial patient HDF5 files.</span>
<a id="__codelineno-0-790" name="__codelineno-0-790"></a><span class="sd">    NOTE: This is a very long process (e.g. 24 hrs). Please use `icentia11k.download_dataset` instead.</span>
<a id="__codelineno-0-791" name="__codelineno-0-791"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-792" name="__codelineno-0-792"></a><span class="sd">        force (bool, optional): Whether to force re-download if destination exists. Defaults to False.</span>
<a id="__codelineno-0-793" name="__codelineno-0-793"></a><span class="sd">        num_workers (int, optional): # parallel workers. Defaults to os.cpu_count().</span>
<a id="__codelineno-0-794" name="__codelineno-0-794"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-795" name="__codelineno-0-795"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Downloading icentia11k dataset&quot;</span><span class="p">)</span>
<a id="__codelineno-0-796" name="__codelineno-0-796"></a>    <span class="n">ds_url</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-797" name="__codelineno-0-797"></a>        <span class="s2">&quot;https://physionet.org/static/published-projects/icentia11k-continuous-ecg/&quot;</span>
<a id="__codelineno-0-798" name="__codelineno-0-798"></a>        <span class="s2">&quot;icentia11k-single-lead-continuous-raw-electrocardiogram-dataset-1.0.zip&quot;</span>
<a id="__codelineno-0-799" name="__codelineno-0-799"></a>    <span class="p">)</span>
<a id="__codelineno-0-800" name="__codelineno-0-800"></a>    <span class="n">ds_zip_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ds_path</span><span class="p">,</span> <span class="s2">&quot;icentia11k.zip&quot;</span><span class="p">)</span>
<a id="__codelineno-0-801" name="__codelineno-0-801"></a>    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ds_path</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-802" name="__codelineno-0-802"></a>    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">ds_zip_path</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">force</span><span class="p">:</span>
<a id="__codelineno-0-803" name="__codelineno-0-803"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
<a id="__codelineno-0-804" name="__codelineno-0-804"></a>            <span class="sa">f</span><span class="s2">&quot;Zip file already exists. Please delete or set `force` flag to redownload. PATH=</span><span class="si">{</span><span class="n">ds_zip_path</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-805" name="__codelineno-0-805"></a>        <span class="p">)</span>
<a id="__codelineno-0-806" name="__codelineno-0-806"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-807" name="__codelineno-0-807"></a>        <span class="n">download_file</span><span class="p">(</span><span class="n">ds_url</span><span class="p">,</span> <span class="n">ds_zip_path</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-808" name="__codelineno-0-808"></a>
<a id="__codelineno-0-809" name="__codelineno-0-809"></a>    <span class="c1"># 2. Extract and convert patient ECG data to H5 files</span>
<a id="__codelineno-0-810" name="__codelineno-0-810"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Generating icentia11k patient data&quot;</span><span class="p">)</span>
<a id="__codelineno-0-811" name="__codelineno-0-811"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_convert_dataset_zip_to_hdf5</span><span class="p">(</span>
<a id="__codelineno-0-812" name="__codelineno-0-812"></a>        <span class="n">zip_path</span><span class="o">=</span><span class="n">ds_zip_path</span><span class="p">,</span>
<a id="__codelineno-0-813" name="__codelineno-0-813"></a>        <span class="n">force</span><span class="o">=</span><span class="n">force</span><span class="p">,</span>
<a id="__codelineno-0-814" name="__codelineno-0-814"></a>        <span class="n">num_workers</span><span class="o">=</span><span class="n">num_workers</span><span class="p">,</span>
<a id="__codelineno-0-815" name="__codelineno-0-815"></a>    <span class="p">)</span>
<a id="__codelineno-0-816" name="__codelineno-0-816"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Finished icentia11k patient data&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="heartkit.datasets.icentia11k.IcentiaDataset.get_complete_beats" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_complete_beats</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Find all complete beats within a frame i.e. start and end of the beat lie within the frame.
The indices are assumed to specify the end of a heartbeat.</p>

  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b>indices</b>
            (<code><a class="autorefs autorefs-external" title="numpy" href="https://numpy.org/doc/stable/reference/index.html#module-numpy">npt</a>.<span title="numpy.NDArray">NDArray</span></code>)
        – <p>List of sorted beat indices.</p>
      </li>
      <li class="field-body">
        <b>labels</b>
            (<code><a class="autorefs autorefs-external" title="numpy" href="https://numpy.org/doc/stable/reference/index.html#module-numpy">npt</a>.<span title="numpy.NDArray">NDArray</span> | None</code>)
        – <p>List of beat labels. Defaults to None.</p>
      </li>
      <li class="field-body">
        <b>start</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code>)
        – <p>Index of the first sample in the frame. Defaults to 0.</p>
      </li>
      <li class="field-body">
        <b>end</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a> | None</code>)
        – <p>Index of the last sample in the frame. Defaults to None.</p>
      </li>
  </ul>

  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#tuple">tuple</a>[<a class="autorefs autorefs-external" title="numpy" href="https://numpy.org/doc/stable/reference/index.html#module-numpy">npt</a>.<span title="numpy.NDArray">NDArray</span>, <a class="autorefs autorefs-external" title="numpy" href="https://numpy.org/doc/stable/reference/index.html#module-numpy">npt</a>.<span title="numpy.NDArray">NDArray</span>]</code>
        – <p>tuple[npt.NDArray, npt.NDArray]: (beat indices, beat labels)</p>
      </li>
  </ul>

      <details class="quote">
        <summary>Source code in <code>heartkit/datasets/icentia11k.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-556">556</a></span>
<span class="normal"><a href="#__codelineno-0-557">557</a></span>
<span class="normal"><a href="#__codelineno-0-558">558</a></span>
<span class="normal"><a href="#__codelineno-0-559">559</a></span>
<span class="normal"><a href="#__codelineno-0-560">560</a></span>
<span class="normal"><a href="#__codelineno-0-561">561</a></span>
<span class="normal"><a href="#__codelineno-0-562">562</a></span>
<span class="normal"><a href="#__codelineno-0-563">563</a></span>
<span class="normal"><a href="#__codelineno-0-564">564</a></span>
<span class="normal"><a href="#__codelineno-0-565">565</a></span>
<span class="normal"><a href="#__codelineno-0-566">566</a></span>
<span class="normal"><a href="#__codelineno-0-567">567</a></span>
<span class="normal"><a href="#__codelineno-0-568">568</a></span>
<span class="normal"><a href="#__codelineno-0-569">569</a></span>
<span class="normal"><a href="#__codelineno-0-570">570</a></span>
<span class="normal"><a href="#__codelineno-0-571">571</a></span>
<span class="normal"><a href="#__codelineno-0-572">572</a></span>
<span class="normal"><a href="#__codelineno-0-573">573</a></span>
<span class="normal"><a href="#__codelineno-0-574">574</a></span>
<span class="normal"><a href="#__codelineno-0-575">575</a></span>
<span class="normal"><a href="#__codelineno-0-576">576</a></span>
<span class="normal"><a href="#__codelineno-0-577">577</a></span>
<span class="normal"><a href="#__codelineno-0-578">578</a></span>
<span class="normal"><a href="#__codelineno-0-579">579</a></span>
<span class="normal"><a href="#__codelineno-0-580">580</a></span>
<span class="normal"><a href="#__codelineno-0-581">581</a></span>
<span class="normal"><a href="#__codelineno-0-582">582</a></span>
<span class="normal"><a href="#__codelineno-0-583">583</a></span>
<span class="normal"><a href="#__codelineno-0-584">584</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-556" name="__codelineno-0-556"></a><span class="k">def</span> <span class="nf">get_complete_beats</span><span class="p">(</span>
<a id="__codelineno-0-557" name="__codelineno-0-557"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-558" name="__codelineno-0-558"></a>    <span class="n">indices</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">,</span>
<a id="__codelineno-0-559" name="__codelineno-0-559"></a>    <span class="n">labels</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-560" name="__codelineno-0-560"></a>    <span class="n">start</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-561" name="__codelineno-0-561"></a>    <span class="n">end</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-562" name="__codelineno-0-562"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">,</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">]:</span>
<a id="__codelineno-0-563" name="__codelineno-0-563"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-564" name="__codelineno-0-564"></a><span class="sd">    Find all complete beats within a frame i.e. start and end of the beat lie within the frame.</span>
<a id="__codelineno-0-565" name="__codelineno-0-565"></a><span class="sd">    The indices are assumed to specify the end of a heartbeat.</span>
<a id="__codelineno-0-566" name="__codelineno-0-566"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-567" name="__codelineno-0-567"></a><span class="sd">        indices (npt.NDArray): List of sorted beat indices.</span>
<a id="__codelineno-0-568" name="__codelineno-0-568"></a><span class="sd">        labels (npt.NDArray | None): List of beat labels. Defaults to None.</span>
<a id="__codelineno-0-569" name="__codelineno-0-569"></a><span class="sd">        start (int): Index of the first sample in the frame. Defaults to 0.</span>
<a id="__codelineno-0-570" name="__codelineno-0-570"></a><span class="sd">        end (int | None): Index of the last sample in the frame. Defaults to None.</span>
<a id="__codelineno-0-571" name="__codelineno-0-571"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-572" name="__codelineno-0-572"></a><span class="sd">        tuple[npt.NDArray, npt.NDArray]: (beat indices, beat labels)</span>
<a id="__codelineno-0-573" name="__codelineno-0-573"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-574" name="__codelineno-0-574"></a>    <span class="k">if</span> <span class="n">end</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-575" name="__codelineno-0-575"></a>        <span class="n">end</span> <span class="o">=</span> <span class="n">indices</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-576" name="__codelineno-0-576"></a>    <span class="k">if</span> <span class="n">start</span> <span class="o">&gt;=</span> <span class="n">end</span><span class="p">:</span>
<a id="__codelineno-0-577" name="__codelineno-0-577"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`end` must be greater than `start`&quot;</span><span class="p">)</span>
<a id="__codelineno-0-578" name="__codelineno-0-578"></a>    <span class="n">start_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">side</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
<a id="__codelineno-0-579" name="__codelineno-0-579"></a>    <span class="n">end_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">side</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">)</span>
<a id="__codelineno-0-580" name="__codelineno-0-580"></a>    <span class="n">indices_slice</span> <span class="o">=</span> <span class="n">indices</span><span class="p">[</span><span class="n">start_index</span><span class="p">:</span><span class="n">end_index</span><span class="p">]</span>
<a id="__codelineno-0-581" name="__codelineno-0-581"></a>    <span class="k">if</span> <span class="n">labels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-582" name="__codelineno-0-582"></a>        <span class="k">return</span> <span class="n">indices_slice</span>
<a id="__codelineno-0-583" name="__codelineno-0-583"></a>    <span class="n">label_slice</span> <span class="o">=</span> <span class="n">labels</span><span class="p">[</span><span class="n">start_index</span><span class="p">:</span><span class="n">end_index</span><span class="p">]</span>
<a id="__codelineno-0-584" name="__codelineno-0-584"></a>    <span class="k">return</span> <span class="p">(</span><span class="n">indices_slice</span><span class="p">,</span> <span class="n">label_slice</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="heartkit.datasets.icentia11k.IcentiaDataset.get_rhythm_statistics" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_rhythm_statistics</span><span class="p">(</span><span class="n">patient_ids</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">save_path</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Utility function to extract rhythm statistics across entire dataset. Useful for EDA.</p>

  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b>patient_ids</b>
            (<code><a class="autorefs autorefs-external" title="numpy" href="https://numpy.org/doc/stable/reference/index.html#module-numpy">npt</a>.<span title="numpy.NDArray">NDArray</span> | None</code>)
        – <p>Patients IDs to include. Defaults to all.</p>
      </li>
      <li class="field-body">
        <b>save_path</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a> | None</code>)
        – <p>Parquet file path to save results. Defaults to None.</p>
      </li>
  </ul>

  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code><span title="pandas">pd</span>.<span title="pandas.DataFrame">DataFrame</span></code>
        – <p>pd.DataFrame: DataFrame of statistics</p>
      </li>
  </ul>

      <details class="quote">
        <summary>Source code in <code>heartkit/datasets/icentia11k.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-672">672</a></span>
<span class="normal"><a href="#__codelineno-0-673">673</a></span>
<span class="normal"><a href="#__codelineno-0-674">674</a></span>
<span class="normal"><a href="#__codelineno-0-675">675</a></span>
<span class="normal"><a href="#__codelineno-0-676">676</a></span>
<span class="normal"><a href="#__codelineno-0-677">677</a></span>
<span class="normal"><a href="#__codelineno-0-678">678</a></span>
<span class="normal"><a href="#__codelineno-0-679">679</a></span>
<span class="normal"><a href="#__codelineno-0-680">680</a></span>
<span class="normal"><a href="#__codelineno-0-681">681</a></span>
<span class="normal"><a href="#__codelineno-0-682">682</a></span>
<span class="normal"><a href="#__codelineno-0-683">683</a></span>
<span class="normal"><a href="#__codelineno-0-684">684</a></span>
<span class="normal"><a href="#__codelineno-0-685">685</a></span>
<span class="normal"><a href="#__codelineno-0-686">686</a></span>
<span class="normal"><a href="#__codelineno-0-687">687</a></span>
<span class="normal"><a href="#__codelineno-0-688">688</a></span>
<span class="normal"><a href="#__codelineno-0-689">689</a></span>
<span class="normal"><a href="#__codelineno-0-690">690</a></span>
<span class="normal"><a href="#__codelineno-0-691">691</a></span>
<span class="normal"><a href="#__codelineno-0-692">692</a></span>
<span class="normal"><a href="#__codelineno-0-693">693</a></span>
<span class="normal"><a href="#__codelineno-0-694">694</a></span>
<span class="normal"><a href="#__codelineno-0-695">695</a></span>
<span class="normal"><a href="#__codelineno-0-696">696</a></span>
<span class="normal"><a href="#__codelineno-0-697">697</a></span>
<span class="normal"><a href="#__codelineno-0-698">698</a></span>
<span class="normal"><a href="#__codelineno-0-699">699</a></span>
<span class="normal"><a href="#__codelineno-0-700">700</a></span>
<span class="normal"><a href="#__codelineno-0-701">701</a></span>
<span class="normal"><a href="#__codelineno-0-702">702</a></span>
<span class="normal"><a href="#__codelineno-0-703">703</a></span>
<span class="normal"><a href="#__codelineno-0-704">704</a></span>
<span class="normal"><a href="#__codelineno-0-705">705</a></span>
<span class="normal"><a href="#__codelineno-0-706">706</a></span>
<span class="normal"><a href="#__codelineno-0-707">707</a></span>
<span class="normal"><a href="#__codelineno-0-708">708</a></span>
<span class="normal"><a href="#__codelineno-0-709">709</a></span>
<span class="normal"><a href="#__codelineno-0-710">710</a></span>
<span class="normal"><a href="#__codelineno-0-711">711</a></span>
<span class="normal"><a href="#__codelineno-0-712">712</a></span>
<span class="normal"><a href="#__codelineno-0-713">713</a></span>
<span class="normal"><a href="#__codelineno-0-714">714</a></span>
<span class="normal"><a href="#__codelineno-0-715">715</a></span>
<span class="normal"><a href="#__codelineno-0-716">716</a></span>
<span class="normal"><a href="#__codelineno-0-717">717</a></span>
<span class="normal"><a href="#__codelineno-0-718">718</a></span>
<span class="normal"><a href="#__codelineno-0-719">719</a></span>
<span class="normal"><a href="#__codelineno-0-720">720</a></span>
<span class="normal"><a href="#__codelineno-0-721">721</a></span>
<span class="normal"><a href="#__codelineno-0-722">722</a></span>
<span class="normal"><a href="#__codelineno-0-723">723</a></span>
<span class="normal"><a href="#__codelineno-0-724">724</a></span>
<span class="normal"><a href="#__codelineno-0-725">725</a></span>
<span class="normal"><a href="#__codelineno-0-726">726</a></span>
<span class="normal"><a href="#__codelineno-0-727">727</a></span>
<span class="normal"><a href="#__codelineno-0-728">728</a></span>
<span class="normal"><a href="#__codelineno-0-729">729</a></span>
<span class="normal"><a href="#__codelineno-0-730">730</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-672" name="__codelineno-0-672"></a><span class="k">def</span> <span class="nf">get_rhythm_statistics</span><span class="p">(</span>
<a id="__codelineno-0-673" name="__codelineno-0-673"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-674" name="__codelineno-0-674"></a>    <span class="n">patient_ids</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-675" name="__codelineno-0-675"></a>    <span class="n">save_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-676" name="__codelineno-0-676"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<a id="__codelineno-0-677" name="__codelineno-0-677"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Utility function to extract rhythm statistics across entire dataset. Useful for EDA.</span>
<a id="__codelineno-0-678" name="__codelineno-0-678"></a>
<a id="__codelineno-0-679" name="__codelineno-0-679"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-680" name="__codelineno-0-680"></a><span class="sd">        patient_ids (npt.NDArray | None, optional): Patients IDs to include. Defaults to all.</span>
<a id="__codelineno-0-681" name="__codelineno-0-681"></a><span class="sd">        save_path (str | None, optional): Parquet file path to save results. Defaults to None.</span>
<a id="__codelineno-0-682" name="__codelineno-0-682"></a>
<a id="__codelineno-0-683" name="__codelineno-0-683"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-684" name="__codelineno-0-684"></a><span class="sd">        pd.DataFrame: DataFrame of statistics</span>
<a id="__codelineno-0-685" name="__codelineno-0-685"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-686" name="__codelineno-0-686"></a>
<a id="__codelineno-0-687" name="__codelineno-0-687"></a>    <span class="k">if</span> <span class="n">patient_ids</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-688" name="__codelineno-0-688"></a>        <span class="n">patient_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">patient_ids</span>
<a id="__codelineno-0-689" name="__codelineno-0-689"></a>    <span class="n">pt_gen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">uniform_patient_generator</span><span class="p">(</span><span class="n">patient_ids</span><span class="o">=</span><span class="n">patient_ids</span><span class="p">,</span> <span class="n">repeat</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-690" name="__codelineno-0-690"></a>    <span class="n">stats</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-691" name="__codelineno-0-691"></a>    <span class="k">for</span> <span class="n">pt</span><span class="p">,</span> <span class="n">segments</span> <span class="ow">in</span> <span class="n">pt_gen</span><span class="p">:</span>
<a id="__codelineno-0-692" name="__codelineno-0-692"></a>        <span class="c1"># Group patient rhythms by type (segment, start, stop)</span>
<a id="__codelineno-0-693" name="__codelineno-0-693"></a>        <span class="n">segment_label_map</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]]</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-694" name="__codelineno-0-694"></a>        <span class="k">for</span> <span class="n">seg_key</span><span class="p">,</span> <span class="n">segment</span> <span class="ow">in</span> <span class="n">segments</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-695" name="__codelineno-0-695"></a>            <span class="n">rlabels</span> <span class="o">=</span> <span class="n">segment</span><span class="p">[</span><span class="s2">&quot;rlabels&quot;</span><span class="p">][:]</span>
<a id="__codelineno-0-696" name="__codelineno-0-696"></a>            <span class="k">if</span> <span class="n">rlabels</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-697" name="__codelineno-0-697"></a>                <span class="k">continue</span>  <span class="c1"># Segment has no rhythm labels</span>
<a id="__codelineno-0-698" name="__codelineno-0-698"></a>            <span class="n">rlabels</span> <span class="o">=</span> <span class="n">rlabels</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">rlabels</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">IcentiaRhythm</span><span class="o">.</span><span class="n">noise</span><span class="o">.</span><span class="n">value</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>
<a id="__codelineno-0-699" name="__codelineno-0-699"></a>            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">rlabels</span><span class="p">[::</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]):</span>
<a id="__codelineno-0-700" name="__codelineno-0-700"></a>                <span class="k">if</span> <span class="n">l</span> <span class="ow">in</span> <span class="p">(</span>
<a id="__codelineno-0-701" name="__codelineno-0-701"></a>                    <span class="n">IcentiaRhythm</span><span class="o">.</span><span class="n">noise</span><span class="p">,</span>
<a id="__codelineno-0-702" name="__codelineno-0-702"></a>                    <span class="n">IcentiaRhythm</span><span class="o">.</span><span class="n">normal</span><span class="p">,</span>
<a id="__codelineno-0-703" name="__codelineno-0-703"></a>                    <span class="n">IcentiaRhythm</span><span class="o">.</span><span class="n">afib</span><span class="p">,</span>
<a id="__codelineno-0-704" name="__codelineno-0-704"></a>                    <span class="n">IcentiaRhythm</span><span class="o">.</span><span class="n">aflut</span><span class="p">,</span>
<a id="__codelineno-0-705" name="__codelineno-0-705"></a>                <span class="p">):</span>
<a id="__codelineno-0-706" name="__codelineno-0-706"></a>                    <span class="n">rhy_start</span><span class="p">,</span> <span class="n">rhy_stop</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-707" name="__codelineno-0-707"></a>                        <span class="n">rlabels</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
<a id="__codelineno-0-708" name="__codelineno-0-708"></a>                        <span class="n">rlabels</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
<a id="__codelineno-0-709" name="__codelineno-0-709"></a>                    <span class="p">)</span>
<a id="__codelineno-0-710" name="__codelineno-0-710"></a>                    <span class="n">stats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<a id="__codelineno-0-711" name="__codelineno-0-711"></a>                        <span class="nb">dict</span><span class="p">(</span>
<a id="__codelineno-0-712" name="__codelineno-0-712"></a>                            <span class="n">pt</span><span class="o">=</span><span class="n">pt</span><span class="p">,</span>
<a id="__codelineno-0-713" name="__codelineno-0-713"></a>                            <span class="n">rc</span><span class="o">=</span><span class="n">seg_key</span><span class="p">,</span>
<a id="__codelineno-0-714" name="__codelineno-0-714"></a>                            <span class="n">rhythm</span><span class="o">=</span><span class="n">l</span><span class="p">,</span>
<a id="__codelineno-0-715" name="__codelineno-0-715"></a>                            <span class="n">start</span><span class="o">=</span><span class="n">rhy_start</span><span class="p">,</span>
<a id="__codelineno-0-716" name="__codelineno-0-716"></a>                            <span class="n">stop</span><span class="o">=</span><span class="n">rhy_stop</span><span class="p">,</span>
<a id="__codelineno-0-717" name="__codelineno-0-717"></a>                            <span class="n">dur</span><span class="o">=</span><span class="n">rhy_stop</span> <span class="o">-</span> <span class="n">rhy_start</span><span class="p">,</span>
<a id="__codelineno-0-718" name="__codelineno-0-718"></a>                        <span class="p">)</span>
<a id="__codelineno-0-719" name="__codelineno-0-719"></a>                    <span class="p">)</span>
<a id="__codelineno-0-720" name="__codelineno-0-720"></a>                    <span class="n">segment_label_map</span><span class="p">[</span><span class="n">l</span><span class="p">]</span> <span class="o">=</span> <span class="n">segment_label_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="p">[])</span> <span class="o">+</span> <span class="p">[</span>
<a id="__codelineno-0-721" name="__codelineno-0-721"></a>                        <span class="p">(</span><span class="n">seg_key</span><span class="p">,</span> <span class="n">rlabels</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">rlabels</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-0-722" name="__codelineno-0-722"></a>                    <span class="p">]</span>
<a id="__codelineno-0-723" name="__codelineno-0-723"></a>                <span class="c1"># END IF</span>
<a id="__codelineno-0-724" name="__codelineno-0-724"></a>            <span class="c1"># END FOR</span>
<a id="__codelineno-0-725" name="__codelineno-0-725"></a>        <span class="c1"># END FOR</span>
<a id="__codelineno-0-726" name="__codelineno-0-726"></a>    <span class="c1"># END FOR</span>
<a id="__codelineno-0-727" name="__codelineno-0-727"></a>    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">stats</span><span class="p">)</span>
<a id="__codelineno-0-728" name="__codelineno-0-728"></a>    <span class="k">if</span> <span class="n">save_path</span><span class="p">:</span>
<a id="__codelineno-0-729" name="__codelineno-0-729"></a>        <span class="n">df</span><span class="o">.</span><span class="n">to_parquet</span><span class="p">(</span><span class="n">save_path</span><span class="p">)</span>
<a id="__codelineno-0-730" name="__codelineno-0-730"></a>    <span class="k">return</span> <span class="n">df</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="heartkit.datasets.icentia11k.IcentiaDataset.get_test_patient_ids" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_test_patient_ids</span><span class="p">()</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Get patient IDs reserved for testing only</p>

  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code><a class="autorefs autorefs-external" title="numpy" href="https://numpy.org/doc/stable/reference/index.html#module-numpy">npt</a>.<span title="numpy.NDArray">NDArray</span></code>
        – <p>npt.NDArray: patient IDs</p>
      </li>
  </ul>

      <details class="quote">
        <summary>Source code in <code>heartkit/datasets/icentia11k.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-145" name="__codelineno-0-145"></a><span class="k">def</span> <span class="nf">get_test_patient_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">:</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get patient IDs reserved for testing only</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a><span class="sd">        npt.NDArray: patient IDs</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">patient_ids</span><span class="p">[</span><span class="mi">10_000</span><span class="p">:]</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="heartkit.datasets.icentia11k.IcentiaDataset.get_train_patient_ids" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_train_patient_ids</span><span class="p">()</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Get training patient IDs</p>

  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code><a class="autorefs autorefs-external" title="numpy" href="https://numpy.org/doc/stable/reference/index.html#module-numpy">npt</a>.<span title="numpy.NDArray">NDArray</span></code>
        – <p>npt.NDArray: patient IDs</p>
      </li>
  </ul>

      <details class="quote">
        <summary>Source code in <code>heartkit/datasets/icentia11k.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-137" name="__codelineno-0-137"></a><span class="k">def</span> <span class="nf">get_train_patient_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">:</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get training patient IDs</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a><span class="sd">        npt.NDArray: patient IDs</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">patient_ids</span><span class="p">[:</span><span class="mi">10_000</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="heartkit.datasets.icentia11k.IcentiaDataset.heart_rate_data_generator" class="doc doc-heading">
<code class="highlight language-python"><span class="n">heart_rate_data_generator</span><span class="p">(</span><span class="n">patient_generator</span><span class="p">,</span> <span class="n">samples_per_patient</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Generate frames and heart rate label using patient generator.</p>

  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b>patient_generator</b>
            (<code><span title="heartkit.datasets.defines.PatientGenerator">PatientGenerator</span></code>)
        – <p>Patient generator</p>
      </li>
      <li class="field-body">
        <b>samples_per_patient</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code>)
        – <h5 id="heartkit.datasets.icentia11k.IcentiaDataset.heart_rate_data_generator--samples-per-patient-defaults-to-1">samples per patient. Defaults to 1.</h5>
      </li>
  </ul>

  <p>Returns:</p>
  <ul>
      <li class="field-body">
<b>SampleGenerator</b>(            <code><span title="heartkit.datasets.defines.SampleGenerator">SampleGenerator</span></code>
)        – <p>Sample generator</p>
      </li>
  </ul>

  <p>Yields:</p>
  <ul>
      <li class="field-body">
            <code><span title="heartkit.datasets.defines.SampleGenerator">SampleGenerator</span></code>
        – <p>Iterator[SampleGenerator]</p>
      </li>
  </ul>

      <details class="quote">
        <summary>Source code in <code>heartkit/datasets/icentia11k.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-432">432</a></span>
<span class="normal"><a href="#__codelineno-0-433">433</a></span>
<span class="normal"><a href="#__codelineno-0-434">434</a></span>
<span class="normal"><a href="#__codelineno-0-435">435</a></span>
<span class="normal"><a href="#__codelineno-0-436">436</a></span>
<span class="normal"><a href="#__codelineno-0-437">437</a></span>
<span class="normal"><a href="#__codelineno-0-438">438</a></span>
<span class="normal"><a href="#__codelineno-0-439">439</a></span>
<span class="normal"><a href="#__codelineno-0-440">440</a></span>
<span class="normal"><a href="#__codelineno-0-441">441</a></span>
<span class="normal"><a href="#__codelineno-0-442">442</a></span>
<span class="normal"><a href="#__codelineno-0-443">443</a></span>
<span class="normal"><a href="#__codelineno-0-444">444</a></span>
<span class="normal"><a href="#__codelineno-0-445">445</a></span>
<span class="normal"><a href="#__codelineno-0-446">446</a></span>
<span class="normal"><a href="#__codelineno-0-447">447</a></span>
<span class="normal"><a href="#__codelineno-0-448">448</a></span>
<span class="normal"><a href="#__codelineno-0-449">449</a></span>
<span class="normal"><a href="#__codelineno-0-450">450</a></span>
<span class="normal"><a href="#__codelineno-0-451">451</a></span>
<span class="normal"><a href="#__codelineno-0-452">452</a></span>
<span class="normal"><a href="#__codelineno-0-453">453</a></span>
<span class="normal"><a href="#__codelineno-0-454">454</a></span>
<span class="normal"><a href="#__codelineno-0-455">455</a></span>
<span class="normal"><a href="#__codelineno-0-456">456</a></span>
<span class="normal"><a href="#__codelineno-0-457">457</a></span>
<span class="normal"><a href="#__codelineno-0-458">458</a></span>
<span class="normal"><a href="#__codelineno-0-459">459</a></span>
<span class="normal"><a href="#__codelineno-0-460">460</a></span>
<span class="normal"><a href="#__codelineno-0-461">461</a></span>
<span class="normal"><a href="#__codelineno-0-462">462</a></span>
<span class="normal"><a href="#__codelineno-0-463">463</a></span>
<span class="normal"><a href="#__codelineno-0-464">464</a></span>
<span class="normal"><a href="#__codelineno-0-465">465</a></span>
<span class="normal"><a href="#__codelineno-0-466">466</a></span>
<span class="normal"><a href="#__codelineno-0-467">467</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-432" name="__codelineno-0-432"></a><span class="k">def</span> <span class="nf">heart_rate_data_generator</span><span class="p">(</span>
<a id="__codelineno-0-433" name="__codelineno-0-433"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-434" name="__codelineno-0-434"></a>    <span class="n">patient_generator</span><span class="p">:</span> <span class="n">PatientGenerator</span><span class="p">,</span>
<a id="__codelineno-0-435" name="__codelineno-0-435"></a>    <span class="n">samples_per_patient</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-436" name="__codelineno-0-436"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SampleGenerator</span><span class="p">:</span>
<a id="__codelineno-0-437" name="__codelineno-0-437"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate frames and heart rate label using patient generator.</span>
<a id="__codelineno-0-438" name="__codelineno-0-438"></a>
<a id="__codelineno-0-439" name="__codelineno-0-439"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-440" name="__codelineno-0-440"></a><span class="sd">        patient_generator (PatientGenerator): Patient generator</span>
<a id="__codelineno-0-441" name="__codelineno-0-441"></a><span class="sd">        samples_per_patient (int, optional): # samples per patient. Defaults to 1.</span>
<a id="__codelineno-0-442" name="__codelineno-0-442"></a>
<a id="__codelineno-0-443" name="__codelineno-0-443"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-444" name="__codelineno-0-444"></a><span class="sd">        SampleGenerator: Sample generator</span>
<a id="__codelineno-0-445" name="__codelineno-0-445"></a>
<a id="__codelineno-0-446" name="__codelineno-0-446"></a><span class="sd">    Yields:</span>
<a id="__codelineno-0-447" name="__codelineno-0-447"></a><span class="sd">        Iterator[SampleGenerator]</span>
<a id="__codelineno-0-448" name="__codelineno-0-448"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-449" name="__codelineno-0-449"></a>
<a id="__codelineno-0-450" name="__codelineno-0-450"></a>    <span class="n">label_frame_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_size</span>
<a id="__codelineno-0-451" name="__codelineno-0-451"></a>    <span class="n">max_frame_size</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frame_size</span><span class="p">,</span> <span class="n">label_frame_size</span><span class="p">)</span>
<a id="__codelineno-0-452" name="__codelineno-0-452"></a>    <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">segments</span> <span class="ow">in</span> <span class="n">patient_generator</span><span class="p">:</span>
<a id="__codelineno-0-453" name="__codelineno-0-453"></a>        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">samples_per_patient</span><span class="p">):</span>
<a id="__codelineno-0-454" name="__codelineno-0-454"></a>            <span class="n">segment</span> <span class="o">=</span> <span class="n">segments</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">segments</span><span class="o">.</span><span class="n">keys</span><span class="p">()))]</span>
<a id="__codelineno-0-455" name="__codelineno-0-455"></a>            <span class="n">segment_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">segment</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-456" name="__codelineno-0-456"></a>            <span class="n">frame_center</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">segment_size</span> <span class="o">-</span> <span class="n">max_frame_size</span><span class="p">)</span> <span class="o">+</span> <span class="n">max_frame_size</span> <span class="o">//</span> <span class="mi">2</span>
<a id="__codelineno-0-457" name="__codelineno-0-457"></a>            <span class="n">signal_frame_start</span> <span class="o">=</span> <span class="n">frame_center</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_size</span> <span class="o">//</span> <span class="mi">2</span>
<a id="__codelineno-0-458" name="__codelineno-0-458"></a>            <span class="n">signal_frame_end</span> <span class="o">=</span> <span class="n">frame_center</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_size</span> <span class="o">//</span> <span class="mi">2</span>
<a id="__codelineno-0-459" name="__codelineno-0-459"></a>            <span class="n">x</span> <span class="o">=</span> <span class="n">segment</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="n">signal_frame_start</span><span class="p">:</span><span class="n">signal_frame_end</span><span class="p">]</span>
<a id="__codelineno-0-460" name="__codelineno-0-460"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampling_rate</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_rate</span><span class="p">:</span>
<a id="__codelineno-0-461" name="__codelineno-0-461"></a>                <span class="n">x</span> <span class="o">=</span> <span class="n">resample_signal</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampling_rate</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_rate</span><span class="p">)</span>
<a id="__codelineno-0-462" name="__codelineno-0-462"></a>            <span class="n">label_frame_start</span> <span class="o">=</span> <span class="n">frame_center</span> <span class="o">-</span> <span class="n">label_frame_size</span> <span class="o">//</span> <span class="mi">2</span>
<a id="__codelineno-0-463" name="__codelineno-0-463"></a>            <span class="n">label_frame_end</span> <span class="o">=</span> <span class="n">frame_center</span> <span class="o">+</span> <span class="n">label_frame_size</span> <span class="o">//</span> <span class="mi">2</span>
<a id="__codelineno-0-464" name="__codelineno-0-464"></a>            <span class="n">beat_indices</span> <span class="o">=</span> <span class="n">segment</span><span class="p">[</span><span class="s2">&quot;blabels&quot;</span><span class="p">][:,</span> <span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-465" name="__codelineno-0-465"></a>            <span class="n">frame_beat_indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_complete_beats</span><span class="p">(</span><span class="n">beat_indices</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">label_frame_start</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">label_frame_end</span><span class="p">)</span>
<a id="__codelineno-0-466" name="__codelineno-0-466"></a>            <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_heart_rate_label</span><span class="p">(</span><span class="n">frame_beat_indices</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampling_rate</span><span class="p">)</span>
<a id="__codelineno-0-467" name="__codelineno-0-467"></a>            <span class="k">yield</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="heartkit.datasets.icentia11k.IcentiaDataset.random_patient_generator" class="doc doc-heading">
<code class="highlight language-python"><span class="n">random_patient_generator</span><span class="p">(</span><span class="n">patient_ids</span><span class="p">,</span> <span class="n">patient_weights</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Samples patient data from the provided patient distribution.</p>

  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b>patient_ids</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#list">list</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a>]</code>)
        – <p>Patient ids</p>
      </li>
      <li class="field-body">
        <b>patient_weights</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#list">list</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a>] | None</code>)
        – <p>Probabilities associated with each patient. Defaults to None.</p>
      </li>
  </ul>

  <p>Returns:</p>
  <ul>
      <li class="field-body">
<b>PatientGenerator</b>(            <code><span title="heartkit.datasets.defines.PatientGenerator">PatientGenerator</span></code>
)        – <p>Patient generator</p>
      </li>
  </ul>

  <p>Yields:</p>
  <ul>
      <li class="field-body">
            <code><span title="heartkit.datasets.defines.PatientGenerator">PatientGenerator</span></code>
        – <p>Iterator[PatientGenerator]</p>
      </li>
  </ul>

      <details class="quote">
        <summary>Source code in <code>heartkit/datasets/icentia11k.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-530">530</a></span>
<span class="normal"><a href="#__codelineno-0-531">531</a></span>
<span class="normal"><a href="#__codelineno-0-532">532</a></span>
<span class="normal"><a href="#__codelineno-0-533">533</a></span>
<span class="normal"><a href="#__codelineno-0-534">534</a></span>
<span class="normal"><a href="#__codelineno-0-535">535</a></span>
<span class="normal"><a href="#__codelineno-0-536">536</a></span>
<span class="normal"><a href="#__codelineno-0-537">537</a></span>
<span class="normal"><a href="#__codelineno-0-538">538</a></span>
<span class="normal"><a href="#__codelineno-0-539">539</a></span>
<span class="normal"><a href="#__codelineno-0-540">540</a></span>
<span class="normal"><a href="#__codelineno-0-541">541</a></span>
<span class="normal"><a href="#__codelineno-0-542">542</a></span>
<span class="normal"><a href="#__codelineno-0-543">543</a></span>
<span class="normal"><a href="#__codelineno-0-544">544</a></span>
<span class="normal"><a href="#__codelineno-0-545">545</a></span>
<span class="normal"><a href="#__codelineno-0-546">546</a></span>
<span class="normal"><a href="#__codelineno-0-547">547</a></span>
<span class="normal"><a href="#__codelineno-0-548">548</a></span>
<span class="normal"><a href="#__codelineno-0-549">549</a></span>
<span class="normal"><a href="#__codelineno-0-550">550</a></span>
<span class="normal"><a href="#__codelineno-0-551">551</a></span>
<span class="normal"><a href="#__codelineno-0-552">552</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-530" name="__codelineno-0-530"></a><span class="k">def</span> <span class="nf">random_patient_generator</span><span class="p">(</span>
<a id="__codelineno-0-531" name="__codelineno-0-531"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-532" name="__codelineno-0-532"></a>    <span class="n">patient_ids</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
<a id="__codelineno-0-533" name="__codelineno-0-533"></a>    <span class="n">patient_weights</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-534" name="__codelineno-0-534"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PatientGenerator</span><span class="p">:</span>
<a id="__codelineno-0-535" name="__codelineno-0-535"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Samples patient data from the provided patient distribution.</span>
<a id="__codelineno-0-536" name="__codelineno-0-536"></a>
<a id="__codelineno-0-537" name="__codelineno-0-537"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-538" name="__codelineno-0-538"></a><span class="sd">        patient_ids (list[int]): Patient ids</span>
<a id="__codelineno-0-539" name="__codelineno-0-539"></a><span class="sd">        patient_weights (list[int] | None, optional): Probabilities associated with each patient. Defaults to None.</span>
<a id="__codelineno-0-540" name="__codelineno-0-540"></a>
<a id="__codelineno-0-541" name="__codelineno-0-541"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-542" name="__codelineno-0-542"></a><span class="sd">        PatientGenerator: Patient generator</span>
<a id="__codelineno-0-543" name="__codelineno-0-543"></a>
<a id="__codelineno-0-544" name="__codelineno-0-544"></a><span class="sd">    Yields:</span>
<a id="__codelineno-0-545" name="__codelineno-0-545"></a><span class="sd">        Iterator[PatientGenerator]</span>
<a id="__codelineno-0-546" name="__codelineno-0-546"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-547" name="__codelineno-0-547"></a>    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
<a id="__codelineno-0-548" name="__codelineno-0-548"></a>        <span class="k">for</span> <span class="n">patient_id</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">patient_ids</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">1024</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">patient_weights</span><span class="p">):</span>
<a id="__codelineno-0-549" name="__codelineno-0-549"></a>            <span class="n">pt_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pt_key</span><span class="p">(</span><span class="n">patient_id</span><span class="p">)</span>
<a id="__codelineno-0-550" name="__codelineno-0-550"></a>            <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ds_path</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pt_key</span><span class="si">}</span><span class="s2">.h5&quot;</span><span class="p">),</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">h5</span><span class="p">:</span>
<a id="__codelineno-0-551" name="__codelineno-0-551"></a>                <span class="n">patient_data</span> <span class="o">=</span> <span class="n">h5</span><span class="p">[</span><span class="n">pt_key</span><span class="p">]</span>
<a id="__codelineno-0-552" name="__codelineno-0-552"></a>                <span class="k">yield</span> <span class="n">patient_id</span><span class="p">,</span> <span class="n">patient_data</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="heartkit.datasets.icentia11k.IcentiaDataset.rhythm_data_generator" class="doc doc-heading">
<code class="highlight language-python"><span class="n">rhythm_data_generator</span><span class="p">(</span><span class="n">patient_generator</span><span class="p">,</span> <span class="n">samples_per_patient</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Generate frames and rhythm label using patient generator.</p>

  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b>patient_generator</b>
            (<code><span title="heartkit.datasets.defines.PatientGenerator">PatientGenerator</span></code>)
        – <p>Patient Generator</p>
      </li>
      <li class="field-body">
        <b>samples_per_patient</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a> | <a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#list">list</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a>]</code>)
        – <h5 id="heartkit.datasets.icentia11k.IcentiaDataset.rhythm_data_generator--samples-per-patient-defaults-to-1">samples per patient. Defaults to 1.</h5>
      </li>
  </ul>

  <p>Returns:</p>
  <ul>
      <li class="field-body">
<b>SampleGenerator</b>(            <code><span title="heartkit.datasets.defines.SampleGenerator">SampleGenerator</span></code>
)        – <p>Sample generator</p>
      </li>
  </ul>

  <p>Yields:</p>
  <ul>
      <li class="field-body">
            <code><span title="heartkit.datasets.defines.SampleGenerator">SampleGenerator</span></code>
        – <p>Iterator[SampleGenerator]</p>
      </li>
  </ul>

      <details class="quote">
        <summary>Source code in <code>heartkit/datasets/icentia11k.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span>
<span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span>
<span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-230" name="__codelineno-0-230"></a><span class="k">def</span> <span class="nf">rhythm_data_generator</span><span class="p">(</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a>    <span class="n">patient_generator</span><span class="p">:</span> <span class="n">PatientGenerator</span><span class="p">,</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a>    <span class="n">samples_per_patient</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SampleGenerator</span><span class="p">:</span>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate frames and rhythm label using patient generator.</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a><span class="sd">        patient_generator (PatientGenerator): Patient Generator</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a><span class="sd">        samples_per_patient (int | list[int], optional): # samples per patient. Defaults to 1.</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a><span class="sd">        SampleGenerator: Sample generator</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a><span class="sd">    Yields:</span>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a><span class="sd">        Iterator[SampleGenerator]</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a>    <span class="n">tgt_labels</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a>        <span class="n">IcentiaRhythm</span><span class="o">.</span><span class="n">normal</span><span class="p">,</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a>        <span class="n">IcentiaRhythm</span><span class="o">.</span><span class="n">afib</span><span class="p">,</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a>        <span class="n">IcentiaRhythm</span><span class="o">.</span><span class="n">aflut</span><span class="p">,</span>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a>    <span class="p">)</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">samples_per_patient</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">):</span>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a>        <span class="n">samples_per_tgt</span> <span class="o">=</span> <span class="n">samples_per_patient</span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a>        <span class="n">num_per_tgt</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">samples_per_patient</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">tgt_labels</span><span class="p">)))</span>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a>        <span class="n">samples_per_tgt</span> <span class="o">=</span> <span class="n">num_per_tgt</span> <span class="o">*</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">tgt_labels</span><span class="p">)]</span>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a>    <span class="n">input_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">sampling_rate</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_rate</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_size</span><span class="p">))</span>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a>    <span class="c1"># Group patient rhythms by type (segment, start, stop, delta)</span>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a>    <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">segments</span> <span class="ow">in</span> <span class="n">patient_generator</span><span class="p">:</span>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a>        <span class="c1"># This maps segment index to segment key</span>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a>        <span class="n">seg_map</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">segments</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a>        <span class="n">pt_tgt_seg_map</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">tgt_labels</span><span class="p">]</span>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a>        <span class="k">for</span> <span class="n">seg_idx</span><span class="p">,</span> <span class="n">seg_key</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">seg_map</span><span class="p">):</span>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a>            <span class="n">rlabels</span> <span class="o">=</span> <span class="n">segments</span><span class="p">[</span><span class="n">seg_key</span><span class="p">][</span><span class="s2">&quot;rlabels&quot;</span><span class="p">][:]</span>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">rlabels</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a>                <span class="k">continue</span>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a>            <span class="n">rlabels</span> <span class="o">=</span> <span class="n">rlabels</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">rlabels</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">IcentiaRhythm</span><span class="o">.</span><span class="n">noise</span><span class="o">.</span><span class="n">value</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a>            <span class="n">xs</span><span class="p">,</span> <span class="n">xe</span><span class="p">,</span> <span class="n">xl</span> <span class="o">=</span> <span class="n">rlabels</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">rlabels</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">rlabels</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a>            <span class="k">for</span> <span class="n">tgt_idx</span><span class="p">,</span> <span class="n">tgt_class</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tgt_labels</span><span class="p">):</span>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a>                <span class="n">idxs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">xe</span> <span class="o">-</span> <span class="n">xs</span> <span class="o">&gt;=</span> <span class="n">input_size</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">xl</span> <span class="o">==</span> <span class="n">tgt_class</span><span class="p">))</span>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a>                <span class="n">seg_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">seg_idx</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">idxs</span><span class="p">),</span> <span class="n">xs</span><span class="p">[</span><span class="n">idxs</span><span class="p">],</span> <span class="n">xe</span><span class="p">[</span><span class="n">idxs</span><span class="p">]))</span><span class="o">.</span><span class="n">T</span>
<a id="__codelineno-0-275" name="__codelineno-0-275"></a>                <span class="n">pt_tgt_seg_map</span><span class="p">[</span><span class="n">tgt_idx</span><span class="p">]</span> <span class="o">+=</span> <span class="n">seg_vals</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a>            <span class="c1"># END FOR</span>
<a id="__codelineno-0-277" name="__codelineno-0-277"></a>        <span class="c1"># END FOR</span>
<a id="__codelineno-0-278" name="__codelineno-0-278"></a>        <span class="n">pt_tgt_seg_map</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">pt_tgt_seg_map</span><span class="p">]</span>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a>        <span class="c1"># Grab target segments</span>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a>        <span class="n">seg_samples</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a>        <span class="k">for</span> <span class="n">tgt_idx</span><span class="p">,</span> <span class="n">tgt_class</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tgt_labels</span><span class="p">):</span>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a>            <span class="n">tgt_segments</span> <span class="o">=</span> <span class="n">pt_tgt_seg_map</span><span class="p">[</span><span class="n">tgt_idx</span><span class="p">]</span>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">tgt_segments</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a>                <span class="k">continue</span>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a>            <span class="n">tgt_seg_indices</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choices</span><span class="p">(</span>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a>                <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">tgt_segments</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a>                <span class="n">weights</span><span class="o">=</span><span class="n">tgt_segments</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">tgt_segments</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a>                <span class="n">k</span><span class="o">=</span><span class="n">samples_per_tgt</span><span class="p">[</span><span class="n">tgt_idx</span><span class="p">],</span>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a>            <span class="p">)</span>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a>            <span class="k">for</span> <span class="n">tgt_seg_idx</span> <span class="ow">in</span> <span class="n">tgt_seg_indices</span><span class="p">:</span>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a>                <span class="n">seg_idx</span><span class="p">,</span> <span class="n">rhy_start</span><span class="p">,</span> <span class="n">rhy_end</span> <span class="o">=</span> <span class="n">tgt_segments</span><span class="p">[</span><span class="n">tgt_seg_idx</span><span class="p">]</span>
<a id="__codelineno-0-293" name="__codelineno-0-293"></a>                <span class="n">frame_start</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">rhy_start</span><span class="p">,</span> <span class="n">rhy_end</span> <span class="o">-</span> <span class="n">input_size</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-294" name="__codelineno-0-294"></a>                <span class="n">frame_end</span> <span class="o">=</span> <span class="n">frame_start</span> <span class="o">+</span> <span class="n">input_size</span>
<a id="__codelineno-0-295" name="__codelineno-0-295"></a>                <span class="n">seg_samples</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">seg_idx</span><span class="p">,</span> <span class="n">frame_start</span><span class="p">,</span> <span class="n">frame_end</span><span class="p">,</span> <span class="n">HeartRhythmMap</span><span class="p">[</span><span class="n">tgt_class</span><span class="p">]))</span>
<a id="__codelineno-0-296" name="__codelineno-0-296"></a>            <span class="c1"># END FOR</span>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a>        <span class="c1"># END FOR</span>
<a id="__codelineno-0-298" name="__codelineno-0-298"></a>
<a id="__codelineno-0-299" name="__codelineno-0-299"></a>        <span class="c1"># Shuffle segments</span>
<a id="__codelineno-0-300" name="__codelineno-0-300"></a>        <span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">seg_samples</span><span class="p">)</span>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a>        <span class="k">for</span> <span class="n">seg_idx</span><span class="p">,</span> <span class="n">frame_start</span><span class="p">,</span> <span class="n">frame_end</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">seg_samples</span><span class="p">:</span>
<a id="__codelineno-0-302" name="__codelineno-0-302"></a>            <span class="n">x</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span> <span class="o">=</span> <span class="n">segments</span><span class="p">[</span><span class="n">seg_map</span><span class="p">[</span><span class="n">seg_idx</span><span class="p">]][</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="n">frame_start</span><span class="p">:</span><span class="n">frame_end</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<a id="__codelineno-0-303" name="__codelineno-0-303"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampling_rate</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_rate</span><span class="p">:</span>
<a id="__codelineno-0-304" name="__codelineno-0-304"></a>                <span class="n">x</span> <span class="o">=</span> <span class="n">resample_signal</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampling_rate</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_rate</span><span class="p">)</span>
<a id="__codelineno-0-305" name="__codelineno-0-305"></a>            <span class="k">yield</span> <span class="n">x</span><span class="p">,</span> <span class="n">label</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="heartkit.datasets.icentia11k.IcentiaDataset.signal_generator" class="doc doc-heading">
<code class="highlight language-python"><span class="n">signal_generator</span><span class="p">(</span><span class="n">patient_generator</span><span class="p">,</span> <span class="n">samples_per_patient</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Generate frames using patient generator.
from the segments in patient data by placing a frame in a random location within one of the segments.</p>

  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b>patient_generator</b>
            (<code><span title="heartkit.datasets.defines.PatientGenerator">PatientGenerator</span></code>)
        – <p>Generator that yields a tuple of patient id and patient data.
    Patient data may contain only signals, since labels are not used.</p>
      </li>
      <li class="field-body">
        <b>samples_per_patient</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code>)
        – <p>Samples per patient.</p>
      </li>
  </ul>

  <p>Returns:</p>
  <ul>
      <li class="field-body">
<b>SampleGenerator</b>(            <code><span title="heartkit.datasets.defines.SampleGenerator">SampleGenerator</span></code>
)        – <p>Generator of input data of shape (frame_size, 1)</p>
      </li>
  </ul>

      <details class="quote">
        <summary>Source code in <code>heartkit/datasets/icentia11k.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-471">471</a></span>
<span class="normal"><a href="#__codelineno-0-472">472</a></span>
<span class="normal"><a href="#__codelineno-0-473">473</a></span>
<span class="normal"><a href="#__codelineno-0-474">474</a></span>
<span class="normal"><a href="#__codelineno-0-475">475</a></span>
<span class="normal"><a href="#__codelineno-0-476">476</a></span>
<span class="normal"><a href="#__codelineno-0-477">477</a></span>
<span class="normal"><a href="#__codelineno-0-478">478</a></span>
<span class="normal"><a href="#__codelineno-0-479">479</a></span>
<span class="normal"><a href="#__codelineno-0-480">480</a></span>
<span class="normal"><a href="#__codelineno-0-481">481</a></span>
<span class="normal"><a href="#__codelineno-0-482">482</a></span>
<span class="normal"><a href="#__codelineno-0-483">483</a></span>
<span class="normal"><a href="#__codelineno-0-484">484</a></span>
<span class="normal"><a href="#__codelineno-0-485">485</a></span>
<span class="normal"><a href="#__codelineno-0-486">486</a></span>
<span class="normal"><a href="#__codelineno-0-487">487</a></span>
<span class="normal"><a href="#__codelineno-0-488">488</a></span>
<span class="normal"><a href="#__codelineno-0-489">489</a></span>
<span class="normal"><a href="#__codelineno-0-490">490</a></span>
<span class="normal"><a href="#__codelineno-0-491">491</a></span>
<span class="normal"><a href="#__codelineno-0-492">492</a></span>
<span class="normal"><a href="#__codelineno-0-493">493</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-471" name="__codelineno-0-471"></a><span class="k">def</span> <span class="nf">signal_generator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">patient_generator</span><span class="p">:</span> <span class="n">PatientGenerator</span><span class="p">,</span> <span class="n">samples_per_patient</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SampleGenerator</span><span class="p">:</span>
<a id="__codelineno-0-472" name="__codelineno-0-472"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-473" name="__codelineno-0-473"></a><span class="sd">    Generate frames using patient generator.</span>
<a id="__codelineno-0-474" name="__codelineno-0-474"></a><span class="sd">    from the segments in patient data by placing a frame in a random location within one of the segments.</span>
<a id="__codelineno-0-475" name="__codelineno-0-475"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-476" name="__codelineno-0-476"></a><span class="sd">        patient_generator (PatientGenerator): Generator that yields a tuple of patient id and patient data.</span>
<a id="__codelineno-0-477" name="__codelineno-0-477"></a><span class="sd">                Patient data may contain only signals, since labels are not used.</span>
<a id="__codelineno-0-478" name="__codelineno-0-478"></a><span class="sd">        samples_per_patient (int): Samples per patient.</span>
<a id="__codelineno-0-479" name="__codelineno-0-479"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-480" name="__codelineno-0-480"></a><span class="sd">        SampleGenerator: Generator of input data of shape (frame_size, 1)</span>
<a id="__codelineno-0-481" name="__codelineno-0-481"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-482" name="__codelineno-0-482"></a>    <span class="n">input_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">sampling_rate</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_rate</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_size</span><span class="p">))</span>
<a id="__codelineno-0-483" name="__codelineno-0-483"></a>    <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">segments</span> <span class="ow">in</span> <span class="n">patient_generator</span><span class="p">:</span>
<a id="__codelineno-0-484" name="__codelineno-0-484"></a>        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">samples_per_patient</span><span class="p">):</span>
<a id="__codelineno-0-485" name="__codelineno-0-485"></a>            <span class="n">segment</span> <span class="o">=</span> <span class="n">segments</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">segments</span><span class="o">.</span><span class="n">keys</span><span class="p">()))]</span>
<a id="__codelineno-0-486" name="__codelineno-0-486"></a>            <span class="n">segment_size</span> <span class="o">=</span> <span class="n">segment</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-487" name="__codelineno-0-487"></a>            <span class="n">frame_start</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">segment_size</span> <span class="o">-</span> <span class="n">input_size</span><span class="p">)</span>
<a id="__codelineno-0-488" name="__codelineno-0-488"></a>            <span class="n">frame_end</span> <span class="o">=</span> <span class="n">frame_start</span> <span class="o">+</span> <span class="n">input_size</span>
<a id="__codelineno-0-489" name="__codelineno-0-489"></a>            <span class="n">x</span> <span class="o">=</span> <span class="n">segment</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="n">frame_start</span><span class="p">:</span><span class="n">frame_end</span><span class="p">]</span>
<a id="__codelineno-0-490" name="__codelineno-0-490"></a>            <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<a id="__codelineno-0-491" name="__codelineno-0-491"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampling_rate</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_rate</span><span class="p">:</span>
<a id="__codelineno-0-492" name="__codelineno-0-492"></a>                <span class="n">x</span> <span class="o">=</span> <span class="n">resample_signal</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampling_rate</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_rate</span><span class="p">)</span>
<a id="__codelineno-0-493" name="__codelineno-0-493"></a>            <span class="k">yield</span> <span class="n">x</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="heartkit.datasets.icentia11k.IcentiaDataset.task_data_generator" class="doc doc-heading">
<code class="highlight language-python"><span class="n">task_data_generator</span><span class="p">(</span><span class="n">patient_generator</span><span class="p">,</span> <span class="n">samples_per_patient</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Task-level data generator.</p>

  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b>patient_generator</b>
            (<code><span title="heartkit.datasets.defines.PatientGenerator">PatientGenerator</span></code>)
        – <p>Patient data generator</p>
      </li>
      <li class="field-body">
        <b>samples_per_patient</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a> | <a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#list">list</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a>]</code>)
        – <h5 id="heartkit.datasets.icentia11k.IcentiaDataset.task_data_generator--samples-per-patient-defaults-to-1">samples per patient. Defaults to 1.</h5>
      </li>
  </ul>

  <p>Returns:</p>
  <ul>
      <li class="field-body">
<b>SampleGenerator</b>(            <code><span title="heartkit.datasets.defines.SampleGenerator">SampleGenerator</span></code>
)        – <p>Sample data generator</p>
      </li>
  </ul>

      <details class="quote">
        <summary>Source code in <code>heartkit/datasets/icentia11k.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-168" name="__codelineno-0-168"></a><span class="k">def</span> <span class="nf">task_data_generator</span><span class="p">(</span>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a>    <span class="n">patient_generator</span><span class="p">:</span> <span class="n">PatientGenerator</span><span class="p">,</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a>    <span class="n">samples_per_patient</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SampleGenerator</span><span class="p">:</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Task-level data generator.</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a><span class="sd">        patient_generator (PatientGenerator): Patient data generator</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a><span class="sd">        samples_per_patient (int | list[int], optional): # samples per patient. Defaults to 1.</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a><span class="sd">        SampleGenerator: Sample data generator</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">task</span> <span class="o">==</span> <span class="n">HeartTask</span><span class="o">.</span><span class="n">arrhythmia</span><span class="p">:</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rhythm_data_generator</span><span class="p">(</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a>            <span class="n">patient_generator</span><span class="o">=</span><span class="n">patient_generator</span><span class="p">,</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a>            <span class="n">samples_per_patient</span><span class="o">=</span><span class="n">samples_per_patient</span><span class="p">,</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a>        <span class="p">)</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">task</span> <span class="o">==</span> <span class="n">HeartTask</span><span class="o">.</span><span class="n">beat</span><span class="p">:</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">beat_data_generator</span><span class="p">(</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a>            <span class="n">patient_generator</span><span class="o">=</span><span class="n">patient_generator</span><span class="p">,</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a>            <span class="n">samples_per_patient</span><span class="o">=</span><span class="n">samples_per_patient</span><span class="p">,</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a>        <span class="p">)</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">task</span> <span class="o">==</span> <span class="n">HeartTask</span><span class="o">.</span><span class="n">hrv</span><span class="p">:</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">heart_rate_data_generator</span><span class="p">(</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a>            <span class="n">patient_generator</span><span class="o">=</span><span class="n">patient_generator</span><span class="p">,</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a>            <span class="n">samples_per_patient</span><span class="o">=</span><span class="n">samples_per_patient</span><span class="p">,</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a>        <span class="p">)</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a>    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="heartkit.datasets.icentia11k.IcentiaDataset.uniform_patient_generator" class="doc doc-heading">
<code class="highlight language-python"><span class="n">uniform_patient_generator</span><span class="p">(</span><span class="n">patient_ids</span><span class="p">,</span> <span class="n">repeat</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Yield data for each patient in the array.</p>

  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b>patient_ids</b>
            (<code>pt.<span title="pt.ArrayLike">ArrayLike</span></code>)
        – <p>Array of patient ids</p>
      </li>
      <li class="field-body">
        <b>repeat</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>)
        – <p>Whether to repeat generator. Defaults to True.</p>
      </li>
      <li class="field-body">
        <b>shuffle</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>)
        – <p>Whether to shuffle patient ids.. Defaults to True.</p>
      </li>
  </ul>

  <p>Returns:</p>
  <ul>
      <li class="field-body">
<b>PatientGenerator</b>(            <code><span title="heartkit.datasets.defines.PatientGenerator">PatientGenerator</span></code>
)        – <p>Patient generator</p>
      </li>
  </ul>

  <p>Yields:</p>
  <ul>
      <li class="field-body">
            <code><span title="heartkit.datasets.defines.PatientGenerator">PatientGenerator</span></code>
        – <p>Iterator[PatientGenerator]</p>
      </li>
  </ul>

      <details class="quote">
        <summary>Source code in <code>heartkit/datasets/icentia11k.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-497">497</a></span>
<span class="normal"><a href="#__codelineno-0-498">498</a></span>
<span class="normal"><a href="#__codelineno-0-499">499</a></span>
<span class="normal"><a href="#__codelineno-0-500">500</a></span>
<span class="normal"><a href="#__codelineno-0-501">501</a></span>
<span class="normal"><a href="#__codelineno-0-502">502</a></span>
<span class="normal"><a href="#__codelineno-0-503">503</a></span>
<span class="normal"><a href="#__codelineno-0-504">504</a></span>
<span class="normal"><a href="#__codelineno-0-505">505</a></span>
<span class="normal"><a href="#__codelineno-0-506">506</a></span>
<span class="normal"><a href="#__codelineno-0-507">507</a></span>
<span class="normal"><a href="#__codelineno-0-508">508</a></span>
<span class="normal"><a href="#__codelineno-0-509">509</a></span>
<span class="normal"><a href="#__codelineno-0-510">510</a></span>
<span class="normal"><a href="#__codelineno-0-511">511</a></span>
<span class="normal"><a href="#__codelineno-0-512">512</a></span>
<span class="normal"><a href="#__codelineno-0-513">513</a></span>
<span class="normal"><a href="#__codelineno-0-514">514</a></span>
<span class="normal"><a href="#__codelineno-0-515">515</a></span>
<span class="normal"><a href="#__codelineno-0-516">516</a></span>
<span class="normal"><a href="#__codelineno-0-517">517</a></span>
<span class="normal"><a href="#__codelineno-0-518">518</a></span>
<span class="normal"><a href="#__codelineno-0-519">519</a></span>
<span class="normal"><a href="#__codelineno-0-520">520</a></span>
<span class="normal"><a href="#__codelineno-0-521">521</a></span>
<span class="normal"><a href="#__codelineno-0-522">522</a></span>
<span class="normal"><a href="#__codelineno-0-523">523</a></span>
<span class="normal"><a href="#__codelineno-0-524">524</a></span>
<span class="normal"><a href="#__codelineno-0-525">525</a></span>
<span class="normal"><a href="#__codelineno-0-526">526</a></span>
<span class="normal"><a href="#__codelineno-0-527">527</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-497" name="__codelineno-0-497"></a><span class="k">def</span> <span class="nf">uniform_patient_generator</span><span class="p">(</span>
<a id="__codelineno-0-498" name="__codelineno-0-498"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-499" name="__codelineno-0-499"></a>    <span class="n">patient_ids</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">,</span>
<a id="__codelineno-0-500" name="__codelineno-0-500"></a>    <span class="n">repeat</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-501" name="__codelineno-0-501"></a>    <span class="n">shuffle</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-502" name="__codelineno-0-502"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PatientGenerator</span><span class="p">:</span>
<a id="__codelineno-0-503" name="__codelineno-0-503"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Yield data for each patient in the array.</span>
<a id="__codelineno-0-504" name="__codelineno-0-504"></a>
<a id="__codelineno-0-505" name="__codelineno-0-505"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-506" name="__codelineno-0-506"></a><span class="sd">        patient_ids (pt.ArrayLike): Array of patient ids</span>
<a id="__codelineno-0-507" name="__codelineno-0-507"></a><span class="sd">        repeat (bool, optional): Whether to repeat generator. Defaults to True.</span>
<a id="__codelineno-0-508" name="__codelineno-0-508"></a><span class="sd">        shuffle (bool, optional): Whether to shuffle patient ids.. Defaults to True.</span>
<a id="__codelineno-0-509" name="__codelineno-0-509"></a>
<a id="__codelineno-0-510" name="__codelineno-0-510"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-511" name="__codelineno-0-511"></a><span class="sd">        PatientGenerator: Patient generator</span>
<a id="__codelineno-0-512" name="__codelineno-0-512"></a>
<a id="__codelineno-0-513" name="__codelineno-0-513"></a><span class="sd">    Yields:</span>
<a id="__codelineno-0-514" name="__codelineno-0-514"></a><span class="sd">        Iterator[PatientGenerator]</span>
<a id="__codelineno-0-515" name="__codelineno-0-515"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-516" name="__codelineno-0-516"></a>    <span class="n">patient_ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">patient_ids</span><span class="p">)</span>
<a id="__codelineno-0-517" name="__codelineno-0-517"></a>    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
<a id="__codelineno-0-518" name="__codelineno-0-518"></a>        <span class="k">if</span> <span class="n">shuffle</span><span class="p">:</span>
<a id="__codelineno-0-519" name="__codelineno-0-519"></a>            <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">patient_ids</span><span class="p">)</span>
<a id="__codelineno-0-520" name="__codelineno-0-520"></a>        <span class="k">for</span> <span class="n">patient_id</span> <span class="ow">in</span> <span class="n">patient_ids</span><span class="p">:</span>
<a id="__codelineno-0-521" name="__codelineno-0-521"></a>            <span class="n">pt_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pt_key</span><span class="p">(</span><span class="n">patient_id</span><span class="p">)</span>
<a id="__codelineno-0-522" name="__codelineno-0-522"></a>            <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ds_path</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pt_key</span><span class="si">}</span><span class="s2">.h5&quot;</span><span class="p">),</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">h5</span><span class="p">:</span>
<a id="__codelineno-0-523" name="__codelineno-0-523"></a>                <span class="n">patient_data</span> <span class="o">=</span> <span class="n">h5</span><span class="p">[</span><span class="n">pt_key</span><span class="p">]</span>
<a id="__codelineno-0-524" name="__codelineno-0-524"></a>                <span class="k">yield</span> <span class="n">patient_id</span><span class="p">,</span> <span class="n">patient_data</span>
<a id="__codelineno-0-525" name="__codelineno-0-525"></a>        <span class="c1"># END FOR</span>
<a id="__codelineno-0-526" name="__codelineno-0-526"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">repeat</span><span class="p">:</span>
<a id="__codelineno-0-527" name="__codelineno-0-527"></a>            <span class="k">break</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="heartkit.datasets.icentia11k.IcentiaHeartRate" class="doc doc-heading">
        <code>IcentiaHeartRate</code>


</h3>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-external" title="enum.IntEnum" href="https://docs.python.org/3/library/enum.html#enum.IntEnum">IntEnum</a></code></p>

  
      <p>Icentia heart rate labels</p>


        <details class="quote">
          <summary>Source code in <code>heartkit/datasets/icentia11k.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-73">73</a></span>
<span class="normal"><a href="#__codelineno-0-74">74</a></span>
<span class="normal"><a href="#__codelineno-0-75">75</a></span>
<span class="normal"><a href="#__codelineno-0-76">76</a></span>
<span class="normal"><a href="#__codelineno-0-77">77</a></span>
<span class="normal"><a href="#__codelineno-0-78">78</a></span>
<span class="normal"><a href="#__codelineno-0-79">79</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-73" name="__codelineno-0-73"></a><span class="k">class</span> <span class="nc">IcentiaHeartRate</span><span class="p">(</span><span class="n">IntEnum</span><span class="p">):</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Icentia heart rate labels&quot;&quot;&quot;</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>    <span class="n">tachycardia</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a>    <span class="n">bradycardia</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a>    <span class="n">normal</span> <span class="o">=</span> <span class="mi">2</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a>    <span class="n">noise</span> <span class="o">=</span> <span class="mi">3</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="heartkit.datasets.icentia11k.IcentiaRhythm" class="doc doc-heading">
        <code>IcentiaRhythm</code>


</h3>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-external" title="enum.IntEnum" href="https://docs.python.org/3/library/enum.html#enum.IntEnum">IntEnum</a></code></p>

  
      <p>Icentia rhythm labels</p>


        <details class="quote">
          <summary>Source code in <code>heartkit/datasets/icentia11k.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="k">class</span> <span class="nc">IcentiaRhythm</span><span class="p">(</span><span class="n">IntEnum</span><span class="p">):</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Icentia rhythm labels&quot;&quot;&quot;</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a>    <span class="n">noise</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a>    <span class="n">normal</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a>    <span class="n">afib</span> <span class="o">=</span> <span class="mi">2</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a>    <span class="n">aflut</span> <span class="o">=</span> <span class="mi">3</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a>    <span class="n">end</span> <span class="o">=</span> <span class="mi">4</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a>    <span class="n">unknown</span> <span class="o">=</span> <span class="mi">5</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a>    <span class="nd">@classmethod</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a>    <span class="k">def</span> <span class="nf">hi_priority</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;High priority labels&quot;&quot;&quot;</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a>        <span class="k">return</span> <span class="p">[</span><span class="bp">cls</span><span class="o">.</span><span class="n">afib</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">aflut</span><span class="p">]</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a>    <span class="nd">@classmethod</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a>    <span class="k">def</span> <span class="nf">lo_priority</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Low priority labels&quot;&quot;&quot;</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a>        <span class="k">return</span> <span class="p">[</span><span class="bp">cls</span><span class="o">.</span><span class="n">noise</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">normal</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">end</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">unknown</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h4 id="heartkit.datasets.icentia11k.IcentiaRhythm.hi_priority" class="doc doc-heading">
<code class="highlight language-python"><span class="n">hi_priority</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h4>


  <div class="doc doc-contents ">
  
      <p>High priority labels</p>

      <details class="quote">
        <summary>Source code in <code>heartkit/datasets/icentia11k.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="nd">@classmethod</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="k">def</span> <span class="nf">hi_priority</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;High priority labels&quot;&quot;&quot;</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a>    <span class="k">return</span> <span class="p">[</span><span class="bp">cls</span><span class="o">.</span><span class="n">afib</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">aflut</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="heartkit.datasets.icentia11k.IcentiaRhythm.lo_priority" class="doc doc-heading">
<code class="highlight language-python"><span class="n">lo_priority</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h4>


  <div class="doc doc-contents ">
  
      <p>Low priority labels</p>

      <details class="quote">
        <summary>Source code in <code>heartkit/datasets/icentia11k.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="nd">@classmethod</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a><span class="k">def</span> <span class="nf">lo_priority</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Low priority labels&quot;&quot;&quot;</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a>    <span class="k">return</span> <span class="p">[</span><span class="bp">cls</span><span class="o">.</span><span class="n">noise</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">normal</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">end</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">unknown</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>




  </div>

  </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="heartkit.datasets.ludb" class="doc doc-heading">
          <code>heartkit.datasets.ludb</code>


</h2>

  <div class="doc doc-contents first">

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="heartkit.datasets.ludb.LudbDataset" class="doc doc-heading">
        <code>LudbDataset</code>


</h3>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><span title="heartkit.datasets.dataset.HeartKitDataset">HeartKitDataset</span></code></p>

  
      <p>LUDB dataset</p>


        <details class="quote">
          <summary>Source code in <code>heartkit/datasets/ludb.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-0-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-0-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-0-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-0-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-0-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-0-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-0-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-0-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-0-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span>
<span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span>
<span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span>
<span class="normal"><a href="#__codelineno-0-309">309</a></span>
<span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span>
<span class="normal"><a href="#__codelineno-0-316">316</a></span>
<span class="normal"><a href="#__codelineno-0-317">317</a></span>
<span class="normal"><a href="#__codelineno-0-318">318</a></span>
<span class="normal"><a href="#__codelineno-0-319">319</a></span>
<span class="normal"><a href="#__codelineno-0-320">320</a></span>
<span class="normal"><a href="#__codelineno-0-321">321</a></span>
<span class="normal"><a href="#__codelineno-0-322">322</a></span>
<span class="normal"><a href="#__codelineno-0-323">323</a></span>
<span class="normal"><a href="#__codelineno-0-324">324</a></span>
<span class="normal"><a href="#__codelineno-0-325">325</a></span>
<span class="normal"><a href="#__codelineno-0-326">326</a></span>
<span class="normal"><a href="#__codelineno-0-327">327</a></span>
<span class="normal"><a href="#__codelineno-0-328">328</a></span>
<span class="normal"><a href="#__codelineno-0-329">329</a></span>
<span class="normal"><a href="#__codelineno-0-330">330</a></span>
<span class="normal"><a href="#__codelineno-0-331">331</a></span>
<span class="normal"><a href="#__codelineno-0-332">332</a></span>
<span class="normal"><a href="#__codelineno-0-333">333</a></span>
<span class="normal"><a href="#__codelineno-0-334">334</a></span>
<span class="normal"><a href="#__codelineno-0-335">335</a></span>
<span class="normal"><a href="#__codelineno-0-336">336</a></span>
<span class="normal"><a href="#__codelineno-0-337">337</a></span>
<span class="normal"><a href="#__codelineno-0-338">338</a></span>
<span class="normal"><a href="#__codelineno-0-339">339</a></span>
<span class="normal"><a href="#__codelineno-0-340">340</a></span>
<span class="normal"><a href="#__codelineno-0-341">341</a></span>
<span class="normal"><a href="#__codelineno-0-342">342</a></span>
<span class="normal"><a href="#__codelineno-0-343">343</a></span>
<span class="normal"><a href="#__codelineno-0-344">344</a></span>
<span class="normal"><a href="#__codelineno-0-345">345</a></span>
<span class="normal"><a href="#__codelineno-0-346">346</a></span>
<span class="normal"><a href="#__codelineno-0-347">347</a></span>
<span class="normal"><a href="#__codelineno-0-348">348</a></span>
<span class="normal"><a href="#__codelineno-0-349">349</a></span>
<span class="normal"><a href="#__codelineno-0-350">350</a></span>
<span class="normal"><a href="#__codelineno-0-351">351</a></span>
<span class="normal"><a href="#__codelineno-0-352">352</a></span>
<span class="normal"><a href="#__codelineno-0-353">353</a></span>
<span class="normal"><a href="#__codelineno-0-354">354</a></span>
<span class="normal"><a href="#__codelineno-0-355">355</a></span>
<span class="normal"><a href="#__codelineno-0-356">356</a></span>
<span class="normal"><a href="#__codelineno-0-357">357</a></span>
<span class="normal"><a href="#__codelineno-0-358">358</a></span>
<span class="normal"><a href="#__codelineno-0-359">359</a></span>
<span class="normal"><a href="#__codelineno-0-360">360</a></span>
<span class="normal"><a href="#__codelineno-0-361">361</a></span>
<span class="normal"><a href="#__codelineno-0-362">362</a></span>
<span class="normal"><a href="#__codelineno-0-363">363</a></span>
<span class="normal"><a href="#__codelineno-0-364">364</a></span>
<span class="normal"><a href="#__codelineno-0-365">365</a></span>
<span class="normal"><a href="#__codelineno-0-366">366</a></span>
<span class="normal"><a href="#__codelineno-0-367">367</a></span>
<span class="normal"><a href="#__codelineno-0-368">368</a></span>
<span class="normal"><a href="#__codelineno-0-369">369</a></span>
<span class="normal"><a href="#__codelineno-0-370">370</a></span>
<span class="normal"><a href="#__codelineno-0-371">371</a></span>
<span class="normal"><a href="#__codelineno-0-372">372</a></span>
<span class="normal"><a href="#__codelineno-0-373">373</a></span>
<span class="normal"><a href="#__codelineno-0-374">374</a></span>
<span class="normal"><a href="#__codelineno-0-375">375</a></span>
<span class="normal"><a href="#__codelineno-0-376">376</a></span>
<span class="normal"><a href="#__codelineno-0-377">377</a></span>
<span class="normal"><a href="#__codelineno-0-378">378</a></span>
<span class="normal"><a href="#__codelineno-0-379">379</a></span>
<span class="normal"><a href="#__codelineno-0-380">380</a></span>
<span class="normal"><a href="#__codelineno-0-381">381</a></span>
<span class="normal"><a href="#__codelineno-0-382">382</a></span>
<span class="normal"><a href="#__codelineno-0-383">383</a></span>
<span class="normal"><a href="#__codelineno-0-384">384</a></span>
<span class="normal"><a href="#__codelineno-0-385">385</a></span>
<span class="normal"><a href="#__codelineno-0-386">386</a></span>
<span class="normal"><a href="#__codelineno-0-387">387</a></span>
<span class="normal"><a href="#__codelineno-0-388">388</a></span>
<span class="normal"><a href="#__codelineno-0-389">389</a></span>
<span class="normal"><a href="#__codelineno-0-390">390</a></span>
<span class="normal"><a href="#__codelineno-0-391">391</a></span>
<span class="normal"><a href="#__codelineno-0-392">392</a></span>
<span class="normal"><a href="#__codelineno-0-393">393</a></span>
<span class="normal"><a href="#__codelineno-0-394">394</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="k">class</span> <span class="nc">LudbDataset</span><span class="p">(</span><span class="n">HeartKitDataset</span><span class="p">):</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;LUDB dataset&quot;&quot;&quot;</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a>        <span class="n">ds_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a>        <span class="n">task</span><span class="p">:</span> <span class="n">HeartTask</span> <span class="o">=</span> <span class="n">HeartTask</span><span class="o">.</span><span class="n">arrhythmia</span><span class="p">,</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a>        <span class="n">frame_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1250</span><span class="p">,</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a>        <span class="n">target_rate</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">250</span><span class="p">,</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ds_path</span><span class="p">,</span> <span class="s2">&quot;ludb&quot;</span><span class="p">),</span> <span class="n">task</span><span class="p">,</span> <span class="n">frame_size</span><span class="p">,</span> <span class="n">target_rate</span><span class="p">)</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a>    <span class="nd">@property</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a>    <span class="k">def</span> <span class="nf">sampling_rate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Sampling rate in Hz&quot;&quot;&quot;</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>        <span class="k">return</span> <span class="mi">500</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>    <span class="nd">@property</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>    <span class="k">def</span> <span class="nf">mean</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Dataset mean&quot;&quot;&quot;</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>        <span class="k">return</span> <span class="mi">0</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>    <span class="nd">@property</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a>    <span class="k">def</span> <span class="nf">std</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Dataset st dev&quot;&quot;&quot;</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>        <span class="k">return</span> <span class="mi">1</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a>    <span class="nd">@property</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a>    <span class="k">def</span> <span class="nf">patient_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">:</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get dataset patient IDs</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="sd">            npt.NDArray: patient IDs</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">201</span><span class="p">)</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>    <span class="k">def</span> <span class="nf">get_train_patient_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">:</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get dataset training patient IDs</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a><span class="sd">            npt.NDArray: patient IDs</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">patient_ids</span><span class="p">[:</span><span class="mi">180</span><span class="p">]</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>    <span class="k">def</span> <span class="nf">get_test_patient_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">:</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get dataset patient IDs reserved for testing only</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a><span class="sd">            npt.NDArray: patient IDs</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">patient_ids</span><span class="p">[</span><span class="mi">180</span><span class="p">:]</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>    <span class="k">def</span> <span class="nf">task_data_generator</span><span class="p">(</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>        <span class="n">patient_generator</span><span class="p">:</span> <span class="n">PatientGenerator</span><span class="p">,</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>        <span class="n">samples_per_patient</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SampleGenerator</span><span class="p">:</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Task-level data generator.</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a><span class="sd">            patient_generator (PatientGenerator): Patient data generator</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a><span class="sd">            samples_per_patient (int | list[int], optional): # samples per patient. Defaults to 1.</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a><span class="sd">            SampleGenerator: Sample data generator</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">task</span> <span class="o">==</span> <span class="n">HeartTask</span><span class="o">.</span><span class="n">segmentation</span><span class="p">:</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">segmentation_generator</span><span class="p">(</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>                <span class="n">patient_generator</span><span class="o">=</span><span class="n">patient_generator</span><span class="p">,</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>                <span class="n">samples_per_patient</span><span class="o">=</span><span class="n">samples_per_patient</span><span class="p">,</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>            <span class="p">)</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>    <span class="k">def</span> <span class="nf">segmentation_generator</span><span class="p">(</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>        <span class="n">patient_generator</span><span class="p">:</span> <span class="n">PatientGenerator</span><span class="p">,</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>        <span class="n">samples_per_patient</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SampleGenerator</span><span class="p">:</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate frames and segment labels.</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a><span class="sd">            patient_generator (PatientGenerator): Patient Generator</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a><span class="sd">            samples_per_patient (int | list[int], optional): # samples per patient. Defaults to 1.</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a><span class="sd">            SampleGenerator: Sample generator</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a><span class="sd">        Yields:</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a><span class="sd">            Iterator[SampleGenerator]</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">pt</span> <span class="ow">in</span> <span class="n">patient_generator</span><span class="p">:</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>            <span class="c1"># NOTE: [:] will load all data into RAM- ideal for small dataset</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>            <span class="n">data</span> <span class="o">=</span> <span class="n">pt</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][:]</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>            <span class="n">segs</span> <span class="o">=</span> <span class="n">pt</span><span class="p">[</span><span class="s2">&quot;segmentations&quot;</span><span class="p">][:]</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>            <span class="n">fids</span> <span class="o">=</span> <span class="n">pt</span><span class="p">[</span><span class="s2">&quot;fiducials&quot;</span><span class="p">][:]</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampling_rate</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_rate</span><span class="p">:</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a>                <span class="n">ratio</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_rate</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampling_rate</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>                <span class="n">data</span> <span class="o">=</span> <span class="n">resample_signal</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampling_rate</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_rate</span><span class="p">)</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>                <span class="n">segs</span><span class="p">[:,</span> <span class="p">(</span><span class="n">SEG_BEG_IDX</span><span class="p">,</span> <span class="n">SEG_END_IDX</span><span class="p">)]</span> <span class="o">=</span> <span class="n">segs</span><span class="p">[:,</span> <span class="p">(</span><span class="n">SEG_BEG_IDX</span><span class="p">,</span> <span class="n">SEG_END_IDX</span><span class="p">)]</span> <span class="o">*</span> <span class="n">ratio</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>                <span class="n">fids</span><span class="p">[:,</span> <span class="n">FID_LOC_IDX</span><span class="p">]</span> <span class="o">=</span> <span class="n">fids</span><span class="p">[:,</span> <span class="n">FID_LOC_IDX</span><span class="p">]</span> <span class="o">*</span> <span class="n">ratio</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>            <span class="c1"># END IF</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a>            <span class="c1"># Create segmentation mask</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>            <span class="n">labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>            <span class="k">for</span> <span class="n">seg_idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">segs</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>                <span class="n">seg</span> <span class="o">=</span> <span class="n">segs</span><span class="p">[</span><span class="n">seg_idx</span><span class="p">]</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>                <span class="n">labels</span><span class="p">[</span><span class="n">seg</span><span class="p">[</span><span class="n">SEG_BEG_IDX</span><span class="p">]</span> <span class="p">:</span> <span class="n">seg</span><span class="p">[</span><span class="n">SEG_END_IDX</span><span class="p">],</span> <span class="n">seg</span><span class="p">[</span><span class="n">SEG_LEAD_IDX</span><span class="p">]]</span> <span class="o">=</span> <span class="n">seg</span><span class="p">[</span><span class="n">SEG_LBL_IDX</span><span class="p">]</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>            <span class="c1"># END FOR</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>            <span class="n">start_offset</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">segs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">SEG_BEG_IDX</span><span class="p">]</span> <span class="o">-</span> <span class="mi">100</span><span class="p">)</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>            <span class="n">stop_offset</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">segs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">SEG_END_IDX</span><span class="p">]</span> <span class="o">+</span> <span class="mi">100</span><span class="p">)</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a>            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">samples_per_patient</span><span class="p">):</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a>                <span class="c1"># Randomly pick an ECG lead</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>                <span class="n">lead_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>                <span class="c1"># Randomly select frame within the segment</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>                <span class="n">frame_start</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">start_offset</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_size</span> <span class="o">-</span> <span class="n">stop_offset</span><span class="p">)</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a>                <span class="n">frame_end</span> <span class="o">=</span> <span class="n">frame_start</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_size</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>                <span class="n">x</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">frame_start</span><span class="p">:</span><span class="n">frame_end</span><span class="p">,</span> <span class="n">lead_idx</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a>                <span class="n">y</span> <span class="o">=</span> <span class="n">labels</span><span class="p">[</span><span class="n">frame_start</span><span class="p">:</span><span class="n">frame_end</span><span class="p">,</span> <span class="n">lead_idx</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a>                <span class="k">yield</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a>            <span class="c1"># END FOR</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a>            <span class="c1"># start_offset = max(segs[0][SEG_BEG_IDX], int(0.55 * self.frame_size))</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a>            <span class="c1"># stop_offset = int(data.shape[0] - 0.55 * self.frame_size)</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>            <span class="c1"># # Identify R peak locations and randomly shuffle</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a>            <span class="c1"># rfids = fids[</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a>            <span class="c1">#     (fids[:, FID_LBL_IDX] == 2)</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>            <span class="c1">#     &amp; (start_offset &lt; fids[:, FID_LOC_IDX])</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a>            <span class="c1">#     &amp; (fids[:, FID_LOC_IDX] &lt; stop_offset)</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a>            <span class="c1"># ]</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a>            <span class="c1"># if rfids.shape[0] &lt;= 2:</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a>            <span class="c1">#     continue</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a>            <span class="c1"># np.random.shuffle(rfids)</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a>            <span class="c1"># for i in range(min(samples_per_patient, rfids.shape[0])):</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a>            <span class="c1">#     lead_idx = rfids[i, FID_LEAD_IDX]</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a>            <span class="c1">#     frame_start = max(rfids[i, FID_LOC_IDX] - int(random.uniform(0.45, 0.55) * self.frame_size), 0)</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a>            <span class="c1">#     frame_end = frame_start + self.frame_size</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a>            <span class="c1">#     if frame_end - frame_start &lt; self.frame_size:</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a>            <span class="c1">#         continue</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a>            <span class="c1">#     x = data[frame_start:frame_end, lead_idx].astype(np.float32)</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a>            <span class="c1">#     y = labels[frame_start:frame_end, lead_idx].astype(np.int32)</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a>            <span class="c1">#     yield x, y</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a>            <span class="c1"># # END FOR</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a>        <span class="c1"># END FOR</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a>    <span class="k">def</span> <span class="nf">signal_generator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">patient_generator</span><span class="p">:</span> <span class="n">PatientGenerator</span><span class="p">,</span> <span class="n">samples_per_patient</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SampleGenerator</span><span class="p">:</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a><span class="sd">        Generate frames using patient generator.</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a><span class="sd">        from the segments in patient data by placing a frame in a random location within one of the segments.</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a><span class="sd">            patient_generator (PatientGenerator): Generator that yields a tuple of patient id and patient data.</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a><span class="sd">                    Patient data may contain only signals, since labels are not used.</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a><span class="sd">            samples_per_patient (int): Samples per patient.</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a><span class="sd">            SampleGenerator: Generator of input data of shape (frame_size, 1)</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a>        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">pt</span> <span class="ow">in</span> <span class="n">patient_generator</span><span class="p">:</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a>            <span class="n">data</span> <span class="o">=</span> <span class="n">pt</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][:]</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampling_rate</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_rate</span><span class="p">:</span>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a>                <span class="n">data</span> <span class="o">=</span> <span class="n">resample_signal</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampling_rate</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_rate</span><span class="p">)</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a>            <span class="c1"># END IF</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a>            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">samples_per_patient</span><span class="p">):</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a>                <span class="n">lead_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a>                <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_size</span><span class="p">:</span>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a>                    <span class="n">frame_start</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_size</span><span class="p">)</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a>                    <span class="n">frame_start</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a>                <span class="n">frame_end</span> <span class="o">=</span> <span class="n">frame_start</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_size</span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a>                <span class="n">x</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">frame_start</span><span class="p">:</span><span class="n">frame_end</span><span class="p">,</span> <span class="n">lead_idx</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">frame_size</span><span class="p">,))</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a>                <span class="k">yield</span> <span class="n">x</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a>            <span class="c1"># END FOR</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a>        <span class="c1"># END FOR</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a>    <span class="k">def</span> <span class="nf">get_patient_data_segments</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">patient</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">,</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">]:</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get patient&#39;s entire data and segments</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a><span class="sd">            patient (int): Patient ID (1-based)</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a><span class="sd">            tuple[npt.NDArray, npt.NDArray]: (data, segment labels)</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a>        <span class="n">pt_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;p</span><span class="si">{</span><span class="n">patient</span><span class="si">:</span><span class="s2">05d</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a>        <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ds_path</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pt_key</span><span class="si">}</span><span class="s2">.h5&quot;</span><span class="p">),</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">pt</span><span class="p">:</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a>            <span class="n">data</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span> <span class="o">=</span> <span class="n">pt</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][:]</span>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a>            <span class="n">segs</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span> <span class="o">=</span> <span class="n">pt</span><span class="p">[</span><span class="s2">&quot;segmentations&quot;</span><span class="p">][:]</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a>        <span class="n">labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a>        <span class="k">for</span> <span class="n">seg_idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">segs</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>  <span class="c1"># pylint: disable=no-member</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a>            <span class="n">seg</span> <span class="o">=</span> <span class="n">segs</span><span class="p">[</span><span class="n">seg_idx</span><span class="p">]</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a>            <span class="n">labels</span><span class="p">[</span><span class="n">seg</span><span class="p">[</span><span class="n">SEG_BEG_IDX</span><span class="p">]</span> <span class="p">:</span> <span class="n">seg</span><span class="p">[</span><span class="n">SEG_END_IDX</span><span class="p">]</span> <span class="o">+</span> <span class="mi">0</span><span class="p">,</span> <span class="n">seg</span><span class="p">[</span><span class="n">SEG_LEAD_IDX</span><span class="p">]]</span> <span class="o">=</span> <span class="n">seg</span><span class="p">[</span><span class="n">SEG_LBL_IDX</span><span class="p">]</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a>        <span class="c1"># END FOR</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a>        <span class="k">return</span> <span class="n">data</span><span class="p">,</span> <span class="n">labels</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a>    <span class="k">def</span> <span class="nf">uniform_patient_generator</span><span class="p">(</span>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a>        <span class="n">patient_ids</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">,</span>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a>        <span class="n">repeat</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a>        <span class="n">shuffle</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PatientGenerator</span><span class="p">:</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Yield data for each patient in the array.</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a><span class="sd">            patient_ids (pt.ArrayLike): Array of patient ids</span>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a><span class="sd">            repeat (bool, optional): Whether to repeat generator. Defaults to True.</span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a><span class="sd">            shuffle (bool, optional): Whether to shuffle patient ids.. Defaults to True.</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a><span class="sd">            PatientGenerator: Patient generator</span>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a><span class="sd">        Yields:</span>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a><span class="sd">            Iterator[PatientGenerator]</span>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a>        <span class="n">patient_ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">patient_ids</span><span class="p">)</span>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a>        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a>            <span class="k">if</span> <span class="n">shuffle</span><span class="p">:</span>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a>                <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">patient_ids</span><span class="p">)</span>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a>            <span class="k">for</span> <span class="n">patient_id</span> <span class="ow">in</span> <span class="n">patient_ids</span><span class="p">:</span>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a>                <span class="n">pt_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;p</span><span class="si">{</span><span class="n">patient_id</span><span class="si">:</span><span class="s2">05d</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a>                <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ds_path</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pt_key</span><span class="si">}</span><span class="s2">.h5&quot;</span><span class="p">),</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">h5</span><span class="p">:</span>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a>                    <span class="k">yield</span> <span class="n">patient_id</span><span class="p">,</span> <span class="n">h5</span>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a>            <span class="c1"># END FOR</span>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">repeat</span><span class="p">:</span>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a>                <span class="k">break</span>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a>        <span class="c1"># END WHILE</span>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a>
<a id="__codelineno-0-275" name="__codelineno-0-275"></a>    <span class="k">def</span> <span class="nf">convert_pt_wfdb_to_hdf5</span><span class="p">(</span>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">patient</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">src_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">dst_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">force</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-277" name="__codelineno-0-277"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">,</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">,</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">]:</span>
<a id="__codelineno-0-278" name="__codelineno-0-278"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert LUDB patient data from WFDB to more consumable HDF5 format.</span>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a><span class="sd">            patient (int): Patient id (1-based)</span>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a><span class="sd">            src_path (str): Source path to WFDB folder</span>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a><span class="sd">            dst_path (str): Destination path to store HDF5 file</span>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a><span class="sd">            tuple[npt.NDArray, npt.NDArray, npt.NDArray]: data, segments, and fiducials</span>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a>        <span class="kn">import</span> <span class="nn">wfdb</span>  <span class="c1"># pylint: disable=import-outside-toplevel</span>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a>        <span class="n">pt_id</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;p</span><span class="si">{</span><span class="n">patient</span><span class="si">:</span><span class="s2">05d</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a>        <span class="n">pt_src_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">src_path</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">patient</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a>        <span class="n">rec</span> <span class="o">=</span> <span class="n">wfdb</span><span class="o">.</span><span class="n">rdrecord</span><span class="p">(</span><span class="n">pt_src_path</span><span class="p">)</span>
<a id="__codelineno-0-293" name="__codelineno-0-293"></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">p_signal</span><span class="p">)</span>
<a id="__codelineno-0-294" name="__codelineno-0-294"></a>        <span class="n">segs</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-295" name="__codelineno-0-295"></a>        <span class="n">fids</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-296" name="__codelineno-0-296"></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">lead</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">sig_name</span><span class="p">):</span>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a>            <span class="n">lead_id</span> <span class="o">=</span> <span class="n">LudbLeadsMap</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">lead</span><span class="p">)</span>
<a id="__codelineno-0-298" name="__codelineno-0-298"></a>            <span class="n">ann</span> <span class="o">=</span> <span class="n">wfdb</span><span class="o">.</span><span class="n">rdann</span><span class="p">(</span><span class="n">pt_src_path</span><span class="p">,</span> <span class="n">extension</span><span class="o">=</span><span class="n">lead</span><span class="p">)</span>
<a id="__codelineno-0-299" name="__codelineno-0-299"></a>            <span class="n">seg_start</span> <span class="o">=</span> <span class="n">seg_stop</span> <span class="o">=</span> <span class="n">sym_id</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-300" name="__codelineno-0-300"></a>            <span class="n">data</span><span class="p">[:,</span> <span class="n">lead_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">rec</span><span class="o">.</span><span class="n">p_signal</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a>            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">symbol</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ann</span><span class="o">.</span><span class="n">symbol</span><span class="p">):</span>
<a id="__codelineno-0-302" name="__codelineno-0-302"></a>                <span class="c1"># Start of segment</span>
<a id="__codelineno-0-303" name="__codelineno-0-303"></a>                <span class="k">if</span> <span class="n">symbol</span> <span class="o">==</span> <span class="s2">&quot;(&quot;</span><span class="p">:</span>
<a id="__codelineno-0-304" name="__codelineno-0-304"></a>                    <span class="n">seg_start</span> <span class="o">=</span> <span class="n">ann</span><span class="o">.</span><span class="n">sample</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
<a id="__codelineno-0-305" name="__codelineno-0-305"></a>                    <span class="n">seg_stop</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-306" name="__codelineno-0-306"></a>                <span class="c1"># Fiducial / segment type</span>
<a id="__codelineno-0-307" name="__codelineno-0-307"></a>                <span class="k">elif</span> <span class="n">symbol</span> <span class="ow">in</span> <span class="n">LudbSymbolMap</span><span class="p">:</span>
<a id="__codelineno-0-308" name="__codelineno-0-308"></a>                    <span class="n">sym_id</span> <span class="o">=</span> <span class="n">LudbSymbolMap</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">symbol</span><span class="p">)</span>
<a id="__codelineno-0-309" name="__codelineno-0-309"></a>                    <span class="k">if</span> <span class="n">seg_start</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-310" name="__codelineno-0-310"></a>                        <span class="n">seg_start</span> <span class="o">=</span> <span class="n">ann</span><span class="o">.</span><span class="n">sample</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
<a id="__codelineno-0-311" name="__codelineno-0-311"></a>                    <span class="n">fids</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">lead_id</span><span class="p">,</span> <span class="n">sym_id</span><span class="p">,</span> <span class="n">ann</span><span class="o">.</span><span class="n">sample</span><span class="p">[</span><span class="n">j</span><span class="p">]])</span>
<a id="__codelineno-0-312" name="__codelineno-0-312"></a>                <span class="c1"># End of segment (start and symbol are never 0 but can be None)</span>
<a id="__codelineno-0-313" name="__codelineno-0-313"></a>                <span class="k">elif</span> <span class="n">symbol</span> <span class="o">==</span> <span class="s2">&quot;)&quot;</span> <span class="ow">and</span> <span class="n">seg_start</span> <span class="ow">and</span> <span class="n">sym_id</span><span class="p">:</span>
<a id="__codelineno-0-314" name="__codelineno-0-314"></a>                    <span class="n">seg_stop</span> <span class="o">=</span> <span class="n">ann</span><span class="o">.</span><span class="n">sample</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
<a id="__codelineno-0-315" name="__codelineno-0-315"></a>                    <span class="n">segs</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">lead_id</span><span class="p">,</span> <span class="n">sym_id</span><span class="p">,</span> <span class="n">seg_start</span><span class="p">,</span> <span class="n">seg_stop</span><span class="p">])</span>
<a id="__codelineno-0-316" name="__codelineno-0-316"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-317" name="__codelineno-0-317"></a>                    <span class="n">seg_start</span> <span class="o">=</span> <span class="n">seg_stop</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-318" name="__codelineno-0-318"></a>                    <span class="n">sym_id</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-319" name="__codelineno-0-319"></a>            <span class="c1"># END FOR</span>
<a id="__codelineno-0-320" name="__codelineno-0-320"></a>        <span class="c1"># END FOR</span>
<a id="__codelineno-0-321" name="__codelineno-0-321"></a>        <span class="n">segs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">segs</span><span class="p">)</span>
<a id="__codelineno-0-322" name="__codelineno-0-322"></a>        <span class="n">fids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">fids</span><span class="p">)</span>
<a id="__codelineno-0-323" name="__codelineno-0-323"></a>
<a id="__codelineno-0-324" name="__codelineno-0-324"></a>        <span class="k">if</span> <span class="n">dst_path</span><span class="p">:</span>
<a id="__codelineno-0-325" name="__codelineno-0-325"></a>            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">dst_path</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-326" name="__codelineno-0-326"></a>            <span class="n">pt_dst_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dst_path</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pt_id</span><span class="si">}</span><span class="s2">.h5&quot;</span><span class="p">)</span>
<a id="__codelineno-0-327" name="__codelineno-0-327"></a>            <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">pt_dst_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">h5</span><span class="p">:</span>
<a id="__codelineno-0-328" name="__codelineno-0-328"></a>                <span class="n">h5</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="s2">&quot;gzip&quot;</span><span class="p">)</span>
<a id="__codelineno-0-329" name="__codelineno-0-329"></a>                <span class="n">h5</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;segmentations&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">segs</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="s2">&quot;gzip&quot;</span><span class="p">)</span>
<a id="__codelineno-0-330" name="__codelineno-0-330"></a>                <span class="n">h5</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;fiducials&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">fids</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="s2">&quot;gzip&quot;</span><span class="p">)</span>
<a id="__codelineno-0-331" name="__codelineno-0-331"></a>            <span class="c1"># END WITH</span>
<a id="__codelineno-0-332" name="__codelineno-0-332"></a>        <span class="c1"># END IF</span>
<a id="__codelineno-0-333" name="__codelineno-0-333"></a>
<a id="__codelineno-0-334" name="__codelineno-0-334"></a>        <span class="k">return</span> <span class="n">data</span><span class="p">,</span> <span class="n">segs</span><span class="p">,</span> <span class="n">fids</span>
<a id="__codelineno-0-335" name="__codelineno-0-335"></a>
<a id="__codelineno-0-336" name="__codelineno-0-336"></a>    <span class="k">def</span> <span class="nf">convert_dataset_zip_to_hdf5</span><span class="p">(</span>
<a id="__codelineno-0-337" name="__codelineno-0-337"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-338" name="__codelineno-0-338"></a>        <span class="n">zip_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-339" name="__codelineno-0-339"></a>        <span class="n">patient_ids</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-340" name="__codelineno-0-340"></a>        <span class="n">force</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-341" name="__codelineno-0-341"></a>        <span class="n">num_workers</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-342" name="__codelineno-0-342"></a>    <span class="p">):</span>
<a id="__codelineno-0-343" name="__codelineno-0-343"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert dataset into individial patient HDF5 files.</span>
<a id="__codelineno-0-344" name="__codelineno-0-344"></a>
<a id="__codelineno-0-345" name="__codelineno-0-345"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-346" name="__codelineno-0-346"></a><span class="sd">            zip_path (str): Zip path</span>
<a id="__codelineno-0-347" name="__codelineno-0-347"></a><span class="sd">            patient_ids (npt.NDArray | None, optional): List of patient IDs to extract. Defaults to all.</span>
<a id="__codelineno-0-348" name="__codelineno-0-348"></a><span class="sd">            force (bool, optional): Whether to force re-download if destination exists. Defaults to False.</span>
<a id="__codelineno-0-349" name="__codelineno-0-349"></a><span class="sd">            num_workers (int, optional): # parallel workers. Defaults to os.cpu_count().</span>
<a id="__codelineno-0-350" name="__codelineno-0-350"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-351" name="__codelineno-0-351"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">patient_ids</span><span class="p">:</span>
<a id="__codelineno-0-352" name="__codelineno-0-352"></a>            <span class="n">patient_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">patient_ids</span>
<a id="__codelineno-0-353" name="__codelineno-0-353"></a>
<a id="__codelineno-0-354" name="__codelineno-0-354"></a>        <span class="n">subdir</span> <span class="o">=</span> <span class="s2">&quot;lobachevsky-university-electrocardiography-database-1.0.1&quot;</span>
<a id="__codelineno-0-355" name="__codelineno-0-355"></a>        <span class="k">with</span> <span class="n">Pool</span><span class="p">(</span><span class="n">processes</span><span class="o">=</span><span class="n">num_workers</span><span class="p">)</span> <span class="k">as</span> <span class="n">pool</span><span class="p">,</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryDirectory</span><span class="p">()</span> <span class="k">as</span> <span class="n">tmpdir</span><span class="p">,</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span>
<a id="__codelineno-0-356" name="__codelineno-0-356"></a>            <span class="n">zip_path</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;r&quot;</span>
<a id="__codelineno-0-357" name="__codelineno-0-357"></a>        <span class="p">)</span> <span class="k">as</span> <span class="n">zp</span><span class="p">:</span>
<a id="__codelineno-0-358" name="__codelineno-0-358"></a>            <span class="n">ludb_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmpdir</span><span class="p">,</span> <span class="s2">&quot;ludb&quot;</span><span class="p">)</span>
<a id="__codelineno-0-359" name="__codelineno-0-359"></a>            <span class="n">zp</span><span class="o">.</span><span class="n">extractall</span><span class="p">(</span><span class="n">ludb_dir</span><span class="p">)</span>
<a id="__codelineno-0-360" name="__codelineno-0-360"></a>            <span class="n">f</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span>
<a id="__codelineno-0-361" name="__codelineno-0-361"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">convert_pt_wfdb_to_hdf5</span><span class="p">,</span>
<a id="__codelineno-0-362" name="__codelineno-0-362"></a>                <span class="n">src_path</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ludb_dir</span><span class="p">,</span> <span class="n">subdir</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">),</span>
<a id="__codelineno-0-363" name="__codelineno-0-363"></a>                <span class="n">dst_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ds_path</span><span class="p">,</span>
<a id="__codelineno-0-364" name="__codelineno-0-364"></a>                <span class="n">force</span><span class="o">=</span><span class="n">force</span><span class="p">,</span>
<a id="__codelineno-0-365" name="__codelineno-0-365"></a>            <span class="p">)</span>
<a id="__codelineno-0-366" name="__codelineno-0-366"></a>            <span class="n">_</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">tqdm</span><span class="p">(</span><span class="n">pool</span><span class="o">.</span><span class="n">imap</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">patient_ids</span><span class="p">),</span> <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">patient_ids</span><span class="p">)))</span>
<a id="__codelineno-0-367" name="__codelineno-0-367"></a>        <span class="c1"># END WITH</span>
<a id="__codelineno-0-368" name="__codelineno-0-368"></a>
<a id="__codelineno-0-369" name="__codelineno-0-369"></a>    <span class="k">def</span> <span class="nf">download</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_workers</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">force</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<a id="__codelineno-0-370" name="__codelineno-0-370"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Download LUDB dataset</span>
<a id="__codelineno-0-371" name="__codelineno-0-371"></a>
<a id="__codelineno-0-372" name="__codelineno-0-372"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-373" name="__codelineno-0-373"></a><span class="sd">            num_workers (int | None, optional): # parallel workers. Defaults to None.</span>
<a id="__codelineno-0-374" name="__codelineno-0-374"></a><span class="sd">            force (bool, optional): Force redownload. Defaults to False.</span>
<a id="__codelineno-0-375" name="__codelineno-0-375"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-376" name="__codelineno-0-376"></a>
<a id="__codelineno-0-377" name="__codelineno-0-377"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Downloading LUDB dataset&quot;</span><span class="p">)</span>
<a id="__codelineno-0-378" name="__codelineno-0-378"></a>        <span class="n">ds_url</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-379" name="__codelineno-0-379"></a>            <span class="s2">&quot;https://physionet.org/static/published-projects/ludb/&quot;</span>
<a id="__codelineno-0-380" name="__codelineno-0-380"></a>            <span class="s2">&quot;lobachevsky-university-electrocardiography-database-1.0.1.zip&quot;</span>
<a id="__codelineno-0-381" name="__codelineno-0-381"></a>        <span class="p">)</span>
<a id="__codelineno-0-382" name="__codelineno-0-382"></a>        <span class="n">ds_zip_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ds_path</span><span class="p">,</span> <span class="s2">&quot;ludb.zip&quot;</span><span class="p">)</span>
<a id="__codelineno-0-383" name="__codelineno-0-383"></a>        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ds_path</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-384" name="__codelineno-0-384"></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">ds_zip_path</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">force</span><span class="p">:</span>
<a id="__codelineno-0-385" name="__codelineno-0-385"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
<a id="__codelineno-0-386" name="__codelineno-0-386"></a>                <span class="sa">f</span><span class="s2">&quot;Zip file already exists. Please delete or set `force` flag to redownload. PATH=</span><span class="si">{</span><span class="n">ds_zip_path</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-387" name="__codelineno-0-387"></a>            <span class="p">)</span>
<a id="__codelineno-0-388" name="__codelineno-0-388"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-389" name="__codelineno-0-389"></a>            <span class="n">download_file</span><span class="p">(</span><span class="n">ds_url</span><span class="p">,</span> <span class="n">ds_zip_path</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-390" name="__codelineno-0-390"></a>
<a id="__codelineno-0-391" name="__codelineno-0-391"></a>        <span class="c1"># 2. Extract and convert patient ECG data to H5 files</span>
<a id="__codelineno-0-392" name="__codelineno-0-392"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Generating LUDB patient data&quot;</span><span class="p">)</span>
<a id="__codelineno-0-393" name="__codelineno-0-393"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">convert_dataset_zip_to_hdf5</span><span class="p">(</span><span class="n">zip_path</span><span class="o">=</span><span class="n">ds_zip_path</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="n">force</span><span class="p">,</span> <span class="n">num_workers</span><span class="o">=</span><span class="n">num_workers</span><span class="p">)</span>
<a id="__codelineno-0-394" name="__codelineno-0-394"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Finished LUDB patient data&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h4 id="heartkit.datasets.ludb.LudbDataset.mean" class="doc doc-heading">
<code class="highlight language-python"><span class="n">mean</span><span class="p">:</span> <span class="nb">float</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h4>


  <div class="doc doc-contents ">
  
      <p>Dataset mean</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="heartkit.datasets.ludb.LudbDataset.patient_ids" class="doc doc-heading">
<code class="highlight language-python"><span class="n">patient_ids</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h4>


  <div class="doc doc-contents ">
  
      <p>Get dataset patient IDs</p>

  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code><a class="autorefs autorefs-external" title="numpy" href="https://numpy.org/doc/stable/reference/index.html#module-numpy">npt</a>.<span title="numpy.NDArray">NDArray</span></code>
        – <p>npt.NDArray: patient IDs</p>
      </li>
  </ul>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="heartkit.datasets.ludb.LudbDataset.sampling_rate" class="doc doc-heading">
<code class="highlight language-python"><span class="n">sampling_rate</span><span class="p">:</span> <span class="nb">int</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h4>


  <div class="doc doc-contents ">
  
      <p>Sampling rate in Hz</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="heartkit.datasets.ludb.LudbDataset.std" class="doc doc-heading">
<code class="highlight language-python"><span class="n">std</span><span class="p">:</span> <span class="nb">float</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h4>


  <div class="doc doc-contents ">
  
      <p>Dataset st dev</p>
  </div>

</div>



<div class="doc doc-object doc-function">



<h4 id="heartkit.datasets.ludb.LudbDataset.convert_dataset_zip_to_hdf5" class="doc doc-heading">
<code class="highlight language-python"><span class="n">convert_dataset_zip_to_hdf5</span><span class="p">(</span><span class="n">zip_path</span><span class="p">,</span> <span class="n">patient_ids</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">num_workers</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Convert dataset into individial patient HDF5 files.</p>

  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b>zip_path</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code>)
        – <p>Zip path</p>
      </li>
      <li class="field-body">
        <b>patient_ids</b>
            (<code><a class="autorefs autorefs-external" title="numpy" href="https://numpy.org/doc/stable/reference/index.html#module-numpy">npt</a>.<span title="numpy.NDArray">NDArray</span> | None</code>)
        – <p>List of patient IDs to extract. Defaults to all.</p>
      </li>
      <li class="field-body">
        <b>force</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>)
        – <p>Whether to force re-download if destination exists. Defaults to False.</p>
      </li>
      <li class="field-body">
        <b>num_workers</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code>)
        – <h5 id="heartkit.datasets.ludb.LudbDataset.convert_dataset_zip_to_hdf5--parallel-workers-defaults-to-oscpu_count">parallel workers. Defaults to os.cpu_count().</h5>
      </li>
  </ul>

      <details class="quote">
        <summary>Source code in <code>heartkit/datasets/ludb.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-336">336</a></span>
<span class="normal"><a href="#__codelineno-0-337">337</a></span>
<span class="normal"><a href="#__codelineno-0-338">338</a></span>
<span class="normal"><a href="#__codelineno-0-339">339</a></span>
<span class="normal"><a href="#__codelineno-0-340">340</a></span>
<span class="normal"><a href="#__codelineno-0-341">341</a></span>
<span class="normal"><a href="#__codelineno-0-342">342</a></span>
<span class="normal"><a href="#__codelineno-0-343">343</a></span>
<span class="normal"><a href="#__codelineno-0-344">344</a></span>
<span class="normal"><a href="#__codelineno-0-345">345</a></span>
<span class="normal"><a href="#__codelineno-0-346">346</a></span>
<span class="normal"><a href="#__codelineno-0-347">347</a></span>
<span class="normal"><a href="#__codelineno-0-348">348</a></span>
<span class="normal"><a href="#__codelineno-0-349">349</a></span>
<span class="normal"><a href="#__codelineno-0-350">350</a></span>
<span class="normal"><a href="#__codelineno-0-351">351</a></span>
<span class="normal"><a href="#__codelineno-0-352">352</a></span>
<span class="normal"><a href="#__codelineno-0-353">353</a></span>
<span class="normal"><a href="#__codelineno-0-354">354</a></span>
<span class="normal"><a href="#__codelineno-0-355">355</a></span>
<span class="normal"><a href="#__codelineno-0-356">356</a></span>
<span class="normal"><a href="#__codelineno-0-357">357</a></span>
<span class="normal"><a href="#__codelineno-0-358">358</a></span>
<span class="normal"><a href="#__codelineno-0-359">359</a></span>
<span class="normal"><a href="#__codelineno-0-360">360</a></span>
<span class="normal"><a href="#__codelineno-0-361">361</a></span>
<span class="normal"><a href="#__codelineno-0-362">362</a></span>
<span class="normal"><a href="#__codelineno-0-363">363</a></span>
<span class="normal"><a href="#__codelineno-0-364">364</a></span>
<span class="normal"><a href="#__codelineno-0-365">365</a></span>
<span class="normal"><a href="#__codelineno-0-366">366</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-336" name="__codelineno-0-336"></a><span class="k">def</span> <span class="nf">convert_dataset_zip_to_hdf5</span><span class="p">(</span>
<a id="__codelineno-0-337" name="__codelineno-0-337"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-338" name="__codelineno-0-338"></a>    <span class="n">zip_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-339" name="__codelineno-0-339"></a>    <span class="n">patient_ids</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-340" name="__codelineno-0-340"></a>    <span class="n">force</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-341" name="__codelineno-0-341"></a>    <span class="n">num_workers</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-342" name="__codelineno-0-342"></a><span class="p">):</span>
<a id="__codelineno-0-343" name="__codelineno-0-343"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert dataset into individial patient HDF5 files.</span>
<a id="__codelineno-0-344" name="__codelineno-0-344"></a>
<a id="__codelineno-0-345" name="__codelineno-0-345"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-346" name="__codelineno-0-346"></a><span class="sd">        zip_path (str): Zip path</span>
<a id="__codelineno-0-347" name="__codelineno-0-347"></a><span class="sd">        patient_ids (npt.NDArray | None, optional): List of patient IDs to extract. Defaults to all.</span>
<a id="__codelineno-0-348" name="__codelineno-0-348"></a><span class="sd">        force (bool, optional): Whether to force re-download if destination exists. Defaults to False.</span>
<a id="__codelineno-0-349" name="__codelineno-0-349"></a><span class="sd">        num_workers (int, optional): # parallel workers. Defaults to os.cpu_count().</span>
<a id="__codelineno-0-350" name="__codelineno-0-350"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-351" name="__codelineno-0-351"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">patient_ids</span><span class="p">:</span>
<a id="__codelineno-0-352" name="__codelineno-0-352"></a>        <span class="n">patient_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">patient_ids</span>
<a id="__codelineno-0-353" name="__codelineno-0-353"></a>
<a id="__codelineno-0-354" name="__codelineno-0-354"></a>    <span class="n">subdir</span> <span class="o">=</span> <span class="s2">&quot;lobachevsky-university-electrocardiography-database-1.0.1&quot;</span>
<a id="__codelineno-0-355" name="__codelineno-0-355"></a>    <span class="k">with</span> <span class="n">Pool</span><span class="p">(</span><span class="n">processes</span><span class="o">=</span><span class="n">num_workers</span><span class="p">)</span> <span class="k">as</span> <span class="n">pool</span><span class="p">,</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryDirectory</span><span class="p">()</span> <span class="k">as</span> <span class="n">tmpdir</span><span class="p">,</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span>
<a id="__codelineno-0-356" name="__codelineno-0-356"></a>        <span class="n">zip_path</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;r&quot;</span>
<a id="__codelineno-0-357" name="__codelineno-0-357"></a>    <span class="p">)</span> <span class="k">as</span> <span class="n">zp</span><span class="p">:</span>
<a id="__codelineno-0-358" name="__codelineno-0-358"></a>        <span class="n">ludb_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmpdir</span><span class="p">,</span> <span class="s2">&quot;ludb&quot;</span><span class="p">)</span>
<a id="__codelineno-0-359" name="__codelineno-0-359"></a>        <span class="n">zp</span><span class="o">.</span><span class="n">extractall</span><span class="p">(</span><span class="n">ludb_dir</span><span class="p">)</span>
<a id="__codelineno-0-360" name="__codelineno-0-360"></a>        <span class="n">f</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span>
<a id="__codelineno-0-361" name="__codelineno-0-361"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">convert_pt_wfdb_to_hdf5</span><span class="p">,</span>
<a id="__codelineno-0-362" name="__codelineno-0-362"></a>            <span class="n">src_path</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ludb_dir</span><span class="p">,</span> <span class="n">subdir</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">),</span>
<a id="__codelineno-0-363" name="__codelineno-0-363"></a>            <span class="n">dst_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ds_path</span><span class="p">,</span>
<a id="__codelineno-0-364" name="__codelineno-0-364"></a>            <span class="n">force</span><span class="o">=</span><span class="n">force</span><span class="p">,</span>
<a id="__codelineno-0-365" name="__codelineno-0-365"></a>        <span class="p">)</span>
<a id="__codelineno-0-366" name="__codelineno-0-366"></a>        <span class="n">_</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">tqdm</span><span class="p">(</span><span class="n">pool</span><span class="o">.</span><span class="n">imap</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">patient_ids</span><span class="p">),</span> <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">patient_ids</span><span class="p">)))</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="heartkit.datasets.ludb.LudbDataset.convert_pt_wfdb_to_hdf5" class="doc doc-heading">
<code class="highlight language-python"><span class="n">convert_pt_wfdb_to_hdf5</span><span class="p">(</span><span class="n">patient</span><span class="p">,</span> <span class="n">src_path</span><span class="p">,</span> <span class="n">dst_path</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Convert LUDB patient data from WFDB to more consumable HDF5 format.</p>

  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b>patient</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code>)
        – <p>Patient id (1-based)</p>
      </li>
      <li class="field-body">
        <b>src_path</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code>)
        – <p>Source path to WFDB folder</p>
      </li>
      <li class="field-body">
        <b>dst_path</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code>)
        – <p>Destination path to store HDF5 file</p>
      </li>
  </ul>

  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#tuple">tuple</a>[<a class="autorefs autorefs-external" title="numpy" href="https://numpy.org/doc/stable/reference/index.html#module-numpy">npt</a>.<span title="numpy.NDArray">NDArray</span>, <a class="autorefs autorefs-external" title="numpy" href="https://numpy.org/doc/stable/reference/index.html#module-numpy">npt</a>.<span title="numpy.NDArray">NDArray</span>, <a class="autorefs autorefs-external" title="numpy" href="https://numpy.org/doc/stable/reference/index.html#module-numpy">npt</a>.<span title="numpy.NDArray">NDArray</span>]</code>
        – <p>tuple[npt.NDArray, npt.NDArray, npt.NDArray]: data, segments, and fiducials</p>
      </li>
  </ul>

      <details class="quote">
        <summary>Source code in <code>heartkit/datasets/ludb.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span>
<span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span>
<span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span>
<span class="normal"><a href="#__codelineno-0-309">309</a></span>
<span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span>
<span class="normal"><a href="#__codelineno-0-316">316</a></span>
<span class="normal"><a href="#__codelineno-0-317">317</a></span>
<span class="normal"><a href="#__codelineno-0-318">318</a></span>
<span class="normal"><a href="#__codelineno-0-319">319</a></span>
<span class="normal"><a href="#__codelineno-0-320">320</a></span>
<span class="normal"><a href="#__codelineno-0-321">321</a></span>
<span class="normal"><a href="#__codelineno-0-322">322</a></span>
<span class="normal"><a href="#__codelineno-0-323">323</a></span>
<span class="normal"><a href="#__codelineno-0-324">324</a></span>
<span class="normal"><a href="#__codelineno-0-325">325</a></span>
<span class="normal"><a href="#__codelineno-0-326">326</a></span>
<span class="normal"><a href="#__codelineno-0-327">327</a></span>
<span class="normal"><a href="#__codelineno-0-328">328</a></span>
<span class="normal"><a href="#__codelineno-0-329">329</a></span>
<span class="normal"><a href="#__codelineno-0-330">330</a></span>
<span class="normal"><a href="#__codelineno-0-331">331</a></span>
<span class="normal"><a href="#__codelineno-0-332">332</a></span>
<span class="normal"><a href="#__codelineno-0-333">333</a></span>
<span class="normal"><a href="#__codelineno-0-334">334</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-275" name="__codelineno-0-275"></a><span class="k">def</span> <span class="nf">convert_pt_wfdb_to_hdf5</span><span class="p">(</span>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a>    <span class="bp">self</span><span class="p">,</span> <span class="n">patient</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">src_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">dst_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">force</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-277" name="__codelineno-0-277"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">,</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">,</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">]:</span>
<a id="__codelineno-0-278" name="__codelineno-0-278"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert LUDB patient data from WFDB to more consumable HDF5 format.</span>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a><span class="sd">        patient (int): Patient id (1-based)</span>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a><span class="sd">        src_path (str): Source path to WFDB folder</span>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a><span class="sd">        dst_path (str): Destination path to store HDF5 file</span>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a><span class="sd">        tuple[npt.NDArray, npt.NDArray, npt.NDArray]: data, segments, and fiducials</span>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a>    <span class="kn">import</span> <span class="nn">wfdb</span>  <span class="c1"># pylint: disable=import-outside-toplevel</span>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a>    <span class="n">pt_id</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;p</span><span class="si">{</span><span class="n">patient</span><span class="si">:</span><span class="s2">05d</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a>    <span class="n">pt_src_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">src_path</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">patient</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a>    <span class="n">rec</span> <span class="o">=</span> <span class="n">wfdb</span><span class="o">.</span><span class="n">rdrecord</span><span class="p">(</span><span class="n">pt_src_path</span><span class="p">)</span>
<a id="__codelineno-0-293" name="__codelineno-0-293"></a>    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">p_signal</span><span class="p">)</span>
<a id="__codelineno-0-294" name="__codelineno-0-294"></a>    <span class="n">segs</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-295" name="__codelineno-0-295"></a>    <span class="n">fids</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-296" name="__codelineno-0-296"></a>    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">lead</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">sig_name</span><span class="p">):</span>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a>        <span class="n">lead_id</span> <span class="o">=</span> <span class="n">LudbLeadsMap</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">lead</span><span class="p">)</span>
<a id="__codelineno-0-298" name="__codelineno-0-298"></a>        <span class="n">ann</span> <span class="o">=</span> <span class="n">wfdb</span><span class="o">.</span><span class="n">rdann</span><span class="p">(</span><span class="n">pt_src_path</span><span class="p">,</span> <span class="n">extension</span><span class="o">=</span><span class="n">lead</span><span class="p">)</span>
<a id="__codelineno-0-299" name="__codelineno-0-299"></a>        <span class="n">seg_start</span> <span class="o">=</span> <span class="n">seg_stop</span> <span class="o">=</span> <span class="n">sym_id</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-300" name="__codelineno-0-300"></a>        <span class="n">data</span><span class="p">[:,</span> <span class="n">lead_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">rec</span><span class="o">.</span><span class="n">p_signal</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a>        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">symbol</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ann</span><span class="o">.</span><span class="n">symbol</span><span class="p">):</span>
<a id="__codelineno-0-302" name="__codelineno-0-302"></a>            <span class="c1"># Start of segment</span>
<a id="__codelineno-0-303" name="__codelineno-0-303"></a>            <span class="k">if</span> <span class="n">symbol</span> <span class="o">==</span> <span class="s2">&quot;(&quot;</span><span class="p">:</span>
<a id="__codelineno-0-304" name="__codelineno-0-304"></a>                <span class="n">seg_start</span> <span class="o">=</span> <span class="n">ann</span><span class="o">.</span><span class="n">sample</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
<a id="__codelineno-0-305" name="__codelineno-0-305"></a>                <span class="n">seg_stop</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-306" name="__codelineno-0-306"></a>            <span class="c1"># Fiducial / segment type</span>
<a id="__codelineno-0-307" name="__codelineno-0-307"></a>            <span class="k">elif</span> <span class="n">symbol</span> <span class="ow">in</span> <span class="n">LudbSymbolMap</span><span class="p">:</span>
<a id="__codelineno-0-308" name="__codelineno-0-308"></a>                <span class="n">sym_id</span> <span class="o">=</span> <span class="n">LudbSymbolMap</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">symbol</span><span class="p">)</span>
<a id="__codelineno-0-309" name="__codelineno-0-309"></a>                <span class="k">if</span> <span class="n">seg_start</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-310" name="__codelineno-0-310"></a>                    <span class="n">seg_start</span> <span class="o">=</span> <span class="n">ann</span><span class="o">.</span><span class="n">sample</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
<a id="__codelineno-0-311" name="__codelineno-0-311"></a>                <span class="n">fids</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">lead_id</span><span class="p">,</span> <span class="n">sym_id</span><span class="p">,</span> <span class="n">ann</span><span class="o">.</span><span class="n">sample</span><span class="p">[</span><span class="n">j</span><span class="p">]])</span>
<a id="__codelineno-0-312" name="__codelineno-0-312"></a>            <span class="c1"># End of segment (start and symbol are never 0 but can be None)</span>
<a id="__codelineno-0-313" name="__codelineno-0-313"></a>            <span class="k">elif</span> <span class="n">symbol</span> <span class="o">==</span> <span class="s2">&quot;)&quot;</span> <span class="ow">and</span> <span class="n">seg_start</span> <span class="ow">and</span> <span class="n">sym_id</span><span class="p">:</span>
<a id="__codelineno-0-314" name="__codelineno-0-314"></a>                <span class="n">seg_stop</span> <span class="o">=</span> <span class="n">ann</span><span class="o">.</span><span class="n">sample</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
<a id="__codelineno-0-315" name="__codelineno-0-315"></a>                <span class="n">segs</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">lead_id</span><span class="p">,</span> <span class="n">sym_id</span><span class="p">,</span> <span class="n">seg_start</span><span class="p">,</span> <span class="n">seg_stop</span><span class="p">])</span>
<a id="__codelineno-0-316" name="__codelineno-0-316"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-317" name="__codelineno-0-317"></a>                <span class="n">seg_start</span> <span class="o">=</span> <span class="n">seg_stop</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-318" name="__codelineno-0-318"></a>                <span class="n">sym_id</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-319" name="__codelineno-0-319"></a>        <span class="c1"># END FOR</span>
<a id="__codelineno-0-320" name="__codelineno-0-320"></a>    <span class="c1"># END FOR</span>
<a id="__codelineno-0-321" name="__codelineno-0-321"></a>    <span class="n">segs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">segs</span><span class="p">)</span>
<a id="__codelineno-0-322" name="__codelineno-0-322"></a>    <span class="n">fids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">fids</span><span class="p">)</span>
<a id="__codelineno-0-323" name="__codelineno-0-323"></a>
<a id="__codelineno-0-324" name="__codelineno-0-324"></a>    <span class="k">if</span> <span class="n">dst_path</span><span class="p">:</span>
<a id="__codelineno-0-325" name="__codelineno-0-325"></a>        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">dst_path</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-326" name="__codelineno-0-326"></a>        <span class="n">pt_dst_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dst_path</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pt_id</span><span class="si">}</span><span class="s2">.h5&quot;</span><span class="p">)</span>
<a id="__codelineno-0-327" name="__codelineno-0-327"></a>        <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">pt_dst_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">h5</span><span class="p">:</span>
<a id="__codelineno-0-328" name="__codelineno-0-328"></a>            <span class="n">h5</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="s2">&quot;gzip&quot;</span><span class="p">)</span>
<a id="__codelineno-0-329" name="__codelineno-0-329"></a>            <span class="n">h5</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;segmentations&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">segs</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="s2">&quot;gzip&quot;</span><span class="p">)</span>
<a id="__codelineno-0-330" name="__codelineno-0-330"></a>            <span class="n">h5</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;fiducials&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">fids</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="s2">&quot;gzip&quot;</span><span class="p">)</span>
<a id="__codelineno-0-331" name="__codelineno-0-331"></a>        <span class="c1"># END WITH</span>
<a id="__codelineno-0-332" name="__codelineno-0-332"></a>    <span class="c1"># END IF</span>
<a id="__codelineno-0-333" name="__codelineno-0-333"></a>
<a id="__codelineno-0-334" name="__codelineno-0-334"></a>    <span class="k">return</span> <span class="n">data</span><span class="p">,</span> <span class="n">segs</span><span class="p">,</span> <span class="n">fids</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="heartkit.datasets.ludb.LudbDataset.download" class="doc doc-heading">
<code class="highlight language-python"><span class="n">download</span><span class="p">(</span><span class="n">num_workers</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Download LUDB dataset</p>

  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b>num_workers</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a> | None</code>)
        – <h5 id="heartkit.datasets.ludb.LudbDataset.download--parallel-workers-defaults-to-none">parallel workers. Defaults to None.</h5>
      </li>
      <li class="field-body">
        <b>force</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>)
        – <p>Force redownload. Defaults to False.</p>
      </li>
  </ul>

      <details class="quote">
        <summary>Source code in <code>heartkit/datasets/ludb.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-369">369</a></span>
<span class="normal"><a href="#__codelineno-0-370">370</a></span>
<span class="normal"><a href="#__codelineno-0-371">371</a></span>
<span class="normal"><a href="#__codelineno-0-372">372</a></span>
<span class="normal"><a href="#__codelineno-0-373">373</a></span>
<span class="normal"><a href="#__codelineno-0-374">374</a></span>
<span class="normal"><a href="#__codelineno-0-375">375</a></span>
<span class="normal"><a href="#__codelineno-0-376">376</a></span>
<span class="normal"><a href="#__codelineno-0-377">377</a></span>
<span class="normal"><a href="#__codelineno-0-378">378</a></span>
<span class="normal"><a href="#__codelineno-0-379">379</a></span>
<span class="normal"><a href="#__codelineno-0-380">380</a></span>
<span class="normal"><a href="#__codelineno-0-381">381</a></span>
<span class="normal"><a href="#__codelineno-0-382">382</a></span>
<span class="normal"><a href="#__codelineno-0-383">383</a></span>
<span class="normal"><a href="#__codelineno-0-384">384</a></span>
<span class="normal"><a href="#__codelineno-0-385">385</a></span>
<span class="normal"><a href="#__codelineno-0-386">386</a></span>
<span class="normal"><a href="#__codelineno-0-387">387</a></span>
<span class="normal"><a href="#__codelineno-0-388">388</a></span>
<span class="normal"><a href="#__codelineno-0-389">389</a></span>
<span class="normal"><a href="#__codelineno-0-390">390</a></span>
<span class="normal"><a href="#__codelineno-0-391">391</a></span>
<span class="normal"><a href="#__codelineno-0-392">392</a></span>
<span class="normal"><a href="#__codelineno-0-393">393</a></span>
<span class="normal"><a href="#__codelineno-0-394">394</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-369" name="__codelineno-0-369"></a><span class="k">def</span> <span class="nf">download</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_workers</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">force</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<a id="__codelineno-0-370" name="__codelineno-0-370"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Download LUDB dataset</span>
<a id="__codelineno-0-371" name="__codelineno-0-371"></a>
<a id="__codelineno-0-372" name="__codelineno-0-372"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-373" name="__codelineno-0-373"></a><span class="sd">        num_workers (int | None, optional): # parallel workers. Defaults to None.</span>
<a id="__codelineno-0-374" name="__codelineno-0-374"></a><span class="sd">        force (bool, optional): Force redownload. Defaults to False.</span>
<a id="__codelineno-0-375" name="__codelineno-0-375"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-376" name="__codelineno-0-376"></a>
<a id="__codelineno-0-377" name="__codelineno-0-377"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Downloading LUDB dataset&quot;</span><span class="p">)</span>
<a id="__codelineno-0-378" name="__codelineno-0-378"></a>    <span class="n">ds_url</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-379" name="__codelineno-0-379"></a>        <span class="s2">&quot;https://physionet.org/static/published-projects/ludb/&quot;</span>
<a id="__codelineno-0-380" name="__codelineno-0-380"></a>        <span class="s2">&quot;lobachevsky-university-electrocardiography-database-1.0.1.zip&quot;</span>
<a id="__codelineno-0-381" name="__codelineno-0-381"></a>    <span class="p">)</span>
<a id="__codelineno-0-382" name="__codelineno-0-382"></a>    <span class="n">ds_zip_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ds_path</span><span class="p">,</span> <span class="s2">&quot;ludb.zip&quot;</span><span class="p">)</span>
<a id="__codelineno-0-383" name="__codelineno-0-383"></a>    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ds_path</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-384" name="__codelineno-0-384"></a>    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">ds_zip_path</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">force</span><span class="p">:</span>
<a id="__codelineno-0-385" name="__codelineno-0-385"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
<a id="__codelineno-0-386" name="__codelineno-0-386"></a>            <span class="sa">f</span><span class="s2">&quot;Zip file already exists. Please delete or set `force` flag to redownload. PATH=</span><span class="si">{</span><span class="n">ds_zip_path</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-387" name="__codelineno-0-387"></a>        <span class="p">)</span>
<a id="__codelineno-0-388" name="__codelineno-0-388"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-389" name="__codelineno-0-389"></a>        <span class="n">download_file</span><span class="p">(</span><span class="n">ds_url</span><span class="p">,</span> <span class="n">ds_zip_path</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-390" name="__codelineno-0-390"></a>
<a id="__codelineno-0-391" name="__codelineno-0-391"></a>    <span class="c1"># 2. Extract and convert patient ECG data to H5 files</span>
<a id="__codelineno-0-392" name="__codelineno-0-392"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Generating LUDB patient data&quot;</span><span class="p">)</span>
<a id="__codelineno-0-393" name="__codelineno-0-393"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">convert_dataset_zip_to_hdf5</span><span class="p">(</span><span class="n">zip_path</span><span class="o">=</span><span class="n">ds_zip_path</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="n">force</span><span class="p">,</span> <span class="n">num_workers</span><span class="o">=</span><span class="n">num_workers</span><span class="p">)</span>
<a id="__codelineno-0-394" name="__codelineno-0-394"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Finished LUDB patient data&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="heartkit.datasets.ludb.LudbDataset.get_patient_data_segments" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_patient_data_segments</span><span class="p">(</span><span class="n">patient</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Get patient's entire data and segments</p>

  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b>patient</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code>)
        – <p>Patient ID (1-based)</p>
      </li>
  </ul>

  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#tuple">tuple</a>[<a class="autorefs autorefs-external" title="numpy" href="https://numpy.org/doc/stable/reference/index.html#module-numpy">npt</a>.<span title="numpy.NDArray">NDArray</span>, <a class="autorefs autorefs-external" title="numpy" href="https://numpy.org/doc/stable/reference/index.html#module-numpy">npt</a>.<span title="numpy.NDArray">NDArray</span>]</code>
        – <p>tuple[npt.NDArray, npt.NDArray]: (data, segment labels)</p>
      </li>
  </ul>

      <details class="quote">
        <summary>Source code in <code>heartkit/datasets/ludb.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-224" name="__codelineno-0-224"></a><span class="k">def</span> <span class="nf">get_patient_data_segments</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">patient</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">,</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">]:</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get patient&#39;s entire data and segments</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a><span class="sd">        patient (int): Patient ID (1-based)</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a><span class="sd">        tuple[npt.NDArray, npt.NDArray]: (data, segment labels)</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a>    <span class="n">pt_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;p</span><span class="si">{</span><span class="n">patient</span><span class="si">:</span><span class="s2">05d</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a>    <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ds_path</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pt_key</span><span class="si">}</span><span class="s2">.h5&quot;</span><span class="p">),</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">pt</span><span class="p">:</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a>        <span class="n">data</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span> <span class="o">=</span> <span class="n">pt</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][:]</span>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a>        <span class="n">segs</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span> <span class="o">=</span> <span class="n">pt</span><span class="p">[</span><span class="s2">&quot;segmentations&quot;</span><span class="p">][:]</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a>    <span class="n">labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a>    <span class="k">for</span> <span class="n">seg_idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">segs</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>  <span class="c1"># pylint: disable=no-member</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a>        <span class="n">seg</span> <span class="o">=</span> <span class="n">segs</span><span class="p">[</span><span class="n">seg_idx</span><span class="p">]</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a>        <span class="n">labels</span><span class="p">[</span><span class="n">seg</span><span class="p">[</span><span class="n">SEG_BEG_IDX</span><span class="p">]</span> <span class="p">:</span> <span class="n">seg</span><span class="p">[</span><span class="n">SEG_END_IDX</span><span class="p">]</span> <span class="o">+</span> <span class="mi">0</span><span class="p">,</span> <span class="n">seg</span><span class="p">[</span><span class="n">SEG_LEAD_IDX</span><span class="p">]]</span> <span class="o">=</span> <span class="n">seg</span><span class="p">[</span><span class="n">SEG_LBL_IDX</span><span class="p">]</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a>    <span class="c1"># END FOR</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a>    <span class="k">return</span> <span class="n">data</span><span class="p">,</span> <span class="n">labels</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="heartkit.datasets.ludb.LudbDataset.get_test_patient_ids" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_test_patient_ids</span><span class="p">()</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Get dataset patient IDs reserved for testing only</p>

  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code><a class="autorefs autorefs-external" title="numpy" href="https://numpy.org/doc/stable/reference/index.html#module-numpy">npt</a>.<span title="numpy.NDArray">NDArray</span></code>
        – <p>npt.NDArray: patient IDs</p>
      </li>
  </ul>

      <details class="quote">
        <summary>Source code in <code>heartkit/datasets/ludb.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-95" name="__codelineno-0-95"></a><span class="k">def</span> <span class="nf">get_test_patient_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">:</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get dataset patient IDs reserved for testing only</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a><span class="sd">        npt.NDArray: patient IDs</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">patient_ids</span><span class="p">[</span><span class="mi">180</span><span class="p">:]</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="heartkit.datasets.ludb.LudbDataset.get_train_patient_ids" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_train_patient_ids</span><span class="p">()</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Get dataset training patient IDs</p>

  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code><a class="autorefs autorefs-external" title="numpy" href="https://numpy.org/doc/stable/reference/index.html#module-numpy">npt</a>.<span title="numpy.NDArray">NDArray</span></code>
        – <p>npt.NDArray: patient IDs</p>
      </li>
  </ul>

      <details class="quote">
        <summary>Source code in <code>heartkit/datasets/ludb.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-87">87</a></span>
<span class="normal"><a href="#__codelineno-0-88">88</a></span>
<span class="normal"><a href="#__codelineno-0-89">89</a></span>
<span class="normal"><a href="#__codelineno-0-90">90</a></span>
<span class="normal"><a href="#__codelineno-0-91">91</a></span>
<span class="normal"><a href="#__codelineno-0-92">92</a></span>
<span class="normal"><a href="#__codelineno-0-93">93</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-87" name="__codelineno-0-87"></a><span class="k">def</span> <span class="nf">get_train_patient_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">:</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get dataset training patient IDs</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a><span class="sd">        npt.NDArray: patient IDs</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">patient_ids</span><span class="p">[:</span><span class="mi">180</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="heartkit.datasets.ludb.LudbDataset.segmentation_generator" class="doc doc-heading">
<code class="highlight language-python"><span class="n">segmentation_generator</span><span class="p">(</span><span class="n">patient_generator</span><span class="p">,</span> <span class="n">samples_per_patient</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Generate frames and segment labels.</p>

  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b>patient_generator</b>
            (<code><span title="heartkit.datasets.defines.PatientGenerator">PatientGenerator</span></code>)
        – <p>Patient Generator</p>
      </li>
      <li class="field-body">
        <b>samples_per_patient</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a> | <a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#list">list</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a>]</code>)
        – <h5 id="heartkit.datasets.ludb.LudbDataset.segmentation_generator--samples-per-patient-defaults-to-1">samples per patient. Defaults to 1.</h5>
      </li>
  </ul>

  <p>Returns:</p>
  <ul>
      <li class="field-body">
<b>SampleGenerator</b>(            <code><span title="heartkit.datasets.defines.SampleGenerator">SampleGenerator</span></code>
)        – <p>Sample generator</p>
      </li>
  </ul>

  <p>Yields:</p>
  <ul>
      <li class="field-body">
            <code><span title="heartkit.datasets.defines.SampleGenerator">SampleGenerator</span></code>
        – <p>Iterator[SampleGenerator]</p>
      </li>
  </ul>

      <details class="quote">
        <summary>Source code in <code>heartkit/datasets/ludb.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-124" name="__codelineno-0-124"></a><span class="k">def</span> <span class="nf">segmentation_generator</span><span class="p">(</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>    <span class="n">patient_generator</span><span class="p">:</span> <span class="n">PatientGenerator</span><span class="p">,</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>    <span class="n">samples_per_patient</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SampleGenerator</span><span class="p">:</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate frames and segment labels.</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a><span class="sd">        patient_generator (PatientGenerator): Patient Generator</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a><span class="sd">        samples_per_patient (int | list[int], optional): # samples per patient. Defaults to 1.</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a><span class="sd">        SampleGenerator: Sample generator</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a><span class="sd">    Yields:</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a><span class="sd">        Iterator[SampleGenerator]</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>    <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">pt</span> <span class="ow">in</span> <span class="n">patient_generator</span><span class="p">:</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>        <span class="c1"># NOTE: [:] will load all data into RAM- ideal for small dataset</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">pt</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][:]</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>        <span class="n">segs</span> <span class="o">=</span> <span class="n">pt</span><span class="p">[</span><span class="s2">&quot;segmentations&quot;</span><span class="p">][:]</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>        <span class="n">fids</span> <span class="o">=</span> <span class="n">pt</span><span class="p">[</span><span class="s2">&quot;fiducials&quot;</span><span class="p">][:]</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampling_rate</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_rate</span><span class="p">:</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a>            <span class="n">ratio</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_rate</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampling_rate</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>            <span class="n">data</span> <span class="o">=</span> <span class="n">resample_signal</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampling_rate</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_rate</span><span class="p">)</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>            <span class="n">segs</span><span class="p">[:,</span> <span class="p">(</span><span class="n">SEG_BEG_IDX</span><span class="p">,</span> <span class="n">SEG_END_IDX</span><span class="p">)]</span> <span class="o">=</span> <span class="n">segs</span><span class="p">[:,</span> <span class="p">(</span><span class="n">SEG_BEG_IDX</span><span class="p">,</span> <span class="n">SEG_END_IDX</span><span class="p">)]</span> <span class="o">*</span> <span class="n">ratio</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>            <span class="n">fids</span><span class="p">[:,</span> <span class="n">FID_LOC_IDX</span><span class="p">]</span> <span class="o">=</span> <span class="n">fids</span><span class="p">[:,</span> <span class="n">FID_LOC_IDX</span><span class="p">]</span> <span class="o">*</span> <span class="n">ratio</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>        <span class="c1"># END IF</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a>        <span class="c1"># Create segmentation mask</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>        <span class="n">labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>        <span class="k">for</span> <span class="n">seg_idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">segs</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>            <span class="n">seg</span> <span class="o">=</span> <span class="n">segs</span><span class="p">[</span><span class="n">seg_idx</span><span class="p">]</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>            <span class="n">labels</span><span class="p">[</span><span class="n">seg</span><span class="p">[</span><span class="n">SEG_BEG_IDX</span><span class="p">]</span> <span class="p">:</span> <span class="n">seg</span><span class="p">[</span><span class="n">SEG_END_IDX</span><span class="p">],</span> <span class="n">seg</span><span class="p">[</span><span class="n">SEG_LEAD_IDX</span><span class="p">]]</span> <span class="o">=</span> <span class="n">seg</span><span class="p">[</span><span class="n">SEG_LBL_IDX</span><span class="p">]</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>        <span class="c1"># END FOR</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>        <span class="n">start_offset</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">segs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">SEG_BEG_IDX</span><span class="p">]</span> <span class="o">-</span> <span class="mi">100</span><span class="p">)</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>        <span class="n">stop_offset</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">segs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">SEG_END_IDX</span><span class="p">]</span> <span class="o">+</span> <span class="mi">100</span><span class="p">)</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a>        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">samples_per_patient</span><span class="p">):</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a>            <span class="c1"># Randomly pick an ECG lead</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>            <span class="n">lead_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>            <span class="c1"># Randomly select frame within the segment</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>            <span class="n">frame_start</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">start_offset</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_size</span> <span class="o">-</span> <span class="n">stop_offset</span><span class="p">)</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a>            <span class="n">frame_end</span> <span class="o">=</span> <span class="n">frame_start</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_size</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>            <span class="n">x</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">frame_start</span><span class="p">:</span><span class="n">frame_end</span><span class="p">,</span> <span class="n">lead_idx</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a>            <span class="n">y</span> <span class="o">=</span> <span class="n">labels</span><span class="p">[</span><span class="n">frame_start</span><span class="p">:</span><span class="n">frame_end</span><span class="p">,</span> <span class="n">lead_idx</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a>            <span class="k">yield</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="heartkit.datasets.ludb.LudbDataset.signal_generator" class="doc doc-heading">
<code class="highlight language-python"><span class="n">signal_generator</span><span class="p">(</span><span class="n">patient_generator</span><span class="p">,</span> <span class="n">samples_per_patient</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Generate frames using patient generator.
from the segments in patient data by placing a frame in a random location within one of the segments.</p>

  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b>patient_generator</b>
            (<code><span title="heartkit.datasets.defines.PatientGenerator">PatientGenerator</span></code>)
        – <p>Generator that yields a tuple of patient id and patient data.
    Patient data may contain only signals, since labels are not used.</p>
      </li>
      <li class="field-body">
        <b>samples_per_patient</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code>)
        – <p>Samples per patient.</p>
      </li>
  </ul>

  <p>Returns:</p>
  <ul>
      <li class="field-body">
<b>SampleGenerator</b>(            <code><span title="heartkit.datasets.defines.SampleGenerator">SampleGenerator</span></code>
)        – <p>Generator of input data of shape (frame_size, 1)</p>
      </li>
  </ul>

      <details class="quote">
        <summary>Source code in <code>heartkit/datasets/ludb.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-196" name="__codelineno-0-196"></a><span class="k">def</span> <span class="nf">signal_generator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">patient_generator</span><span class="p">:</span> <span class="n">PatientGenerator</span><span class="p">,</span> <span class="n">samples_per_patient</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SampleGenerator</span><span class="p">:</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a><span class="sd">    Generate frames using patient generator.</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a><span class="sd">    from the segments in patient data by placing a frame in a random location within one of the segments.</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a><span class="sd">        patient_generator (PatientGenerator): Generator that yields a tuple of patient id and patient data.</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a><span class="sd">                Patient data may contain only signals, since labels are not used.</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a><span class="sd">        samples_per_patient (int): Samples per patient.</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a><span class="sd">        SampleGenerator: Generator of input data of shape (frame_size, 1)</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a>    <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">pt</span> <span class="ow">in</span> <span class="n">patient_generator</span><span class="p">:</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">pt</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][:]</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampling_rate</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_rate</span><span class="p">:</span>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a>            <span class="n">data</span> <span class="o">=</span> <span class="n">resample_signal</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampling_rate</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_rate</span><span class="p">)</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a>        <span class="c1"># END IF</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a>        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">samples_per_patient</span><span class="p">):</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a>            <span class="n">lead_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a>            <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_size</span><span class="p">:</span>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a>                <span class="n">frame_start</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_size</span><span class="p">)</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a>                <span class="n">frame_start</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a>            <span class="n">frame_end</span> <span class="o">=</span> <span class="n">frame_start</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_size</span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a>            <span class="n">x</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">frame_start</span><span class="p">:</span><span class="n">frame_end</span><span class="p">,</span> <span class="n">lead_idx</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">frame_size</span><span class="p">,))</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a>            <span class="k">yield</span> <span class="n">x</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="heartkit.datasets.ludb.LudbDataset.task_data_generator" class="doc doc-heading">
<code class="highlight language-python"><span class="n">task_data_generator</span><span class="p">(</span><span class="n">patient_generator</span><span class="p">,</span> <span class="n">samples_per_patient</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Task-level data generator.</p>

  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b>patient_generator</b>
            (<code><span title="heartkit.datasets.defines.PatientGenerator">PatientGenerator</span></code>)
        – <p>Patient data generator</p>
      </li>
      <li class="field-body">
        <b>samples_per_patient</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a> | <a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#list">list</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a>]</code>)
        – <h5 id="heartkit.datasets.ludb.LudbDataset.task_data_generator--samples-per-patient-defaults-to-1">samples per patient. Defaults to 1.</h5>
      </li>
  </ul>

  <p>Returns:</p>
  <ul>
      <li class="field-body">
<b>SampleGenerator</b>(            <code><span title="heartkit.datasets.defines.SampleGenerator">SampleGenerator</span></code>
)        – <p>Sample data generator</p>
      </li>
  </ul>

      <details class="quote">
        <summary>Source code in <code>heartkit/datasets/ludb.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-103" name="__codelineno-0-103"></a><span class="k">def</span> <span class="nf">task_data_generator</span><span class="p">(</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>    <span class="n">patient_generator</span><span class="p">:</span> <span class="n">PatientGenerator</span><span class="p">,</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>    <span class="n">samples_per_patient</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SampleGenerator</span><span class="p">:</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Task-level data generator.</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a><span class="sd">        patient_generator (PatientGenerator): Patient data generator</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a><span class="sd">        samples_per_patient (int | list[int], optional): # samples per patient. Defaults to 1.</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a><span class="sd">        SampleGenerator: Sample data generator</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">task</span> <span class="o">==</span> <span class="n">HeartTask</span><span class="o">.</span><span class="n">segmentation</span><span class="p">:</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">segmentation_generator</span><span class="p">(</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>            <span class="n">patient_generator</span><span class="o">=</span><span class="n">patient_generator</span><span class="p">,</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>            <span class="n">samples_per_patient</span><span class="o">=</span><span class="n">samples_per_patient</span><span class="p">,</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>        <span class="p">)</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="heartkit.datasets.ludb.LudbDataset.uniform_patient_generator" class="doc doc-heading">
<code class="highlight language-python"><span class="n">uniform_patient_generator</span><span class="p">(</span><span class="n">patient_ids</span><span class="p">,</span> <span class="n">repeat</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Yield data for each patient in the array.</p>

  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b>patient_ids</b>
            (<code>pt.<span title="pt.ArrayLike">ArrayLike</span></code>)
        – <p>Array of patient ids</p>
      </li>
      <li class="field-body">
        <b>repeat</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>)
        – <p>Whether to repeat generator. Defaults to True.</p>
      </li>
      <li class="field-body">
        <b>shuffle</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>)
        – <p>Whether to shuffle patient ids.. Defaults to True.</p>
      </li>
  </ul>

  <p>Returns:</p>
  <ul>
      <li class="field-body">
<b>PatientGenerator</b>(            <code><span title="heartkit.datasets.defines.PatientGenerator">PatientGenerator</span></code>
)        – <p>Patient generator</p>
      </li>
  </ul>

  <p>Yields:</p>
  <ul>
      <li class="field-body">
            <code><span title="heartkit.datasets.defines.PatientGenerator">PatientGenerator</span></code>
        – <p>Iterator[PatientGenerator]</p>
      </li>
  </ul>

      <details class="quote">
        <summary>Source code in <code>heartkit/datasets/ludb.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-243" name="__codelineno-0-243"></a><span class="k">def</span> <span class="nf">uniform_patient_generator</span><span class="p">(</span>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a>    <span class="n">patient_ids</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">,</span>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a>    <span class="n">repeat</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a>    <span class="n">shuffle</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PatientGenerator</span><span class="p">:</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Yield data for each patient in the array.</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a><span class="sd">        patient_ids (pt.ArrayLike): Array of patient ids</span>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a><span class="sd">        repeat (bool, optional): Whether to repeat generator. Defaults to True.</span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a><span class="sd">        shuffle (bool, optional): Whether to shuffle patient ids.. Defaults to True.</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a><span class="sd">        PatientGenerator: Patient generator</span>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a><span class="sd">    Yields:</span>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a><span class="sd">        Iterator[PatientGenerator]</span>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a>    <span class="n">patient_ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">patient_ids</span><span class="p">)</span>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a>    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a>        <span class="k">if</span> <span class="n">shuffle</span><span class="p">:</span>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a>            <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">patient_ids</span><span class="p">)</span>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a>        <span class="k">for</span> <span class="n">patient_id</span> <span class="ow">in</span> <span class="n">patient_ids</span><span class="p">:</span>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a>            <span class="n">pt_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;p</span><span class="si">{</span><span class="n">patient_id</span><span class="si">:</span><span class="s2">05d</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a>            <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ds_path</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pt_key</span><span class="si">}</span><span class="s2">.h5&quot;</span><span class="p">),</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">h5</span><span class="p">:</span>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a>                <span class="k">yield</span> <span class="n">patient_id</span><span class="p">,</span> <span class="n">h5</span>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a>        <span class="c1"># END FOR</span>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">repeat</span><span class="p">:</span>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a>            <span class="k">break</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>




  </div>

  </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="heartkit.datasets.qtdb" class="doc doc-heading">
          <code>heartkit.datasets.qtdb</code>


</h2>

  <div class="doc doc-contents first">

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="heartkit.datasets.qtdb.QtdbDataset" class="doc doc-heading">
        <code>QtdbDataset</code>


</h3>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><span title="heartkit.datasets.dataset.HeartKitDataset">HeartKitDataset</span></code></p>

  
      <p>QT dataset</p>


        <details class="quote">
          <summary>Source code in <code>heartkit/datasets/qtdb.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-0-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-0-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-0-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-0-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-0-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-0-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-0-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-0-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-0-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-0-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-0-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-0-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-0-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-0-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-0-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-0-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-0-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-0-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-0-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-0-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-0-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-0-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-0-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span>
<span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span>
<span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span>
<span class="normal"><a href="#__codelineno-0-309">309</a></span>
<span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span>
<span class="normal"><a href="#__codelineno-0-316">316</a></span>
<span class="normal"><a href="#__codelineno-0-317">317</a></span>
<span class="normal"><a href="#__codelineno-0-318">318</a></span>
<span class="normal"><a href="#__codelineno-0-319">319</a></span>
<span class="normal"><a href="#__codelineno-0-320">320</a></span>
<span class="normal"><a href="#__codelineno-0-321">321</a></span>
<span class="normal"><a href="#__codelineno-0-322">322</a></span>
<span class="normal"><a href="#__codelineno-0-323">323</a></span>
<span class="normal"><a href="#__codelineno-0-324">324</a></span>
<span class="normal"><a href="#__codelineno-0-325">325</a></span>
<span class="normal"><a href="#__codelineno-0-326">326</a></span>
<span class="normal"><a href="#__codelineno-0-327">327</a></span>
<span class="normal"><a href="#__codelineno-0-328">328</a></span>
<span class="normal"><a href="#__codelineno-0-329">329</a></span>
<span class="normal"><a href="#__codelineno-0-330">330</a></span>
<span class="normal"><a href="#__codelineno-0-331">331</a></span>
<span class="normal"><a href="#__codelineno-0-332">332</a></span>
<span class="normal"><a href="#__codelineno-0-333">333</a></span>
<span class="normal"><a href="#__codelineno-0-334">334</a></span>
<span class="normal"><a href="#__codelineno-0-335">335</a></span>
<span class="normal"><a href="#__codelineno-0-336">336</a></span>
<span class="normal"><a href="#__codelineno-0-337">337</a></span>
<span class="normal"><a href="#__codelineno-0-338">338</a></span>
<span class="normal"><a href="#__codelineno-0-339">339</a></span>
<span class="normal"><a href="#__codelineno-0-340">340</a></span>
<span class="normal"><a href="#__codelineno-0-341">341</a></span>
<span class="normal"><a href="#__codelineno-0-342">342</a></span>
<span class="normal"><a href="#__codelineno-0-343">343</a></span>
<span class="normal"><a href="#__codelineno-0-344">344</a></span>
<span class="normal"><a href="#__codelineno-0-345">345</a></span>
<span class="normal"><a href="#__codelineno-0-346">346</a></span>
<span class="normal"><a href="#__codelineno-0-347">347</a></span>
<span class="normal"><a href="#__codelineno-0-348">348</a></span>
<span class="normal"><a href="#__codelineno-0-349">349</a></span>
<span class="normal"><a href="#__codelineno-0-350">350</a></span>
<span class="normal"><a href="#__codelineno-0-351">351</a></span>
<span class="normal"><a href="#__codelineno-0-352">352</a></span>
<span class="normal"><a href="#__codelineno-0-353">353</a></span>
<span class="normal"><a href="#__codelineno-0-354">354</a></span>
<span class="normal"><a href="#__codelineno-0-355">355</a></span>
<span class="normal"><a href="#__codelineno-0-356">356</a></span>
<span class="normal"><a href="#__codelineno-0-357">357</a></span>
<span class="normal"><a href="#__codelineno-0-358">358</a></span>
<span class="normal"><a href="#__codelineno-0-359">359</a></span>
<span class="normal"><a href="#__codelineno-0-360">360</a></span>
<span class="normal"><a href="#__codelineno-0-361">361</a></span>
<span class="normal"><a href="#__codelineno-0-362">362</a></span>
<span class="normal"><a href="#__codelineno-0-363">363</a></span>
<span class="normal"><a href="#__codelineno-0-364">364</a></span>
<span class="normal"><a href="#__codelineno-0-365">365</a></span>
<span class="normal"><a href="#__codelineno-0-366">366</a></span>
<span class="normal"><a href="#__codelineno-0-367">367</a></span>
<span class="normal"><a href="#__codelineno-0-368">368</a></span>
<span class="normal"><a href="#__codelineno-0-369">369</a></span>
<span class="normal"><a href="#__codelineno-0-370">370</a></span>
<span class="normal"><a href="#__codelineno-0-371">371</a></span>
<span class="normal"><a href="#__codelineno-0-372">372</a></span>
<span class="normal"><a href="#__codelineno-0-373">373</a></span>
<span class="normal"><a href="#__codelineno-0-374">374</a></span>
<span class="normal"><a href="#__codelineno-0-375">375</a></span>
<span class="normal"><a href="#__codelineno-0-376">376</a></span>
<span class="normal"><a href="#__codelineno-0-377">377</a></span>
<span class="normal"><a href="#__codelineno-0-378">378</a></span>
<span class="normal"><a href="#__codelineno-0-379">379</a></span>
<span class="normal"><a href="#__codelineno-0-380">380</a></span>
<span class="normal"><a href="#__codelineno-0-381">381</a></span>
<span class="normal"><a href="#__codelineno-0-382">382</a></span>
<span class="normal"><a href="#__codelineno-0-383">383</a></span>
<span class="normal"><a href="#__codelineno-0-384">384</a></span>
<span class="normal"><a href="#__codelineno-0-385">385</a></span>
<span class="normal"><a href="#__codelineno-0-386">386</a></span>
<span class="normal"><a href="#__codelineno-0-387">387</a></span>
<span class="normal"><a href="#__codelineno-0-388">388</a></span>
<span class="normal"><a href="#__codelineno-0-389">389</a></span>
<span class="normal"><a href="#__codelineno-0-390">390</a></span>
<span class="normal"><a href="#__codelineno-0-391">391</a></span>
<span class="normal"><a href="#__codelineno-0-392">392</a></span>
<span class="normal"><a href="#__codelineno-0-393">393</a></span>
<span class="normal"><a href="#__codelineno-0-394">394</a></span>
<span class="normal"><a href="#__codelineno-0-395">395</a></span>
<span class="normal"><a href="#__codelineno-0-396">396</a></span>
<span class="normal"><a href="#__codelineno-0-397">397</a></span>
<span class="normal"><a href="#__codelineno-0-398">398</a></span>
<span class="normal"><a href="#__codelineno-0-399">399</a></span>
<span class="normal"><a href="#__codelineno-0-400">400</a></span>
<span class="normal"><a href="#__codelineno-0-401">401</a></span>
<span class="normal"><a href="#__codelineno-0-402">402</a></span>
<span class="normal"><a href="#__codelineno-0-403">403</a></span>
<span class="normal"><a href="#__codelineno-0-404">404</a></span>
<span class="normal"><a href="#__codelineno-0-405">405</a></span>
<span class="normal"><a href="#__codelineno-0-406">406</a></span>
<span class="normal"><a href="#__codelineno-0-407">407</a></span>
<span class="normal"><a href="#__codelineno-0-408">408</a></span>
<span class="normal"><a href="#__codelineno-0-409">409</a></span>
<span class="normal"><a href="#__codelineno-0-410">410</a></span>
<span class="normal"><a href="#__codelineno-0-411">411</a></span>
<span class="normal"><a href="#__codelineno-0-412">412</a></span>
<span class="normal"><a href="#__codelineno-0-413">413</a></span>
<span class="normal"><a href="#__codelineno-0-414">414</a></span>
<span class="normal"><a href="#__codelineno-0-415">415</a></span>
<span class="normal"><a href="#__codelineno-0-416">416</a></span>
<span class="normal"><a href="#__codelineno-0-417">417</a></span>
<span class="normal"><a href="#__codelineno-0-418">418</a></span>
<span class="normal"><a href="#__codelineno-0-419">419</a></span>
<span class="normal"><a href="#__codelineno-0-420">420</a></span>
<span class="normal"><a href="#__codelineno-0-421">421</a></span>
<span class="normal"><a href="#__codelineno-0-422">422</a></span>
<span class="normal"><a href="#__codelineno-0-423">423</a></span>
<span class="normal"><a href="#__codelineno-0-424">424</a></span>
<span class="normal"><a href="#__codelineno-0-425">425</a></span>
<span class="normal"><a href="#__codelineno-0-426">426</a></span>
<span class="normal"><a href="#__codelineno-0-427">427</a></span>
<span class="normal"><a href="#__codelineno-0-428">428</a></span>
<span class="normal"><a href="#__codelineno-0-429">429</a></span>
<span class="normal"><a href="#__codelineno-0-430">430</a></span>
<span class="normal"><a href="#__codelineno-0-431">431</a></span>
<span class="normal"><a href="#__codelineno-0-432">432</a></span>
<span class="normal"><a href="#__codelineno-0-433">433</a></span>
<span class="normal"><a href="#__codelineno-0-434">434</a></span>
<span class="normal"><a href="#__codelineno-0-435">435</a></span>
<span class="normal"><a href="#__codelineno-0-436">436</a></span>
<span class="normal"><a href="#__codelineno-0-437">437</a></span>
<span class="normal"><a href="#__codelineno-0-438">438</a></span>
<span class="normal"><a href="#__codelineno-0-439">439</a></span>
<span class="normal"><a href="#__codelineno-0-440">440</a></span>
<span class="normal"><a href="#__codelineno-0-441">441</a></span>
<span class="normal"><a href="#__codelineno-0-442">442</a></span>
<span class="normal"><a href="#__codelineno-0-443">443</a></span>
<span class="normal"><a href="#__codelineno-0-444">444</a></span>
<span class="normal"><a href="#__codelineno-0-445">445</a></span>
<span class="normal"><a href="#__codelineno-0-446">446</a></span>
<span class="normal"><a href="#__codelineno-0-447">447</a></span>
<span class="normal"><a href="#__codelineno-0-448">448</a></span>
<span class="normal"><a href="#__codelineno-0-449">449</a></span>
<span class="normal"><a href="#__codelineno-0-450">450</a></span>
<span class="normal"><a href="#__codelineno-0-451">451</a></span>
<span class="normal"><a href="#__codelineno-0-452">452</a></span>
<span class="normal"><a href="#__codelineno-0-453">453</a></span>
<span class="normal"><a href="#__codelineno-0-454">454</a></span>
<span class="normal"><a href="#__codelineno-0-455">455</a></span>
<span class="normal"><a href="#__codelineno-0-456">456</a></span>
<span class="normal"><a href="#__codelineno-0-457">457</a></span>
<span class="normal"><a href="#__codelineno-0-458">458</a></span>
<span class="normal"><a href="#__codelineno-0-459">459</a></span>
<span class="normal"><a href="#__codelineno-0-460">460</a></span>
<span class="normal"><a href="#__codelineno-0-461">461</a></span>
<span class="normal"><a href="#__codelineno-0-462">462</a></span>
<span class="normal"><a href="#__codelineno-0-463">463</a></span>
<span class="normal"><a href="#__codelineno-0-464">464</a></span>
<span class="normal"><a href="#__codelineno-0-465">465</a></span>
<span class="normal"><a href="#__codelineno-0-466">466</a></span>
<span class="normal"><a href="#__codelineno-0-467">467</a></span>
<span class="normal"><a href="#__codelineno-0-468">468</a></span>
<span class="normal"><a href="#__codelineno-0-469">469</a></span>
<span class="normal"><a href="#__codelineno-0-470">470</a></span>
<span class="normal"><a href="#__codelineno-0-471">471</a></span>
<span class="normal"><a href="#__codelineno-0-472">472</a></span>
<span class="normal"><a href="#__codelineno-0-473">473</a></span>
<span class="normal"><a href="#__codelineno-0-474">474</a></span>
<span class="normal"><a href="#__codelineno-0-475">475</a></span>
<span class="normal"><a href="#__codelineno-0-476">476</a></span>
<span class="normal"><a href="#__codelineno-0-477">477</a></span>
<span class="normal"><a href="#__codelineno-0-478">478</a></span>
<span class="normal"><a href="#__codelineno-0-479">479</a></span>
<span class="normal"><a href="#__codelineno-0-480">480</a></span>
<span class="normal"><a href="#__codelineno-0-481">481</a></span>
<span class="normal"><a href="#__codelineno-0-482">482</a></span>
<span class="normal"><a href="#__codelineno-0-483">483</a></span>
<span class="normal"><a href="#__codelineno-0-484">484</a></span>
<span class="normal"><a href="#__codelineno-0-485">485</a></span>
<span class="normal"><a href="#__codelineno-0-486">486</a></span>
<span class="normal"><a href="#__codelineno-0-487">487</a></span>
<span class="normal"><a href="#__codelineno-0-488">488</a></span>
<span class="normal"><a href="#__codelineno-0-489">489</a></span>
<span class="normal"><a href="#__codelineno-0-490">490</a></span>
<span class="normal"><a href="#__codelineno-0-491">491</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="k">class</span> <span class="nc">QtdbDataset</span><span class="p">(</span><span class="n">HeartKitDataset</span><span class="p">):</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;QT dataset&quot;&quot;&quot;</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a>        <span class="n">ds_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a>        <span class="n">task</span><span class="p">:</span> <span class="n">HeartTask</span> <span class="o">=</span> <span class="n">HeartTask</span><span class="o">.</span><span class="n">arrhythmia</span><span class="p">,</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a>        <span class="n">frame_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1250</span><span class="p">,</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a>        <span class="n">target_rate</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">250</span><span class="p">,</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ds_path</span><span class="p">,</span> <span class="s2">&quot;qtdb&quot;</span><span class="p">),</span> <span class="n">task</span><span class="p">,</span> <span class="n">frame_size</span><span class="p">,</span> <span class="n">target_rate</span><span class="p">)</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a>    <span class="nd">@property</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a>    <span class="k">def</span> <span class="nf">sampling_rate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Sampling rate in Hz&quot;&quot;&quot;</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a>        <span class="k">return</span> <span class="mi">250</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a>    <span class="nd">@property</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a>    <span class="k">def</span> <span class="nf">mean</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Dataset mean&quot;&quot;&quot;</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a>        <span class="k">return</span> <span class="mi">0</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a>    <span class="nd">@property</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a>    <span class="k">def</span> <span class="nf">std</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Dataset st dev&quot;&quot;&quot;</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>        <span class="k">return</span> <span class="mi">1</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a>    <span class="nd">@property</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a>    <span class="k">def</span> <span class="nf">patient_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">:</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get dataset patient IDs</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a><span class="sd">            npt.NDArray: patient IDs</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>            <span class="p">[</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>                <span class="mi">30</span><span class="p">,</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a>                <span class="mi">31</span><span class="p">,</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a>                <span class="mi">32</span><span class="p">,</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>                <span class="mi">33</span><span class="p">,</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a>                <span class="mi">34</span><span class="p">,</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a>                <span class="mi">35</span><span class="p">,</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a>                <span class="mi">36</span><span class="p">,</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a>                <span class="mi">37</span><span class="p">,</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a>                <span class="mi">38</span><span class="p">,</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a>                <span class="mi">39</span><span class="p">,</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a>                <span class="mi">40</span><span class="p">,</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>                <span class="mi">41</span><span class="p">,</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>                <span class="mi">42</span><span class="p">,</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>                <span class="mi">43</span><span class="p">,</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>                <span class="mi">44</span><span class="p">,</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>                <span class="mi">45</span><span class="p">,</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>                <span class="mi">46</span><span class="p">,</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>                <span class="mi">47</span><span class="p">,</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>                <span class="mi">48</span><span class="p">,</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>                <span class="mi">49</span><span class="p">,</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>                <span class="mi">50</span><span class="p">,</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>                <span class="mi">51</span><span class="p">,</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>                <span class="mi">52</span><span class="p">,</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>                <span class="mi">100</span><span class="p">,</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>                <span class="mi">102</span><span class="p">,</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>                <span class="mi">103</span><span class="p">,</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>                <span class="mi">104</span><span class="p">,</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>                <span class="mi">106</span><span class="p">,</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>                <span class="mi">107</span><span class="p">,</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>                <span class="mi">110</span><span class="p">,</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>                <span class="mi">111</span><span class="p">,</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>                <span class="mi">112</span><span class="p">,</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>                <span class="mi">114</span><span class="p">,</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>                <span class="mi">116</span><span class="p">,</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>                <span class="mi">117</span><span class="p">,</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>                <span class="mi">121</span><span class="p">,</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>                <span class="mi">122</span><span class="p">,</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>                <span class="mi">123</span><span class="p">,</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>                <span class="mi">124</span><span class="p">,</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>                <span class="mi">126</span><span class="p">,</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>                <span class="mi">129</span><span class="p">,</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>                <span class="mi">133</span><span class="p">,</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>                <span class="mi">136</span><span class="p">,</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>                <span class="mi">166</span><span class="p">,</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>                <span class="mi">170</span><span class="p">,</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>                <span class="mi">203</span><span class="p">,</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>                <span class="mi">210</span><span class="p">,</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>                <span class="mi">211</span><span class="p">,</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>                <span class="mi">213</span><span class="p">,</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>                <span class="mi">221</span><span class="p">,</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>                <span class="mi">223</span><span class="p">,</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>                <span class="mi">230</span><span class="p">,</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>                <span class="mi">231</span><span class="p">,</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>                <span class="mi">232</span><span class="p">,</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>                <span class="mi">233</span><span class="p">,</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>                <span class="mi">301</span><span class="p">,</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>                <span class="mi">302</span><span class="p">,</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>                <span class="mi">303</span><span class="p">,</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>                <span class="mi">306</span><span class="p">,</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>                <span class="mi">307</span><span class="p">,</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>                <span class="mi">308</span><span class="p">,</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>                <span class="mi">310</span><span class="p">,</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>                <span class="mi">405</span><span class="p">,</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>                <span class="mi">406</span><span class="p">,</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>                <span class="mi">409</span><span class="p">,</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>                <span class="mi">411</span><span class="p">,</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>                <span class="mi">509</span><span class="p">,</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>                <span class="mi">603</span><span class="p">,</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>                <span class="mi">604</span><span class="p">,</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>                <span class="mi">606</span><span class="p">,</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>                <span class="mi">607</span><span class="p">,</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>                <span class="mi">609</span><span class="p">,</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>                <span class="mi">612</span><span class="p">,</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a>                <span class="mi">704</span><span class="p">,</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>                <span class="mi">803</span><span class="p">,</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>                <span class="mi">808</span><span class="p">,</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>                <span class="mi">811</span><span class="p">,</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>                <span class="mi">820</span><span class="p">,</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>                <span class="mi">821</span><span class="p">,</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a>                <span class="mi">840</span><span class="p">,</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>                <span class="mi">847</span><span class="p">,</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>                <span class="mi">853</span><span class="p">,</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>                <span class="mi">871</span><span class="p">,</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>                <span class="mi">872</span><span class="p">,</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>                <span class="mi">873</span><span class="p">,</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a>                <span class="mi">883</span><span class="p">,</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>                <span class="mi">891</span><span class="p">,</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>                <span class="mi">14046</span><span class="p">,</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a>                <span class="mi">14157</span><span class="p">,</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a>                <span class="mi">14172</span><span class="p">,</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>                <span class="mi">15814</span><span class="p">,</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>                <span class="mi">16265</span><span class="p">,</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>                <span class="mi">16272</span><span class="p">,</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a>                <span class="mi">16273</span><span class="p">,</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>                <span class="mi">16420</span><span class="p">,</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a>                <span class="mi">16483</span><span class="p">,</span>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a>                <span class="mi">16539</span><span class="p">,</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a>                <span class="mi">16773</span><span class="p">,</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a>                <span class="mi">16786</span><span class="p">,</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a>                <span class="mi">16795</span><span class="p">,</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a>                <span class="mi">17152</span><span class="p">,</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>                <span class="mi">17453</span><span class="p">,</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a>            <span class="p">]</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a>        <span class="p">)</span>  <span class="c1"># 104, 114, 116 have multiple recordings</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a>    <span class="k">def</span> <span class="nf">get_train_patient_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">:</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get dataset training patient IDs</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a><span class="sd">            npt.NDArray: patient IDs</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">patient_ids</span><span class="p">[:</span><span class="mi">82</span><span class="p">]</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a>    <span class="k">def</span> <span class="nf">get_test_patient_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">:</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get dataset patient IDs reserved for testing only</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a><span class="sd">            npt.NDArray: patient IDs</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">patient_ids</span><span class="p">[</span><span class="mi">82</span><span class="p">:]</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a>    <span class="k">def</span> <span class="nf">task_data_generator</span><span class="p">(</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a>        <span class="n">patient_generator</span><span class="p">:</span> <span class="n">PatientGenerator</span><span class="p">,</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a>        <span class="n">samples_per_patient</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SampleGenerator</span><span class="p">:</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Task-level data generator.</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a><span class="sd">            patient_generator (PatientGenerator): Patient data generator</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a><span class="sd">            samples_per_patient (int | list[int], optional): # samples per patient. Defaults to 1.</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a><span class="sd">            SampleGenerator: Sample data generator</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">task</span> <span class="o">==</span> <span class="n">HeartTask</span><span class="o">.</span><span class="n">segmentation</span><span class="p">:</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">segmentation_generator</span><span class="p">(</span>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a>                <span class="n">patient_generator</span><span class="o">=</span><span class="n">patient_generator</span><span class="p">,</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a>                <span class="n">samples_per_patient</span><span class="o">=</span><span class="n">samples_per_patient</span><span class="p">,</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a>            <span class="p">)</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a>    <span class="k">def</span> <span class="nf">segmentation_generator</span><span class="p">(</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a>        <span class="n">patient_generator</span><span class="p">:</span> <span class="n">PatientGenerator</span><span class="p">,</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a>        <span class="n">samples_per_patient</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SampleGenerator</span><span class="p">:</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate frames and segment labels.</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a><span class="sd">            patient_generator (PatientGenerator): Patient Generator</span>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a><span class="sd">            samples_per_patient (int | list[int], optional): # samples per patient. Defaults to 1.</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a><span class="sd">            SampleGenerator: Sample generator</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a><span class="sd">        Yields:</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a><span class="sd">            Iterator[SampleGenerator]</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a>        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">pt</span> <span class="ow">in</span> <span class="n">patient_generator</span><span class="p">:</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a>            <span class="c1"># NOTE: [:] will load all data into RAM- ideal for small dataset</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a>            <span class="n">data</span> <span class="o">=</span> <span class="n">pt</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][:]</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a>            <span class="n">segs</span> <span class="o">=</span> <span class="n">pt</span><span class="p">[</span><span class="s2">&quot;segmentations&quot;</span><span class="p">][:]</span>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a>            <span class="n">fids</span> <span class="o">=</span> <span class="n">pt</span><span class="p">[</span><span class="s2">&quot;fiducials&quot;</span><span class="p">][:]</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampling_rate</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_rate</span><span class="p">:</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a>                <span class="n">ratio</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_rate</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampling_rate</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a>                <span class="n">data</span> <span class="o">=</span> <span class="n">resample_signal</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampling_rate</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_rate</span><span class="p">)</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a>                <span class="n">segs</span><span class="p">[:,</span> <span class="p">(</span><span class="n">SEG_BEG_IDX</span><span class="p">,</span> <span class="n">SEG_END_IDX</span><span class="p">)]</span> <span class="o">=</span> <span class="n">segs</span><span class="p">[:,</span> <span class="p">(</span><span class="n">SEG_BEG_IDX</span><span class="p">,</span> <span class="n">SEG_END_IDX</span><span class="p">)]</span> <span class="o">*</span> <span class="n">ratio</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a>                <span class="n">fids</span><span class="p">[:,</span> <span class="n">FID_LOC_IDX</span><span class="p">]</span> <span class="o">=</span> <span class="n">fids</span><span class="p">[:,</span> <span class="n">FID_LOC_IDX</span><span class="p">]</span> <span class="o">*</span> <span class="n">ratio</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a>            <span class="c1"># END IF</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a>            <span class="c1"># Create segmentation mask</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a>            <span class="n">labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a>            <span class="k">for</span> <span class="n">seg_idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">segs</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a>                <span class="n">seg</span> <span class="o">=</span> <span class="n">segs</span><span class="p">[</span><span class="n">seg_idx</span><span class="p">]</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a>                <span class="n">labels</span><span class="p">[</span><span class="n">seg</span><span class="p">[</span><span class="n">SEG_BEG_IDX</span><span class="p">]</span> <span class="p">:</span> <span class="n">seg</span><span class="p">[</span><span class="n">SEG_END_IDX</span><span class="p">],</span> <span class="n">seg</span><span class="p">[</span><span class="n">SEG_LEAD_IDX</span><span class="p">]]</span> <span class="o">=</span> <span class="n">seg</span><span class="p">[</span><span class="n">SEG_LBL_IDX</span><span class="p">]</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a>            <span class="c1"># END FOR</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a>            <span class="n">start_offset</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">segs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">SEG_BEG_IDX</span><span class="p">]</span> <span class="o">-</span> <span class="mi">100</span><span class="p">)</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a>            <span class="n">stop_offset</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">segs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">SEG_END_IDX</span><span class="p">]</span> <span class="o">+</span> <span class="mi">100</span><span class="p">)</span>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a>            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">samples_per_patient</span><span class="p">):</span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a>                <span class="c1"># Randomly pick an ECG lead</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a>                <span class="n">lead_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a>                <span class="c1"># Randomly select frame within the segment</span>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a>                <span class="n">frame_start</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">start_offset</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_size</span> <span class="o">-</span> <span class="n">stop_offset</span><span class="p">)</span>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a>                <span class="n">frame_end</span> <span class="o">=</span> <span class="n">frame_start</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_size</span>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a>                <span class="n">x</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">frame_start</span><span class="p">:</span><span class="n">frame_end</span><span class="p">,</span> <span class="n">lead_idx</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">frame_size</span><span class="p">,))</span>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a>                <span class="n">y</span> <span class="o">=</span> <span class="n">labels</span><span class="p">[</span><span class="n">frame_start</span><span class="p">:</span><span class="n">frame_end</span><span class="p">,</span> <span class="n">lead_idx</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a>                <span class="k">yield</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a>            <span class="c1"># END FOR</span>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a>            <span class="c1"># start_offset = max(segs[0][SEG_BEG_IDX], int(0.55 * self.frame_size))</span>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a>            <span class="c1"># stop_offset = int(data.shape[0] - 0.55 * self.frame_size)</span>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a>            <span class="c1"># # Identify R peak locations and randomly shuffle</span>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a>            <span class="c1"># rfids = fids[</span>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a>            <span class="c1">#     (fids[:, FID_LBL_IDX] == 2)</span>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a>            <span class="c1">#     &amp; (start_offset &lt; fids[:, FID_LOC_IDX])</span>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a>            <span class="c1">#     &amp; (fids[:, FID_LOC_IDX] &lt; stop_offset)</span>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a>            <span class="c1"># ]</span>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a>            <span class="c1"># if rfids.shape[0] &lt;= 2:</span>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a>            <span class="c1">#     continue</span>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a>
<a id="__codelineno-0-275" name="__codelineno-0-275"></a>            <span class="c1"># np.random.shuffle(rfids)</span>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a>            <span class="c1"># num_samples = 0</span>
<a id="__codelineno-0-277" name="__codelineno-0-277"></a>            <span class="c1"># for i in range(rfids.shape[0]):</span>
<a id="__codelineno-0-278" name="__codelineno-0-278"></a>            <span class="c1">#     lead_idx = rfids[i, FID_LEAD_IDX]</span>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a>            <span class="c1">#     frame_start = max(rfids[i, FID_LOC_IDX] - int(random.uniform(0.45, 0.55) * self.frame_size), 0)</span>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a>            <span class="c1">#     frame_end = frame_start + self.frame_size</span>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a>            <span class="c1">#     if frame_end - frame_start &lt; self.frame_size:</span>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a>            <span class="c1">#         continue</span>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a>            <span class="c1">#     x = data[frame_start:frame_end, lead_idx].astype(np.float32).reshape((self.frame_size,))</span>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a>            <span class="c1">#     y = labels[frame_start:frame_end, lead_idx].astype(np.int32)</span>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a>            <span class="c1">#     # Should contain all fiducials</span>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a>            <span class="c1">#     if np.intersect1d(y, [1, 2, 3]).size &lt; 3:</span>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a>            <span class="c1">#         continue</span>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a>            <span class="c1">#     yield x, y</span>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a>            <span class="c1">#     num_samples += 1</span>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a>            <span class="c1">#     if num_samples &gt; samples_per_patient:</span>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a>            <span class="c1">#         break</span>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a>            <span class="c1"># # END FOR</span>
<a id="__codelineno-0-293" name="__codelineno-0-293"></a>        <span class="c1"># END FOR</span>
<a id="__codelineno-0-294" name="__codelineno-0-294"></a>
<a id="__codelineno-0-295" name="__codelineno-0-295"></a>    <span class="k">def</span> <span class="nf">signal_generator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">patient_generator</span><span class="p">:</span> <span class="n">PatientGenerator</span><span class="p">,</span> <span class="n">samples_per_patient</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SampleGenerator</span><span class="p">:</span>
<a id="__codelineno-0-296" name="__codelineno-0-296"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a><span class="sd">        Generate frames using patient generator.</span>
<a id="__codelineno-0-298" name="__codelineno-0-298"></a><span class="sd">        from the segments in patient data by placing a frame in a random location within one of the segments.</span>
<a id="__codelineno-0-299" name="__codelineno-0-299"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-300" name="__codelineno-0-300"></a><span class="sd">            patient_generator (PatientGenerator): Generator that yields a tuple of patient id and patient data.</span>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a><span class="sd">                    Patient data may contain only signals, since labels are not used.</span>
<a id="__codelineno-0-302" name="__codelineno-0-302"></a><span class="sd">            samples_per_patient (int): Samples per patient.</span>
<a id="__codelineno-0-303" name="__codelineno-0-303"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-304" name="__codelineno-0-304"></a><span class="sd">            SampleGenerator: Generator of input data of shape (frame_size, 1)</span>
<a id="__codelineno-0-305" name="__codelineno-0-305"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-306" name="__codelineno-0-306"></a>        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">pt</span> <span class="ow">in</span> <span class="n">patient_generator</span><span class="p">:</span>
<a id="__codelineno-0-307" name="__codelineno-0-307"></a>            <span class="n">data</span> <span class="o">=</span> <span class="n">pt</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][:]</span>
<a id="__codelineno-0-308" name="__codelineno-0-308"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampling_rate</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_rate</span><span class="p">:</span>
<a id="__codelineno-0-309" name="__codelineno-0-309"></a>                <span class="n">data</span> <span class="o">=</span> <span class="n">resample_signal</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampling_rate</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_rate</span><span class="p">)</span>
<a id="__codelineno-0-310" name="__codelineno-0-310"></a>            <span class="c1"># END IF</span>
<a id="__codelineno-0-311" name="__codelineno-0-311"></a>            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">samples_per_patient</span><span class="p">):</span>
<a id="__codelineno-0-312" name="__codelineno-0-312"></a>                <span class="n">lead_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<a id="__codelineno-0-313" name="__codelineno-0-313"></a>                <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_size</span><span class="p">:</span>
<a id="__codelineno-0-314" name="__codelineno-0-314"></a>                    <span class="n">frame_start</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_size</span><span class="p">)</span>
<a id="__codelineno-0-315" name="__codelineno-0-315"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-316" name="__codelineno-0-316"></a>                    <span class="n">frame_start</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-317" name="__codelineno-0-317"></a>                <span class="n">frame_end</span> <span class="o">=</span> <span class="n">frame_start</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_size</span>
<a id="__codelineno-0-318" name="__codelineno-0-318"></a>                <span class="n">x</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">frame_start</span><span class="p">:</span><span class="n">frame_end</span><span class="p">,</span> <span class="n">lead_idx</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">frame_size</span><span class="p">,))</span>
<a id="__codelineno-0-319" name="__codelineno-0-319"></a>                <span class="k">yield</span> <span class="n">x</span>
<a id="__codelineno-0-320" name="__codelineno-0-320"></a>            <span class="c1"># END FOR</span>
<a id="__codelineno-0-321" name="__codelineno-0-321"></a>        <span class="c1"># END FOR</span>
<a id="__codelineno-0-322" name="__codelineno-0-322"></a>
<a id="__codelineno-0-323" name="__codelineno-0-323"></a>    <span class="k">def</span> <span class="nf">get_patient_data_segments</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">patient</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">,</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">]:</span>
<a id="__codelineno-0-324" name="__codelineno-0-324"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get patient&#39;s entire data and segments</span>
<a id="__codelineno-0-325" name="__codelineno-0-325"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-326" name="__codelineno-0-326"></a><span class="sd">            patient (int): Patient ID (1-based)</span>
<a id="__codelineno-0-327" name="__codelineno-0-327"></a>
<a id="__codelineno-0-328" name="__codelineno-0-328"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-329" name="__codelineno-0-329"></a><span class="sd">            tuple[npt.NDArray, npt.NDArray]: (data, segment labels)</span>
<a id="__codelineno-0-330" name="__codelineno-0-330"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-331" name="__codelineno-0-331"></a>        <span class="n">pt_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;p</span><span class="si">{</span><span class="n">patient</span><span class="si">:</span><span class="s2">05d</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-332" name="__codelineno-0-332"></a>        <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ds_path</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pt_key</span><span class="si">}</span><span class="s2">.h5&quot;</span><span class="p">),</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">pt</span><span class="p">:</span>
<a id="__codelineno-0-333" name="__codelineno-0-333"></a>            <span class="n">data</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span> <span class="o">=</span> <span class="n">pt</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][:]</span>
<a id="__codelineno-0-334" name="__codelineno-0-334"></a>            <span class="n">segs</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span> <span class="o">=</span> <span class="n">pt</span><span class="p">[</span><span class="s2">&quot;segmentations&quot;</span><span class="p">][:]</span>
<a id="__codelineno-0-335" name="__codelineno-0-335"></a>        <span class="n">labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<a id="__codelineno-0-336" name="__codelineno-0-336"></a>        <span class="k">for</span> <span class="n">seg_idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">segs</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>  <span class="c1"># pylint: disable=no-member</span>
<a id="__codelineno-0-337" name="__codelineno-0-337"></a>            <span class="n">seg</span> <span class="o">=</span> <span class="n">segs</span><span class="p">[</span><span class="n">seg_idx</span><span class="p">]</span>
<a id="__codelineno-0-338" name="__codelineno-0-338"></a>            <span class="n">labels</span><span class="p">[</span><span class="n">seg</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="p">:</span> <span class="n">seg</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="mi">0</span><span class="p">,</span> <span class="n">seg</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">seg</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-339" name="__codelineno-0-339"></a>        <span class="k">return</span> <span class="n">data</span><span class="p">,</span> <span class="n">labels</span>
<a id="__codelineno-0-340" name="__codelineno-0-340"></a>
<a id="__codelineno-0-341" name="__codelineno-0-341"></a>    <span class="k">def</span> <span class="nf">uniform_patient_generator</span><span class="p">(</span>
<a id="__codelineno-0-342" name="__codelineno-0-342"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-343" name="__codelineno-0-343"></a>        <span class="n">patient_ids</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">,</span>
<a id="__codelineno-0-344" name="__codelineno-0-344"></a>        <span class="n">repeat</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-345" name="__codelineno-0-345"></a>        <span class="n">shuffle</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-346" name="__codelineno-0-346"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PatientGenerator</span><span class="p">:</span>
<a id="__codelineno-0-347" name="__codelineno-0-347"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Yield data for each patient in the array.</span>
<a id="__codelineno-0-348" name="__codelineno-0-348"></a>
<a id="__codelineno-0-349" name="__codelineno-0-349"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-350" name="__codelineno-0-350"></a><span class="sd">            patient_ids (pt.ArrayLike): Array of patient ids</span>
<a id="__codelineno-0-351" name="__codelineno-0-351"></a><span class="sd">            repeat (bool, optional): Whether to repeat generator. Defaults to True.</span>
<a id="__codelineno-0-352" name="__codelineno-0-352"></a><span class="sd">            shuffle (bool, optional): Whether to shuffle patient ids.. Defaults to True.</span>
<a id="__codelineno-0-353" name="__codelineno-0-353"></a>
<a id="__codelineno-0-354" name="__codelineno-0-354"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-355" name="__codelineno-0-355"></a><span class="sd">            PatientGenerator: Patient generator</span>
<a id="__codelineno-0-356" name="__codelineno-0-356"></a>
<a id="__codelineno-0-357" name="__codelineno-0-357"></a><span class="sd">        Yields:</span>
<a id="__codelineno-0-358" name="__codelineno-0-358"></a><span class="sd">            Iterator[PatientGenerator]</span>
<a id="__codelineno-0-359" name="__codelineno-0-359"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-360" name="__codelineno-0-360"></a>        <span class="n">patient_ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">patient_ids</span><span class="p">)</span>
<a id="__codelineno-0-361" name="__codelineno-0-361"></a>        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
<a id="__codelineno-0-362" name="__codelineno-0-362"></a>            <span class="k">if</span> <span class="n">shuffle</span><span class="p">:</span>
<a id="__codelineno-0-363" name="__codelineno-0-363"></a>                <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">patient_ids</span><span class="p">)</span>
<a id="__codelineno-0-364" name="__codelineno-0-364"></a>            <span class="k">for</span> <span class="n">patient_id</span> <span class="ow">in</span> <span class="n">patient_ids</span><span class="p">:</span>
<a id="__codelineno-0-365" name="__codelineno-0-365"></a>                <span class="n">pt_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">patient_id</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-366" name="__codelineno-0-366"></a>                <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ds_path</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pt_key</span><span class="si">}</span><span class="s2">.h5&quot;</span><span class="p">),</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">h5</span><span class="p">:</span>
<a id="__codelineno-0-367" name="__codelineno-0-367"></a>                    <span class="k">yield</span> <span class="n">patient_id</span><span class="p">,</span> <span class="n">h5</span>
<a id="__codelineno-0-368" name="__codelineno-0-368"></a>            <span class="c1"># END FOR</span>
<a id="__codelineno-0-369" name="__codelineno-0-369"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">repeat</span><span class="p">:</span>
<a id="__codelineno-0-370" name="__codelineno-0-370"></a>                <span class="k">break</span>
<a id="__codelineno-0-371" name="__codelineno-0-371"></a>        <span class="c1"># END WHILE</span>
<a id="__codelineno-0-372" name="__codelineno-0-372"></a>
<a id="__codelineno-0-373" name="__codelineno-0-373"></a>    <span class="k">def</span> <span class="nf">convert_pt_wfdb_to_hdf5</span><span class="p">(</span>
<a id="__codelineno-0-374" name="__codelineno-0-374"></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">patient</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">src_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">dst_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">force</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-375" name="__codelineno-0-375"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">,</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">,</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">]:</span>
<a id="__codelineno-0-376" name="__codelineno-0-376"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert QTDB patient data from WFDB to more consumable HDF5 format.</span>
<a id="__codelineno-0-377" name="__codelineno-0-377"></a>
<a id="__codelineno-0-378" name="__codelineno-0-378"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-379" name="__codelineno-0-379"></a><span class="sd">            patient (int): Patient id (1-based)</span>
<a id="__codelineno-0-380" name="__codelineno-0-380"></a><span class="sd">            src_path (str): Source path to WFDB folder</span>
<a id="__codelineno-0-381" name="__codelineno-0-381"></a><span class="sd">            dst_path (str): Destination path to store HDF5 file</span>
<a id="__codelineno-0-382" name="__codelineno-0-382"></a>
<a id="__codelineno-0-383" name="__codelineno-0-383"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-384" name="__codelineno-0-384"></a><span class="sd">            tuple[npt.NDArray, npt.NDArray, npt.NDArray]: data, segments, and fiducials</span>
<a id="__codelineno-0-385" name="__codelineno-0-385"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-386" name="__codelineno-0-386"></a>        <span class="kn">import</span> <span class="nn">wfdb</span>  <span class="c1"># pylint: disable=import-outside-toplevel</span>
<a id="__codelineno-0-387" name="__codelineno-0-387"></a>
<a id="__codelineno-0-388" name="__codelineno-0-388"></a>        <span class="n">pt_id</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;sel</span><span class="si">{</span><span class="n">patient</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">src_path</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;sel</span><span class="si">{</span><span class="n">patient</span><span class="si">}</span><span class="s2">.dat&quot;</span><span class="p">))</span> <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;sele</span><span class="si">{</span><span class="n">patient</span><span class="si">:</span><span class="s2">04d</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-389" name="__codelineno-0-389"></a>        <span class="n">pt_src_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">src_path</span><span class="p">,</span> <span class="n">pt_id</span><span class="p">)</span>
<a id="__codelineno-0-390" name="__codelineno-0-390"></a>        <span class="n">rec</span> <span class="o">=</span> <span class="n">wfdb</span><span class="o">.</span><span class="n">rdrecord</span><span class="p">(</span><span class="n">pt_src_path</span><span class="p">)</span>
<a id="__codelineno-0-391" name="__codelineno-0-391"></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">p_signal</span><span class="p">)</span>
<a id="__codelineno-0-392" name="__codelineno-0-392"></a>        <span class="n">segs</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-393" name="__codelineno-0-393"></a>        <span class="n">fids</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-394" name="__codelineno-0-394"></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">sig_name</span><span class="p">):</span>
<a id="__codelineno-0-395" name="__codelineno-0-395"></a>            <span class="n">lead_id</span> <span class="o">=</span> <span class="n">i</span>
<a id="__codelineno-0-396" name="__codelineno-0-396"></a>
<a id="__codelineno-0-397" name="__codelineno-0-397"></a>            <span class="n">ann</span> <span class="o">=</span> <span class="n">wfdb</span><span class="o">.</span><span class="n">rdann</span><span class="p">(</span><span class="n">pt_src_path</span><span class="p">,</span> <span class="n">extension</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;pu</span><span class="si">{</span><span class="n">lead_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-398" name="__codelineno-0-398"></a>
<a id="__codelineno-0-399" name="__codelineno-0-399"></a>            <span class="n">seg_start</span> <span class="o">=</span> <span class="n">seg_stop</span> <span class="o">=</span> <span class="n">sym_id</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-400" name="__codelineno-0-400"></a>            <span class="n">data</span><span class="p">[:,</span> <span class="n">lead_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">rec</span><span class="o">.</span><span class="n">p_signal</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span>
<a id="__codelineno-0-401" name="__codelineno-0-401"></a>            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">symbol</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ann</span><span class="o">.</span><span class="n">symbol</span><span class="p">):</span>
<a id="__codelineno-0-402" name="__codelineno-0-402"></a>                <span class="c1"># Start of segment</span>
<a id="__codelineno-0-403" name="__codelineno-0-403"></a>                <span class="k">if</span> <span class="n">symbol</span> <span class="o">==</span> <span class="s2">&quot;(&quot;</span><span class="p">:</span>
<a id="__codelineno-0-404" name="__codelineno-0-404"></a>                    <span class="n">seg_start</span> <span class="o">=</span> <span class="n">ann</span><span class="o">.</span><span class="n">sample</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
<a id="__codelineno-0-405" name="__codelineno-0-405"></a>                    <span class="n">seg_stop</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-406" name="__codelineno-0-406"></a>                <span class="c1"># Fiducial / segment type</span>
<a id="__codelineno-0-407" name="__codelineno-0-407"></a>                <span class="k">elif</span> <span class="n">symbol</span> <span class="ow">in</span> <span class="n">QtdbSymbolMap</span><span class="p">:</span>
<a id="__codelineno-0-408" name="__codelineno-0-408"></a>                    <span class="n">sym_id</span> <span class="o">=</span> <span class="n">QtdbSymbolMap</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">symbol</span><span class="p">)</span>
<a id="__codelineno-0-409" name="__codelineno-0-409"></a>                    <span class="k">if</span> <span class="n">seg_start</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-410" name="__codelineno-0-410"></a>                        <span class="n">seg_start</span> <span class="o">=</span> <span class="n">ann</span><span class="o">.</span><span class="n">sample</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
<a id="__codelineno-0-411" name="__codelineno-0-411"></a>                    <span class="n">fids</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">lead_id</span><span class="p">,</span> <span class="n">sym_id</span><span class="p">,</span> <span class="n">ann</span><span class="o">.</span><span class="n">sample</span><span class="p">[</span><span class="n">j</span><span class="p">]])</span>
<a id="__codelineno-0-412" name="__codelineno-0-412"></a>                <span class="k">elif</span> <span class="n">symbol</span> <span class="o">==</span> <span class="s2">&quot;)&quot;</span> <span class="ow">and</span> <span class="n">seg_start</span> <span class="ow">and</span> <span class="n">sym_id</span><span class="p">:</span>
<a id="__codelineno-0-413" name="__codelineno-0-413"></a>                    <span class="n">seg_stop</span> <span class="o">=</span> <span class="n">ann</span><span class="o">.</span><span class="n">sample</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
<a id="__codelineno-0-414" name="__codelineno-0-414"></a>                    <span class="n">segs</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">lead_id</span><span class="p">,</span> <span class="n">sym_id</span><span class="p">,</span> <span class="n">seg_start</span><span class="p">,</span> <span class="n">seg_stop</span><span class="p">])</span>
<a id="__codelineno-0-415" name="__codelineno-0-415"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-416" name="__codelineno-0-416"></a>                    <span class="n">seg_start</span> <span class="o">=</span> <span class="n">seg_stop</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-417" name="__codelineno-0-417"></a>                    <span class="n">sym_id</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-418" name="__codelineno-0-418"></a>            <span class="c1"># END FOR</span>
<a id="__codelineno-0-419" name="__codelineno-0-419"></a>        <span class="c1"># END FOR</span>
<a id="__codelineno-0-420" name="__codelineno-0-420"></a>        <span class="n">fids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">fids</span><span class="p">)</span>
<a id="__codelineno-0-421" name="__codelineno-0-421"></a>        <span class="n">segs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">segs</span><span class="p">)</span>
<a id="__codelineno-0-422" name="__codelineno-0-422"></a>
<a id="__codelineno-0-423" name="__codelineno-0-423"></a>        <span class="k">if</span> <span class="n">dst_path</span><span class="p">:</span>
<a id="__codelineno-0-424" name="__codelineno-0-424"></a>            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">dst_path</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-425" name="__codelineno-0-425"></a>            <span class="n">pt_dst_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dst_path</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">patient</span><span class="si">}</span><span class="s2">.h5&quot;</span><span class="p">)</span>
<a id="__codelineno-0-426" name="__codelineno-0-426"></a>            <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">pt_dst_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">h5</span><span class="p">:</span>
<a id="__codelineno-0-427" name="__codelineno-0-427"></a>                <span class="n">h5</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="s2">&quot;gzip&quot;</span><span class="p">)</span>
<a id="__codelineno-0-428" name="__codelineno-0-428"></a>                <span class="n">h5</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;segmentations&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">segs</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="s2">&quot;gzip&quot;</span><span class="p">)</span>
<a id="__codelineno-0-429" name="__codelineno-0-429"></a>                <span class="n">h5</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;fiducials&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">fids</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="s2">&quot;gzip&quot;</span><span class="p">)</span>
<a id="__codelineno-0-430" name="__codelineno-0-430"></a>            <span class="c1"># END WITH</span>
<a id="__codelineno-0-431" name="__codelineno-0-431"></a>        <span class="c1"># END IF</span>
<a id="__codelineno-0-432" name="__codelineno-0-432"></a>
<a id="__codelineno-0-433" name="__codelineno-0-433"></a>        <span class="k">return</span> <span class="n">data</span><span class="p">,</span> <span class="n">segs</span><span class="p">,</span> <span class="n">fids</span>
<a id="__codelineno-0-434" name="__codelineno-0-434"></a>
<a id="__codelineno-0-435" name="__codelineno-0-435"></a>    <span class="k">def</span> <span class="nf">convert_dataset_zip_to_hdf5</span><span class="p">(</span>
<a id="__codelineno-0-436" name="__codelineno-0-436"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-437" name="__codelineno-0-437"></a>        <span class="n">zip_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-438" name="__codelineno-0-438"></a>        <span class="n">patient_ids</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-439" name="__codelineno-0-439"></a>        <span class="n">force</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-440" name="__codelineno-0-440"></a>        <span class="n">num_workers</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-441" name="__codelineno-0-441"></a>    <span class="p">):</span>
<a id="__codelineno-0-442" name="__codelineno-0-442"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert dataset into individial patient HDF5 files.</span>
<a id="__codelineno-0-443" name="__codelineno-0-443"></a>
<a id="__codelineno-0-444" name="__codelineno-0-444"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-445" name="__codelineno-0-445"></a><span class="sd">            zip_path (str): Zip path</span>
<a id="__codelineno-0-446" name="__codelineno-0-446"></a><span class="sd">            patient_ids (npt.NDArray | None, optional): List of patient IDs to extract. Defaults to all.</span>
<a id="__codelineno-0-447" name="__codelineno-0-447"></a><span class="sd">            force (bool, optional): Whether to force re-download if destination exists. Defaults to False.</span>
<a id="__codelineno-0-448" name="__codelineno-0-448"></a><span class="sd">            num_workers (int, optional): # parallel workers. Defaults to os.cpu_count().</span>
<a id="__codelineno-0-449" name="__codelineno-0-449"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-450" name="__codelineno-0-450"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">patient_ids</span><span class="p">:</span>
<a id="__codelineno-0-451" name="__codelineno-0-451"></a>            <span class="n">patient_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">patient_ids</span>
<a id="__codelineno-0-452" name="__codelineno-0-452"></a>
<a id="__codelineno-0-453" name="__codelineno-0-453"></a>        <span class="n">subdir</span> <span class="o">=</span> <span class="s2">&quot;qt-database-1.0.0&quot;</span>
<a id="__codelineno-0-454" name="__codelineno-0-454"></a>        <span class="k">with</span> <span class="n">Pool</span><span class="p">(</span><span class="n">processes</span><span class="o">=</span><span class="n">num_workers</span><span class="p">)</span> <span class="k">as</span> <span class="n">pool</span><span class="p">,</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryDirectory</span><span class="p">()</span> <span class="k">as</span> <span class="n">tmpdir</span><span class="p">,</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span>
<a id="__codelineno-0-455" name="__codelineno-0-455"></a>            <span class="n">zip_path</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;r&quot;</span>
<a id="__codelineno-0-456" name="__codelineno-0-456"></a>        <span class="p">)</span> <span class="k">as</span> <span class="n">zp</span><span class="p">:</span>
<a id="__codelineno-0-457" name="__codelineno-0-457"></a>            <span class="n">qtdb_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmpdir</span><span class="p">,</span> <span class="s2">&quot;qtdb&quot;</span><span class="p">)</span>
<a id="__codelineno-0-458" name="__codelineno-0-458"></a>            <span class="n">zp</span><span class="o">.</span><span class="n">extractall</span><span class="p">(</span><span class="n">qtdb_dir</span><span class="p">)</span>
<a id="__codelineno-0-459" name="__codelineno-0-459"></a>
<a id="__codelineno-0-460" name="__codelineno-0-460"></a>            <span class="n">f</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span>
<a id="__codelineno-0-461" name="__codelineno-0-461"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">convert_pt_wfdb_to_hdf5</span><span class="p">,</span>
<a id="__codelineno-0-462" name="__codelineno-0-462"></a>                <span class="n">src_path</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">qtdb_dir</span><span class="p">,</span> <span class="n">subdir</span><span class="p">),</span>
<a id="__codelineno-0-463" name="__codelineno-0-463"></a>                <span class="n">dst_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ds_path</span><span class="p">,</span>
<a id="__codelineno-0-464" name="__codelineno-0-464"></a>                <span class="n">force</span><span class="o">=</span><span class="n">force</span><span class="p">,</span>
<a id="__codelineno-0-465" name="__codelineno-0-465"></a>            <span class="p">)</span>
<a id="__codelineno-0-466" name="__codelineno-0-466"></a>            <span class="n">_</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">tqdm</span><span class="p">(</span><span class="n">pool</span><span class="o">.</span><span class="n">imap</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">patient_ids</span><span class="p">),</span> <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">patient_ids</span><span class="p">)))</span>
<a id="__codelineno-0-467" name="__codelineno-0-467"></a>        <span class="c1"># END WITH</span>
<a id="__codelineno-0-468" name="__codelineno-0-468"></a>
<a id="__codelineno-0-469" name="__codelineno-0-469"></a>    <span class="k">def</span> <span class="nf">download</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_workers</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">force</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<a id="__codelineno-0-470" name="__codelineno-0-470"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Download QT dataset</span>
<a id="__codelineno-0-471" name="__codelineno-0-471"></a>
<a id="__codelineno-0-472" name="__codelineno-0-472"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-473" name="__codelineno-0-473"></a><span class="sd">            num_workers (int | None, optional): # parallel workers. Defaults to None.</span>
<a id="__codelineno-0-474" name="__codelineno-0-474"></a><span class="sd">            force (bool, optional): Force redownload. Defaults to False.</span>
<a id="__codelineno-0-475" name="__codelineno-0-475"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-476" name="__codelineno-0-476"></a>
<a id="__codelineno-0-477" name="__codelineno-0-477"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Downloading QTDB dataset&quot;</span><span class="p">)</span>
<a id="__codelineno-0-478" name="__codelineno-0-478"></a>        <span class="n">ds_url</span> <span class="o">=</span> <span class="s2">&quot;https://physionet.org/static/published-projects/qtdb/qt-database-1.0.0.zip&quot;</span>
<a id="__codelineno-0-479" name="__codelineno-0-479"></a>        <span class="n">ds_zip_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ds_path</span><span class="p">,</span> <span class="s2">&quot;qtdb.zip&quot;</span><span class="p">)</span>
<a id="__codelineno-0-480" name="__codelineno-0-480"></a>        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ds_path</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-481" name="__codelineno-0-481"></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">ds_zip_path</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">force</span><span class="p">:</span>
<a id="__codelineno-0-482" name="__codelineno-0-482"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
<a id="__codelineno-0-483" name="__codelineno-0-483"></a>                <span class="sa">f</span><span class="s2">&quot;Zip file already exists. Please delete or set `force` flag to redownload. PATH=</span><span class="si">{</span><span class="n">ds_zip_path</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-484" name="__codelineno-0-484"></a>            <span class="p">)</span>
<a id="__codelineno-0-485" name="__codelineno-0-485"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-486" name="__codelineno-0-486"></a>            <span class="n">download_file</span><span class="p">(</span><span class="n">ds_url</span><span class="p">,</span> <span class="n">ds_zip_path</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-487" name="__codelineno-0-487"></a>
<a id="__codelineno-0-488" name="__codelineno-0-488"></a>        <span class="c1"># 2. Extract and convert patient ECG data to H5 files</span>
<a id="__codelineno-0-489" name="__codelineno-0-489"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Generating QT patient data&quot;</span><span class="p">)</span>
<a id="__codelineno-0-490" name="__codelineno-0-490"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">convert_dataset_zip_to_hdf5</span><span class="p">(</span><span class="n">zip_path</span><span class="o">=</span><span class="n">ds_zip_path</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="n">force</span><span class="p">,</span> <span class="n">num_workers</span><span class="o">=</span><span class="n">num_workers</span><span class="p">)</span>
<a id="__codelineno-0-491" name="__codelineno-0-491"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Finished QTDB patient data&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h4 id="heartkit.datasets.qtdb.QtdbDataset.mean" class="doc doc-heading">
<code class="highlight language-python"><span class="n">mean</span><span class="p">:</span> <span class="nb">float</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h4>


  <div class="doc doc-contents ">
  
      <p>Dataset mean</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="heartkit.datasets.qtdb.QtdbDataset.patient_ids" class="doc doc-heading">
<code class="highlight language-python"><span class="n">patient_ids</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h4>


  <div class="doc doc-contents ">
  
      <p>Get dataset patient IDs</p>

  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code><a class="autorefs autorefs-external" title="numpy" href="https://numpy.org/doc/stable/reference/index.html#module-numpy">npt</a>.<span title="numpy.NDArray">NDArray</span></code>
        – <p>npt.NDArray: patient IDs</p>
      </li>
  </ul>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="heartkit.datasets.qtdb.QtdbDataset.sampling_rate" class="doc doc-heading">
<code class="highlight language-python"><span class="n">sampling_rate</span><span class="p">:</span> <span class="nb">int</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h4>


  <div class="doc doc-contents ">
  
      <p>Sampling rate in Hz</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="heartkit.datasets.qtdb.QtdbDataset.std" class="doc doc-heading">
<code class="highlight language-python"><span class="n">std</span><span class="p">:</span> <span class="nb">float</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h4>


  <div class="doc doc-contents ">
  
      <p>Dataset st dev</p>
  </div>

</div>



<div class="doc doc-object doc-function">



<h4 id="heartkit.datasets.qtdb.QtdbDataset.convert_dataset_zip_to_hdf5" class="doc doc-heading">
<code class="highlight language-python"><span class="n">convert_dataset_zip_to_hdf5</span><span class="p">(</span><span class="n">zip_path</span><span class="p">,</span> <span class="n">patient_ids</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">num_workers</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Convert dataset into individial patient HDF5 files.</p>

  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b>zip_path</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code>)
        – <p>Zip path</p>
      </li>
      <li class="field-body">
        <b>patient_ids</b>
            (<code><a class="autorefs autorefs-external" title="numpy" href="https://numpy.org/doc/stable/reference/index.html#module-numpy">npt</a>.<span title="numpy.NDArray">NDArray</span> | None</code>)
        – <p>List of patient IDs to extract. Defaults to all.</p>
      </li>
      <li class="field-body">
        <b>force</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>)
        – <p>Whether to force re-download if destination exists. Defaults to False.</p>
      </li>
      <li class="field-body">
        <b>num_workers</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code>)
        – <h5 id="heartkit.datasets.qtdb.QtdbDataset.convert_dataset_zip_to_hdf5--parallel-workers-defaults-to-oscpu_count">parallel workers. Defaults to os.cpu_count().</h5>
      </li>
  </ul>

      <details class="quote">
        <summary>Source code in <code>heartkit/datasets/qtdb.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-435">435</a></span>
<span class="normal"><a href="#__codelineno-0-436">436</a></span>
<span class="normal"><a href="#__codelineno-0-437">437</a></span>
<span class="normal"><a href="#__codelineno-0-438">438</a></span>
<span class="normal"><a href="#__codelineno-0-439">439</a></span>
<span class="normal"><a href="#__codelineno-0-440">440</a></span>
<span class="normal"><a href="#__codelineno-0-441">441</a></span>
<span class="normal"><a href="#__codelineno-0-442">442</a></span>
<span class="normal"><a href="#__codelineno-0-443">443</a></span>
<span class="normal"><a href="#__codelineno-0-444">444</a></span>
<span class="normal"><a href="#__codelineno-0-445">445</a></span>
<span class="normal"><a href="#__codelineno-0-446">446</a></span>
<span class="normal"><a href="#__codelineno-0-447">447</a></span>
<span class="normal"><a href="#__codelineno-0-448">448</a></span>
<span class="normal"><a href="#__codelineno-0-449">449</a></span>
<span class="normal"><a href="#__codelineno-0-450">450</a></span>
<span class="normal"><a href="#__codelineno-0-451">451</a></span>
<span class="normal"><a href="#__codelineno-0-452">452</a></span>
<span class="normal"><a href="#__codelineno-0-453">453</a></span>
<span class="normal"><a href="#__codelineno-0-454">454</a></span>
<span class="normal"><a href="#__codelineno-0-455">455</a></span>
<span class="normal"><a href="#__codelineno-0-456">456</a></span>
<span class="normal"><a href="#__codelineno-0-457">457</a></span>
<span class="normal"><a href="#__codelineno-0-458">458</a></span>
<span class="normal"><a href="#__codelineno-0-459">459</a></span>
<span class="normal"><a href="#__codelineno-0-460">460</a></span>
<span class="normal"><a href="#__codelineno-0-461">461</a></span>
<span class="normal"><a href="#__codelineno-0-462">462</a></span>
<span class="normal"><a href="#__codelineno-0-463">463</a></span>
<span class="normal"><a href="#__codelineno-0-464">464</a></span>
<span class="normal"><a href="#__codelineno-0-465">465</a></span>
<span class="normal"><a href="#__codelineno-0-466">466</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-435" name="__codelineno-0-435"></a><span class="k">def</span> <span class="nf">convert_dataset_zip_to_hdf5</span><span class="p">(</span>
<a id="__codelineno-0-436" name="__codelineno-0-436"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-437" name="__codelineno-0-437"></a>    <span class="n">zip_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-438" name="__codelineno-0-438"></a>    <span class="n">patient_ids</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-439" name="__codelineno-0-439"></a>    <span class="n">force</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-440" name="__codelineno-0-440"></a>    <span class="n">num_workers</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-441" name="__codelineno-0-441"></a><span class="p">):</span>
<a id="__codelineno-0-442" name="__codelineno-0-442"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert dataset into individial patient HDF5 files.</span>
<a id="__codelineno-0-443" name="__codelineno-0-443"></a>
<a id="__codelineno-0-444" name="__codelineno-0-444"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-445" name="__codelineno-0-445"></a><span class="sd">        zip_path (str): Zip path</span>
<a id="__codelineno-0-446" name="__codelineno-0-446"></a><span class="sd">        patient_ids (npt.NDArray | None, optional): List of patient IDs to extract. Defaults to all.</span>
<a id="__codelineno-0-447" name="__codelineno-0-447"></a><span class="sd">        force (bool, optional): Whether to force re-download if destination exists. Defaults to False.</span>
<a id="__codelineno-0-448" name="__codelineno-0-448"></a><span class="sd">        num_workers (int, optional): # parallel workers. Defaults to os.cpu_count().</span>
<a id="__codelineno-0-449" name="__codelineno-0-449"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-450" name="__codelineno-0-450"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">patient_ids</span><span class="p">:</span>
<a id="__codelineno-0-451" name="__codelineno-0-451"></a>        <span class="n">patient_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">patient_ids</span>
<a id="__codelineno-0-452" name="__codelineno-0-452"></a>
<a id="__codelineno-0-453" name="__codelineno-0-453"></a>    <span class="n">subdir</span> <span class="o">=</span> <span class="s2">&quot;qt-database-1.0.0&quot;</span>
<a id="__codelineno-0-454" name="__codelineno-0-454"></a>    <span class="k">with</span> <span class="n">Pool</span><span class="p">(</span><span class="n">processes</span><span class="o">=</span><span class="n">num_workers</span><span class="p">)</span> <span class="k">as</span> <span class="n">pool</span><span class="p">,</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryDirectory</span><span class="p">()</span> <span class="k">as</span> <span class="n">tmpdir</span><span class="p">,</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span>
<a id="__codelineno-0-455" name="__codelineno-0-455"></a>        <span class="n">zip_path</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;r&quot;</span>
<a id="__codelineno-0-456" name="__codelineno-0-456"></a>    <span class="p">)</span> <span class="k">as</span> <span class="n">zp</span><span class="p">:</span>
<a id="__codelineno-0-457" name="__codelineno-0-457"></a>        <span class="n">qtdb_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmpdir</span><span class="p">,</span> <span class="s2">&quot;qtdb&quot;</span><span class="p">)</span>
<a id="__codelineno-0-458" name="__codelineno-0-458"></a>        <span class="n">zp</span><span class="o">.</span><span class="n">extractall</span><span class="p">(</span><span class="n">qtdb_dir</span><span class="p">)</span>
<a id="__codelineno-0-459" name="__codelineno-0-459"></a>
<a id="__codelineno-0-460" name="__codelineno-0-460"></a>        <span class="n">f</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span>
<a id="__codelineno-0-461" name="__codelineno-0-461"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">convert_pt_wfdb_to_hdf5</span><span class="p">,</span>
<a id="__codelineno-0-462" name="__codelineno-0-462"></a>            <span class="n">src_path</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">qtdb_dir</span><span class="p">,</span> <span class="n">subdir</span><span class="p">),</span>
<a id="__codelineno-0-463" name="__codelineno-0-463"></a>            <span class="n">dst_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ds_path</span><span class="p">,</span>
<a id="__codelineno-0-464" name="__codelineno-0-464"></a>            <span class="n">force</span><span class="o">=</span><span class="n">force</span><span class="p">,</span>
<a id="__codelineno-0-465" name="__codelineno-0-465"></a>        <span class="p">)</span>
<a id="__codelineno-0-466" name="__codelineno-0-466"></a>        <span class="n">_</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">tqdm</span><span class="p">(</span><span class="n">pool</span><span class="o">.</span><span class="n">imap</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">patient_ids</span><span class="p">),</span> <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">patient_ids</span><span class="p">)))</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="heartkit.datasets.qtdb.QtdbDataset.convert_pt_wfdb_to_hdf5" class="doc doc-heading">
<code class="highlight language-python"><span class="n">convert_pt_wfdb_to_hdf5</span><span class="p">(</span><span class="n">patient</span><span class="p">,</span> <span class="n">src_path</span><span class="p">,</span> <span class="n">dst_path</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Convert QTDB patient data from WFDB to more consumable HDF5 format.</p>

  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b>patient</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code>)
        – <p>Patient id (1-based)</p>
      </li>
      <li class="field-body">
        <b>src_path</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code>)
        – <p>Source path to WFDB folder</p>
      </li>
      <li class="field-body">
        <b>dst_path</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code>)
        – <p>Destination path to store HDF5 file</p>
      </li>
  </ul>

  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#tuple">tuple</a>[<a class="autorefs autorefs-external" title="numpy" href="https://numpy.org/doc/stable/reference/index.html#module-numpy">npt</a>.<span title="numpy.NDArray">NDArray</span>, <a class="autorefs autorefs-external" title="numpy" href="https://numpy.org/doc/stable/reference/index.html#module-numpy">npt</a>.<span title="numpy.NDArray">NDArray</span>, <a class="autorefs autorefs-external" title="numpy" href="https://numpy.org/doc/stable/reference/index.html#module-numpy">npt</a>.<span title="numpy.NDArray">NDArray</span>]</code>
        – <p>tuple[npt.NDArray, npt.NDArray, npt.NDArray]: data, segments, and fiducials</p>
      </li>
  </ul>

      <details class="quote">
        <summary>Source code in <code>heartkit/datasets/qtdb.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-373">373</a></span>
<span class="normal"><a href="#__codelineno-0-374">374</a></span>
<span class="normal"><a href="#__codelineno-0-375">375</a></span>
<span class="normal"><a href="#__codelineno-0-376">376</a></span>
<span class="normal"><a href="#__codelineno-0-377">377</a></span>
<span class="normal"><a href="#__codelineno-0-378">378</a></span>
<span class="normal"><a href="#__codelineno-0-379">379</a></span>
<span class="normal"><a href="#__codelineno-0-380">380</a></span>
<span class="normal"><a href="#__codelineno-0-381">381</a></span>
<span class="normal"><a href="#__codelineno-0-382">382</a></span>
<span class="normal"><a href="#__codelineno-0-383">383</a></span>
<span class="normal"><a href="#__codelineno-0-384">384</a></span>
<span class="normal"><a href="#__codelineno-0-385">385</a></span>
<span class="normal"><a href="#__codelineno-0-386">386</a></span>
<span class="normal"><a href="#__codelineno-0-387">387</a></span>
<span class="normal"><a href="#__codelineno-0-388">388</a></span>
<span class="normal"><a href="#__codelineno-0-389">389</a></span>
<span class="normal"><a href="#__codelineno-0-390">390</a></span>
<span class="normal"><a href="#__codelineno-0-391">391</a></span>
<span class="normal"><a href="#__codelineno-0-392">392</a></span>
<span class="normal"><a href="#__codelineno-0-393">393</a></span>
<span class="normal"><a href="#__codelineno-0-394">394</a></span>
<span class="normal"><a href="#__codelineno-0-395">395</a></span>
<span class="normal"><a href="#__codelineno-0-396">396</a></span>
<span class="normal"><a href="#__codelineno-0-397">397</a></span>
<span class="normal"><a href="#__codelineno-0-398">398</a></span>
<span class="normal"><a href="#__codelineno-0-399">399</a></span>
<span class="normal"><a href="#__codelineno-0-400">400</a></span>
<span class="normal"><a href="#__codelineno-0-401">401</a></span>
<span class="normal"><a href="#__codelineno-0-402">402</a></span>
<span class="normal"><a href="#__codelineno-0-403">403</a></span>
<span class="normal"><a href="#__codelineno-0-404">404</a></span>
<span class="normal"><a href="#__codelineno-0-405">405</a></span>
<span class="normal"><a href="#__codelineno-0-406">406</a></span>
<span class="normal"><a href="#__codelineno-0-407">407</a></span>
<span class="normal"><a href="#__codelineno-0-408">408</a></span>
<span class="normal"><a href="#__codelineno-0-409">409</a></span>
<span class="normal"><a href="#__codelineno-0-410">410</a></span>
<span class="normal"><a href="#__codelineno-0-411">411</a></span>
<span class="normal"><a href="#__codelineno-0-412">412</a></span>
<span class="normal"><a href="#__codelineno-0-413">413</a></span>
<span class="normal"><a href="#__codelineno-0-414">414</a></span>
<span class="normal"><a href="#__codelineno-0-415">415</a></span>
<span class="normal"><a href="#__codelineno-0-416">416</a></span>
<span class="normal"><a href="#__codelineno-0-417">417</a></span>
<span class="normal"><a href="#__codelineno-0-418">418</a></span>
<span class="normal"><a href="#__codelineno-0-419">419</a></span>
<span class="normal"><a href="#__codelineno-0-420">420</a></span>
<span class="normal"><a href="#__codelineno-0-421">421</a></span>
<span class="normal"><a href="#__codelineno-0-422">422</a></span>
<span class="normal"><a href="#__codelineno-0-423">423</a></span>
<span class="normal"><a href="#__codelineno-0-424">424</a></span>
<span class="normal"><a href="#__codelineno-0-425">425</a></span>
<span class="normal"><a href="#__codelineno-0-426">426</a></span>
<span class="normal"><a href="#__codelineno-0-427">427</a></span>
<span class="normal"><a href="#__codelineno-0-428">428</a></span>
<span class="normal"><a href="#__codelineno-0-429">429</a></span>
<span class="normal"><a href="#__codelineno-0-430">430</a></span>
<span class="normal"><a href="#__codelineno-0-431">431</a></span>
<span class="normal"><a href="#__codelineno-0-432">432</a></span>
<span class="normal"><a href="#__codelineno-0-433">433</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-373" name="__codelineno-0-373"></a><span class="k">def</span> <span class="nf">convert_pt_wfdb_to_hdf5</span><span class="p">(</span>
<a id="__codelineno-0-374" name="__codelineno-0-374"></a>    <span class="bp">self</span><span class="p">,</span> <span class="n">patient</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">src_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">dst_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">force</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-375" name="__codelineno-0-375"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">,</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">,</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">]:</span>
<a id="__codelineno-0-376" name="__codelineno-0-376"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert QTDB patient data from WFDB to more consumable HDF5 format.</span>
<a id="__codelineno-0-377" name="__codelineno-0-377"></a>
<a id="__codelineno-0-378" name="__codelineno-0-378"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-379" name="__codelineno-0-379"></a><span class="sd">        patient (int): Patient id (1-based)</span>
<a id="__codelineno-0-380" name="__codelineno-0-380"></a><span class="sd">        src_path (str): Source path to WFDB folder</span>
<a id="__codelineno-0-381" name="__codelineno-0-381"></a><span class="sd">        dst_path (str): Destination path to store HDF5 file</span>
<a id="__codelineno-0-382" name="__codelineno-0-382"></a>
<a id="__codelineno-0-383" name="__codelineno-0-383"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-384" name="__codelineno-0-384"></a><span class="sd">        tuple[npt.NDArray, npt.NDArray, npt.NDArray]: data, segments, and fiducials</span>
<a id="__codelineno-0-385" name="__codelineno-0-385"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-386" name="__codelineno-0-386"></a>    <span class="kn">import</span> <span class="nn">wfdb</span>  <span class="c1"># pylint: disable=import-outside-toplevel</span>
<a id="__codelineno-0-387" name="__codelineno-0-387"></a>
<a id="__codelineno-0-388" name="__codelineno-0-388"></a>    <span class="n">pt_id</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;sel</span><span class="si">{</span><span class="n">patient</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">src_path</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;sel</span><span class="si">{</span><span class="n">patient</span><span class="si">}</span><span class="s2">.dat&quot;</span><span class="p">))</span> <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;sele</span><span class="si">{</span><span class="n">patient</span><span class="si">:</span><span class="s2">04d</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-389" name="__codelineno-0-389"></a>    <span class="n">pt_src_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">src_path</span><span class="p">,</span> <span class="n">pt_id</span><span class="p">)</span>
<a id="__codelineno-0-390" name="__codelineno-0-390"></a>    <span class="n">rec</span> <span class="o">=</span> <span class="n">wfdb</span><span class="o">.</span><span class="n">rdrecord</span><span class="p">(</span><span class="n">pt_src_path</span><span class="p">)</span>
<a id="__codelineno-0-391" name="__codelineno-0-391"></a>    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">p_signal</span><span class="p">)</span>
<a id="__codelineno-0-392" name="__codelineno-0-392"></a>    <span class="n">segs</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-393" name="__codelineno-0-393"></a>    <span class="n">fids</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-394" name="__codelineno-0-394"></a>    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">sig_name</span><span class="p">):</span>
<a id="__codelineno-0-395" name="__codelineno-0-395"></a>        <span class="n">lead_id</span> <span class="o">=</span> <span class="n">i</span>
<a id="__codelineno-0-396" name="__codelineno-0-396"></a>
<a id="__codelineno-0-397" name="__codelineno-0-397"></a>        <span class="n">ann</span> <span class="o">=</span> <span class="n">wfdb</span><span class="o">.</span><span class="n">rdann</span><span class="p">(</span><span class="n">pt_src_path</span><span class="p">,</span> <span class="n">extension</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;pu</span><span class="si">{</span><span class="n">lead_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-398" name="__codelineno-0-398"></a>
<a id="__codelineno-0-399" name="__codelineno-0-399"></a>        <span class="n">seg_start</span> <span class="o">=</span> <span class="n">seg_stop</span> <span class="o">=</span> <span class="n">sym_id</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-400" name="__codelineno-0-400"></a>        <span class="n">data</span><span class="p">[:,</span> <span class="n">lead_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">rec</span><span class="o">.</span><span class="n">p_signal</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span>
<a id="__codelineno-0-401" name="__codelineno-0-401"></a>        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">symbol</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ann</span><span class="o">.</span><span class="n">symbol</span><span class="p">):</span>
<a id="__codelineno-0-402" name="__codelineno-0-402"></a>            <span class="c1"># Start of segment</span>
<a id="__codelineno-0-403" name="__codelineno-0-403"></a>            <span class="k">if</span> <span class="n">symbol</span> <span class="o">==</span> <span class="s2">&quot;(&quot;</span><span class="p">:</span>
<a id="__codelineno-0-404" name="__codelineno-0-404"></a>                <span class="n">seg_start</span> <span class="o">=</span> <span class="n">ann</span><span class="o">.</span><span class="n">sample</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
<a id="__codelineno-0-405" name="__codelineno-0-405"></a>                <span class="n">seg_stop</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-406" name="__codelineno-0-406"></a>            <span class="c1"># Fiducial / segment type</span>
<a id="__codelineno-0-407" name="__codelineno-0-407"></a>            <span class="k">elif</span> <span class="n">symbol</span> <span class="ow">in</span> <span class="n">QtdbSymbolMap</span><span class="p">:</span>
<a id="__codelineno-0-408" name="__codelineno-0-408"></a>                <span class="n">sym_id</span> <span class="o">=</span> <span class="n">QtdbSymbolMap</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">symbol</span><span class="p">)</span>
<a id="__codelineno-0-409" name="__codelineno-0-409"></a>                <span class="k">if</span> <span class="n">seg_start</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-410" name="__codelineno-0-410"></a>                    <span class="n">seg_start</span> <span class="o">=</span> <span class="n">ann</span><span class="o">.</span><span class="n">sample</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
<a id="__codelineno-0-411" name="__codelineno-0-411"></a>                <span class="n">fids</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">lead_id</span><span class="p">,</span> <span class="n">sym_id</span><span class="p">,</span> <span class="n">ann</span><span class="o">.</span><span class="n">sample</span><span class="p">[</span><span class="n">j</span><span class="p">]])</span>
<a id="__codelineno-0-412" name="__codelineno-0-412"></a>            <span class="k">elif</span> <span class="n">symbol</span> <span class="o">==</span> <span class="s2">&quot;)&quot;</span> <span class="ow">and</span> <span class="n">seg_start</span> <span class="ow">and</span> <span class="n">sym_id</span><span class="p">:</span>
<a id="__codelineno-0-413" name="__codelineno-0-413"></a>                <span class="n">seg_stop</span> <span class="o">=</span> <span class="n">ann</span><span class="o">.</span><span class="n">sample</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
<a id="__codelineno-0-414" name="__codelineno-0-414"></a>                <span class="n">segs</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">lead_id</span><span class="p">,</span> <span class="n">sym_id</span><span class="p">,</span> <span class="n">seg_start</span><span class="p">,</span> <span class="n">seg_stop</span><span class="p">])</span>
<a id="__codelineno-0-415" name="__codelineno-0-415"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-416" name="__codelineno-0-416"></a>                <span class="n">seg_start</span> <span class="o">=</span> <span class="n">seg_stop</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-417" name="__codelineno-0-417"></a>                <span class="n">sym_id</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-418" name="__codelineno-0-418"></a>        <span class="c1"># END FOR</span>
<a id="__codelineno-0-419" name="__codelineno-0-419"></a>    <span class="c1"># END FOR</span>
<a id="__codelineno-0-420" name="__codelineno-0-420"></a>    <span class="n">fids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">fids</span><span class="p">)</span>
<a id="__codelineno-0-421" name="__codelineno-0-421"></a>    <span class="n">segs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">segs</span><span class="p">)</span>
<a id="__codelineno-0-422" name="__codelineno-0-422"></a>
<a id="__codelineno-0-423" name="__codelineno-0-423"></a>    <span class="k">if</span> <span class="n">dst_path</span><span class="p">:</span>
<a id="__codelineno-0-424" name="__codelineno-0-424"></a>        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">dst_path</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-425" name="__codelineno-0-425"></a>        <span class="n">pt_dst_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dst_path</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">patient</span><span class="si">}</span><span class="s2">.h5&quot;</span><span class="p">)</span>
<a id="__codelineno-0-426" name="__codelineno-0-426"></a>        <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">pt_dst_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">h5</span><span class="p">:</span>
<a id="__codelineno-0-427" name="__codelineno-0-427"></a>            <span class="n">h5</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="s2">&quot;gzip&quot;</span><span class="p">)</span>
<a id="__codelineno-0-428" name="__codelineno-0-428"></a>            <span class="n">h5</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;segmentations&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">segs</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="s2">&quot;gzip&quot;</span><span class="p">)</span>
<a id="__codelineno-0-429" name="__codelineno-0-429"></a>            <span class="n">h5</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;fiducials&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">fids</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="s2">&quot;gzip&quot;</span><span class="p">)</span>
<a id="__codelineno-0-430" name="__codelineno-0-430"></a>        <span class="c1"># END WITH</span>
<a id="__codelineno-0-431" name="__codelineno-0-431"></a>    <span class="c1"># END IF</span>
<a id="__codelineno-0-432" name="__codelineno-0-432"></a>
<a id="__codelineno-0-433" name="__codelineno-0-433"></a>    <span class="k">return</span> <span class="n">data</span><span class="p">,</span> <span class="n">segs</span><span class="p">,</span> <span class="n">fids</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="heartkit.datasets.qtdb.QtdbDataset.download" class="doc doc-heading">
<code class="highlight language-python"><span class="n">download</span><span class="p">(</span><span class="n">num_workers</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Download QT dataset</p>

  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b>num_workers</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a> | None</code>)
        – <h5 id="heartkit.datasets.qtdb.QtdbDataset.download--parallel-workers-defaults-to-none">parallel workers. Defaults to None.</h5>
      </li>
      <li class="field-body">
        <b>force</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>)
        – <p>Force redownload. Defaults to False.</p>
      </li>
  </ul>

      <details class="quote">
        <summary>Source code in <code>heartkit/datasets/qtdb.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-469">469</a></span>
<span class="normal"><a href="#__codelineno-0-470">470</a></span>
<span class="normal"><a href="#__codelineno-0-471">471</a></span>
<span class="normal"><a href="#__codelineno-0-472">472</a></span>
<span class="normal"><a href="#__codelineno-0-473">473</a></span>
<span class="normal"><a href="#__codelineno-0-474">474</a></span>
<span class="normal"><a href="#__codelineno-0-475">475</a></span>
<span class="normal"><a href="#__codelineno-0-476">476</a></span>
<span class="normal"><a href="#__codelineno-0-477">477</a></span>
<span class="normal"><a href="#__codelineno-0-478">478</a></span>
<span class="normal"><a href="#__codelineno-0-479">479</a></span>
<span class="normal"><a href="#__codelineno-0-480">480</a></span>
<span class="normal"><a href="#__codelineno-0-481">481</a></span>
<span class="normal"><a href="#__codelineno-0-482">482</a></span>
<span class="normal"><a href="#__codelineno-0-483">483</a></span>
<span class="normal"><a href="#__codelineno-0-484">484</a></span>
<span class="normal"><a href="#__codelineno-0-485">485</a></span>
<span class="normal"><a href="#__codelineno-0-486">486</a></span>
<span class="normal"><a href="#__codelineno-0-487">487</a></span>
<span class="normal"><a href="#__codelineno-0-488">488</a></span>
<span class="normal"><a href="#__codelineno-0-489">489</a></span>
<span class="normal"><a href="#__codelineno-0-490">490</a></span>
<span class="normal"><a href="#__codelineno-0-491">491</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-469" name="__codelineno-0-469"></a><span class="k">def</span> <span class="nf">download</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_workers</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">force</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<a id="__codelineno-0-470" name="__codelineno-0-470"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Download QT dataset</span>
<a id="__codelineno-0-471" name="__codelineno-0-471"></a>
<a id="__codelineno-0-472" name="__codelineno-0-472"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-473" name="__codelineno-0-473"></a><span class="sd">        num_workers (int | None, optional): # parallel workers. Defaults to None.</span>
<a id="__codelineno-0-474" name="__codelineno-0-474"></a><span class="sd">        force (bool, optional): Force redownload. Defaults to False.</span>
<a id="__codelineno-0-475" name="__codelineno-0-475"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-476" name="__codelineno-0-476"></a>
<a id="__codelineno-0-477" name="__codelineno-0-477"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Downloading QTDB dataset&quot;</span><span class="p">)</span>
<a id="__codelineno-0-478" name="__codelineno-0-478"></a>    <span class="n">ds_url</span> <span class="o">=</span> <span class="s2">&quot;https://physionet.org/static/published-projects/qtdb/qt-database-1.0.0.zip&quot;</span>
<a id="__codelineno-0-479" name="__codelineno-0-479"></a>    <span class="n">ds_zip_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ds_path</span><span class="p">,</span> <span class="s2">&quot;qtdb.zip&quot;</span><span class="p">)</span>
<a id="__codelineno-0-480" name="__codelineno-0-480"></a>    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ds_path</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-481" name="__codelineno-0-481"></a>    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">ds_zip_path</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">force</span><span class="p">:</span>
<a id="__codelineno-0-482" name="__codelineno-0-482"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
<a id="__codelineno-0-483" name="__codelineno-0-483"></a>            <span class="sa">f</span><span class="s2">&quot;Zip file already exists. Please delete or set `force` flag to redownload. PATH=</span><span class="si">{</span><span class="n">ds_zip_path</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-484" name="__codelineno-0-484"></a>        <span class="p">)</span>
<a id="__codelineno-0-485" name="__codelineno-0-485"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-486" name="__codelineno-0-486"></a>        <span class="n">download_file</span><span class="p">(</span><span class="n">ds_url</span><span class="p">,</span> <span class="n">ds_zip_path</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-487" name="__codelineno-0-487"></a>
<a id="__codelineno-0-488" name="__codelineno-0-488"></a>    <span class="c1"># 2. Extract and convert patient ECG data to H5 files</span>
<a id="__codelineno-0-489" name="__codelineno-0-489"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Generating QT patient data&quot;</span><span class="p">)</span>
<a id="__codelineno-0-490" name="__codelineno-0-490"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">convert_dataset_zip_to_hdf5</span><span class="p">(</span><span class="n">zip_path</span><span class="o">=</span><span class="n">ds_zip_path</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="n">force</span><span class="p">,</span> <span class="n">num_workers</span><span class="o">=</span><span class="n">num_workers</span><span class="p">)</span>
<a id="__codelineno-0-491" name="__codelineno-0-491"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Finished QTDB patient data&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="heartkit.datasets.qtdb.QtdbDataset.get_patient_data_segments" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_patient_data_segments</span><span class="p">(</span><span class="n">patient</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Get patient's entire data and segments</p>

  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b>patient</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code>)
        – <p>Patient ID (1-based)</p>
      </li>
  </ul>

  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#tuple">tuple</a>[<a class="autorefs autorefs-external" title="numpy" href="https://numpy.org/doc/stable/reference/index.html#module-numpy">npt</a>.<span title="numpy.NDArray">NDArray</span>, <a class="autorefs autorefs-external" title="numpy" href="https://numpy.org/doc/stable/reference/index.html#module-numpy">npt</a>.<span title="numpy.NDArray">NDArray</span>]</code>
        – <p>tuple[npt.NDArray, npt.NDArray]: (data, segment labels)</p>
      </li>
  </ul>

      <details class="quote">
        <summary>Source code in <code>heartkit/datasets/qtdb.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-323">323</a></span>
<span class="normal"><a href="#__codelineno-0-324">324</a></span>
<span class="normal"><a href="#__codelineno-0-325">325</a></span>
<span class="normal"><a href="#__codelineno-0-326">326</a></span>
<span class="normal"><a href="#__codelineno-0-327">327</a></span>
<span class="normal"><a href="#__codelineno-0-328">328</a></span>
<span class="normal"><a href="#__codelineno-0-329">329</a></span>
<span class="normal"><a href="#__codelineno-0-330">330</a></span>
<span class="normal"><a href="#__codelineno-0-331">331</a></span>
<span class="normal"><a href="#__codelineno-0-332">332</a></span>
<span class="normal"><a href="#__codelineno-0-333">333</a></span>
<span class="normal"><a href="#__codelineno-0-334">334</a></span>
<span class="normal"><a href="#__codelineno-0-335">335</a></span>
<span class="normal"><a href="#__codelineno-0-336">336</a></span>
<span class="normal"><a href="#__codelineno-0-337">337</a></span>
<span class="normal"><a href="#__codelineno-0-338">338</a></span>
<span class="normal"><a href="#__codelineno-0-339">339</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-323" name="__codelineno-0-323"></a><span class="k">def</span> <span class="nf">get_patient_data_segments</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">patient</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">,</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">]:</span>
<a id="__codelineno-0-324" name="__codelineno-0-324"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get patient&#39;s entire data and segments</span>
<a id="__codelineno-0-325" name="__codelineno-0-325"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-326" name="__codelineno-0-326"></a><span class="sd">        patient (int): Patient ID (1-based)</span>
<a id="__codelineno-0-327" name="__codelineno-0-327"></a>
<a id="__codelineno-0-328" name="__codelineno-0-328"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-329" name="__codelineno-0-329"></a><span class="sd">        tuple[npt.NDArray, npt.NDArray]: (data, segment labels)</span>
<a id="__codelineno-0-330" name="__codelineno-0-330"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-331" name="__codelineno-0-331"></a>    <span class="n">pt_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;p</span><span class="si">{</span><span class="n">patient</span><span class="si">:</span><span class="s2">05d</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-332" name="__codelineno-0-332"></a>    <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ds_path</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pt_key</span><span class="si">}</span><span class="s2">.h5&quot;</span><span class="p">),</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">pt</span><span class="p">:</span>
<a id="__codelineno-0-333" name="__codelineno-0-333"></a>        <span class="n">data</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span> <span class="o">=</span> <span class="n">pt</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][:]</span>
<a id="__codelineno-0-334" name="__codelineno-0-334"></a>        <span class="n">segs</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span> <span class="o">=</span> <span class="n">pt</span><span class="p">[</span><span class="s2">&quot;segmentations&quot;</span><span class="p">][:]</span>
<a id="__codelineno-0-335" name="__codelineno-0-335"></a>    <span class="n">labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<a id="__codelineno-0-336" name="__codelineno-0-336"></a>    <span class="k">for</span> <span class="n">seg_idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">segs</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>  <span class="c1"># pylint: disable=no-member</span>
<a id="__codelineno-0-337" name="__codelineno-0-337"></a>        <span class="n">seg</span> <span class="o">=</span> <span class="n">segs</span><span class="p">[</span><span class="n">seg_idx</span><span class="p">]</span>
<a id="__codelineno-0-338" name="__codelineno-0-338"></a>        <span class="n">labels</span><span class="p">[</span><span class="n">seg</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="p">:</span> <span class="n">seg</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="mi">0</span><span class="p">,</span> <span class="n">seg</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">seg</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-339" name="__codelineno-0-339"></a>    <span class="k">return</span> <span class="n">data</span><span class="p">,</span> <span class="n">labels</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="heartkit.datasets.qtdb.QtdbDataset.get_test_patient_ids" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_test_patient_ids</span><span class="p">()</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Get dataset patient IDs reserved for testing only</p>

  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code><a class="autorefs autorefs-external" title="numpy" href="https://numpy.org/doc/stable/reference/index.html#module-numpy">npt</a>.<span title="numpy.NDArray">NDArray</span></code>
        – <p>npt.NDArray: patient IDs</p>
      </li>
  </ul>

      <details class="quote">
        <summary>Source code in <code>heartkit/datasets/qtdb.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-186" name="__codelineno-0-186"></a><span class="k">def</span> <span class="nf">get_test_patient_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">:</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get dataset patient IDs reserved for testing only</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a><span class="sd">        npt.NDArray: patient IDs</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">patient_ids</span><span class="p">[</span><span class="mi">82</span><span class="p">:]</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="heartkit.datasets.qtdb.QtdbDataset.get_train_patient_ids" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_train_patient_ids</span><span class="p">()</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Get dataset training patient IDs</p>

  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code><a class="autorefs autorefs-external" title="numpy" href="https://numpy.org/doc/stable/reference/index.html#module-numpy">npt</a>.<span title="numpy.NDArray">NDArray</span></code>
        – <p>npt.NDArray: patient IDs</p>
      </li>
  </ul>

      <details class="quote">
        <summary>Source code in <code>heartkit/datasets/qtdb.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-178" name="__codelineno-0-178"></a><span class="k">def</span> <span class="nf">get_train_patient_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">:</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get dataset training patient IDs</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a><span class="sd">        npt.NDArray: patient IDs</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">patient_ids</span><span class="p">[:</span><span class="mi">82</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="heartkit.datasets.qtdb.QtdbDataset.segmentation_generator" class="doc doc-heading">
<code class="highlight language-python"><span class="n">segmentation_generator</span><span class="p">(</span><span class="n">patient_generator</span><span class="p">,</span> <span class="n">samples_per_patient</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Generate frames and segment labels.</p>

  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b>patient_generator</b>
            (<code><span title="heartkit.datasets.defines.PatientGenerator">PatientGenerator</span></code>)
        – <p>Patient Generator</p>
      </li>
      <li class="field-body">
        <b>samples_per_patient</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a> | <a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#list">list</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a>]</code>)
        – <h5 id="heartkit.datasets.qtdb.QtdbDataset.segmentation_generator--samples-per-patient-defaults-to-1">samples per patient. Defaults to 1.</h5>
      </li>
  </ul>

  <p>Returns:</p>
  <ul>
      <li class="field-body">
<b>SampleGenerator</b>(            <code><span title="heartkit.datasets.defines.SampleGenerator">SampleGenerator</span></code>
)        – <p>Sample generator</p>
      </li>
  </ul>

  <p>Yields:</p>
  <ul>
      <li class="field-body">
            <code><span title="heartkit.datasets.defines.SampleGenerator">SampleGenerator</span></code>
        – <p>Iterator[SampleGenerator]</p>
      </li>
  </ul>

      <details class="quote">
        <summary>Source code in <code>heartkit/datasets/qtdb.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-215" name="__codelineno-0-215"></a><span class="k">def</span> <span class="nf">segmentation_generator</span><span class="p">(</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a>    <span class="n">patient_generator</span><span class="p">:</span> <span class="n">PatientGenerator</span><span class="p">,</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a>    <span class="n">samples_per_patient</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SampleGenerator</span><span class="p">:</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate frames and segment labels.</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a><span class="sd">        patient_generator (PatientGenerator): Patient Generator</span>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a><span class="sd">        samples_per_patient (int | list[int], optional): # samples per patient. Defaults to 1.</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a><span class="sd">        SampleGenerator: Sample generator</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a><span class="sd">    Yields:</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a><span class="sd">        Iterator[SampleGenerator]</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a>    <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">pt</span> <span class="ow">in</span> <span class="n">patient_generator</span><span class="p">:</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a>        <span class="c1"># NOTE: [:] will load all data into RAM- ideal for small dataset</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">pt</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][:]</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a>        <span class="n">segs</span> <span class="o">=</span> <span class="n">pt</span><span class="p">[</span><span class="s2">&quot;segmentations&quot;</span><span class="p">][:]</span>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a>        <span class="n">fids</span> <span class="o">=</span> <span class="n">pt</span><span class="p">[</span><span class="s2">&quot;fiducials&quot;</span><span class="p">][:]</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampling_rate</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_rate</span><span class="p">:</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a>            <span class="n">ratio</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_rate</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampling_rate</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a>            <span class="n">data</span> <span class="o">=</span> <span class="n">resample_signal</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampling_rate</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_rate</span><span class="p">)</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a>            <span class="n">segs</span><span class="p">[:,</span> <span class="p">(</span><span class="n">SEG_BEG_IDX</span><span class="p">,</span> <span class="n">SEG_END_IDX</span><span class="p">)]</span> <span class="o">=</span> <span class="n">segs</span><span class="p">[:,</span> <span class="p">(</span><span class="n">SEG_BEG_IDX</span><span class="p">,</span> <span class="n">SEG_END_IDX</span><span class="p">)]</span> <span class="o">*</span> <span class="n">ratio</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a>            <span class="n">fids</span><span class="p">[:,</span> <span class="n">FID_LOC_IDX</span><span class="p">]</span> <span class="o">=</span> <span class="n">fids</span><span class="p">[:,</span> <span class="n">FID_LOC_IDX</span><span class="p">]</span> <span class="o">*</span> <span class="n">ratio</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a>        <span class="c1"># END IF</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a>        <span class="c1"># Create segmentation mask</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a>        <span class="n">labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a>        <span class="k">for</span> <span class="n">seg_idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">segs</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a>            <span class="n">seg</span> <span class="o">=</span> <span class="n">segs</span><span class="p">[</span><span class="n">seg_idx</span><span class="p">]</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a>            <span class="n">labels</span><span class="p">[</span><span class="n">seg</span><span class="p">[</span><span class="n">SEG_BEG_IDX</span><span class="p">]</span> <span class="p">:</span> <span class="n">seg</span><span class="p">[</span><span class="n">SEG_END_IDX</span><span class="p">],</span> <span class="n">seg</span><span class="p">[</span><span class="n">SEG_LEAD_IDX</span><span class="p">]]</span> <span class="o">=</span> <span class="n">seg</span><span class="p">[</span><span class="n">SEG_LBL_IDX</span><span class="p">]</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a>        <span class="c1"># END FOR</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a>        <span class="n">start_offset</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">segs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">SEG_BEG_IDX</span><span class="p">]</span> <span class="o">-</span> <span class="mi">100</span><span class="p">)</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a>        <span class="n">stop_offset</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">segs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">SEG_END_IDX</span><span class="p">]</span> <span class="o">+</span> <span class="mi">100</span><span class="p">)</span>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a>        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">samples_per_patient</span><span class="p">):</span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a>            <span class="c1"># Randomly pick an ECG lead</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a>            <span class="n">lead_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a>            <span class="c1"># Randomly select frame within the segment</span>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a>            <span class="n">frame_start</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">start_offset</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_size</span> <span class="o">-</span> <span class="n">stop_offset</span><span class="p">)</span>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a>            <span class="n">frame_end</span> <span class="o">=</span> <span class="n">frame_start</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_size</span>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a>            <span class="n">x</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">frame_start</span><span class="p">:</span><span class="n">frame_end</span><span class="p">,</span> <span class="n">lead_idx</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">frame_size</span><span class="p">,))</span>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a>            <span class="n">y</span> <span class="o">=</span> <span class="n">labels</span><span class="p">[</span><span class="n">frame_start</span><span class="p">:</span><span class="n">frame_end</span><span class="p">,</span> <span class="n">lead_idx</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a>            <span class="k">yield</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="heartkit.datasets.qtdb.QtdbDataset.signal_generator" class="doc doc-heading">
<code class="highlight language-python"><span class="n">signal_generator</span><span class="p">(</span><span class="n">patient_generator</span><span class="p">,</span> <span class="n">samples_per_patient</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Generate frames using patient generator.
from the segments in patient data by placing a frame in a random location within one of the segments.</p>

  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b>patient_generator</b>
            (<code><span title="heartkit.datasets.defines.PatientGenerator">PatientGenerator</span></code>)
        – <p>Generator that yields a tuple of patient id and patient data.
    Patient data may contain only signals, since labels are not used.</p>
      </li>
      <li class="field-body">
        <b>samples_per_patient</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code>)
        – <p>Samples per patient.</p>
      </li>
  </ul>

  <p>Returns:</p>
  <ul>
      <li class="field-body">
<b>SampleGenerator</b>(            <code><span title="heartkit.datasets.defines.SampleGenerator">SampleGenerator</span></code>
)        – <p>Generator of input data of shape (frame_size, 1)</p>
      </li>
  </ul>

      <details class="quote">
        <summary>Source code in <code>heartkit/datasets/qtdb.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span>
<span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span>
<span class="normal"><a href="#__codelineno-0-309">309</a></span>
<span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span>
<span class="normal"><a href="#__codelineno-0-316">316</a></span>
<span class="normal"><a href="#__codelineno-0-317">317</a></span>
<span class="normal"><a href="#__codelineno-0-318">318</a></span>
<span class="normal"><a href="#__codelineno-0-319">319</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-295" name="__codelineno-0-295"></a><span class="k">def</span> <span class="nf">signal_generator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">patient_generator</span><span class="p">:</span> <span class="n">PatientGenerator</span><span class="p">,</span> <span class="n">samples_per_patient</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SampleGenerator</span><span class="p">:</span>
<a id="__codelineno-0-296" name="__codelineno-0-296"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a><span class="sd">    Generate frames using patient generator.</span>
<a id="__codelineno-0-298" name="__codelineno-0-298"></a><span class="sd">    from the segments in patient data by placing a frame in a random location within one of the segments.</span>
<a id="__codelineno-0-299" name="__codelineno-0-299"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-300" name="__codelineno-0-300"></a><span class="sd">        patient_generator (PatientGenerator): Generator that yields a tuple of patient id and patient data.</span>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a><span class="sd">                Patient data may contain only signals, since labels are not used.</span>
<a id="__codelineno-0-302" name="__codelineno-0-302"></a><span class="sd">        samples_per_patient (int): Samples per patient.</span>
<a id="__codelineno-0-303" name="__codelineno-0-303"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-304" name="__codelineno-0-304"></a><span class="sd">        SampleGenerator: Generator of input data of shape (frame_size, 1)</span>
<a id="__codelineno-0-305" name="__codelineno-0-305"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-306" name="__codelineno-0-306"></a>    <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">pt</span> <span class="ow">in</span> <span class="n">patient_generator</span><span class="p">:</span>
<a id="__codelineno-0-307" name="__codelineno-0-307"></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">pt</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][:]</span>
<a id="__codelineno-0-308" name="__codelineno-0-308"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampling_rate</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_rate</span><span class="p">:</span>
<a id="__codelineno-0-309" name="__codelineno-0-309"></a>            <span class="n">data</span> <span class="o">=</span> <span class="n">resample_signal</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampling_rate</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_rate</span><span class="p">)</span>
<a id="__codelineno-0-310" name="__codelineno-0-310"></a>        <span class="c1"># END IF</span>
<a id="__codelineno-0-311" name="__codelineno-0-311"></a>        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">samples_per_patient</span><span class="p">):</span>
<a id="__codelineno-0-312" name="__codelineno-0-312"></a>            <span class="n">lead_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<a id="__codelineno-0-313" name="__codelineno-0-313"></a>            <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_size</span><span class="p">:</span>
<a id="__codelineno-0-314" name="__codelineno-0-314"></a>                <span class="n">frame_start</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_size</span><span class="p">)</span>
<a id="__codelineno-0-315" name="__codelineno-0-315"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-316" name="__codelineno-0-316"></a>                <span class="n">frame_start</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-317" name="__codelineno-0-317"></a>            <span class="n">frame_end</span> <span class="o">=</span> <span class="n">frame_start</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_size</span>
<a id="__codelineno-0-318" name="__codelineno-0-318"></a>            <span class="n">x</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">frame_start</span><span class="p">:</span><span class="n">frame_end</span><span class="p">,</span> <span class="n">lead_idx</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">frame_size</span><span class="p">,))</span>
<a id="__codelineno-0-319" name="__codelineno-0-319"></a>            <span class="k">yield</span> <span class="n">x</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="heartkit.datasets.qtdb.QtdbDataset.task_data_generator" class="doc doc-heading">
<code class="highlight language-python"><span class="n">task_data_generator</span><span class="p">(</span><span class="n">patient_generator</span><span class="p">,</span> <span class="n">samples_per_patient</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Task-level data generator.</p>

  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b>patient_generator</b>
            (<code><span title="heartkit.datasets.defines.PatientGenerator">PatientGenerator</span></code>)
        – <p>Patient data generator</p>
      </li>
      <li class="field-body">
        <b>samples_per_patient</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a> | <a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#list">list</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a>]</code>)
        – <h5 id="heartkit.datasets.qtdb.QtdbDataset.task_data_generator--samples-per-patient-defaults-to-1">samples per patient. Defaults to 1.</h5>
      </li>
  </ul>

  <p>Returns:</p>
  <ul>
      <li class="field-body">
<b>SampleGenerator</b>(            <code><span title="heartkit.datasets.defines.SampleGenerator">SampleGenerator</span></code>
)        – <p>Sample data generator</p>
      </li>
  </ul>

      <details class="quote">
        <summary>Source code in <code>heartkit/datasets/qtdb.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-194" name="__codelineno-0-194"></a><span class="k">def</span> <span class="nf">task_data_generator</span><span class="p">(</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a>    <span class="n">patient_generator</span><span class="p">:</span> <span class="n">PatientGenerator</span><span class="p">,</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a>    <span class="n">samples_per_patient</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SampleGenerator</span><span class="p">:</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Task-level data generator.</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a><span class="sd">        patient_generator (PatientGenerator): Patient data generator</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a><span class="sd">        samples_per_patient (int | list[int], optional): # samples per patient. Defaults to 1.</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a><span class="sd">        SampleGenerator: Sample data generator</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">task</span> <span class="o">==</span> <span class="n">HeartTask</span><span class="o">.</span><span class="n">segmentation</span><span class="p">:</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">segmentation_generator</span><span class="p">(</span>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a>            <span class="n">patient_generator</span><span class="o">=</span><span class="n">patient_generator</span><span class="p">,</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a>            <span class="n">samples_per_patient</span><span class="o">=</span><span class="n">samples_per_patient</span><span class="p">,</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a>        <span class="p">)</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a>    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="heartkit.datasets.qtdb.QtdbDataset.uniform_patient_generator" class="doc doc-heading">
<code class="highlight language-python"><span class="n">uniform_patient_generator</span><span class="p">(</span><span class="n">patient_ids</span><span class="p">,</span> <span class="n">repeat</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Yield data for each patient in the array.</p>

  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b>patient_ids</b>
            (<code>pt.<span title="pt.ArrayLike">ArrayLike</span></code>)
        – <p>Array of patient ids</p>
      </li>
      <li class="field-body">
        <b>repeat</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>)
        – <p>Whether to repeat generator. Defaults to True.</p>
      </li>
      <li class="field-body">
        <b>shuffle</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>)
        – <p>Whether to shuffle patient ids.. Defaults to True.</p>
      </li>
  </ul>

  <p>Returns:</p>
  <ul>
      <li class="field-body">
<b>PatientGenerator</b>(            <code><span title="heartkit.datasets.defines.PatientGenerator">PatientGenerator</span></code>
)        – <p>Patient generator</p>
      </li>
  </ul>

  <p>Yields:</p>
  <ul>
      <li class="field-body">
            <code><span title="heartkit.datasets.defines.PatientGenerator">PatientGenerator</span></code>
        – <p>Iterator[PatientGenerator]</p>
      </li>
  </ul>

      <details class="quote">
        <summary>Source code in <code>heartkit/datasets/qtdb.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-341">341</a></span>
<span class="normal"><a href="#__codelineno-0-342">342</a></span>
<span class="normal"><a href="#__codelineno-0-343">343</a></span>
<span class="normal"><a href="#__codelineno-0-344">344</a></span>
<span class="normal"><a href="#__codelineno-0-345">345</a></span>
<span class="normal"><a href="#__codelineno-0-346">346</a></span>
<span class="normal"><a href="#__codelineno-0-347">347</a></span>
<span class="normal"><a href="#__codelineno-0-348">348</a></span>
<span class="normal"><a href="#__codelineno-0-349">349</a></span>
<span class="normal"><a href="#__codelineno-0-350">350</a></span>
<span class="normal"><a href="#__codelineno-0-351">351</a></span>
<span class="normal"><a href="#__codelineno-0-352">352</a></span>
<span class="normal"><a href="#__codelineno-0-353">353</a></span>
<span class="normal"><a href="#__codelineno-0-354">354</a></span>
<span class="normal"><a href="#__codelineno-0-355">355</a></span>
<span class="normal"><a href="#__codelineno-0-356">356</a></span>
<span class="normal"><a href="#__codelineno-0-357">357</a></span>
<span class="normal"><a href="#__codelineno-0-358">358</a></span>
<span class="normal"><a href="#__codelineno-0-359">359</a></span>
<span class="normal"><a href="#__codelineno-0-360">360</a></span>
<span class="normal"><a href="#__codelineno-0-361">361</a></span>
<span class="normal"><a href="#__codelineno-0-362">362</a></span>
<span class="normal"><a href="#__codelineno-0-363">363</a></span>
<span class="normal"><a href="#__codelineno-0-364">364</a></span>
<span class="normal"><a href="#__codelineno-0-365">365</a></span>
<span class="normal"><a href="#__codelineno-0-366">366</a></span>
<span class="normal"><a href="#__codelineno-0-367">367</a></span>
<span class="normal"><a href="#__codelineno-0-368">368</a></span>
<span class="normal"><a href="#__codelineno-0-369">369</a></span>
<span class="normal"><a href="#__codelineno-0-370">370</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-341" name="__codelineno-0-341"></a><span class="k">def</span> <span class="nf">uniform_patient_generator</span><span class="p">(</span>
<a id="__codelineno-0-342" name="__codelineno-0-342"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-343" name="__codelineno-0-343"></a>    <span class="n">patient_ids</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">,</span>
<a id="__codelineno-0-344" name="__codelineno-0-344"></a>    <span class="n">repeat</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-345" name="__codelineno-0-345"></a>    <span class="n">shuffle</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-346" name="__codelineno-0-346"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PatientGenerator</span><span class="p">:</span>
<a id="__codelineno-0-347" name="__codelineno-0-347"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Yield data for each patient in the array.</span>
<a id="__codelineno-0-348" name="__codelineno-0-348"></a>
<a id="__codelineno-0-349" name="__codelineno-0-349"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-350" name="__codelineno-0-350"></a><span class="sd">        patient_ids (pt.ArrayLike): Array of patient ids</span>
<a id="__codelineno-0-351" name="__codelineno-0-351"></a><span class="sd">        repeat (bool, optional): Whether to repeat generator. Defaults to True.</span>
<a id="__codelineno-0-352" name="__codelineno-0-352"></a><span class="sd">        shuffle (bool, optional): Whether to shuffle patient ids.. Defaults to True.</span>
<a id="__codelineno-0-353" name="__codelineno-0-353"></a>
<a id="__codelineno-0-354" name="__codelineno-0-354"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-355" name="__codelineno-0-355"></a><span class="sd">        PatientGenerator: Patient generator</span>
<a id="__codelineno-0-356" name="__codelineno-0-356"></a>
<a id="__codelineno-0-357" name="__codelineno-0-357"></a><span class="sd">    Yields:</span>
<a id="__codelineno-0-358" name="__codelineno-0-358"></a><span class="sd">        Iterator[PatientGenerator]</span>
<a id="__codelineno-0-359" name="__codelineno-0-359"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-360" name="__codelineno-0-360"></a>    <span class="n">patient_ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">patient_ids</span><span class="p">)</span>
<a id="__codelineno-0-361" name="__codelineno-0-361"></a>    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
<a id="__codelineno-0-362" name="__codelineno-0-362"></a>        <span class="k">if</span> <span class="n">shuffle</span><span class="p">:</span>
<a id="__codelineno-0-363" name="__codelineno-0-363"></a>            <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">patient_ids</span><span class="p">)</span>
<a id="__codelineno-0-364" name="__codelineno-0-364"></a>        <span class="k">for</span> <span class="n">patient_id</span> <span class="ow">in</span> <span class="n">patient_ids</span><span class="p">:</span>
<a id="__codelineno-0-365" name="__codelineno-0-365"></a>            <span class="n">pt_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">patient_id</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-366" name="__codelineno-0-366"></a>            <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ds_path</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pt_key</span><span class="si">}</span><span class="s2">.h5&quot;</span><span class="p">),</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">h5</span><span class="p">:</span>
<a id="__codelineno-0-367" name="__codelineno-0-367"></a>                <span class="k">yield</span> <span class="n">patient_id</span><span class="p">,</span> <span class="n">h5</span>
<a id="__codelineno-0-368" name="__codelineno-0-368"></a>        <span class="c1"># END FOR</span>
<a id="__codelineno-0-369" name="__codelineno-0-369"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">repeat</span><span class="p">:</span>
<a id="__codelineno-0-370" name="__codelineno-0-370"></a>            <span class="k">break</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>




  </div>

  </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="heartkit.datasets.synthetic" class="doc doc-heading">
          <code>heartkit.datasets.synthetic</code>


</h2>

  <div class="doc doc-contents first">

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="heartkit.datasets.synthetic.SyntheticDataset" class="doc doc-heading">
        <code>SyntheticDataset</code>


</h3>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><span title="heartkit.datasets.dataset.HeartKitDataset">HeartKitDataset</span></code></p>

  
      <p>Synthetic dataset</p>


        <details class="quote">
          <summary>Source code in <code>heartkit/datasets/synthetic/synthetic_dataset.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-0-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-0-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-0-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-0-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-0-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-0-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-0-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-0-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-0-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-0-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-0-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-0-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-0-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-0-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-0-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-0-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-0-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-0-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-0-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-0-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-0-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-0-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-0-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-0-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-0-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-0-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-0-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-0-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-0-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-0-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-0-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-0-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-0-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-0-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-0-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-0-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-0-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-0-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-0-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-0-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-0-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-0-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-0-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-17" name="__codelineno-0-17"></a><span class="k">class</span> <span class="nc">SyntheticDataset</span><span class="p">(</span><span class="n">HeartKitDataset</span><span class="p">):</span>
<a id="__codelineno-0-18" name="__codelineno-0-18"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Synthetic dataset&quot;&quot;&quot;</span>
<a id="__codelineno-0-19" name="__codelineno-0-19"></a>
<a id="__codelineno-0-20" name="__codelineno-0-20"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a>        <span class="n">ds_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a>        <span class="n">task</span><span class="p">:</span> <span class="n">HeartTask</span> <span class="o">=</span> <span class="n">HeartTask</span><span class="o">.</span><span class="n">arrhythmia</span><span class="p">,</span>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a>        <span class="n">frame_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1250</span><span class="p">,</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a>        <span class="n">target_rate</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">250</span><span class="p">,</span>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a>        <span class="n">num_pts</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">250</span><span class="p">,</span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ds_path</span><span class="p">,</span> <span class="s2">&quot;synthetic&quot;</span><span class="p">),</span> <span class="n">task</span><span class="p">,</span> <span class="n">frame_size</span><span class="p">,</span> <span class="n">target_rate</span><span class="p">)</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_num_pts</span> <span class="o">=</span> <span class="n">num_pts</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a>    <span class="nd">@property</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a>    <span class="k">def</span> <span class="nf">cachable</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;If dataset supports file caching.&quot;&quot;&quot;</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a>        <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a>    <span class="nd">@property</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a>    <span class="k">def</span> <span class="nf">sampling_rate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Sampling rate in Hz&quot;&quot;&quot;</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_rate</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a>    <span class="nd">@property</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a>    <span class="k">def</span> <span class="nf">mean</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Dataset mean&quot;&quot;&quot;</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a>        <span class="k">return</span> <span class="mi">0</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a>    <span class="nd">@property</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a>    <span class="k">def</span> <span class="nf">std</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Dataset st dev&quot;&quot;&quot;</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a>        <span class="k">return</span> <span class="mi">1</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a>    <span class="nd">@property</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a>    <span class="k">def</span> <span class="nf">patient_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">:</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get dataset patient IDs</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="sd">            npt.NDArray: patient IDs</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_pts</span><span class="p">)</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a>    <span class="k">def</span> <span class="nf">get_train_patient_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">:</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get dataset training patient IDs</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="sd">            npt.NDArray: patient IDs</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>        <span class="n">numel</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">0.80</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_pts</span><span class="p">)</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">patient_ids</span><span class="p">[:</span><span class="n">numel</span><span class="p">]</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>    <span class="k">def</span> <span class="nf">get_test_patient_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">:</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get dataset patient IDs reserved for testing only</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a><span class="sd">            npt.NDArray: patient IDs</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a>        <span class="n">numel</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">0.80</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_pts</span><span class="p">)</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">patient_ids</span><span class="p">[</span><span class="n">numel</span><span class="p">:]</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a>    <span class="k">def</span> <span class="nf">task_data_generator</span><span class="p">(</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a>        <span class="n">patient_generator</span><span class="p">:</span> <span class="n">PatientGenerator</span><span class="p">,</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a>        <span class="n">samples_per_patient</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SampleGenerator</span><span class="p">:</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Task-level data generator.</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a><span class="sd">            patient_generator (PatientGenerator): Patient data generator</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a><span class="sd">            samples_per_patient (int | list[int], optional): # samples per patient. Defaults to 1.</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a><span class="sd">            SampleGenerator: Sample data generator</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">task</span> <span class="o">==</span> <span class="n">HeartTask</span><span class="o">.</span><span class="n">segmentation</span><span class="p">:</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">segmentation_generator</span><span class="p">(</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>                <span class="n">patient_generator</span><span class="o">=</span><span class="n">patient_generator</span><span class="p">,</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>                <span class="n">samples_per_patient</span><span class="o">=</span><span class="n">samples_per_patient</span><span class="p">,</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>            <span class="p">)</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>    <span class="k">def</span> <span class="nf">signal_generator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">patient_generator</span><span class="p">:</span> <span class="n">PatientGenerator</span><span class="p">,</span> <span class="n">samples_per_patient</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SampleGenerator</span><span class="p">:</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a><span class="sd">        Generate frames using patient generator.</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a><span class="sd">            patient_generator (PatientGenerator): Generator that yields a tuple of patient id and patient data.</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a><span class="sd">                    Patient data may contain only signals, since labels are not used.</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a><span class="sd">            samples_per_patient (int): Samples per patient.</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a><span class="sd">            SampleGenerator: Generator of input data of shape (frame_size, 1)</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>        <span class="n">start_offset</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>        <span class="n">num_leads</span> <span class="o">=</span> <span class="mi">12</span>  <span class="c1"># Use all 12 leads</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>        <span class="n">presets</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>            <span class="n">EcgPresets</span><span class="o">.</span><span class="n">SR</span><span class="p">,</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>            <span class="n">EcgPresets</span><span class="o">.</span><span class="n">LAHB</span><span class="p">,</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>            <span class="n">EcgPresets</span><span class="o">.</span><span class="n">LPHB</span><span class="p">,</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>            <span class="n">EcgPresets</span><span class="o">.</span><span class="n">LBBB</span><span class="p">,</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>            <span class="n">EcgPresets</span><span class="o">.</span><span class="n">ant_STEMI</span><span class="p">,</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>            <span class="n">EcgPresets</span><span class="o">.</span><span class="n">random_morphology</span><span class="p">,</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>            <span class="n">EcgPresets</span><span class="o">.</span><span class="n">high_take_off</span><span class="p">,</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>        <span class="p">)</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>        <span class="n">preset_weights</span> <span class="o">=</span> <span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">patient_generator</span><span class="p">:</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>            <span class="n">_</span><span class="p">,</span> <span class="n">syn_ecg</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">generate_nsr</span><span class="p">(</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>                <span class="n">leads</span><span class="o">=</span><span class="n">num_leads</span><span class="p">,</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>                <span class="n">signal_frequency</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sampling_rate</span><span class="p">,</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>                <span class="n">rate</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">120</span><span class="p">),</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>                <span class="n">preset</span><span class="o">=</span><span class="n">random</span><span class="o">.</span><span class="n">choices</span><span class="p">(</span><span class="n">presets</span><span class="p">,</span> <span class="n">preset_weights</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>                <span class="n">noise_multiplier</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">),</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>                <span class="n">impedance</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.60</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">),</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>                <span class="n">p_multiplier</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.60</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">),</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>                <span class="n">t_multiplier</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.60</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">),</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>                <span class="n">duration</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>                    <span class="mi">10</span><span class="p">,</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>                    <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frame_size</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampling_rate</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">samples_per_patient</span><span class="p">),</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>                <span class="p">),</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>                <span class="n">voltage_factor</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">275</span><span class="p">,</span> <span class="mi">325</span><span class="p">),</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>            <span class="p">)</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">samples_per_patient</span><span class="p">):</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>                <span class="c1"># Randomly pick an ECG lead and frame</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>                <span class="n">lead_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">syn_ecg</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>                <span class="n">frame_start</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">start_offset</span><span class="p">,</span> <span class="n">syn_ecg</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_size</span><span class="p">)</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>                <span class="n">frame_end</span> <span class="o">=</span> <span class="n">frame_start</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_size</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>                <span class="n">x</span> <span class="o">=</span> <span class="n">syn_ecg</span><span class="p">[</span><span class="n">lead_idx</span><span class="p">,</span> <span class="n">frame_start</span><span class="p">:</span><span class="n">frame_end</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">frame_size</span><span class="p">,))</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>                <span class="k">yield</span> <span class="n">x</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a>            <span class="c1"># END FOR</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>        <span class="c1"># END FOR</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>    <span class="k">def</span> <span class="nf">segmentation_generator</span><span class="p">(</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>        <span class="n">patient_generator</span><span class="p">:</span> <span class="n">PatientGenerator</span><span class="p">,</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a>        <span class="n">samples_per_patient</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SampleGenerator</span><span class="p">:</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate frames and segment labels.</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a><span class="sd">            patient_generator (PatientGenerator): Patient Generator</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a><span class="sd">            samples_per_patient (int | list[int], optional): # samples per patient. Defaults to 1.</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a><span class="sd">            SampleGenerator: Sample generator</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a><span class="sd">        Yields:</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a><span class="sd">            Iterator[SampleGenerator]</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>        <span class="n">start_offset</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>        <span class="n">num_leads</span> <span class="o">=</span> <span class="mi">12</span>  <span class="c1"># Use all 12 leads</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a>        <span class="n">presets</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>            <span class="n">EcgPresets</span><span class="o">.</span><span class="n">SR</span><span class="p">,</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a>            <span class="n">EcgPresets</span><span class="o">.</span><span class="n">LAHB</span><span class="p">,</span>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a>            <span class="n">EcgPresets</span><span class="o">.</span><span class="n">LPHB</span><span class="p">,</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a>            <span class="n">EcgPresets</span><span class="o">.</span><span class="n">LBBB</span><span class="p">,</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a>            <span class="n">EcgPresets</span><span class="o">.</span><span class="n">ant_STEMI</span><span class="p">,</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a>            <span class="n">EcgPresets</span><span class="o">.</span><span class="n">random_morphology</span><span class="p">,</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a>            <span class="n">EcgPresets</span><span class="o">.</span><span class="n">high_take_off</span><span class="p">,</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>        <span class="p">)</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a>        <span class="n">preset_weights</span> <span class="o">=</span> <span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">patient_generator</span><span class="p">:</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a>            <span class="n">_</span><span class="p">,</span> <span class="n">syn_ecg</span><span class="p">,</span> <span class="n">syn_segs_t</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">generate_nsr</span><span class="p">(</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a>                <span class="n">leads</span><span class="o">=</span><span class="n">num_leads</span><span class="p">,</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a>                <span class="n">signal_frequency</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sampling_rate</span><span class="p">,</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a>                <span class="n">rate</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">120</span><span class="p">),</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a>                <span class="n">preset</span><span class="o">=</span><span class="n">random</span><span class="o">.</span><span class="n">choices</span><span class="p">(</span><span class="n">presets</span><span class="p">,</span> <span class="n">preset_weights</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a>                <span class="n">noise_multiplier</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">),</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a>                <span class="n">impedance</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.60</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">),</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a>                <span class="n">p_multiplier</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.60</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">),</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a>                <span class="n">t_multiplier</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.60</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">),</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a>                <span class="n">duration</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a>                    <span class="mi">10</span><span class="p">,</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a>                    <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frame_size</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampling_rate</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">samples_per_patient</span> <span class="o">/</span> <span class="n">num_leads</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a>                <span class="p">),</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a>                <span class="n">voltage_factor</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">275</span><span class="p">,</span> <span class="mi">325</span><span class="p">),</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a>            <span class="p">)</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a>            <span class="n">syn_segs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">syn_segs_t</span><span class="p">)</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">syn_segs_t</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a>                <span class="n">syn_segs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">syn_segs_t</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">SyntheticSegments</span><span class="o">.</span><span class="n">tp_overlap</span><span class="p">))[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">HeartSegment</span><span class="o">.</span><span class="n">pwave</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a>                <span class="n">syn_segs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">syn_segs_t</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">SyntheticSegments</span><span class="o">.</span><span class="n">p_wave</span><span class="p">))[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">HeartSegment</span><span class="o">.</span><span class="n">pwave</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a>                <span class="n">syn_segs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">syn_segs_t</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">SyntheticSegments</span><span class="o">.</span><span class="n">qrs_complex</span><span class="p">))[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">HeartSegment</span><span class="o">.</span><span class="n">qrs</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a>                <span class="n">syn_segs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">syn_segs_t</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">SyntheticSegments</span><span class="o">.</span><span class="n">t_wave</span><span class="p">))[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">HeartSegment</span><span class="o">.</span><span class="n">twave</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a>            <span class="c1"># END FOR</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a>            <span class="c1"># # BELOW NEW</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a>            <span class="c1"># start_offset = int(0.55 * self.frame_size)</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a>            <span class="c1"># stop_offset = int(syn_ecg.shape[1] - 0.55 * self.frame_size)</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>            <span class="c1"># rfids = np.vstack(</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a>            <span class="c1">#     np.where((syn_fids_t == SyntheticFiducials.r_peak) | (syn_fids_t == SyntheticFiducials.rpr_peak))</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a>            <span class="c1"># ).T</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a>            <span class="c1"># rfids = rfids[(rfids[:, 1] &gt; start_offset) &amp; (rfids[:, 1] &lt; stop_offset)]</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a>            <span class="c1"># if rfids.shape[0] &lt;= 2:</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a>            <span class="c1">#     continue</span>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a>            <span class="c1"># np.random.shuffle(rfids)</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a>            <span class="c1"># for i in range(min(samples_per_patient, rfids.shape[0])):</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a>            <span class="c1">#     lead_idx = rfids[i, 0]</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a>            <span class="c1">#     frame_start = rfids[i, 1] - int(random.uniform(0.45, 0.55) * self.frame_size)</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a>            <span class="c1">#     frame_end = frame_start + self.frame_size</span>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a>            <span class="c1">#     if frame_end - frame_start &lt; self.frame_size:</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a>            <span class="c1">#         print(&quot;x&quot;)</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a>            <span class="c1">#         continue</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a>            <span class="c1">#     x = syn_ecg[lead_idx, frame_start:frame_end].astype(np.float32).reshape((self.frame_size,))</span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a>            <span class="c1">#     y = syn_segs[lead_idx, frame_start:frame_end].astype(np.int32)</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a>            <span class="c1">#     yield x, y</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a>            <span class="c1"># # END FOR</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a>            <span class="c1"># # ABOVE NEW</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">samples_per_patient</span><span class="p">):</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a>                <span class="c1"># Randomly pick an ECG lead and frame</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a>                <span class="n">lead_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">syn_ecg</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a>                <span class="n">frame_start</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">start_offset</span><span class="p">,</span> <span class="n">syn_ecg</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_size</span><span class="p">)</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a>                <span class="n">frame_end</span> <span class="o">=</span> <span class="n">frame_start</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_size</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a>                <span class="n">x</span> <span class="o">=</span> <span class="n">syn_ecg</span><span class="p">[</span><span class="n">lead_idx</span><span class="p">,</span> <span class="n">frame_start</span><span class="p">:</span><span class="n">frame_end</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a>                <span class="n">y</span> <span class="o">=</span> <span class="n">syn_segs</span><span class="p">[</span><span class="n">lead_idx</span><span class="p">,</span> <span class="n">frame_start</span><span class="p">:</span><span class="n">frame_end</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a>                <span class="k">yield</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a>            <span class="c1"># END FOR</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a>        <span class="c1"># END FOR</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a>    <span class="k">def</span> <span class="nf">uniform_patient_generator</span><span class="p">(</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a>        <span class="n">patient_ids</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">,</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a>        <span class="n">repeat</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a>        <span class="n">shuffle</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PatientGenerator</span><span class="p">:</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Yield data for each patient in the array.</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a><span class="sd">            patient_ids (pt.ArrayLike): Array of patient ids</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a><span class="sd">            repeat (bool, optional): Whether to repeat generator. Defaults to True.</span>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a><span class="sd">            shuffle (bool, optional): Whether to shuffle patient ids.. Defaults to True.</span>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a><span class="sd">            PatientGenerator: Patient generator</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a><span class="sd">        Yields:</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a><span class="sd">            Iterator[PatientGenerator]</span>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a>        <span class="n">patient_ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">patient_ids</span><span class="p">)</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a>        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a>            <span class="k">if</span> <span class="n">shuffle</span><span class="p">:</span>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a>                <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">patient_ids</span><span class="p">)</span>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a>            <span class="k">for</span> <span class="n">patient_id</span> <span class="ow">in</span> <span class="n">patient_ids</span><span class="p">:</span>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a>                <span class="k">yield</span> <span class="n">patient_id</span><span class="p">,</span> <span class="kc">None</span>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a>            <span class="c1"># END FOR</span>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">repeat</span><span class="p">:</span>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a>                <span class="k">break</span>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a>        <span class="c1"># END WHILE</span>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a>    <span class="k">def</span> <span class="nf">download</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_workers</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">force</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Download dataset</span>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a><span class="sd">            num_workers (int | None, optional): # parallel workers. Defaults to None.</span>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a><span class="sd">            force (bool, optional): Force redownload. Defaults to False.</span>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a><span class="sd">        &quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h4 id="heartkit.datasets.synthetic.synthetic_dataset.SyntheticDataset.cachable" class="doc doc-heading">
<code class="highlight language-python"><span class="n">cachable</span><span class="p">:</span> <span class="nb">bool</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h4>


  <div class="doc doc-contents ">
  
      <p>If dataset supports file caching.</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="heartkit.datasets.synthetic.synthetic_dataset.SyntheticDataset.mean" class="doc doc-heading">
<code class="highlight language-python"><span class="n">mean</span><span class="p">:</span> <span class="nb">float</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h4>


  <div class="doc doc-contents ">
  
      <p>Dataset mean</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="heartkit.datasets.synthetic.synthetic_dataset.SyntheticDataset.patient_ids" class="doc doc-heading">
<code class="highlight language-python"><span class="n">patient_ids</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h4>


  <div class="doc doc-contents ">
  
      <p>Get dataset patient IDs</p>

  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code><a class="autorefs autorefs-external" title="numpy" href="https://numpy.org/doc/stable/reference/index.html#module-numpy">npt</a>.<span title="numpy.NDArray">NDArray</span></code>
        – <p>npt.NDArray: patient IDs</p>
      </li>
  </ul>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="heartkit.datasets.synthetic.synthetic_dataset.SyntheticDataset.sampling_rate" class="doc doc-heading">
<code class="highlight language-python"><span class="n">sampling_rate</span><span class="p">:</span> <span class="nb">int</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h4>


  <div class="doc doc-contents ">
  
      <p>Sampling rate in Hz</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="heartkit.datasets.synthetic.synthetic_dataset.SyntheticDataset.std" class="doc doc-heading">
<code class="highlight language-python"><span class="n">std</span><span class="p">:</span> <span class="nb">float</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h4>


  <div class="doc doc-contents ">
  
      <p>Dataset st dev</p>
  </div>

</div>



<div class="doc doc-object doc-function">



<h4 id="heartkit.datasets.synthetic.synthetic_dataset.SyntheticDataset.download" class="doc doc-heading">
<code class="highlight language-python"><span class="n">download</span><span class="p">(</span><span class="n">num_workers</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Download dataset</p>

  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b>num_workers</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a> | None</code>)
        – <h5 id="heartkit.datasets.synthetic.synthetic_dataset.SyntheticDataset.download--parallel-workers-defaults-to-none">parallel workers. Defaults to None.</h5>
      </li>
      <li class="field-body">
        <b>force</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>)
        – <p>Force redownload. Defaults to False.</p>
      </li>
  </ul>

      <details class="quote">
        <summary>Source code in <code>heartkit/datasets/synthetic/synthetic_dataset.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-265" name="__codelineno-0-265"></a><span class="k">def</span> <span class="nf">download</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_workers</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">force</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Download dataset</span>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a><span class="sd">        num_workers (int | None, optional): # parallel workers. Defaults to None.</span>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a><span class="sd">        force (bool, optional): Force redownload. Defaults to False.</span>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a><span class="sd">    &quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="heartkit.datasets.synthetic.synthetic_dataset.SyntheticDataset.get_test_patient_ids" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_test_patient_ids</span><span class="p">()</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Get dataset patient IDs reserved for testing only</p>

  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code><a class="autorefs autorefs-external" title="numpy" href="https://numpy.org/doc/stable/reference/index.html#module-numpy">npt</a>.<span title="numpy.NDArray">NDArray</span></code>
        – <p>npt.NDArray: patient IDs</p>
      </li>
  </ul>

      <details class="quote">
        <summary>Source code in <code>heartkit/datasets/synthetic/synthetic_dataset.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-69">69</a></span>
<span class="normal"><a href="#__codelineno-0-70">70</a></span>
<span class="normal"><a href="#__codelineno-0-71">71</a></span>
<span class="normal"><a href="#__codelineno-0-72">72</a></span>
<span class="normal"><a href="#__codelineno-0-73">73</a></span>
<span class="normal"><a href="#__codelineno-0-74">74</a></span>
<span class="normal"><a href="#__codelineno-0-75">75</a></span>
<span class="normal"><a href="#__codelineno-0-76">76</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-69" name="__codelineno-0-69"></a><span class="k">def</span> <span class="nf">get_test_patient_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">:</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get dataset patient IDs reserved for testing only</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a><span class="sd">        npt.NDArray: patient IDs</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a>    <span class="n">numel</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">0.80</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_pts</span><span class="p">)</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">patient_ids</span><span class="p">[</span><span class="n">numel</span><span class="p">:]</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="heartkit.datasets.synthetic.synthetic_dataset.SyntheticDataset.get_train_patient_ids" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_train_patient_ids</span><span class="p">()</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Get dataset training patient IDs</p>

  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code><a class="autorefs autorefs-external" title="numpy" href="https://numpy.org/doc/stable/reference/index.html#module-numpy">npt</a>.<span title="numpy.NDArray">NDArray</span></code>
        – <p>npt.NDArray: patient IDs</p>
      </li>
  </ul>

      <details class="quote">
        <summary>Source code in <code>heartkit/datasets/synthetic/synthetic_dataset.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span>
<span class="normal"><a href="#__codelineno-0-64">64</a></span>
<span class="normal"><a href="#__codelineno-0-65">65</a></span>
<span class="normal"><a href="#__codelineno-0-66">66</a></span>
<span class="normal"><a href="#__codelineno-0-67">67</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="k">def</span> <span class="nf">get_train_patient_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">:</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get dataset training patient IDs</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="sd">        npt.NDArray: patient IDs</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>    <span class="n">numel</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">0.80</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_pts</span><span class="p">)</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">patient_ids</span><span class="p">[:</span><span class="n">numel</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="heartkit.datasets.synthetic.synthetic_dataset.SyntheticDataset.segmentation_generator" class="doc doc-heading">
<code class="highlight language-python"><span class="n">segmentation_generator</span><span class="p">(</span><span class="n">patient_generator</span><span class="p">,</span> <span class="n">samples_per_patient</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Generate frames and segment labels.</p>

  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b>patient_generator</b>
            (<code><span title="heartkit.datasets.defines.PatientGenerator">PatientGenerator</span></code>)
        – <p>Patient Generator</p>
      </li>
      <li class="field-body">
        <b>samples_per_patient</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a> | <a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#list">list</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a>]</code>)
        – <h5 id="heartkit.datasets.synthetic.synthetic_dataset.SyntheticDataset.segmentation_generator--samples-per-patient-defaults-to-1">samples per patient. Defaults to 1.</h5>
      </li>
  </ul>

  <p>Returns:</p>
  <ul>
      <li class="field-body">
<b>SampleGenerator</b>(            <code><span title="heartkit.datasets.defines.SampleGenerator">SampleGenerator</span></code>
)        – <p>Sample generator</p>
      </li>
  </ul>

  <p>Yields:</p>
  <ul>
      <li class="field-body">
            <code><span title="heartkit.datasets.defines.SampleGenerator">SampleGenerator</span></code>
        – <p>Iterator[SampleGenerator]</p>
      </li>
  </ul>

      <details class="quote">
        <summary>Source code in <code>heartkit/datasets/synthetic/synthetic_dataset.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-149" name="__codelineno-0-149"></a><span class="k">def</span> <span class="nf">segmentation_generator</span><span class="p">(</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>    <span class="n">patient_generator</span><span class="p">:</span> <span class="n">PatientGenerator</span><span class="p">,</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a>    <span class="n">samples_per_patient</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SampleGenerator</span><span class="p">:</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate frames and segment labels.</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a><span class="sd">        patient_generator (PatientGenerator): Patient Generator</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a><span class="sd">        samples_per_patient (int | list[int], optional): # samples per patient. Defaults to 1.</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a><span class="sd">        SampleGenerator: Sample generator</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a><span class="sd">    Yields:</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a><span class="sd">        Iterator[SampleGenerator]</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>    <span class="n">start_offset</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>    <span class="n">num_leads</span> <span class="o">=</span> <span class="mi">12</span>  <span class="c1"># Use all 12 leads</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a>    <span class="n">presets</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>        <span class="n">EcgPresets</span><span class="o">.</span><span class="n">SR</span><span class="p">,</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a>        <span class="n">EcgPresets</span><span class="o">.</span><span class="n">LAHB</span><span class="p">,</span>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a>        <span class="n">EcgPresets</span><span class="o">.</span><span class="n">LPHB</span><span class="p">,</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a>        <span class="n">EcgPresets</span><span class="o">.</span><span class="n">LBBB</span><span class="p">,</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a>        <span class="n">EcgPresets</span><span class="o">.</span><span class="n">ant_STEMI</span><span class="p">,</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a>        <span class="n">EcgPresets</span><span class="o">.</span><span class="n">random_morphology</span><span class="p">,</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a>        <span class="n">EcgPresets</span><span class="o">.</span><span class="n">high_take_off</span><span class="p">,</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>    <span class="p">)</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a>    <span class="n">preset_weights</span> <span class="o">=</span> <span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">patient_generator</span><span class="p">:</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a>        <span class="n">_</span><span class="p">,</span> <span class="n">syn_ecg</span><span class="p">,</span> <span class="n">syn_segs_t</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">generate_nsr</span><span class="p">(</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a>            <span class="n">leads</span><span class="o">=</span><span class="n">num_leads</span><span class="p">,</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a>            <span class="n">signal_frequency</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sampling_rate</span><span class="p">,</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a>            <span class="n">rate</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">120</span><span class="p">),</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a>            <span class="n">preset</span><span class="o">=</span><span class="n">random</span><span class="o">.</span><span class="n">choices</span><span class="p">(</span><span class="n">presets</span><span class="p">,</span> <span class="n">preset_weights</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a>            <span class="n">noise_multiplier</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">),</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a>            <span class="n">impedance</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.60</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">),</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a>            <span class="n">p_multiplier</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.60</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">),</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a>            <span class="n">t_multiplier</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.60</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">),</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a>            <span class="n">duration</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a>                <span class="mi">10</span><span class="p">,</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a>                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frame_size</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampling_rate</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">samples_per_patient</span> <span class="o">/</span> <span class="n">num_leads</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a>            <span class="p">),</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a>            <span class="n">voltage_factor</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">275</span><span class="p">,</span> <span class="mi">325</span><span class="p">),</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a>        <span class="p">)</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a>        <span class="n">syn_segs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">syn_segs_t</span><span class="p">)</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">syn_segs_t</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a>            <span class="n">syn_segs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">syn_segs_t</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">SyntheticSegments</span><span class="o">.</span><span class="n">tp_overlap</span><span class="p">))[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">HeartSegment</span><span class="o">.</span><span class="n">pwave</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a>            <span class="n">syn_segs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">syn_segs_t</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">SyntheticSegments</span><span class="o">.</span><span class="n">p_wave</span><span class="p">))[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">HeartSegment</span><span class="o">.</span><span class="n">pwave</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a>            <span class="n">syn_segs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">syn_segs_t</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">SyntheticSegments</span><span class="o">.</span><span class="n">qrs_complex</span><span class="p">))[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">HeartSegment</span><span class="o">.</span><span class="n">qrs</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a>            <span class="n">syn_segs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">syn_segs_t</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">SyntheticSegments</span><span class="o">.</span><span class="n">t_wave</span><span class="p">))[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">HeartSegment</span><span class="o">.</span><span class="n">twave</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a>        <span class="c1"># END FOR</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a>        <span class="c1"># # BELOW NEW</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a>        <span class="c1"># start_offset = int(0.55 * self.frame_size)</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a>        <span class="c1"># stop_offset = int(syn_ecg.shape[1] - 0.55 * self.frame_size)</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>        <span class="c1"># rfids = np.vstack(</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a>        <span class="c1">#     np.where((syn_fids_t == SyntheticFiducials.r_peak) | (syn_fids_t == SyntheticFiducials.rpr_peak))</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a>        <span class="c1"># ).T</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a>        <span class="c1"># rfids = rfids[(rfids[:, 1] &gt; start_offset) &amp; (rfids[:, 1] &lt; stop_offset)]</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a>        <span class="c1"># if rfids.shape[0] &lt;= 2:</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a>        <span class="c1">#     continue</span>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a>        <span class="c1"># np.random.shuffle(rfids)</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a>        <span class="c1"># for i in range(min(samples_per_patient, rfids.shape[0])):</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a>        <span class="c1">#     lead_idx = rfids[i, 0]</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a>        <span class="c1">#     frame_start = rfids[i, 1] - int(random.uniform(0.45, 0.55) * self.frame_size)</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a>        <span class="c1">#     frame_end = frame_start + self.frame_size</span>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a>        <span class="c1">#     if frame_end - frame_start &lt; self.frame_size:</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a>        <span class="c1">#         print(&quot;x&quot;)</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a>        <span class="c1">#         continue</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a>        <span class="c1">#     x = syn_ecg[lead_idx, frame_start:frame_end].astype(np.float32).reshape((self.frame_size,))</span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a>        <span class="c1">#     y = syn_segs[lead_idx, frame_start:frame_end].astype(np.int32)</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a>        <span class="c1">#     yield x, y</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a>        <span class="c1"># # END FOR</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a>        <span class="c1"># # ABOVE NEW</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">samples_per_patient</span><span class="p">):</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a>            <span class="c1"># Randomly pick an ECG lead and frame</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a>            <span class="n">lead_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">syn_ecg</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a>            <span class="n">frame_start</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">start_offset</span><span class="p">,</span> <span class="n">syn_ecg</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_size</span><span class="p">)</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a>            <span class="n">frame_end</span> <span class="o">=</span> <span class="n">frame_start</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_size</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a>            <span class="n">x</span> <span class="o">=</span> <span class="n">syn_ecg</span><span class="p">[</span><span class="n">lead_idx</span><span class="p">,</span> <span class="n">frame_start</span><span class="p">:</span><span class="n">frame_end</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a>            <span class="n">y</span> <span class="o">=</span> <span class="n">syn_segs</span><span class="p">[</span><span class="n">lead_idx</span><span class="p">,</span> <span class="n">frame_start</span><span class="p">:</span><span class="n">frame_end</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a>            <span class="k">yield</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="heartkit.datasets.synthetic.synthetic_dataset.SyntheticDataset.signal_generator" class="doc doc-heading">
<code class="highlight language-python"><span class="n">signal_generator</span><span class="p">(</span><span class="n">patient_generator</span><span class="p">,</span> <span class="n">samples_per_patient</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Generate frames using patient generator.</p>

  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b>patient_generator</b>
            (<code><span title="heartkit.datasets.defines.PatientGenerator">PatientGenerator</span></code>)
        – <p>Generator that yields a tuple of patient id and patient data.
    Patient data may contain only signals, since labels are not used.</p>
      </li>
      <li class="field-body">
        <b>samples_per_patient</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code>)
        – <p>Samples per patient.</p>
      </li>
  </ul>

  <p>Returns:</p>
  <ul>
      <li class="field-body">
<b>SampleGenerator</b>(            <code><span title="heartkit.datasets.defines.SampleGenerator">SampleGenerator</span></code>
)        – <p>Generator of input data of shape (frame_size, 1)</p>
      </li>
  </ul>

      <details class="quote">
        <summary>Source code in <code>heartkit/datasets/synthetic/synthetic_dataset.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-99" name="__codelineno-0-99"></a><span class="k">def</span> <span class="nf">signal_generator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">patient_generator</span><span class="p">:</span> <span class="n">PatientGenerator</span><span class="p">,</span> <span class="n">samples_per_patient</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SampleGenerator</span><span class="p">:</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a><span class="sd">    Generate frames using patient generator.</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a><span class="sd">        patient_generator (PatientGenerator): Generator that yields a tuple of patient id and patient data.</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a><span class="sd">                Patient data may contain only signals, since labels are not used.</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a><span class="sd">        samples_per_patient (int): Samples per patient.</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a><span class="sd">        SampleGenerator: Generator of input data of shape (frame_size, 1)</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>    <span class="n">start_offset</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>    <span class="n">num_leads</span> <span class="o">=</span> <span class="mi">12</span>  <span class="c1"># Use all 12 leads</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>    <span class="n">presets</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>        <span class="n">EcgPresets</span><span class="o">.</span><span class="n">SR</span><span class="p">,</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>        <span class="n">EcgPresets</span><span class="o">.</span><span class="n">LAHB</span><span class="p">,</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>        <span class="n">EcgPresets</span><span class="o">.</span><span class="n">LPHB</span><span class="p">,</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>        <span class="n">EcgPresets</span><span class="o">.</span><span class="n">LBBB</span><span class="p">,</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>        <span class="n">EcgPresets</span><span class="o">.</span><span class="n">ant_STEMI</span><span class="p">,</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>        <span class="n">EcgPresets</span><span class="o">.</span><span class="n">random_morphology</span><span class="p">,</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>        <span class="n">EcgPresets</span><span class="o">.</span><span class="n">high_take_off</span><span class="p">,</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>    <span class="p">)</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>    <span class="n">preset_weights</span> <span class="o">=</span> <span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">patient_generator</span><span class="p">:</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>        <span class="n">_</span><span class="p">,</span> <span class="n">syn_ecg</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">generate_nsr</span><span class="p">(</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>            <span class="n">leads</span><span class="o">=</span><span class="n">num_leads</span><span class="p">,</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>            <span class="n">signal_frequency</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sampling_rate</span><span class="p">,</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>            <span class="n">rate</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">120</span><span class="p">),</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>            <span class="n">preset</span><span class="o">=</span><span class="n">random</span><span class="o">.</span><span class="n">choices</span><span class="p">(</span><span class="n">presets</span><span class="p">,</span> <span class="n">preset_weights</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>            <span class="n">noise_multiplier</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">),</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>            <span class="n">impedance</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.60</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">),</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>            <span class="n">p_multiplier</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.60</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">),</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>            <span class="n">t_multiplier</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.60</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">),</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>            <span class="n">duration</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>                <span class="mi">10</span><span class="p">,</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frame_size</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampling_rate</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">samples_per_patient</span><span class="p">),</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>            <span class="p">),</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>            <span class="n">voltage_factor</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">275</span><span class="p">,</span> <span class="mi">325</span><span class="p">),</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>        <span class="p">)</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">samples_per_patient</span><span class="p">):</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>            <span class="c1"># Randomly pick an ECG lead and frame</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>            <span class="n">lead_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">syn_ecg</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>            <span class="n">frame_start</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">start_offset</span><span class="p">,</span> <span class="n">syn_ecg</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_size</span><span class="p">)</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>            <span class="n">frame_end</span> <span class="o">=</span> <span class="n">frame_start</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_size</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>            <span class="n">x</span> <span class="o">=</span> <span class="n">syn_ecg</span><span class="p">[</span><span class="n">lead_idx</span><span class="p">,</span> <span class="n">frame_start</span><span class="p">:</span><span class="n">frame_end</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">frame_size</span><span class="p">,))</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>            <span class="k">yield</span> <span class="n">x</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="heartkit.datasets.synthetic.synthetic_dataset.SyntheticDataset.task_data_generator" class="doc doc-heading">
<code class="highlight language-python"><span class="n">task_data_generator</span><span class="p">(</span><span class="n">patient_generator</span><span class="p">,</span> <span class="n">samples_per_patient</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Task-level data generator.</p>

  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b>patient_generator</b>
            (<code><span title="heartkit.datasets.defines.PatientGenerator">PatientGenerator</span></code>)
        – <p>Patient data generator</p>
      </li>
      <li class="field-body">
        <b>samples_per_patient</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a> | <a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#list">list</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a>]</code>)
        – <h5 id="heartkit.datasets.synthetic.synthetic_dataset.SyntheticDataset.task_data_generator--samples-per-patient-defaults-to-1">samples per patient. Defaults to 1.</h5>
      </li>
  </ul>

  <p>Returns:</p>
  <ul>
      <li class="field-body">
<b>SampleGenerator</b>(            <code><span title="heartkit.datasets.defines.SampleGenerator">SampleGenerator</span></code>
)        – <p>Sample data generator</p>
      </li>
  </ul>

      <details class="quote">
        <summary>Source code in <code>heartkit/datasets/synthetic/synthetic_dataset.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-78">78</a></span>
<span class="normal"><a href="#__codelineno-0-79">79</a></span>
<span class="normal"><a href="#__codelineno-0-80">80</a></span>
<span class="normal"><a href="#__codelineno-0-81">81</a></span>
<span class="normal"><a href="#__codelineno-0-82">82</a></span>
<span class="normal"><a href="#__codelineno-0-83">83</a></span>
<span class="normal"><a href="#__codelineno-0-84">84</a></span>
<span class="normal"><a href="#__codelineno-0-85">85</a></span>
<span class="normal"><a href="#__codelineno-0-86">86</a></span>
<span class="normal"><a href="#__codelineno-0-87">87</a></span>
<span class="normal"><a href="#__codelineno-0-88">88</a></span>
<span class="normal"><a href="#__codelineno-0-89">89</a></span>
<span class="normal"><a href="#__codelineno-0-90">90</a></span>
<span class="normal"><a href="#__codelineno-0-91">91</a></span>
<span class="normal"><a href="#__codelineno-0-92">92</a></span>
<span class="normal"><a href="#__codelineno-0-93">93</a></span>
<span class="normal"><a href="#__codelineno-0-94">94</a></span>
<span class="normal"><a href="#__codelineno-0-95">95</a></span>
<span class="normal"><a href="#__codelineno-0-96">96</a></span>
<span class="normal"><a href="#__codelineno-0-97">97</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="k">def</span> <span class="nf">task_data_generator</span><span class="p">(</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a>    <span class="n">patient_generator</span><span class="p">:</span> <span class="n">PatientGenerator</span><span class="p">,</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a>    <span class="n">samples_per_patient</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SampleGenerator</span><span class="p">:</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Task-level data generator.</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a><span class="sd">        patient_generator (PatientGenerator): Patient data generator</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a><span class="sd">        samples_per_patient (int | list[int], optional): # samples per patient. Defaults to 1.</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a><span class="sd">        SampleGenerator: Sample data generator</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">task</span> <span class="o">==</span> <span class="n">HeartTask</span><span class="o">.</span><span class="n">segmentation</span><span class="p">:</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">segmentation_generator</span><span class="p">(</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>            <span class="n">patient_generator</span><span class="o">=</span><span class="n">patient_generator</span><span class="p">,</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>            <span class="n">samples_per_patient</span><span class="o">=</span><span class="n">samples_per_patient</span><span class="p">,</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>        <span class="p">)</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="heartkit.datasets.synthetic.synthetic_dataset.SyntheticDataset.uniform_patient_generator" class="doc doc-heading">
<code class="highlight language-python"><span class="n">uniform_patient_generator</span><span class="p">(</span><span class="n">patient_ids</span><span class="p">,</span> <span class="n">repeat</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Yield data for each patient in the array.</p>

  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b>patient_ids</b>
            (<code>pt.<span title="pt.ArrayLike">ArrayLike</span></code>)
        – <p>Array of patient ids</p>
      </li>
      <li class="field-body">
        <b>repeat</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>)
        – <p>Whether to repeat generator. Defaults to True.</p>
      </li>
      <li class="field-body">
        <b>shuffle</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>)
        – <p>Whether to shuffle patient ids.. Defaults to True.</p>
      </li>
  </ul>

  <p>Returns:</p>
  <ul>
      <li class="field-body">
<b>PatientGenerator</b>(            <code><span title="heartkit.datasets.defines.PatientGenerator">PatientGenerator</span></code>
)        – <p>Patient generator</p>
      </li>
  </ul>

  <p>Yields:</p>
  <ul>
      <li class="field-body">
            <code><span title="heartkit.datasets.defines.PatientGenerator">PatientGenerator</span></code>
        – <p>Iterator[PatientGenerator]</p>
      </li>
  </ul>

      <details class="quote">
        <summary>Source code in <code>heartkit/datasets/synthetic/synthetic_dataset.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-235" name="__codelineno-0-235"></a><span class="k">def</span> <span class="nf">uniform_patient_generator</span><span class="p">(</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a>    <span class="n">patient_ids</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">,</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a>    <span class="n">repeat</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a>    <span class="n">shuffle</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PatientGenerator</span><span class="p">:</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Yield data for each patient in the array.</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a><span class="sd">        patient_ids (pt.ArrayLike): Array of patient ids</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a><span class="sd">        repeat (bool, optional): Whether to repeat generator. Defaults to True.</span>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a><span class="sd">        shuffle (bool, optional): Whether to shuffle patient ids.. Defaults to True.</span>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a><span class="sd">        PatientGenerator: Patient generator</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a><span class="sd">    Yields:</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a><span class="sd">        Iterator[PatientGenerator]</span>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a>    <span class="n">patient_ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">patient_ids</span><span class="p">)</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a>    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a>        <span class="k">if</span> <span class="n">shuffle</span><span class="p">:</span>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a>            <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">patient_ids</span><span class="p">)</span>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a>        <span class="k">for</span> <span class="n">patient_id</span> <span class="ow">in</span> <span class="n">patient_ids</span><span class="p">:</span>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a>            <span class="k">yield</span> <span class="n">patient_id</span><span class="p">,</span> <span class="kc">None</span>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a>        <span class="c1"># END FOR</span>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">repeat</span><span class="p">:</span>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a>            <span class="k">break</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>




  </div>

  </div>

</div>





                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2023 Ambiq
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["content.tabs.link"], "search": "../../assets/javascripts/workers/search.74e28a9f.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.220ee61c.min.js"></script>
      
        
          <script src="../../js/termynal.js"></script>
        
      
        
          <script src="../../js/custom.js"></script>
        
      
    
  </body>
</html>